---
phase: 27.1-post-phase-bugfixes
plan: 03
type: execute
wave: 2
depends_on: ["27.1-01"]
files_modified:
  - src/services/export/cssGenerator.ts
  - src/services/export/htmlGenerator.ts
autonomous: true

must_haves:
  truths:
    - "Crossfade Slider shows A/B gradient track in HTML preview"
    - "LED Ring renders centered and correctly in HTML preview"
    - "All professional meters render correctly in HTML preview"
  artifacts:
    - path: "src/services/export/cssGenerator.ts"
      provides: "Fixed CSS for crossfade slider, LED ring, and meters"
    - path: "src/services/export/htmlGenerator.ts"
      provides: "Fixed HTML structure for crossfade slider, LED ring, and meters"
  key_links:
    - from: "src/services/export/cssGenerator.ts"
      to: "HTML preview"
      via: "generateCSS function"
      pattern: "crossfadeslider|ledring|meter"
---

<objective>
Fix BUG-01, BUG-05, and BUG-06: HTML export/preview rendering issues for sliders, LEDs, and meters

**BUG-01 (Crossfade Slider track):**
The crossfade slider track should show an A/B gradient (typically left side one color, right side another). The CSS generator may be missing the gradient background.

**BUG-05 (LED Ring positioning):**
LED Ring is not centered in its frame and renders incorrectly. The HTML/CSS export likely has positioning or sizing calculation issues.

**BUG-06 (Professional meters):**
All new professional meters (RMS, VU, PPM, LUFS, K-System, etc.) don't render correctly in preview. The HTML/CSS generators may be missing cases or have incorrect structure.

Purpose: Fix HTML export rendering to match canvas appearance
Output: Correct HTML preview for crossfade sliders, LED rings, and all professional meters
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/services/export/cssGenerator.ts (lines 1050-1200 for crossfade/slider CSS)
@src/services/export/htmlGenerator.ts (lines 820-900 for crossfade HTML)
@src/components/elements/renderers/controls/CrossfadeSliderRenderer.tsx
@src/components/elements/renderers/displays/LEDRingRenderer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Crossfade Slider track gradient in export</name>
  <files>src/services/export/cssGenerator.ts, src/services/export/htmlGenerator.ts</files>
  <action>
Compare the CrossfadeSliderRenderer canvas implementation with the CSS/HTML export:

1. Read the CrossfadeSliderRenderer.tsx to understand the track gradient rendering
2. Check cssGenerator.ts for the crossfadeslider case (around line 1060-1090)
3. Check htmlGenerator.ts for the crossfade HTML structure (around line 823-845)

The crossfade slider track should have a gradient showing A label on left (typically one color) and B label on right (another color). Update the CSS to include:

```css
${selector} .slider-track {
  background: linear-gradient(to right, ${element.labelAColor || '#666'}, ${element.labelBColor || '#666'});
  /* ... other properties */
}
```

Also ensure the HTML structure matches what the renderer expects:
- Track element with gradient background
- Thumb element positioned correctly
- A/B labels if configured

Verify by comparing renderer JSX output with generated HTML structure.
  </action>
  <verify>
1. Add a Crossfade Slider to canvas
2. Click Preview to open HTML export
3. Crossfade slider should show track with gradient (not solid color)
  </verify>
  <done>Crossfade Slider preview shows A/B gradient track matching canvas appearance</done>
</task>

<task type="auto">
  <name>Task 2: Fix LED Ring centering and rendering in export</name>
  <files>src/services/export/cssGenerator.ts, src/services/export/htmlGenerator.ts</files>
  <action>
Compare LEDRingRenderer.tsx with the HTML/CSS export:

1. Read LEDRingRenderer.tsx to understand the SVG-based LED ring rendering
2. Check the generateLedRingCSS function (around line 2249)
3. Check generateLedRingHTML function (around line 1813)

The LED ring uses SVG with dashed stroke to create discrete segments. Issues may include:
- SVG viewBox not matching element dimensions
- Centering calculations off
- Stroke width or dash array incorrect

Ensure the exported HTML/CSS:
- Uses correct SVG viewBox based on element width/height
- Centers the SVG circle within the container
- Has correct stroke-dasharray and stroke-dashoffset for segment count
- Preserves the innerRadius and outerRadius relationship

The LED ring should be centered using flexbox or absolute positioning with transform.
  </action>
  <verify>
1. Add an LED Ring to canvas
2. Click Preview to open HTML export
3. LED Ring should be centered in its bounding box
4. Segments should appear as discrete LEDs in a circle
  </verify>
  <done>LED Ring preview renders centered with correct segment appearance</done>
</task>

<task type="auto">
  <name>Task 3: Fix professional meter rendering in export</name>
  <files>src/services/export/cssGenerator.ts, src/services/export/htmlGenerator.ts</files>
  <action>
Investigate why professional meters (RMS, VU, PPM, LUFS, K-System) don't render correctly:

1. Check if all meter type cases are handled in the switch statements:
   - cssGenerator.ts should have cases for: rmsmetermo, rmsmeterstereo, vumetermono, vumeterstereo, ppmtype1mono, ppmtype1stereo, ppmtype2mono, ppmtype2stereo, truepeakmetermono, truepeakmeterstereo, lufsmomomo, lufsmomostereo, lufsshortmono, lufsshortstereo, lufsintmono, lufsintstereo, k12metermono, k12meterstereo, k14metermono, k14meterstereo, k20metermono, k20meterstereo, correlationmeter, stereowidthmeter

2. Search for existing meter CSS/HTML generation functions (likely a shared helper)

3. If cases are missing, add them. If they exist, compare with the canvas renderer to identify CSS/HTML mismatches.

Common issues:
- CSS Grid for segments may use incorrect gap or segment sizes
- Color zone boundaries may be miscalculated
- Peak hold indicator styling missing
- Stereo wrapper flex layout incorrect

Focus on getting at least one meter type (e.g., RMS Meter) rendering correctly first, then apply pattern to others.
  </action>
  <verify>
1. Add an RMS Meter (mono) to canvas
2. Click Preview - meter should show segmented bar with color zones
3. Add a VU Meter (stereo) - should show two channels with correct spacing
4. Add a Correlation Meter - should show horizontal bar with center marker
  </verify>
  <done>All professional meter types render correctly in HTML preview with segments, color zones, and proper layout</done>
</task>

</tasks>

<verification>
1. Run `npm run dev`, add Crossfade Slider, LED Ring, RMS Meter to canvas
2. Click Preview button to open HTML export
3. Crossfade slider: track shows gradient between A and B sides
4. LED Ring: centered in frame, shows discrete LED segments in circular arrangement
5. RMS Meter: shows segmented bar with green/yellow/red color zones
6. Add stereo meter variant - two channels display side by side
7. Add Correlation Meter - horizontal bar with -1 to +1 range and center marker
</verification>

<success_criteria>
- Crossfade Slider track shows A/B gradient in preview
- LED Ring is visually centered and segments appear correctly
- All 24 professional meter types render in preview (segmented bars, color zones, peak hold)
- Stereo variants show two channels with proper spacing
- Analysis meters (Correlation, Stereo Width) show horizontal bar layout
</success_criteria>

<output>
After completion, create `.planning/phases/27.1-post-phase-bugfixes/27.1-03-SUMMARY.md`
</output>
