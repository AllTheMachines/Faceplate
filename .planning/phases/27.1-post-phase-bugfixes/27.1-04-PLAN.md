---
phase: 27.1-post-phase-bugfixes
plan: 04
type: execute
wave: 2
depends_on: []
files_modified:
  - src/services/export/cssGenerator.ts
  - src/services/export/htmlGenerator.ts
autonomous: true

must_haves:
  truths:
    - "Rocker Switch preview matches canvas appearance"
    - "Rotary Switch preview matches canvas appearance"
    - "Button fonts are consistent between canvas and preview"
  artifacts:
    - path: "src/services/export/cssGenerator.ts"
      provides: "Fixed CSS for rocker switch, rotary switch, and buttons"
    - path: "src/services/export/htmlGenerator.ts"
      provides: "Fixed HTML structure for switches"
  key_links:
    - from: "src/services/export/cssGenerator.ts"
      to: "Switch renderers"
      via: "generateRockerSwitchCSS, generateRotarySwitchCSS"
      pattern: "rockerswitch|rotaryswitch"
---

<objective>
Fix BUG-02, BUG-03, and BUG-04: Switch styling and button font mismatches in preview

**BUG-02 (Rocker Switch):**
The rocker switch looks different in HTML preview compared to canvas. The CSS generator may have incorrect styling for the 3-position switch (up/center/down).

**BUG-03 (Rotary Switch):**
The rotary switch looks different in preview. The vintage rotating selector with position labels may have incorrect CSS for the dial, pointer, or label positioning.

**BUG-04 (Button fonts):**
Some buttons have different fonts in preview vs canvas. The font-family CSS property may be missing or not inheriting correctly.

Purpose: Ensure switch and button elements match between canvas and HTML preview
Output: Consistent visual appearance for switches and buttons in both views
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/services/export/cssGenerator.ts (lines 1641-1800 for switch CSS)
@src/components/elements/renderers/controls/RockerSwitchRenderer.tsx
@src/components/elements/renderers/controls/RotarySwitchRenderer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Rocker Switch styling in export</name>
  <files>src/services/export/cssGenerator.ts, src/services/export/htmlGenerator.ts</files>
  <action>
Compare RockerSwitchRenderer.tsx with the exported CSS/HTML:

1. Read RockerSwitchRenderer.tsx to understand the 3-position switch rendering:
   - Housing (outer container)
   - Rocker element (the movable part)
   - Position indicators (up/center/down)
   - Visual feedback for current position

2. Find generateRockerSwitchCSS (around line 1641) and generateRockerSwitchHTML (around line 1344)

3. Compare the CSS properties:
   - Housing dimensions and background
   - Rocker positioning within housing (transforms for tilt)
   - Position indicator styling
   - Shadows and borders for 3D effect

4. Ensure the HTML structure matches:
   - Same element hierarchy as renderer
   - Correct data attributes for position state
   - Proper class names for CSS targeting

Fix any discrepancies between canvas renderer and export.
  </action>
  <verify>
1. Add a Rocker Switch to canvas
2. Click Preview
3. Rocker switch should look identical (same colors, 3D effect, position indicators)
  </verify>
  <done>Rocker Switch preview matches canvas appearance exactly</done>
</task>

<task type="auto">
  <name>Task 2: Fix Rotary Switch styling in export</name>
  <files>src/services/export/cssGenerator.ts, src/services/export/htmlGenerator.ts</files>
  <action>
Compare RotarySwitchRenderer.tsx with exported CSS/HTML:

1. Read RotarySwitchRenderer.tsx to understand the vintage rotary switch:
   - Outer dial (circular housing)
   - Pointer/indicator (rotating element)
   - Position labels (arranged radially around dial)
   - Current position highlighting

2. Find generateRotarySwitchCSS (around line 1701) and generateRotarySwitchHTML (around line 1364)

3. Compare:
   - Dial dimensions and border styling
   - Pointer rotation calculation based on position
   - Label positioning (use transform: rotate() and translate)
   - Active position styling

4. The rotary switch uses radial label layout when positions <= 6, legend layout otherwise (per Phase 21 decisions). Ensure both modes are handled in export.

Fix any CSS/HTML structure differences.
  </action>
  <verify>
1. Add a Rotary Switch to canvas (default 4 positions)
2. Click Preview
3. Rotary switch should look identical (dial, pointer, labels positioned correctly)
4. Try 8-position rotary switch - labels should use legend layout
  </verify>
  <done>Rotary Switch preview matches canvas appearance for both radial and legend label layouts</done>
</task>

<task type="auto">
  <name>Task 3: Fix button font consistency in export</name>
  <files>src/services/export/cssGenerator.ts</files>
  <action>
Investigate button font differences:

1. Check the base CSS in generateCSS for global font-family
2. Check button-specific CSS generation functions:
   - generateIconButtonCSS
   - generateKickButtonCSS
   - generateToggleSwitchCSS
   - generatePowerButtonCSS
   - generateSegmentButtonCSS
   - Basic button case

3. Ensure all button types include explicit font-family property:
   ```css
   font-family: Inter, system-ui, sans-serif;
   ```

4. If buttons rely on inheritance, ensure the parent container has the correct font-family.

5. Check if any button type uses a different font (e.g., monospace for numeric displays) and preserve that intentional difference.

The issue is likely that exported CSS doesn't explicitly set font-family on button elements, relying on browser defaults instead.
  </action>
  <verify>
1. Add various button types to canvas (Button, Icon Button, Kick Button, Segment Button)
2. Click Preview
3. All buttons should use same font (Inter) as canvas
4. Compare font rendering closely - weight, size, spacing should match
  </verify>
  <done>All button types use consistent fonts matching canvas appearance</done>
</task>

</tasks>

<verification>
1. Run `npm run dev`, add Rocker Switch, Rotary Switch, and various buttons
2. Click Preview
3. Rocker Switch: 3-position switch looks identical to canvas (housing, tilt, shadows)
4. Rotary Switch: dial, pointer, and radial labels match canvas
5. Buttons: fonts are consistent with canvas (Inter family, same weights)
6. Test with different switch/button configurations to ensure robustness
</verification>

<success_criteria>
- Rocker Switch preview matches canvas (3D housing, tilt animation, position states)
- Rotary Switch preview matches canvas (dial, pointer rotation, label positioning)
- All button types use consistent Inter font family in preview
- No visual differences detectable between canvas and preview for these elements
</success_criteria>

<output>
After completion, create `.planning/phases/27.1-post-phase-bugfixes/27.1-04-SUMMARY.md`
</output>
