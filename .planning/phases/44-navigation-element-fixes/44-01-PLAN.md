---
phase: 44-navigation-element-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Properties/TreeViewProperties.tsx
  - src/components/elements/renderers/controls/TagSelectorRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "Tree View children are visible in the properties panel tree when added"
    - "Tree View child properties can be edited (name field works)"
    - "Tag Selector shows dropdown suggestions when user types in input"
    - "Tag Selector shows 'no matching tags' message when filter has no results"
  artifacts:
    - path: "src/components/Properties/TreeViewProperties.tsx"
      provides: "Tree node editing with auto-expand on child add"
      contains: "setExpandedNodeIds"
    - path: "src/components/elements/renderers/controls/TagSelectorRenderer.tsx"
      provides: "Tag dropdown with empty state handling"
      contains: "No matching tags"
  key_links:
    - from: "TreeViewProperties.tsx"
      to: "expandedNodeIds state"
      via: "addChildNode updates expandedNodeIds"
      pattern: "setExpandedNodeIds.*parentNode.id"
    - from: "TagSelectorRenderer.tsx"
      to: "dropdown visibility"
      via: "show dropdown when open, regardless of results"
      pattern: "dropdownOpen && \\("
---

<objective>
Fix Tree View child visibility and Tag Selector dropdown bugs

Purpose: NAV-01 and NAV-02 prevent users from effectively using Tree View and Tag Selector elements. Tree View children disappear after being added (parent not expanded), and Tag Selector hides the dropdown entirely when typing non-matching text.

Output: Both navigation elements work correctly - Tree View auto-expands parents when adding children, Tag Selector shows "no matching tags" feedback when filtering yields no results.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/44-navigation-element-fixes/44-RESEARCH.md

@src/components/Properties/TreeViewProperties.tsx
@src/components/elements/renderers/controls/TagSelectorRenderer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Tree View auto-expand on child add (NAV-01)</name>
  <files>src/components/Properties/TreeViewProperties.tsx</files>
  <action>
In TreeViewProperties.tsx, modify the `addChildNode` callback to auto-expand the parent node after adding a child:

1. After adding the child node to parentNode.children (around line 44), add logic to expand the parent:
   ```typescript
   // FIX NAV-01: Auto-expand parent so child is immediately visible
   setExpandedNodeIds((prev) =>
     prev.includes(parentNode.id) ? prev : [...prev, parentNode.id]
   )
   ```

2. This ensures when user clicks "Add Child", the parent node expands automatically and the new child is visible in the tree.

Note: The fix must be placed BEFORE the onUpdate call so the state change happens in the same render cycle.
  </action>
  <verify>
1. Run `npm run build` - should compile without errors
2. Manual test: Add a Tree View element to canvas, go to Properties panel
3. Add a root node, then click "Add Child" on it
4. Child should appear immediately (parent expanded automatically)
5. Child's name should be editable in the properties panel
  </verify>
  <done>
Tree View parent nodes auto-expand when children are added. Children are immediately visible and their properties (name) are editable.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Tag Selector dropdown visibility (NAV-02)</name>
  <files>src/components/elements/renderers/controls/TagSelectorRenderer.tsx</files>
  <action>
In TagSelectorRenderer.tsx, fix the dropdown visibility condition to show feedback when no matches:

1. Find the dropdown rendering condition around line 198:
   ```typescript
   {dropdownOpen && filteredAvailable.length > 0 && (
   ```

2. Change it to show dropdown whenever open, with empty state handling:
   ```typescript
   {dropdownOpen && (
     <div className={dropdownClass} style={{...existing styles...}}>
       {filteredAvailable.length > 0 ? (
         filteredAvailable.map((tag) => (
           <div key={tag.id} ...existing tag item...>
             {tag.label}
           </div>
         ))
       ) : filterText ? (
         <div style={{
           padding: '8px 12px',
           color: '#6b7280',
           fontStyle: 'italic',
           fontSize: '13px',
           fontFamily: 'Inter, system-ui, sans-serif',
         }}>
           No matching tags
         </div>
       ) : null}
     </div>
   )}
   ```

3. This shows the dropdown with "No matching tags" when user is typing but no results match, providing clear feedback instead of hiding the dropdown.

Note: Only show "No matching tags" when filterText is non-empty (user is actively filtering). When filterText is empty and no available tags, don't show anything.
  </action>
  <verify>
1. Run `npm run build` - should compile without errors
2. Manual test: Add a Tag Selector element to canvas
3. Focus the input field - dropdown should appear with available tags
4. Type text that doesn't match any tag - dropdown should stay open with "No matching tags" message
5. Clear input - dropdown should show all available tags again
  </verify>
  <done>
Tag Selector dropdown remains open when typing, shows available tags that match filter, and shows "No matching tags" message when filter yields no results.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes successfully
2. `npm run dev` starts without errors
3. Tree View: Adding child nodes auto-expands parent, children visible and editable
4. Tag Selector: Dropdown shows suggestions while typing, shows "no matching tags" for empty results
</verification>

<success_criteria>
- NAV-01: Tree View children visible in properties panel tree, properties editable
- NAV-02: Tag Selector shows tag input/suggestions when user starts typing
- Both elements behave intuitively with proper visual feedback
</success_criteria>

<output>
After completion, create `.planning/phases/44-navigation-element-fixes/44-01-SUMMARY.md`
</output>
