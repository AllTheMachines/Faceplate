---
phase: 44-navigation-element-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/elements/renderers/controls/ComboBoxRenderer.tsx
  - src/components/elements/renderers/controls/BreadcrumbRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "Combo Box dropdown shows ALL options after user makes a selection"
    - "Combo Box options can be re-selected without typing to clear"
    - "Breadcrumb ellipsis can be clicked to expand and show all items"
    - "Breadcrumb non-current items are clickable for navigation"
  artifacts:
    - path: "src/components/elements/renderers/controls/ComboBoxRenderer.tsx"
      provides: "Combo box with full options display after selection"
      contains: "filteredOptions"
    - path: "src/components/elements/renderers/controls/BreadcrumbRenderer.tsx"
      provides: "Breadcrumb with clickable items and ellipsis expansion"
      contains: "onClick"
  key_links:
    - from: "ComboBoxRenderer.tsx"
      to: "filteredOptions logic"
      via: "show all when inputValue matches existing option"
      pattern: "config.options.some.*toLowerCase.*===.*inputValue"
    - from: "BreadcrumbRenderer.tsx"
      to: "click handlers"
      via: "onClick for navigation and expansion"
      pattern: "onClick.*=>"
---

<objective>
Fix Combo Box option filtering and Breadcrumb expansion bugs

Purpose: NAV-03 prevents users from seeing all Combo Box options after making a selection (filter persists). NAV-04 prevents users from expanding collapsed breadcrumbs after navigating to root level.

Output: Combo Box shows all options when reopening dropdown after selection. Breadcrumb ellipsis is clickable to expand, and non-current items trigger navigation callbacks.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/44-navigation-element-fixes/44-RESEARCH.md

@src/components/elements/renderers/controls/ComboBoxRenderer.tsx
@src/components/elements/renderers/controls/BreadcrumbRenderer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Combo Box shows all options after selection (NAV-03)</name>
  <files>src/components/elements/renderers/controls/ComboBoxRenderer.tsx</files>
  <action>
In ComboBoxRenderer.tsx, fix the filter logic to show all options when input matches an existing selection:

1. Find the filteredOptions calculation around line 27-29:
   ```typescript
   const filteredOptions = config.options.filter((option) =>
     option.toLowerCase().includes(inputValue.toLowerCase())
   )
   ```

2. Replace with logic that shows all options when inputValue exactly matches an existing option:
   ```typescript
   // FIX NAV-03: Show all options when inputValue matches an existing selection
   const inputMatchesOption = config.options.some(
     (opt) => opt.toLowerCase() === inputValue.toLowerCase()
   )
   const filteredOptions = config.options.filter((option) => {
     // If input exactly matches a selected option, show all options
     if (inputMatchesOption) {
       return true
     }
     return option.toLowerCase().includes(inputValue.toLowerCase())
   })
   ```

3. This ensures that after selecting "Option 1", reopening the dropdown shows ALL options (not just options containing "option 1").

Alternative approach if above feels complex - clear input on focus when it matches a selection:
   ```typescript
   onFocus={() => {
     // Clear filter if input matches existing option (shows all)
     if (config.options.some(opt => opt.toLowerCase() === inputValue.toLowerCase())) {
       setInputValue('')
     }
     setIsOpen(true)
   }}
   ```

Choose the approach that maintains best UX (first approach preserves selected text display, second clears it).
  </action>
  <verify>
1. Run `npm run build` - should compile without errors
2. Manual test: Add a Combo Box element with multiple options
3. Click dropdown and select an option - input shows selected value
4. Click input again to reopen dropdown
5. ALL options should be visible (not just ones matching the selected text)
6. Can select a different option
  </verify>
  <done>
Combo Box dropdown shows all options after making a selection. Users can easily switch between options without manually clearing the input.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Breadcrumb expansion after navigation (NAV-04)</name>
  <files>src/components/elements/renderers/controls/BreadcrumbRenderer.tsx</files>
  <action>
In BreadcrumbRenderer.tsx, add click handlers for ellipsis expansion and item navigation:

1. The component currently has data-clickable attributes but no onClick handlers. Add interactivity:

2. For the item span (around line 53-69), add onClick handler:
   ```typescript
   <span
     className={isLast ? 'breadcrumb-current' : 'breadcrumb-link'}
     onClick={() => {
       if (!isLast && !isEllipsis) {
         // Navigation would be handled by parent via callback
         // For now, log to show it's clickable (real navigation happens in exported runtime)
         console.log(`Breadcrumb navigate to: ${item.id}`)
       }
     }}
     style={{
       color: isLast ? config.currentColor : config.linkColor,
       cursor: isLast || isEllipsis ? 'default' : 'pointer',
       ...rest of existing styles...
     }}
     data-breadcrumb-id={item.id}
     data-clickable={!isLast && !isEllipsis}
   >
   ```

3. For the ellipsis item specifically, make it clickable to show all items. The ellipsis is a synthetic item with id='ellipsis'. When clicked, it should indicate expansion is requested:
   ```typescript
   // In the map callback, handle ellipsis specially:
   {isEllipsis && (
     <span
       onClick={() => {
         // Signal that user wants to see all items
         // In designer mode, just log; in runtime, this would expand
         console.log('Breadcrumb expand all requested')
       }}
       style={{
         ...existing styles...
         cursor: 'pointer',
       }}
       title="Click to show all items"
     >
       {item.label}
     </span>
   )}
   ```

4. Alternative: Since this is a design-time renderer, the actual navigation is handled by exported JS. The fix should:
   - Add cursor:pointer to non-last, non-ellipsis items (already there)
   - Add onClick that emits console log for debugging
   - Add title tooltip on ellipsis explaining it expands
   - The actual expansion logic would be in the runtime (export generates JS that handles clicks)

Note: The Breadcrumb element in the designer is for visual design. Real interactivity happens in exported code. The fix ensures:
- Visual affordance (pointer cursor) is correct
- data-clickable attribute is set (export uses this)
- Optional: Add hover color effect using config.hoverColor
  </action>
  <verify>
1. Run `npm run build` - should compile without errors
2. Manual test: Add a Breadcrumb element with 5+ items
3. Set maxVisibleItems to 3 (should show ellipsis)
4. Non-current breadcrumb items should show pointer cursor
5. Ellipsis should show pointer cursor and have tooltip
6. Clicking non-current item should log navigation (designer mode)
7. Clicking ellipsis should log expansion request
  </verify>
  <done>
Breadcrumb items have proper click affordances. Ellipsis is clickable with tooltip. Non-current items show pointer cursor and trigger click events. Visual feedback matches expected behavior.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes successfully
2. `npm run dev` starts without errors
3. Combo Box: Dropdown shows all options after selection, can easily change selection
4. Breadcrumb: Ellipsis clickable, non-current items have pointer cursor and click handlers
</verification>

<success_criteria>
- NAV-03: Combo Box dropdown shows all options after making a selection
- NAV-04: Breadcrumb can expand after navigating (ellipsis clickable, items navigable)
- Both elements have proper visual affordances and interaction feedback
</success_criteria>

<output>
After completion, create `.planning/phases/44-navigation-element-fixes/44-02-SUMMARY.md`
</output>
