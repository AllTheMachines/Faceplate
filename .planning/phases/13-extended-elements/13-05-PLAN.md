---
phase: 13-extended-elements
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements.ts
  - src/components/elements/Element.tsx
  - src/components/elements/renderers/TextFieldRenderer.tsx
  - src/components/Properties/TextFieldProperties.tsx
  - src/components/Properties/PropertyPanel.tsx
  - src/components/Palette/Palette.tsx
  - src/services/export/htmlGenerator.ts
  - src/services/export/cssGenerator.ts
autonomous: true

must_haves:
  truths:
    - "User can add Text Field element from palette"
    - "Text Field displays with placeholder text when empty"
    - "Text Field shows current value when set"
    - "Property panel allows configuring placeholder, value, and max length"
    - "Text Field exports as native HTML input[type=text] element"
  artifacts:
    - path: "src/types/elements.ts"
      provides: "TextFieldElementConfig interface"
      contains: "type: 'textfield'"
    - path: "src/components/elements/renderers/TextFieldRenderer.tsx"
      provides: "Text input rendering"
      min_lines: 20
  key_links:
    - from: "src/services/export/htmlGenerator.ts"
      to: "native HTML"
      via: "input[type=text] element generation"
---

<objective>
Add Text Field element for text input (preset names, custom values, etc.).

Purpose: Audio plugins need text input for preset naming, custom labels, and user values. This is requirement ELEM-09 (text field).

Output:
- TextFieldElementConfig type definition
- TextFieldRenderer using native HTML input
- Property panel for text field configuration
- Palette entry in Form Controls category
- Export to native HTML input element
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-extended-elements/13-CONTEXT.md
@.planning/phases/13-extended-elements/13-RESEARCH.md

@src/types/elements.ts
@src/components/elements/Element.tsx
@src/components/Properties/PropertyPanel.tsx
@src/components/Palette/Palette.tsx
@src/services/export/htmlGenerator.ts
@src/services/export/cssGenerator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TextFieldElementConfig type</name>
  <files>src/types/elements.ts</files>
  <action>
Add TextFieldElementConfig interface:
```typescript
export interface TextFieldElementConfig extends BaseElementConfig {
  type: 'textfield'

  // Value
  value: string
  placeholder: string
  maxLength: number  // 0 = unlimited

  // Appearance
  fontSize: number
  fontFamily: string
  textColor: string
  backgroundColor: string
  borderColor: string
  borderWidth: number
  borderRadius: number
  padding: number
  textAlign: 'left' | 'center' | 'right'
}
```

Update ElementConfig union to include TextFieldElementConfig.

Add type guard:
```typescript
export function isTextField(element: ElementConfig): element is TextFieldElementConfig {
  return element.type === 'textfield'
}
```

Add factory function:
```typescript
export function createTextField(overrides?: Partial<TextFieldElementConfig>): TextFieldElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'textfield',
    name: 'Text Field',
    x: 0, y: 0,
    width: 150, height: 32,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    value: '',
    placeholder: 'Enter text...',
    maxLength: 0,
    fontSize: 14,
    fontFamily: 'Inter, system-ui, sans-serif',
    textColor: '#ffffff',
    backgroundColor: '#1f2937',
    borderColor: '#4b5563',
    borderWidth: 1,
    borderRadius: 4,
    padding: 8,
    textAlign: 'left',
    ...overrides,
  }
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>TextFieldElementConfig type defined with type guard and factory function</done>
</task>

<task type="auto">
  <name>Task 2: Create TextFieldRenderer and update Element switch</name>
  <files>
src/components/elements/renderers/TextFieldRenderer.tsx
src/components/elements/Element.tsx
  </files>
  <action>
Create TextFieldRenderer.tsx:
```tsx
import type { TextFieldElementConfig } from '../../../types/elements'

interface TextFieldRendererProps {
  config: TextFieldElementConfig
}

export function TextFieldRenderer({ config }: TextFieldRendererProps) {
  return (
    <input
      type="text"
      className="textfield-element"
      value={config.value}
      placeholder={config.placeholder}
      maxLength={config.maxLength > 0 ? config.maxLength : undefined}
      readOnly
      style={{
        width: '100%',
        height: '100%',
        fontSize: `${config.fontSize}px`,
        fontFamily: config.fontFamily,
        color: config.textColor,
        backgroundColor: config.backgroundColor,
        border: `${config.borderWidth}px solid ${config.borderColor}`,
        borderRadius: `${config.borderRadius}px`,
        padding: `0 ${config.padding}px`,
        textAlign: config.textAlign,
        outline: 'none',
        boxSizing: 'border-box',
        pointerEvents: 'none',  // Prevent interaction in designer
      }}
    />
  )
}
```

Update Element.tsx:
1. Import TextFieldRenderer
2. Add case to switch:
```tsx
case 'textfield':
  return <TextFieldRenderer config={element} />
```
  </action>
  <verify>TypeScript compiles and text field renders correctly in browser</verify>
  <done>TextFieldRenderer created; Element.tsx routes correctly</done>
</task>

<task type="auto">
  <name>Task 3: Add property panel, palette entry, and export</name>
  <files>
src/components/Properties/TextFieldProperties.tsx
src/components/Properties/PropertyPanel.tsx
src/components/Palette/Palette.tsx
src/services/export/htmlGenerator.ts
src/services/export/cssGenerator.ts
  </files>
  <action>
Create TextFieldProperties.tsx:
```tsx
import { PropertySection } from './PropertySection'
import { TextInput } from './TextInput'
import { NumberInput } from './NumberInput'
import { ColorInput } from './ColorInput'
import type { TextFieldElementConfig, ElementConfig } from '../../types/elements'

interface TextFieldPropertiesProps {
  element: TextFieldElementConfig
  onUpdate: (updates: Partial<ElementConfig>) => void
}

export function TextFieldProperties({ element, onUpdate }: TextFieldPropertiesProps) {
  return (
    <>
      <PropertySection title="Content">
        <TextInput
          label="Value"
          value={element.value}
          onChange={(value) => onUpdate({ value })}
        />
        <TextInput
          label="Placeholder"
          value={element.placeholder}
          onChange={(placeholder) => onUpdate({ placeholder })}
        />
        <NumberInput
          label="Max Length (0=none)"
          value={element.maxLength}
          onChange={(maxLength) => onUpdate({ maxLength })}
          min={0}
          max={1000}
        />
      </PropertySection>

      <PropertySection title="Text">
        <NumberInput
          label="Font Size"
          value={element.fontSize}
          onChange={(fontSize) => onUpdate({ fontSize })}
          min={10}
          max={32}
        />
        <ColorInput
          label="Text Color"
          value={element.textColor}
          onChange={(textColor) => onUpdate({ textColor })}
        />
        <div>
          <label className="block text-xs text-gray-400 mb-1">Text Align</label>
          <select
            value={element.textAlign}
            onChange={(e) => onUpdate({ textAlign: e.target.value as 'left' | 'center' | 'right' })}
            className="w-full bg-gray-700 border border-gray-600 text-white rounded px-2 py-1.5 text-sm"
          >
            <option value="left">Left</option>
            <option value="center">Center</option>
            <option value="right">Right</option>
          </select>
        </div>
      </PropertySection>

      <PropertySection title="Appearance">
        <ColorInput
          label="Background"
          value={element.backgroundColor}
          onChange={(backgroundColor) => onUpdate({ backgroundColor })}
        />
        <NumberInput
          label="Padding"
          value={element.padding}
          onChange={(padding) => onUpdate({ padding })}
          min={0}
          max={24}
        />
      </PropertySection>

      <PropertySection title="Border">
        <NumberInput
          label="Border Width"
          value={element.borderWidth}
          onChange={(borderWidth) => onUpdate({ borderWidth })}
          min={0}
          max={5}
        />
        <ColorInput
          label="Border Color"
          value={element.borderColor}
          onChange={(borderColor) => onUpdate({ borderColor })}
        />
        <NumberInput
          label="Border Radius"
          value={element.borderRadius}
          onChange={(borderRadius) => onUpdate({ borderRadius })}
          min={0}
          max={16}
        />
      </PropertySection>
    </>
  )
}
```

Update PropertyPanel.tsx:
1. Import TextFieldProperties
2. Add case:
```tsx
case 'textfield':
  return <TextFieldProperties element={selectedElement} onUpdate={handleUpdate} />
```

Update Palette.tsx - add to Form Controls category (if exists from 13-04) OR create:
```typescript
{ id: 'textfield', type: 'textfield', name: 'Text Field' },
```

Update htmlGenerator.ts:
```typescript
case 'textfield':
  return `<input id="${id}" class="${baseClass} textfield-element" data-type="textfield" type="text" value="${escapeHTML(element.value)}" placeholder="${escapeHTML(element.placeholder)}"${element.maxLength > 0 ? ` maxlength="${element.maxLength}"` : ''} style="${positionStyle}" />`
```

Update cssGenerator.ts:
```typescript
case 'textfield':
  return `${selector} {
  font-size: ${element.fontSize}px;
  font-family: ${element.fontFamily};
  color: ${element.textColor};
  background-color: ${element.backgroundColor};
  border: ${element.borderWidth}px solid ${element.borderColor};
  border-radius: ${element.borderRadius}px;
  padding: 0 ${element.padding}px;
  text-align: ${element.textAlign};
  outline: none;
  box-sizing: border-box;
}

${selector}::placeholder {
  color: ${element.textColor};
  opacity: 0.5;
}

${selector}:focus {
  border-color: #3b82f6;
}`
```
  </action>
  <verify>
1. Run `npm run dev`
2. Find Text Field in Form Controls category
3. Drag to canvas
4. Verify placeholder text appears
5. In property panel, change value and placeholder
6. Verify changes appear on canvas
7. Export project, verify native input element in HTML
  </verify>
  <done>TextFieldProperties complete; Palette entry added; Export generates native HTML input</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npm run build`
2. Text Field appears in Palette (Form Controls category)
3. Element renders with placeholder when value is empty
4. Element renders with value when set
5. Property panel has Content, Text, Appearance, Border sections
6. Exported HTML contains input[type=text] element
7. Exported CSS styles the input including placeholder
</verification>

<success_criteria>
- [ ] TextFieldElementConfig type exists with all properties
- [ ] Type guard isTextField works correctly
- [ ] Factory function createTextField has sensible defaults
- [ ] TextFieldRenderer displays placeholder and value correctly
- [ ] Element.tsx handles 'textfield' type
- [ ] TextFieldProperties has all configuration sections
- [ ] Palette Form Controls category includes Text Field
- [ ] HTML export generates native input element
- [ ] CSS export includes placeholder and focus styles
</success_criteria>

<output>
After completion, create `.planning/phases/13-extended-elements/13-05-SUMMARY.md`
</output>
