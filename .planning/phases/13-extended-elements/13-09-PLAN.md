---
phase: 13-extended-elements
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements.ts
  - src/components/elements/Element.tsx
  - src/components/elements/renderers/WaveformRenderer.tsx
  - src/components/elements/renderers/OscilloscopeRenderer.tsx
  - src/components/Properties/WaveformProperties.tsx
  - src/components/Properties/OscilloscopeProperties.tsx
  - src/components/Properties/PropertyPanel.tsx
  - src/components/Palette/Palette.tsx
  - src/services/export/htmlGenerator.ts
  - src/services/export/cssGenerator.ts
autonomous: true

must_haves:
  truths:
    - "User can add Waveform Display placeholder element"
    - "User can add Oscilloscope Display placeholder element"
    - "Waveform shows placeholder with 'Waveform Display' label"
    - "Oscilloscope shows grid placeholder with 'Oscilloscope' label"
    - "Both elements have configurable colors and grid options"
    - "Both elements export with data-* attributes for JUCE integration"
  artifacts:
    - path: "src/types/elements.ts"
      provides: "WaveformElementConfig and OscilloscopeElementConfig interfaces"
      contains: "type: 'waveform'"
    - path: "src/components/elements/renderers/WaveformRenderer.tsx"
      provides: "Waveform placeholder rendering"
      min_lines: 20
  key_links:
    - from: "src/services/export/htmlGenerator.ts"
      to: "HTML"
      via: "data-* attributes for JUCE runtime binding"
---

<objective>
Add Waveform and Oscilloscope display placeholder elements.

Purpose: Audio plugins need waveform and oscilloscope displays. Phase 13 creates placeholders - actual rendering happens in JUCE at runtime. This is requirement ELEM-11.

Output:
- WaveformElementConfig and OscilloscopeElementConfig types
- Placeholder renderers with labels and grid preview
- Property panels for configuration
- Palette entries in Audio Displays category
- Export with data-* attributes for JUCE integration

NOTE: These are PLACEHOLDERS. Actual waveform/oscilloscope rendering requires real audio data from JUCE at runtime.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-extended-elements/13-CONTEXT.md
@.planning/phases/13-extended-elements/13-RESEARCH.md

@src/types/elements.ts
@src/components/elements/Element.tsx
@src/components/Properties/PropertyPanel.tsx
@src/components/Palette/Palette.tsx
@src/services/export/htmlGenerator.ts
@src/services/export/cssGenerator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Waveform and Oscilloscope element types</name>
  <files>src/types/elements.ts</files>
  <action>
Add WaveformElementConfig interface:
```typescript
export interface WaveformElementConfig extends BaseElementConfig {
  type: 'waveform'

  // Visual
  backgroundColor: string
  waveformColor: string
  borderColor: string
  borderWidth: number

  // Grid (optional visual guide)
  showGrid: boolean
  gridColor: string

  // JUCE integration hints
  zoomLevel: number  // 1 = default, 2 = 2x zoom, etc.
}
```

Add OscilloscopeElementConfig interface:
```typescript
export interface OscilloscopeElementConfig extends BaseElementConfig {
  type: 'oscilloscope'

  // Visual
  backgroundColor: string
  traceColor: string
  borderColor: string
  borderWidth: number

  // Grid
  showGrid: boolean
  gridColor: string
  gridDivisions: number  // Number of horizontal/vertical divisions

  // Scope settings (hints for JUCE)
  timeDiv: number  // Time per division in ms
  amplitudeScale: number  // 0-1 normalized
  triggerLevel: number  // 0-1 normalized
}
```

Update ElementConfig union.

Add type guards:
```typescript
export function isWaveform(element: ElementConfig): element is WaveformElementConfig {
  return element.type === 'waveform'
}
export function isOscilloscope(element: ElementConfig): element is OscilloscopeElementConfig {
  return element.type === 'oscilloscope'
}
```

Add factory functions:
```typescript
export function createWaveform(overrides?: Partial<WaveformElementConfig>): WaveformElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'waveform',
    name: 'Waveform',
    x: 0, y: 0,
    width: 200, height: 80,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    backgroundColor: '#1f2937',
    waveformColor: '#3b82f6',
    borderColor: '#374151',
    borderWidth: 1,
    showGrid: false,
    gridColor: '#374151',
    zoomLevel: 1,
    ...overrides,
  }
}

export function createOscilloscope(overrides?: Partial<OscilloscopeElementConfig>): OscilloscopeElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'oscilloscope',
    name: 'Oscilloscope',
    x: 0, y: 0,
    width: 200, height: 150,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    backgroundColor: '#0f172a',
    traceColor: '#22c55e',
    borderColor: '#374151',
    borderWidth: 1,
    showGrid: true,
    gridColor: '#1e3a5f',
    gridDivisions: 8,
    timeDiv: 10,
    amplitudeScale: 1,
    triggerLevel: 0.5,
    ...overrides,
  }
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>WaveformElementConfig and OscilloscopeElementConfig types defined with type guards and factories</done>
</task>

<task type="auto">
  <name>Task 2: Create placeholder renderers and update Element switch</name>
  <files>
src/components/elements/renderers/WaveformRenderer.tsx
src/components/elements/renderers/OscilloscopeRenderer.tsx
src/components/elements/Element.tsx
  </files>
  <action>
Create WaveformRenderer.tsx:
```tsx
import type { WaveformElementConfig } from '../../../types/elements'

interface WaveformRendererProps {
  config: WaveformElementConfig
}

export function WaveformRenderer({ config }: WaveformRendererProps) {
  return (
    <div
      className="waveform-element"
      data-type="waveform"
      data-zoom-level={config.zoomLevel}
      style={{
        width: '100%',
        height: '100%',
        backgroundColor: config.backgroundColor,
        border: `${config.borderWidth}px solid ${config.borderColor}`,
        borderRadius: '4px',
        position: 'relative',
        overflow: 'hidden',
      }}
    >
      {/* Grid lines (if enabled) */}
      {config.showGrid && (
        <div
          style={{
            position: 'absolute',
            inset: 0,
            backgroundImage: `
              linear-gradient(${config.gridColor} 1px, transparent 1px),
              linear-gradient(90deg, ${config.gridColor} 1px, transparent 1px)
            `,
            backgroundSize: '20% 50%',
            opacity: 0.5,
          }}
        />
      )}

      {/* Placeholder waveform visualization */}
      <svg
        width="100%"
        height="100%"
        viewBox="0 0 100 50"
        preserveAspectRatio="none"
        style={{ position: 'absolute', inset: 0 }}
      >
        <path
          d="M0,25 Q10,10 20,25 T40,25 T60,25 T80,25 T100,25"
          fill="none"
          stroke={config.waveformColor}
          strokeWidth="2"
          opacity="0.5"
        />
      </svg>

      {/* Label */}
      <div
        style={{
          position: 'absolute',
          inset: 0,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          color: config.waveformColor,
          opacity: 0.7,
          fontSize: '12px',
          fontWeight: 500,
          userSelect: 'none',
        }}
      >
        Waveform Display
      </div>
    </div>
  )
}
```

Create OscilloscopeRenderer.tsx:
```tsx
import type { OscilloscopeElementConfig } from '../../../types/elements'

interface OscilloscopeRendererProps {
  config: OscilloscopeElementConfig
}

export function OscilloscopeRenderer({ config }: OscilloscopeRendererProps) {
  const divPercent = 100 / config.gridDivisions

  return (
    <div
      className="oscilloscope-element"
      data-type="oscilloscope"
      data-time-div={config.timeDiv}
      data-amplitude-scale={config.amplitudeScale}
      data-trigger-level={config.triggerLevel}
      style={{
        width: '100%',
        height: '100%',
        backgroundColor: config.backgroundColor,
        border: `${config.borderWidth}px solid ${config.borderColor}`,
        borderRadius: '4px',
        position: 'relative',
        overflow: 'hidden',
      }}
    >
      {/* Grid lines */}
      {config.showGrid && (
        <div
          style={{
            position: 'absolute',
            inset: 0,
            backgroundImage: `
              linear-gradient(${config.gridColor} 1px, transparent 1px),
              linear-gradient(90deg, ${config.gridColor} 1px, transparent 1px)
            `,
            backgroundSize: `${divPercent}% ${divPercent}%`,
          }}
        />
      )}

      {/* Center crosshair */}
      <div
        style={{
          position: 'absolute',
          top: '50%',
          left: 0,
          right: 0,
          height: '1px',
          backgroundColor: config.gridColor,
          opacity: 0.8,
        }}
      />
      <div
        style={{
          position: 'absolute',
          left: '50%',
          top: 0,
          bottom: 0,
          width: '1px',
          backgroundColor: config.gridColor,
          opacity: 0.8,
        }}
      />

      {/* Placeholder sine wave */}
      <svg
        width="100%"
        height="100%"
        viewBox="0 0 100 100"
        preserveAspectRatio="none"
        style={{ position: 'absolute', inset: 0 }}
      >
        <path
          d="M0,50 Q12.5,20 25,50 T50,50 T75,50 T100,50"
          fill="none"
          stroke={config.traceColor}
          strokeWidth="2"
          opacity="0.6"
        />
      </svg>

      {/* Label */}
      <div
        style={{
          position: 'absolute',
          inset: 0,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          color: config.traceColor,
          opacity: 0.7,
          fontSize: '12px',
          fontWeight: 500,
          userSelect: 'none',
        }}
      >
        Oscilloscope
      </div>
    </div>
  )
}
```

Update Element.tsx with cases for waveform, oscilloscope.
  </action>
  <verify>TypeScript compiles and both placeholders render with grid and labels</verify>
  <done>WaveformRenderer and OscilloscopeRenderer show placeholders; Element.tsx routes correctly</done>
</task>

<task type="auto">
  <name>Task 3: Add property panels, palette entries, and export</name>
  <files>
src/components/Properties/WaveformProperties.tsx
src/components/Properties/OscilloscopeProperties.tsx
src/components/Properties/PropertyPanel.tsx
src/components/Palette/Palette.tsx
src/services/export/htmlGenerator.ts
src/services/export/cssGenerator.ts
  </files>
  <action>
Create WaveformProperties.tsx with sections:
- Colors: backgroundColor, waveformColor
- Border: borderColor, borderWidth
- Grid: showGrid (checkbox), gridColor
- JUCE: zoomLevel

Create OscilloscopeProperties.tsx with sections:
- Colors: backgroundColor, traceColor
- Border: borderColor, borderWidth
- Grid: showGrid, gridColor, gridDivisions
- Scope Settings: timeDiv, amplitudeScale, triggerLevel

Update PropertyPanel.tsx with cases for waveform, oscilloscope.

Update Palette.tsx - add to "Audio Displays" category (if exists from 13-08):
```typescript
{ id: 'waveform', type: 'waveform', name: 'Waveform' },
{ id: 'oscilloscope', type: 'oscilloscope', name: 'Oscilloscope' },
```

Update htmlGenerator.ts:
```typescript
case 'waveform':
  return `<div id="${id}" class="${baseClass} waveform-element" data-type="waveform" data-zoom-level="${element.zoomLevel}" style="${positionStyle}">
    <div class="waveform-placeholder">Waveform Display</div>
  </div>`

case 'oscilloscope':
  return `<div id="${id}" class="${baseClass} oscilloscope-element" data-type="oscilloscope" data-time-div="${element.timeDiv}" data-amplitude-scale="${element.amplitudeScale}" data-trigger-level="${element.triggerLevel}" data-grid-divisions="${element.gridDivisions}" style="${positionStyle}">
    <div class="oscilloscope-grid"></div>
    <div class="oscilloscope-placeholder">Oscilloscope</div>
  </div>`
```

Update cssGenerator.ts with styles for waveform and oscilloscope (background, border, grid pattern).
  </action>
  <verify>
1. Run `npm run dev`
2. Find Waveform and Oscilloscope in Audio Displays category
3. Drag Waveform - verify placeholder with grid option
4. Drag Oscilloscope - verify grid with divisions
5. Toggle showGrid, verify grid appears/disappears
6. Export project, verify HTML contains data-* attributes
7. Verify CSS contains grid styles
  </verify>
  <done>Property panels complete; Palette entries added; Export generates placeholder HTML/CSS with JUCE data attributes</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npm run build`
2. Waveform and Oscilloscope appear in Audio Displays palette category
3. Both render as placeholders with appropriate labels
4. Grid toggle works for both elements
5. Oscilloscope grid divisions are configurable
6. Property panels have all configuration options
7. Exported HTML contains data-* attributes for JUCE integration
8. Exported CSS contains grid and styling
</verification>

<success_criteria>
- [ ] WaveformElementConfig and OscilloscopeElementConfig types exist
- [ ] Type guards work for both types
- [ ] Factory functions have sensible defaults
- [ ] WaveformRenderer shows placeholder with optional grid
- [ ] OscilloscopeRenderer shows grid with configurable divisions
- [ ] Element.tsx handles both types
- [ ] Property panels exist for both
- [ ] Audio Displays category includes both elements
- [ ] HTML export contains data-* attributes for JUCE
- [ ] CSS export generates grid patterns
</success_criteria>

<output>
After completion, create `.planning/phases/13-extended-elements/13-09-SUMMARY.md`
</output>
