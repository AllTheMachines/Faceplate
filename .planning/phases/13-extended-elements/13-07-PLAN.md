---
phase: 13-extended-elements
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements.ts
  - src/components/elements/Element.tsx
  - src/components/elements/renderers/RangeSliderRenderer.tsx
  - src/components/Properties/RangeSliderProperties.tsx
  - src/components/Properties/PropertyPanel.tsx
  - src/components/Palette/Palette.tsx
  - src/services/export/htmlGenerator.ts
  - src/services/export/cssGenerator.ts
  - src/services/export/jsGenerator.ts
autonomous: true

must_haves:
  truths:
    - "User can add Range Slider element with two thumbs"
    - "Range Slider displays min and max values with visual range fill"
    - "Property panel allows setting minValue and maxValue within min/max bounds"
    - "Min thumb cannot exceed max thumb and vice versa"
    - "Range Slider exports with dual-thumb interaction in JavaScript"
  artifacts:
    - path: "src/types/elements.ts"
      provides: "RangeSliderElementConfig interface"
      contains: "type: 'rangeslider'"
    - path: "src/components/elements/renderers/RangeSliderRenderer.tsx"
      provides: "Dual-thumb slider rendering"
      contains: "minValue"
  key_links:
    - from: "src/services/export/jsGenerator.ts"
      to: "HTML"
      via: "setupRangeSliderInteraction function"
---

<objective>
Add Range Slider element with dual thumbs for min/max range selection.

Purpose: Audio plugins need range selection for frequency bands, time ranges, etc. This is requirement ELEM-07 (Range Slider).

Output:
- RangeSliderElementConfig type with minValue and maxValue
- RangeSliderRenderer with two thumbs and range fill
- Property panel for range configuration
- Palette entry in Linear Controls category
- Export with dual-thumb JavaScript interaction
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-extended-elements/13-CONTEXT.md
@.planning/phases/13-extended-elements/13-RESEARCH.md

@src/types/elements.ts
@src/components/elements/Element.tsx
@src/components/Properties/PropertyPanel.tsx
@src/components/Palette/Palette.tsx
@src/services/export/htmlGenerator.ts
@src/services/export/cssGenerator.ts
@src/services/export/jsGenerator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add RangeSliderElementConfig type</name>
  <files>src/types/elements.ts</files>
  <action>
Add RangeSliderElementConfig interface:
```typescript
export interface RangeSliderElementConfig extends BaseElementConfig {
  type: 'rangeslider'

  // Orientation
  orientation: 'horizontal' | 'vertical'

  // Range bounds
  min: number  // Absolute minimum
  max: number  // Absolute maximum

  // Current values
  minValue: number  // Current minimum selection
  maxValue: number  // Current maximum selection

  // Track styling
  trackColor: string
  fillColor: string

  // Thumb styling
  thumbColor: string
  thumbWidth: number
  thumbHeight: number
}
```

Update ElementConfig union.

Add type guard:
```typescript
export function isRangeSlider(element: ElementConfig): element is RangeSliderElementConfig {
  return element.type === 'rangeslider'
}
```

Add factory function:
```typescript
export function createRangeSlider(overrides?: Partial<RangeSliderElementConfig>): RangeSliderElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'rangeslider',
    name: 'Range Slider',
    x: 0, y: 0,
    width: 200, height: 40,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    orientation: 'horizontal',
    min: 0,
    max: 1,
    minValue: 0.25,
    maxValue: 0.75,
    trackColor: '#374151',
    fillColor: '#3b82f6',
    thumbColor: '#ffffff',
    thumbWidth: 16,
    thumbHeight: 16,
    ...overrides,
  }
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>RangeSliderElementConfig type defined with type guard and factory function</done>
</task>

<task type="auto">
  <name>Task 2: Create RangeSliderRenderer and update Element switch</name>
  <files>
src/components/elements/renderers/RangeSliderRenderer.tsx
src/components/elements/Element.tsx
  </files>
  <action>
Create RangeSliderRenderer.tsx:
```tsx
import type { RangeSliderElementConfig } from '../../../types/elements'

interface RangeSliderRendererProps {
  config: RangeSliderElementConfig
}

export function RangeSliderRenderer({ config }: RangeSliderRendererProps) {
  const isHorizontal = config.orientation === 'horizontal'

  // Normalize values to 0-1 range for positioning
  const range = config.max - config.min
  const normalizedMin = (config.minValue - config.min) / range
  const normalizedMax = (config.maxValue - config.min) / range

  // Calculate fill position and size
  const fillStart = normalizedMin * 100
  const fillSize = (normalizedMax - normalizedMin) * 100

  return (
    <div
      className={`rangeslider-element ${isHorizontal ? 'horizontal' : 'vertical'}`}
      style={{
        width: '100%',
        height: '100%',
        position: 'relative',
      }}
    >
      {/* Track */}
      <div
        className="rangeslider-track"
        style={{
          position: 'absolute',
          ...(isHorizontal ? {
            left: 0,
            right: 0,
            top: '50%',
            height: '6px',
            transform: 'translateY(-50%)',
          } : {
            top: 0,
            bottom: 0,
            left: '50%',
            width: '6px',
            transform: 'translateX(-50%)',
          }),
          backgroundColor: config.trackColor,
          borderRadius: '3px',
        }}
      />

      {/* Range Fill */}
      <div
        className="rangeslider-fill"
        style={{
          position: 'absolute',
          ...(isHorizontal ? {
            left: `${fillStart}%`,
            width: `${fillSize}%`,
            top: '50%',
            height: '6px',
            transform: 'translateY(-50%)',
          } : {
            bottom: `${fillStart}%`,
            height: `${fillSize}%`,
            left: '50%',
            width: '6px',
            transform: 'translateX(-50%)',
          }),
          backgroundColor: config.fillColor,
          borderRadius: '3px',
        }}
      />

      {/* Min Thumb */}
      <div
        className="rangeslider-thumb rangeslider-thumb-min"
        style={{
          position: 'absolute',
          width: `${config.thumbWidth}px`,
          height: `${config.thumbHeight}px`,
          backgroundColor: config.thumbColor,
          borderRadius: '4px',
          boxShadow: '0 2px 4px rgba(0,0,0,0.3)',
          ...(isHorizontal ? {
            left: `${normalizedMin * 100}%`,
            top: '50%',
            transform: 'translate(-50%, -50%)',
          } : {
            bottom: `${normalizedMin * 100}%`,
            left: '50%',
            transform: 'translate(-50%, 50%)',
          }),
        }}
      />

      {/* Max Thumb */}
      <div
        className="rangeslider-thumb rangeslider-thumb-max"
        style={{
          position: 'absolute',
          width: `${config.thumbWidth}px`,
          height: `${config.thumbHeight}px`,
          backgroundColor: config.thumbColor,
          borderRadius: '4px',
          boxShadow: '0 2px 4px rgba(0,0,0,0.3)',
          ...(isHorizontal ? {
            left: `${normalizedMax * 100}%`,
            top: '50%',
            transform: 'translate(-50%, -50%)',
          } : {
            bottom: `${normalizedMax * 100}%`,
            left: '50%',
            transform: 'translate(-50%, 50%)',
          }),
        }}
      />
    </div>
  )
}
```

Update Element.tsx:
1. Import RangeSliderRenderer
2. Add case:
```tsx
case 'rangeslider':
  return <RangeSliderRenderer config={element} />
```
  </action>
  <verify>TypeScript compiles and range slider renders with two thumbs</verify>
  <done>RangeSliderRenderer shows track, fill, and two thumbs; Element.tsx routes correctly</done>
</task>

<task type="auto">
  <name>Task 3: Add property panel, palette entry, and export</name>
  <files>
src/components/Properties/RangeSliderProperties.tsx
src/components/Properties/PropertyPanel.tsx
src/components/Palette/Palette.tsx
src/services/export/htmlGenerator.ts
src/services/export/cssGenerator.ts
src/services/export/jsGenerator.ts
  </files>
  <action>
Create RangeSliderProperties.tsx:
```tsx
import { PropertySection } from './PropertySection'
import { NumberInput } from './NumberInput'
import { ColorInput } from './ColorInput'
import type { RangeSliderElementConfig, ElementConfig } from '../../types/elements'

interface RangeSliderPropertiesProps {
  element: RangeSliderElementConfig
  onUpdate: (updates: Partial<ElementConfig>) => void
}

export function RangeSliderProperties({ element, onUpdate }: RangeSliderPropertiesProps) {
  // Constrain minValue and maxValue to not cross each other
  const handleMinValueChange = (minValue: number) => {
    onUpdate({ minValue: Math.min(minValue, element.maxValue) })
  }

  const handleMaxValueChange = (maxValue: number) => {
    onUpdate({ maxValue: Math.max(maxValue, element.minValue) })
  }

  return (
    <>
      <PropertySection title="Layout">
        <div>
          <label className="block text-xs text-gray-400 mb-1">Orientation</label>
          <select
            value={element.orientation}
            onChange={(e) => onUpdate({ orientation: e.target.value as 'horizontal' | 'vertical' })}
            className="w-full bg-gray-700 border border-gray-600 text-white rounded px-2 py-1.5 text-sm"
          >
            <option value="horizontal">Horizontal</option>
            <option value="vertical">Vertical</option>
          </select>
        </div>
      </PropertySection>

      <PropertySection title="Range Bounds">
        <NumberInput
          label="Minimum"
          value={element.min}
          onChange={(min) => onUpdate({ min })}
          step={0.01}
        />
        <NumberInput
          label="Maximum"
          value={element.max}
          onChange={(max) => onUpdate({ max })}
          step={0.01}
        />
      </PropertySection>

      <PropertySection title="Current Selection">
        <NumberInput
          label="Min Value"
          value={element.minValue}
          onChange={handleMinValueChange}
          min={element.min}
          max={element.max}
          step={0.01}
        />
        <NumberInput
          label="Max Value"
          value={element.maxValue}
          onChange={handleMaxValueChange}
          min={element.min}
          max={element.max}
          step={0.01}
        />
      </PropertySection>

      <PropertySection title="Track">
        <ColorInput
          label="Track Color"
          value={element.trackColor}
          onChange={(trackColor) => onUpdate({ trackColor })}
        />
        <ColorInput
          label="Fill Color"
          value={element.fillColor}
          onChange={(fillColor) => onUpdate({ fillColor })}
        />
      </PropertySection>

      <PropertySection title="Thumb">
        <ColorInput
          label="Color"
          value={element.thumbColor}
          onChange={(thumbColor) => onUpdate({ thumbColor })}
        />
        <NumberInput
          label="Width"
          value={element.thumbWidth}
          onChange={(thumbWidth) => onUpdate({ thumbWidth })}
          min={8}
          max={32}
        />
        <NumberInput
          label="Height"
          value={element.thumbHeight}
          onChange={(thumbHeight) => onUpdate({ thumbHeight })}
          min={8}
          max={32}
        />
      </PropertySection>
    </>
  )
}
```

Update PropertyPanel.tsx with case for rangeslider.

Update Palette.tsx - add to "Linear Controls" category:
```typescript
{ id: 'rangeslider', type: 'rangeslider', name: 'Range Slider' },
```

Update htmlGenerator.ts:
```typescript
case 'rangeslider':
  const isHorizontal = element.orientation === 'horizontal'
  const range = element.max - element.min
  const normMin = (element.minValue - element.min) / range
  const normMax = (element.maxValue - element.min) / range
  return `<div id="${id}" class="${baseClass} rangeslider-element ${isHorizontal ? 'horizontal' : 'vertical'}" data-type="rangeslider" data-orientation="${element.orientation}" data-min="${element.min}" data-max="${element.max}" data-min-value="${element.minValue}" data-max-value="${element.maxValue}" style="${positionStyle}">
    <div class="rangeslider-track"></div>
    <div class="rangeslider-fill" style="${isHorizontal ? `left: ${normMin * 100}%; width: ${(normMax - normMin) * 100}%` : `bottom: ${normMin * 100}%; height: ${(normMax - normMin) * 100}%`}"></div>
    <div class="rangeslider-thumb rangeslider-thumb-min" style="${isHorizontal ? `left: ${normMin * 100}%` : `bottom: ${normMin * 100}%`}"></div>
    <div class="rangeslider-thumb rangeslider-thumb-max" style="${isHorizontal ? `left: ${normMax * 100}%` : `bottom: ${normMax * 100}%`}"></div>
  </div>`
```

Update cssGenerator.ts with range slider styles (track, fill, thumbs for both orientations).

Update jsGenerator.ts - add setupRangeSliderInteraction function:
- Setup for range sliders after initialization
- Handle dragging either thumb
- Constrain thumbs to not cross
- Update visual and emit events
  </action>
  <verify>
1. Run `npm run dev`
2. Find Range Slider in "Linear Controls" category
3. Drag to canvas - verify two thumbs appear
4. In property panel, adjust minValue and maxValue
5. Verify thumbs move and fill updates
6. Verify minValue cannot exceed maxValue
7. Export project, verify HTML has range slider structure
8. Verify JS contains range slider interaction code
  </verify>
  <done>RangeSliderProperties complete; Palette entry added; Export generates HTML/CSS/JS for dual-thumb interaction</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npm run build`
2. Range Slider appears in Palette (Linear Controls category)
3. Element renders with track, fill between thumbs, and two thumbs
4. Property panel has Range Bounds and Current Selection sections
5. Min/max value constraints work (thumbs can't cross)
6. Orientation switch between horizontal/vertical works
7. Exported HTML contains range slider structure with data attributes
8. Exported CSS handles both orientations
9. Exported JS contains setupRangeSliderInteraction function
</verification>

<success_criteria>
- [ ] RangeSliderElementConfig type exists with minValue, maxValue
- [ ] Type guard isRangeSlider works correctly
- [ ] Factory function createRangeSlider has sensible defaults
- [ ] RangeSliderRenderer displays track, fill, and two thumbs
- [ ] Fill shows between min and max thumbs
- [ ] Element.tsx handles 'rangeslider' type
- [ ] RangeSliderProperties constrains min/max values
- [ ] Palette "Linear Controls" includes Range Slider
- [ ] HTML export generates dual-thumb structure
- [ ] CSS export handles both orientations
- [ ] JS export includes range slider interaction setup
</success_criteria>

<output>
After completion, create `.planning/phases/13-extended-elements/13-07-SUMMARY.md`
</output>
