---
phase: 13-extended-elements
plan: 11
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements.ts
  - src/components/elements/Element.tsx
  - src/components/elements/renderers/PresetBrowserRenderer.tsx
  - src/components/Properties/PresetBrowserProperties.tsx
  - src/components/Properties/PropertyPanel.tsx
  - src/components/Palette/Palette.tsx
  - src/services/export/htmlGenerator.ts
  - src/services/export/cssGenerator.ts
autonomous: true

must_haves:
  truths:
    - "User can add Preset Browser placeholder element"
    - "Browser displays list/tree structure with sample presets"
    - "Property panel allows configuring placeholder preset names"
    - "Browser shows folder/preset hierarchy visual"
    - "Element exports with list structure for JUCE integration"
  artifacts:
    - path: "src/types/elements.ts"
      provides: "PresetBrowserElementConfig interface"
      contains: "type: 'presetbrowser'"
    - path: "src/components/elements/renderers/PresetBrowserRenderer.tsx"
      provides: "List/tree preset browser rendering"
      contains: "presets"
  key_links:
    - from: "src/services/export/htmlGenerator.ts"
      to: "HTML"
      via: "list structure with data-presets attribute"
---

<objective>
Add Preset Browser placeholder widget for preset selection.

Purpose: Audio plugins need preset browsers for managing and selecting presets. Phase 13 creates a configurable placeholder - actual preset loading is handled by JUCE. This is requirement ELEM-12.

Output:
- PresetBrowserElementConfig type with preset list configuration
- List-based renderer showing folder/preset hierarchy
- Property panel for configuring sample presets
- Palette entry in Complex Widgets category
- Export with list structure for JUCE integration

NOTE: This is a PLACEHOLDER. Actual preset loading and management requires JUCE backend integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-extended-elements/13-CONTEXT.md
@.planning/phases/13-extended-elements/13-RESEARCH.md

@src/types/elements.ts
@src/components/elements/Element.tsx
@src/components/Properties/PropertyPanel.tsx
@src/components/Palette/Palette.tsx
@src/services/export/htmlGenerator.ts
@src/services/export/cssGenerator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PresetBrowserElementConfig type</name>
  <files>src/types/elements.ts</files>
  <action>
Add PresetBrowserElementConfig interface:
```typescript
export interface PresetBrowserElementConfig extends BaseElementConfig {
  type: 'presetbrowser'

  // Sample presets for placeholder display
  // Format: "Folder/Preset Name" or just "Preset Name"
  presets: string[]

  // Currently selected preset index
  selectedIndex: number

  // Display
  showFolders: boolean  // Show folder hierarchy
  showSearch: boolean  // Show search bar placeholder

  // Styling
  backgroundColor: string
  itemColor: string
  selectedColor: string
  textColor: string
  selectedTextColor: string
  fontSize: number
  itemHeight: number
  borderColor: string
  borderRadius: number
}
```

Update ElementConfig union.

Add type guard:
```typescript
export function isPresetBrowser(element: ElementConfig): element is PresetBrowserElementConfig {
  return element.type === 'presetbrowser'
}
```

Add factory function:
```typescript
export function createPresetBrowser(overrides?: Partial<PresetBrowserElementConfig>): PresetBrowserElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'presetbrowser',
    name: 'Preset Browser',
    x: 0, y: 0,
    width: 200, height: 250,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    presets: [
      'Factory/Init',
      'Factory/Bass',
      'Factory/Lead',
      'Factory/Pad',
      'User/My Preset 1',
      'User/My Preset 2',
    ],
    selectedIndex: 0,
    showFolders: true,
    showSearch: true,
    backgroundColor: '#1f2937',
    itemColor: 'transparent',
    selectedColor: '#3b82f6',
    textColor: '#e5e7eb',
    selectedTextColor: '#ffffff',
    fontSize: 13,
    itemHeight: 28,
    borderColor: '#374151',
    borderRadius: 4,
    ...overrides,
  }
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>PresetBrowserElementConfig type defined with type guard and factory function</done>
</task>

<task type="auto">
  <name>Task 2: Create PresetBrowserRenderer and update Element switch</name>
  <files>
src/components/elements/renderers/PresetBrowserRenderer.tsx
src/components/elements/Element.tsx
  </files>
  <action>
Create PresetBrowserRenderer.tsx:
```tsx
import type { PresetBrowserElementConfig } from '../../../types/elements'

interface PresetBrowserRendererProps {
  config: PresetBrowserElementConfig
}

interface PresetItem {
  name: string
  folder?: string
  isFolder: boolean
  depth: number
}

export function PresetBrowserRenderer({ config }: PresetBrowserRendererProps) {
  // Parse presets into structured list
  const parsePresets = (): PresetItem[] => {
    if (!config.showFolders) {
      // Flat list - just show preset names
      return config.presets.map(p => ({
        name: p.includes('/') ? p.split('/').pop()! : p,
        isFolder: false,
        depth: 0,
      }))
    }

    // Group by folder
    const folders = new Map<string, string[]>()
    const rootPresets: string[] = []

    config.presets.forEach(preset => {
      if (preset.includes('/')) {
        const [folder, name] = preset.split('/')
        if (!folders.has(folder)) {
          folders.set(folder, [])
        }
        folders.get(folder)!.push(name)
      } else {
        rootPresets.push(preset)
      }
    })

    const items: PresetItem[] = []

    // Add folders with their presets
    folders.forEach((presets, folderName) => {
      items.push({ name: folderName, isFolder: true, depth: 0 })
      presets.forEach(preset => {
        items.push({ name: preset, folder: folderName, isFolder: false, depth: 1 })
      })
    })

    // Add root presets
    rootPresets.forEach(preset => {
      items.push({ name: preset, isFolder: false, depth: 0 })
    })

    return items
  }

  const items = parsePresets()

  // Find selected item index in parsed list
  const getSelectedItemIndex = () => {
    if (config.selectedIndex < 0 || config.selectedIndex >= config.presets.length) return -1
    const selectedPreset = config.presets[config.selectedIndex]
    return items.findIndex(item =>
      !item.isFolder && (
        (item.folder ? `${item.folder}/${item.name}` : item.name) === selectedPreset
      )
    )
  }

  const selectedItemIndex = getSelectedItemIndex()

  return (
    <div
      className="presetbrowser-element"
      style={{
        width: '100%',
        height: '100%',
        backgroundColor: config.backgroundColor,
        border: `1px solid ${config.borderColor}`,
        borderRadius: `${config.borderRadius}px`,
        display: 'flex',
        flexDirection: 'column',
        overflow: 'hidden',
      }}
    >
      {/* Search bar placeholder */}
      {config.showSearch && (
        <div
          style={{
            padding: '8px',
            borderBottom: `1px solid ${config.borderColor}`,
          }}
        >
          <div
            style={{
              backgroundColor: '#111827',
              border: `1px solid ${config.borderColor}`,
              borderRadius: '4px',
              padding: '6px 10px',
              fontSize: '12px',
              color: '#6b7280',
            }}
          >
            Search presets...
          </div>
        </div>
      )}

      {/* Preset list */}
      <div
        style={{
          flex: 1,
          overflow: 'auto',
        }}
      >
        {items.map((item, idx) => {
          const isSelected = idx === selectedItemIndex

          return (
            <div
              key={idx}
              style={{
                height: `${config.itemHeight}px`,
                display: 'flex',
                alignItems: 'center',
                paddingLeft: `${8 + item.depth * 16}px`,
                paddingRight: '8px',
                backgroundColor: isSelected ? config.selectedColor : config.itemColor,
                color: isSelected ? config.selectedTextColor : config.textColor,
                fontSize: `${config.fontSize}px`,
                cursor: 'pointer',
                userSelect: 'none',
              }}
            >
              {item.isFolder && (
                <span style={{ marginRight: '6px', opacity: 0.7 }}>üìÅ</span>
              )}
              {!item.isFolder && item.depth > 0 && (
                <span style={{ marginRight: '6px', opacity: 0.5 }}>‚ô™</span>
              )}
              {item.name}
            </div>
          )
        })}
      </div>
    </div>
  )
}
```

Update Element.tsx:
1. Import PresetBrowserRenderer
2. Add case:
```tsx
case 'presetbrowser':
  return <PresetBrowserRenderer config={element} />
```
  </action>
  <verify>TypeScript compiles and preset browser renders with folder hierarchy and selection</verify>
  <done>PresetBrowserRenderer shows list with folders and presets; Element.tsx routes correctly</done>
</task>

<task type="auto">
  <name>Task 3: Add property panel, palette entry, and export</name>
  <files>
src/components/Properties/PresetBrowserProperties.tsx
src/components/Properties/PropertyPanel.tsx
src/components/Palette/Palette.tsx
src/services/export/htmlGenerator.ts
src/services/export/cssGenerator.ts
  </files>
  <action>
Create PresetBrowserProperties.tsx:
```tsx
import { PropertySection } from './PropertySection'
import { NumberInput } from './NumberInput'
import { ColorInput } from './ColorInput'
import type { PresetBrowserElementConfig, ElementConfig } from '../../types/elements'

interface PresetBrowserPropertiesProps {
  element: PresetBrowserElementConfig
  onUpdate: (updates: Partial<ElementConfig>) => void
}

export function PresetBrowserProperties({ element, onUpdate }: PresetBrowserPropertiesProps) {
  const handlePresetsChange = (text: string) => {
    const presets = text.split('\n').filter(line => line.trim() !== '')
    onUpdate({ presets })
  }

  return (
    <>
      <PropertySection title="Presets">
        <div>
          <label className="block text-xs text-gray-400 mb-1">Presets (one per line, use Folder/Name for hierarchy)</label>
          <textarea
            value={element.presets.join('\n')}
            onChange={(e) => handlePresetsChange(e.target.value)}
            className="w-full bg-gray-700 border border-gray-600 text-white rounded px-2 py-1.5 text-sm"
            rows={6}
            placeholder="Factory/Init&#10;Factory/Bass&#10;User/My Preset"
          />
        </div>
        <NumberInput
          label="Selected Index"
          value={element.selectedIndex}
          onChange={(selectedIndex) => onUpdate({ selectedIndex })}
          min={0}
          max={Math.max(0, element.presets.length - 1)}
        />
      </PropertySection>

      <PropertySection title="Display">
        <label className="flex items-center gap-2 text-sm cursor-pointer select-none">
          <input
            type="checkbox"
            checked={element.showFolders}
            onChange={(e) => onUpdate({ showFolders: e.target.checked })}
            className="rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500"
          />
          <span className="text-gray-300">Show Folders</span>
        </label>
        <label className="flex items-center gap-2 text-sm cursor-pointer select-none">
          <input
            type="checkbox"
            checked={element.showSearch}
            onChange={(e) => onUpdate({ showSearch: e.target.checked })}
            className="rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500"
          />
          <span className="text-gray-300">Show Search Bar</span>
        </label>
      </PropertySection>

      <PropertySection title="Item Styling">
        <NumberInput
          label="Font Size"
          value={element.fontSize}
          onChange={(fontSize) => onUpdate({ fontSize })}
          min={10}
          max={18}
        />
        <NumberInput
          label="Item Height"
          value={element.itemHeight}
          onChange={(itemHeight) => onUpdate({ itemHeight })}
          min={20}
          max={40}
        />
        <ColorInput
          label="Text Color"
          value={element.textColor}
          onChange={(textColor) => onUpdate({ textColor })}
        />
        <ColorInput
          label="Selected Color"
          value={element.selectedColor}
          onChange={(selectedColor) => onUpdate({ selectedColor })}
        />
        <ColorInput
          label="Selected Text"
          value={element.selectedTextColor}
          onChange={(selectedTextColor) => onUpdate({ selectedTextColor })}
        />
      </PropertySection>

      <PropertySection title="Appearance">
        <ColorInput
          label="Background"
          value={element.backgroundColor}
          onChange={(backgroundColor) => onUpdate({ backgroundColor })}
        />
        <ColorInput
          label="Border Color"
          value={element.borderColor}
          onChange={(borderColor) => onUpdate({ borderColor })}
        />
        <NumberInput
          label="Border Radius"
          value={element.borderRadius}
          onChange={(borderRadius) => onUpdate({ borderRadius })}
          min={0}
          max={16}
        />
      </PropertySection>
    </>
  )
}
```

Update PropertyPanel.tsx with case for presetbrowser.

Update Palette.tsx - add to "Complex Widgets" category (if exists from 13-10):
```typescript
{ id: 'presetbrowser', type: 'presetbrowser', name: 'Preset Browser' },
```

Update htmlGenerator.ts:
```typescript
case 'presetbrowser':
  const presetsData = element.presets.map(p => escapeHTML(p)).join('|')
  return `<div id="${id}" class="${baseClass} presetbrowser-element" data-type="presetbrowser" data-presets="${presetsData}" data-selected="${element.selectedIndex}" style="${positionStyle}">
    ${element.showSearch ? '<div class="preset-search"><input type="text" placeholder="Search presets..." /></div>' : ''}
    <div class="preset-list"></div>
  </div>`
```

Update cssGenerator.ts with preset browser styles.
  </action>
  <verify>
1. Run `npm run dev`
2. Find Preset Browser in "Complex Widgets" category
3. Drag to canvas - verify list with folders displays
4. In property panel, add/remove presets
5. Toggle showFolders, verify hierarchy changes
6. Toggle showSearch, verify search bar appears/disappears
7. Change selectedIndex, verify selection highlights
8. Export project, verify HTML contains data-presets
  </verify>
  <done>PresetBrowserProperties complete; Palette entry added; Export generates list structure with data attributes</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npm run build`
2. Preset Browser appears in Complex Widgets palette category
3. Browser renders with folder/preset hierarchy
4. Search bar placeholder shows when enabled
5. Selected preset is highlighted
6. Property panel allows editing presets as text
7. Folder hierarchy toggle works
8. Exported HTML contains data-presets and data-selected attributes
9. Exported CSS contains browser styling
</verification>

<success_criteria>
- [ ] PresetBrowserElementConfig type exists with presets array
- [ ] Type guard isPresetBrowser works correctly
- [ ] Factory function createPresetBrowser has sample presets
- [ ] PresetBrowserRenderer displays folder hierarchy
- [ ] Search bar placeholder shows when showSearch is true
- [ ] Selected preset is visually highlighted
- [ ] Element.tsx handles 'presetbrowser' type
- [ ] PresetBrowserProperties allows editing presets
- [ ] Complex Widgets category includes Preset Browser
- [ ] HTML export contains data attributes for JUCE
- [ ] CSS export generates browser styling
</success_criteria>

<output>
After completion, create `.planning/phases/13-extended-elements/13-11-SUMMARY.md`
</output>
