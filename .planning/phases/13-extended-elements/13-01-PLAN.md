---
phase: 13-extended-elements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements.ts
  - src/components/elements/Element.tsx
  - src/components/elements/renderers/KnobRenderer.tsx
  - src/components/elements/renderers/SliderRenderer.tsx
  - src/components/Properties/KnobProperties.tsx
  - src/components/Properties/SliderProperties.tsx
  - src/services/export/htmlGenerator.ts
  - src/services/export/cssGenerator.ts
autonomous: true

must_haves:
  truths:
    - "Knob element shows optional label text above/below/left/right of the knob"
    - "Knob element shows optional value display in configurable format"
    - "Slider element shows optional label text in configurable position"
    - "Slider element shows optional value display in configurable format"
    - "Label/value settings are configurable in property panel"
    - "Label/value export correctly to HTML/CSS"
  artifacts:
    - path: "src/types/elements.ts"
      provides: "Extended KnobElementConfig and SliderElementConfig with label/value properties"
      contains: "showLabel"
    - path: "src/components/elements/renderers/KnobRenderer.tsx"
      provides: "Knob rendering with optional label and value display"
      contains: "labelPosition"
    - path: "src/components/elements/renderers/SliderRenderer.tsx"
      provides: "Slider rendering with optional label and value display"
      contains: "labelPosition"
  key_links:
    - from: "src/components/Properties/KnobProperties.tsx"
      to: "src/types/elements.ts"
      via: "showLabel, showValue, labelPosition, valueFormat properties"
    - from: "src/services/export/htmlGenerator.ts"
      to: "src/types/elements.ts"
      via: "Label/value HTML generation for knobs and sliders"
---

<objective>
Add optional integrated label and value display fields to Knob and Slider elements.

Purpose: Professional audio plugin UIs need parameter labels and real-time value readouts attached to controls. This is requirement ELEM-07.

Output:
- Extended element type definitions with label/value properties
- Updated renderers showing label and value alongside controls
- Property panel controls for label/value configuration
- Export support for label/value in HTML/CSS
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-extended-elements/13-CONTEXT.md
@.planning/phases/13-extended-elements/13-RESEARCH.md

@src/types/elements.ts
@src/components/elements/renderers/KnobRenderer.tsx
@src/components/elements/renderers/SliderRenderer.tsx
@src/components/Properties/KnobProperties.tsx
@src/components/Properties/SliderProperties.tsx
@src/services/export/htmlGenerator.ts
@src/services/export/cssGenerator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend element types with label/value properties</name>
  <files>src/types/elements.ts</files>
  <action>
Add label/value properties to KnobElementConfig and SliderElementConfig interfaces:

For BOTH KnobElementConfig and SliderElementConfig, add:
```typescript
// Label Display
showLabel: boolean
labelText: string
labelPosition: 'top' | 'bottom' | 'left' | 'right'
labelFontSize: number
labelColor: string

// Value Display
showValue: boolean
valuePosition: 'top' | 'bottom' | 'left' | 'right'
valueFormat: 'numeric' | 'percentage' | 'db' | 'hz' | 'custom'
valueSuffix: string  // For custom format
valueDecimalPlaces: number
valueFontSize: number
valueColor: string
```

Update factory functions createKnob() and createSlider() with defaults:
- showLabel: false
- labelText: element name
- labelPosition: 'bottom'
- labelFontSize: 12
- labelColor: '#ffffff'
- showValue: false
- valuePosition: 'top'
- valueFormat: 'numeric'
- valueSuffix: ''
- valueDecimalPlaces: 2
- valueFontSize: 12
- valueColor: '#a0a0a0'

Keep width/height defaults the same - the label/value are rendered OUTSIDE the control bounds.
  </action>
  <verify>TypeScript compiles without errors: `npm run build` or `npx tsc --noEmit`</verify>
  <done>KnobElementConfig and SliderElementConfig have label/value properties; factory functions provide sensible defaults</done>
</task>

<task type="auto">
  <name>Task 2: Update renderers to show label and value</name>
  <files>
src/components/elements/renderers/KnobRenderer.tsx
src/components/elements/renderers/SliderRenderer.tsx
  </files>
  <action>
Update KnobRenderer to show label and value:

1. Import value formatting utility (create inline or as helper):
```typescript
function formatValue(value: number, min: number, max: number, format: string, suffix: string, decimals: number): string {
  const actual = min + value * (max - min)
  switch (format) {
    case 'percentage': return `${Math.round(value * 100)}%`
    case 'db': return `${actual.toFixed(decimals)} dB`
    case 'hz': return actual >= 1000 ? `${(actual / 1000).toFixed(decimals)} kHz` : `${actual.toFixed(decimals)} Hz`
    case 'custom': return `${actual.toFixed(decimals)}${suffix}`
    default: return actual.toFixed(decimals)
  }
}
```

2. Wrap existing knob SVG in a flex container that positions label/value:
- Use CSS flexbox with direction based on position (top/bottom = column, left/right = row)
- Label and value are rendered as <span> elements outside the SVG
- The SVG (knob itself) stays centered; label/value are positioned around it
- Use absolute positioning with overflow: visible on parent to allow label/value outside bounds

3. Render label span if config.showLabel is true:
```tsx
{config.showLabel && (
  <span style={{
    position: 'absolute',
    fontSize: config.labelFontSize,
    color: config.labelColor,
    whiteSpace: 'nowrap',
    // Position based on labelPosition
  }}>
    {config.labelText}
  </span>
)}
```

4. Render value span if config.showValue is true, using formatValue()

Apply same pattern to SliderRenderer:
- Wrap slider track/thumb in container
- Add label/value spans positioned based on config
- Use same formatValue utility

IMPORTANT: The label/value are positioned relative to the control using absolute positioning. They may extend beyond the element bounds - this is intentional and matches how professional audio plugins display labels.
  </action>
  <verify>Run `npm run dev`, add a Knob, enable showLabel and showValue in property panel (after Task 3), verify label and value appear in correct positions</verify>
  <done>Knobs and Sliders render optional label and value displays based on config properties</done>
</task>

<task type="auto">
  <name>Task 3: Add label/value controls to property panels and update export</name>
  <files>
src/components/Properties/KnobProperties.tsx
src/components/Properties/SliderProperties.tsx
src/services/export/htmlGenerator.ts
src/services/export/cssGenerator.ts
  </files>
  <action>
Update KnobProperties.tsx:

1. Add new PropertySection "Label":
- Checkbox: "Show Label" (showLabel)
- TextInput: "Label Text" (labelText) - only visible if showLabel
- Select: "Position" with options top/bottom/left/right (labelPosition)
- NumberInput: "Font Size" (labelFontSize)
- ColorInput: "Color" (labelColor)

2. Add new PropertySection "Value Display":
- Checkbox: "Show Value" (showValue)
- Select: "Position" with options top/bottom/left/right (valuePosition)
- Select: "Format" with options Numeric/Percentage/dB/Hz/Custom (valueFormat)
- TextInput: "Suffix" (valueSuffix) - only visible if format is custom
- NumberInput: "Decimal Places" (valueDecimalPlaces)
- NumberInput: "Font Size" (valueFontSize)
- ColorInput: "Color" (valueColor)

Apply identical changes to SliderProperties.tsx.

Update htmlGenerator.ts generateKnobHTML():
- Add label span if showLabel is true
- Add value span if showValue is true
- Use same positioning logic as renderer

Update htmlGenerator.ts generateSliderHTML():
- Add label span if showLabel is true
- Add value span if showValue is true

Update cssGenerator.ts:
- Add CSS for .knob-label, .knob-value, .slider-label, .slider-value classes
- Handle positioning for each labelPosition/valuePosition option
  </action>
  <verify>
1. Run `npm run dev`
2. Add a Knob to canvas
3. In property panel, find "Label" section, check "Show Label"
4. Verify label appears on canvas below knob
5. Change position to "top", verify label moves
6. Enable "Show Value", verify value appears
7. Export project, verify HTML contains label/value spans
  </verify>
  <done>Property panels have label/value controls; export generates label/value HTML/CSS correctly</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npm run build`
2. Knob with label enabled shows label at configured position
3. Knob with value enabled shows formatted value at configured position
4. Slider with label/value works identically
5. All value formats display correctly (numeric, percentage, dB, Hz, custom)
6. Exported HTML contains label/value markup
7. Exported CSS contains label/value positioning styles
</verification>

<success_criteria>
- [ ] KnobElementConfig has 10 new label/value properties
- [ ] SliderElementConfig has 10 new label/value properties
- [ ] KnobRenderer displays optional label and value
- [ ] SliderRenderer displays optional label and value
- [ ] KnobProperties has Label and Value Display sections
- [ ] SliderProperties has Label and Value Display sections
- [ ] HTML export includes label/value spans
- [ ] CSS export includes label/value positioning
- [ ] Value formatting works for all 5 formats
</success_criteria>

<output>
After completion, create `.planning/phases/13-extended-elements/13-01-SUMMARY.md`
</output>
