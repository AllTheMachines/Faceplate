---
phase: 13-extended-elements
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements.ts
  - src/components/elements/Element.tsx
  - src/components/elements/renderers/PanelRenderer.tsx
  - src/components/elements/renderers/FrameRenderer.tsx
  - src/components/elements/renderers/GroupBoxRenderer.tsx
  - src/components/Properties/PanelProperties.tsx
  - src/components/Properties/FrameProperties.tsx
  - src/components/Properties/GroupBoxProperties.tsx
  - src/components/Properties/PropertyPanel.tsx
  - src/components/Palette/Palette.tsx
  - src/services/export/htmlGenerator.ts
  - src/services/export/cssGenerator.ts
autonomous: true

must_haves:
  truths:
    - "User can add Panel element from palette to canvas"
    - "User can add Frame element from palette to canvas"
    - "User can add Group Box element with header text from palette to canvas"
    - "Panel displays as background box with configurable color and border radius"
    - "Frame displays as bordered container with configurable border style"
    - "Group Box displays with header text that breaks the border"
    - "All container elements export correctly to HTML/CSS"
  artifacts:
    - path: "src/types/elements.ts"
      provides: "PanelElementConfig, FrameElementConfig, GroupBoxElementConfig interfaces"
      contains: "type: 'panel'"
    - path: "src/components/elements/renderers/PanelRenderer.tsx"
      provides: "Panel visual rendering"
      min_lines: 20
    - path: "src/components/elements/renderers/GroupBoxRenderer.tsx"
      provides: "Group Box with header rendering"
      contains: "headerText"
  key_links:
    - from: "src/components/elements/Element.tsx"
      to: "renderers"
      via: "switch statement includes panel, frame, groupbox cases"
    - from: "src/components/Palette/Palette.tsx"
      to: "paletteCategories"
      via: "Containers category with Panel, Frame, Group Box items"
---

<objective>
Add container elements (Panel, Frame, Group Box) for visual grouping of UI sections.

Purpose: Professional plugin UIs need visual containers to organize related controls into logical sections. This is requirement ELEM-08.

Output:
- Three new element types: Panel, Frame, Group Box
- Renderers for each container type
- Property panels for container configuration
- Palette category "Containers" with all three elements
- Export support in HTML/CSS generators

NOTE: These are VISUAL containers only in Phase 13. They do not support parent-child element nesting - that requires store architecture changes for a future phase.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-extended-elements/13-CONTEXT.md
@.planning/phases/13-extended-elements/13-RESEARCH.md

@src/types/elements.ts
@src/components/elements/Element.tsx
@src/components/Properties/PropertyPanel.tsx
@src/components/Palette/Palette.tsx
@src/services/export/htmlGenerator.ts
@src/services/export/cssGenerator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add container element types and factories</name>
  <files>src/types/elements.ts</files>
  <action>
Add three new element config interfaces:

1. PanelElementConfig:
```typescript
export interface PanelElementConfig extends BaseElementConfig {
  type: 'panel'
  backgroundColor: string
  borderRadius: number
  borderWidth: number
  borderColor: string
  padding: number
}
```

2. FrameElementConfig:
```typescript
export interface FrameElementConfig extends BaseElementConfig {
  type: 'frame'
  borderStyle: 'solid' | 'dashed' | 'dotted' | 'double' | 'groove' | 'ridge'
  borderWidth: number
  borderColor: string
  borderRadius: number
  padding: number
}
```

3. GroupBoxElementConfig:
```typescript
export interface GroupBoxElementConfig extends BaseElementConfig {
  type: 'groupbox'
  headerText: string
  headerFontSize: number
  headerColor: string
  headerBackground: string  // Background behind header text
  borderWidth: number
  borderColor: string
  borderRadius: number
  padding: number
}
```

Update ElementConfig union:
```typescript
export type ElementConfig =
  | KnobElementConfig
  | SliderElementConfig
  | ButtonElementConfig
  | LabelElementConfig
  | MeterElementConfig
  | ImageElementConfig
  | PanelElementConfig
  | FrameElementConfig
  | GroupBoxElementConfig
```

Add type guards:
```typescript
export function isPanel(element: ElementConfig): element is PanelElementConfig {
  return element.type === 'panel'
}
export function isFrame(element: ElementConfig): element is FrameElementConfig {
  return element.type === 'frame'
}
export function isGroupBox(element: ElementConfig): element is GroupBoxElementConfig {
  return element.type === 'groupbox'
}
```

Add factory functions with defaults:
```typescript
export function createPanel(overrides?: Partial<PanelElementConfig>): PanelElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'panel',
    name: 'Panel',
    x: 0, y: 0,
    width: 200, height: 150,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    backgroundColor: '#1e293b',
    borderRadius: 8,
    borderWidth: 0,
    borderColor: '#334155',
    padding: 12,
    ...overrides,
  }
}

export function createFrame(overrides?: Partial<FrameElementConfig>): FrameElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'frame',
    name: 'Frame',
    x: 0, y: 0,
    width: 200, height: 150,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    borderStyle: 'solid',
    borderWidth: 2,
    borderColor: '#475569',
    borderRadius: 4,
    padding: 12,
    ...overrides,
  }
}

export function createGroupBox(overrides?: Partial<GroupBoxElementConfig>): GroupBoxElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'groupbox',
    name: 'Group Box',
    x: 0, y: 0,
    width: 200, height: 150,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    headerText: 'Group',
    headerFontSize: 14,
    headerColor: '#e2e8f0',
    headerBackground: '#1e293b',
    borderWidth: 1,
    borderColor: '#475569',
    borderRadius: 4,
    padding: 16,
    ...overrides,
  }
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Three container element types defined with type guards and factory functions</done>
</task>

<task type="auto">
  <name>Task 2: Create renderers and update Element switch</name>
  <files>
src/components/elements/renderers/PanelRenderer.tsx
src/components/elements/renderers/FrameRenderer.tsx
src/components/elements/renderers/GroupBoxRenderer.tsx
src/components/elements/Element.tsx
  </files>
  <action>
Create PanelRenderer.tsx:
```tsx
import type { PanelElementConfig } from '../../../types/elements'

interface PanelRendererProps {
  config: PanelElementConfig
}

export function PanelRenderer({ config }: PanelRendererProps) {
  return (
    <div
      className="panel-element"
      style={{
        width: '100%',
        height: '100%',
        backgroundColor: config.backgroundColor,
        borderRadius: `${config.borderRadius}px`,
        border: config.borderWidth > 0 ? `${config.borderWidth}px solid ${config.borderColor}` : 'none',
        padding: `${config.padding}px`,
        boxSizing: 'border-box',
      }}
    />
  )
}
```

Create FrameRenderer.tsx:
```tsx
import type { FrameElementConfig } from '../../../types/elements'

interface FrameRendererProps {
  config: FrameElementConfig
}

export function FrameRenderer({ config }: FrameRendererProps) {
  return (
    <div
      className="frame-element"
      style={{
        width: '100%',
        height: '100%',
        border: `${config.borderWidth}px ${config.borderStyle} ${config.borderColor}`,
        borderRadius: `${config.borderRadius}px`,
        padding: `${config.padding}px`,
        boxSizing: 'border-box',
      }}
    />
  )
}
```

Create GroupBoxRenderer.tsx:
```tsx
import type { GroupBoxElementConfig } from '../../../types/elements'

interface GroupBoxRendererProps {
  config: GroupBoxElementConfig
}

export function GroupBoxRenderer({ config }: GroupBoxRendererProps) {
  const headerId = `${config.id}-header`

  return (
    <div
      className="groupbox-element"
      role="group"
      aria-labelledby={headerId}
      style={{
        width: '100%',
        height: '100%',
        border: `${config.borderWidth}px solid ${config.borderColor}`,
        borderRadius: `${config.borderRadius}px`,
        padding: `${config.padding}px`,
        paddingTop: `${config.padding + config.headerFontSize / 2}px`,
        position: 'relative',
        boxSizing: 'border-box',
      }}
    >
      <div
        id={headerId}
        style={{
          position: 'absolute',
          top: `-${config.headerFontSize / 2}px`,
          left: '12px',
          backgroundColor: config.headerBackground,
          padding: '0 8px',
          fontSize: `${config.headerFontSize}px`,
          fontWeight: 600,
          color: config.headerColor,
          lineHeight: 1,
        }}
      >
        {config.headerText}
      </div>
    </div>
  )
}
```

Update Element.tsx:
1. Add imports for all three renderers
2. Add cases to switch statement:
```tsx
case 'panel':
  return <PanelRenderer config={element} />
case 'frame':
  return <FrameRenderer config={element} />
case 'groupbox':
  return <GroupBoxRenderer config={element} />
```

The exhaustive check at the end will now error until these cases are added - this is good TypeScript behavior.
  </action>
  <verify>TypeScript compiles and `npm run dev` shows no console errors</verify>
  <done>Three renderer components created; Element.tsx routes to correct renderer for each container type</done>
</task>

<task type="auto">
  <name>Task 3: Add property panels, palette category, and export</name>
  <files>
src/components/Properties/PanelProperties.tsx
src/components/Properties/FrameProperties.tsx
src/components/Properties/GroupBoxProperties.tsx
src/components/Properties/PropertyPanel.tsx
src/components/Palette/Palette.tsx
src/services/export/htmlGenerator.ts
src/services/export/cssGenerator.ts
  </files>
  <action>
Create PanelProperties.tsx:
- PropertySection "Appearance": backgroundColor (ColorInput), borderRadius (NumberInput)
- PropertySection "Border": borderWidth (NumberInput), borderColor (ColorInput)
- PropertySection "Layout": padding (NumberInput)

Create FrameProperties.tsx:
- PropertySection "Border": borderStyle (select), borderWidth, borderColor, borderRadius
- PropertySection "Layout": padding

Create GroupBoxProperties.tsx:
- PropertySection "Header": headerText (TextInput), headerFontSize (NumberInput), headerColor (ColorInput), headerBackground (ColorInput)
- PropertySection "Border": borderWidth, borderColor, borderRadius
- PropertySection "Layout": padding

Update PropertyPanel.tsx:
1. Import all three property components
2. Add cases to the type-specific rendering:
```tsx
case 'panel':
  return <PanelProperties element={selectedElement} onUpdate={handleUpdate} />
case 'frame':
  return <FrameProperties element={selectedElement} onUpdate={handleUpdate} />
case 'groupbox':
  return <GroupBoxProperties element={selectedElement} onUpdate={handleUpdate} />
```

Update Palette.tsx - add new category:
```typescript
{
  name: 'Containers',
  items: [
    { id: 'panel', type: 'panel', name: 'Panel' },
    { id: 'frame', type: 'frame', name: 'Frame' },
    { id: 'groupbox', type: 'groupbox', name: 'Group Box' },
  ],
},
```

Update htmlGenerator.ts - add cases:
```typescript
case 'panel':
  return `<div id="${id}" class="${baseClass} panel-element" data-type="panel" style="${positionStyle}"></div>`

case 'frame':
  return `<div id="${id}" class="${baseClass} frame-element" data-type="frame" style="${positionStyle}"></div>`

case 'groupbox':
  return `<div id="${id}" class="${baseClass} groupbox-element" data-type="groupbox" role="group" style="${positionStyle}">
    <span class="groupbox-header">${escapeHTML(element.headerText)}</span>
  </div>`
```

Update cssGenerator.ts - add cases:
```typescript
case 'panel':
  return `${selector} {
  background-color: ${element.backgroundColor};
  border-radius: ${element.borderRadius}px;
  ${element.borderWidth > 0 ? `border: ${element.borderWidth}px solid ${element.borderColor};` : ''}
  padding: ${element.padding}px;
  box-sizing: border-box;
}`

case 'frame':
  return `${selector} {
  border: ${element.borderWidth}px ${element.borderStyle} ${element.borderColor};
  border-radius: ${element.borderRadius}px;
  padding: ${element.padding}px;
  box-sizing: border-box;
}`

case 'groupbox':
  return `${selector} {
  border: ${element.borderWidth}px solid ${element.borderColor};
  border-radius: ${element.borderRadius}px;
  padding: ${element.padding}px;
  padding-top: ${element.padding + element.headerFontSize / 2}px;
  position: relative;
  box-sizing: border-box;
}
${selector} .groupbox-header {
  position: absolute;
  top: -${element.headerFontSize / 2}px;
  left: 12px;
  background: ${element.headerBackground};
  padding: 0 8px;
  font-size: ${element.headerFontSize}px;
  font-weight: 600;
  color: ${element.headerColor};
  line-height: 1;
}`
```
  </action>
  <verify>
1. Run `npm run dev`
2. Open Palette, find "Containers" category
3. Drag Panel to canvas - verify background appears
4. Drag Frame to canvas - verify border appears
5. Drag Group Box to canvas - verify header text appears
6. Select each, verify property panel shows appropriate controls
7. Export project, verify HTML/CSS contains container markup
  </verify>
  <done>Property panels complete; Palette has Containers category; Export generates container HTML/CSS</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npm run build`
2. Palette shows "Containers" category with Panel, Frame, Group Box
3. Each container type renders correctly on canvas
4. Property panels have appropriate controls for each container type
5. Group Box shows header text that "breaks" the border
6. Exported HTML contains container divs with correct data-type attributes
7. Exported CSS contains container-specific styling
</verification>

<success_criteria>
- [ ] PanelElementConfig, FrameElementConfig, GroupBoxElementConfig types exist
- [ ] Type guards isPanel, isFrame, isGroupBox work correctly
- [ ] Factory functions createPanel, createFrame, createGroupBox have sensible defaults
- [ ] PanelRenderer, FrameRenderer, GroupBoxRenderer render correctly
- [ ] Element.tsx switch handles all three container types
- [ ] Property panels exist for all three container types
- [ ] Palette "Containers" category contains all three elements
- [ ] HTML export generates container markup
- [ ] CSS export generates container styles
</success_criteria>

<output>
After completion, create `.planning/phases/13-extended-elements/13-02-SUMMARY.md`
</output>
