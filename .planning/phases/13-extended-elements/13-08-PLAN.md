---
phase: 13-extended-elements
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements.ts
  - src/components/elements/Element.tsx
  - src/components/elements/renderers/DbDisplayRenderer.tsx
  - src/components/elements/renderers/FrequencyDisplayRenderer.tsx
  - src/components/elements/renderers/GainReductionMeterRenderer.tsx
  - src/components/Properties/DbDisplayProperties.tsx
  - src/components/Properties/FrequencyDisplayProperties.tsx
  - src/components/Properties/GainReductionMeterProperties.tsx
  - src/components/Properties/PropertyPanel.tsx
  - src/components/Palette/Palette.tsx
  - src/services/export/htmlGenerator.ts
  - src/services/export/cssGenerator.ts
autonomous: true

must_haves:
  truths:
    - "User can add dB Display showing decibel value with unit"
    - "User can add Frequency Display showing Hz/kHz with auto-switching"
    - "User can add Gain Reduction Meter that grows downward (inverted)"
    - "dB Display shows configurable decimal places and range"
    - "Frequency Display auto-switches between Hz and kHz at 1000Hz"
    - "All audio displays export correctly to HTML/CSS"
  artifacts:
    - path: "src/types/elements.ts"
      provides: "DbDisplayElementConfig, FrequencyDisplayElementConfig, GainReductionMeterElementConfig interfaces"
      contains: "type: 'dbdisplay'"
    - path: "src/components/elements/renderers/GainReductionMeterRenderer.tsx"
      provides: "Inverted meter that grows from top"
      contains: "inverted"
  key_links:
    - from: "src/components/Palette/Palette.tsx"
      to: "paletteCategories"
      via: "Audio Displays category"
---

<objective>
Add specialized audio display elements (dB Display, Frequency Display, Gain Reduction Meter).

Purpose: Professional audio plugins need specialized readouts for levels, frequencies, and dynamics processing. This is requirement ELEM-11.

Output:
- Three audio display element types
- Renderers with appropriate formatting
- Property panels for configuration
- New Palette category "Audio Displays"
- Export support
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-extended-elements/13-CONTEXT.md
@.planning/phases/13-extended-elements/13-RESEARCH.md

@src/types/elements.ts
@src/components/elements/Element.tsx
@src/components/Properties/PropertyPanel.tsx
@src/components/Palette/Palette.tsx
@src/services/export/htmlGenerator.ts
@src/services/export/cssGenerator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add audio display element types</name>
  <files>src/types/elements.ts</files>
  <action>
Add three audio display interfaces:

1. DbDisplayElementConfig:
```typescript
export interface DbDisplayElementConfig extends BaseElementConfig {
  type: 'dbdisplay'

  // Value
  value: number  // Actual dB value (can be negative)
  minDb: number  // Display range minimum (e.g., -60)
  maxDb: number  // Display range maximum (e.g., 0)

  // Display
  decimalPlaces: number
  showUnit: boolean  // Show "dB" suffix

  // Appearance
  fontSize: number
  fontFamily: string
  textColor: string
  backgroundColor: string
  padding: number
}
```

2. FrequencyDisplayElementConfig:
```typescript
export interface FrequencyDisplayElementConfig extends BaseElementConfig {
  type: 'frequencydisplay'

  // Value (always stored as Hz)
  value: number  // Frequency in Hz

  // Display
  decimalPlaces: number
  autoSwitchKHz: boolean  // Auto-switch to kHz at >= 1000Hz
  showUnit: boolean

  // Appearance
  fontSize: number
  fontFamily: string
  textColor: string
  backgroundColor: string
  padding: number
}
```

3. GainReductionMeterElementConfig:
```typescript
export interface GainReductionMeterElementConfig extends BaseElementConfig {
  type: 'gainreductionmeter'

  // Orientation (typically vertical for GR meters)
  orientation: 'vertical' | 'horizontal'

  // Value (0-1 normalized, but displayed inverted - grows from top/right)
  value: number
  maxReduction: number  // Maximum dB reduction to display (e.g., -24)

  // Colors
  meterColor: string
  backgroundColor: string

  // Display
  showValue: boolean
  fontSize: number
  textColor: string
}
```

Update ElementConfig union.

Add type guards:
```typescript
export function isDbDisplay(element: ElementConfig): element is DbDisplayElementConfig {
  return element.type === 'dbdisplay'
}
export function isFrequencyDisplay(element: ElementConfig): element is FrequencyDisplayElementConfig {
  return element.type === 'frequencydisplay'
}
export function isGainReductionMeter(element: ElementConfig): element is GainReductionMeterElementConfig {
  return element.type === 'gainreductionmeter'
}
```

Add factory functions:
```typescript
export function createDbDisplay(overrides?: Partial<DbDisplayElementConfig>): DbDisplayElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'dbdisplay',
    name: 'dB Display',
    x: 0, y: 0,
    width: 80, height: 30,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    value: -12,
    minDb: -60,
    maxDb: 0,
    decimalPlaces: 1,
    showUnit: true,
    fontSize: 16,
    fontFamily: 'Roboto Mono, monospace',
    textColor: '#10b981',
    backgroundColor: '#1f2937',
    padding: 8,
    ...overrides,
  }
}

export function createFrequencyDisplay(overrides?: Partial<FrequencyDisplayElementConfig>): FrequencyDisplayElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'frequencydisplay',
    name: 'Frequency Display',
    x: 0, y: 0,
    width: 100, height: 30,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    value: 1000,
    decimalPlaces: 1,
    autoSwitchKHz: true,
    showUnit: true,
    fontSize: 16,
    fontFamily: 'Roboto Mono, monospace',
    textColor: '#3b82f6',
    backgroundColor: '#1f2937',
    padding: 8,
    ...overrides,
  }
}

export function createGainReductionMeter(overrides?: Partial<GainReductionMeterElementConfig>): GainReductionMeterElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'gainreductionmeter',
    name: 'GR Meter',
    x: 0, y: 0,
    width: 30, height: 120,
    rotation: 0, zIndex: 0,
    locked: false, visible: true,
    orientation: 'vertical',
    value: 0.25,  // 25% reduction
    maxReduction: -24,
    meterColor: '#f59e0b',
    backgroundColor: '#1f2937',
    showValue: true,
    fontSize: 10,
    textColor: '#9ca3af',
    ...overrides,
  }
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Three audio display element types defined with type guards and factory functions</done>
</task>

<task type="auto">
  <name>Task 2: Create audio display renderers and update Element switch</name>
  <files>
src/components/elements/renderers/DbDisplayRenderer.tsx
src/components/elements/renderers/FrequencyDisplayRenderer.tsx
src/components/elements/renderers/GainReductionMeterRenderer.tsx
src/components/elements/Element.tsx
  </files>
  <action>
Create DbDisplayRenderer.tsx:
```tsx
import type { DbDisplayElementConfig } from '../../../types/elements'

interface DbDisplayRendererProps {
  config: DbDisplayElementConfig
}

export function DbDisplayRenderer({ config }: DbDisplayRendererProps) {
  const formattedValue = config.value.toFixed(config.decimalPlaces)
  const displayText = config.showUnit ? `${formattedValue} dB` : formattedValue

  return (
    <div
      className="dbdisplay-element"
      style={{
        width: '100%',
        height: '100%',
        backgroundColor: config.backgroundColor,
        padding: `0 ${config.padding}px`,
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        fontFamily: config.fontFamily,
        fontSize: `${config.fontSize}px`,
        color: config.textColor,
        borderRadius: '4px',
        boxSizing: 'border-box',
      }}
    >
      {displayText}
    </div>
  )
}
```

Create FrequencyDisplayRenderer.tsx:
```tsx
import type { FrequencyDisplayElementConfig } from '../../../types/elements'

interface FrequencyDisplayRendererProps {
  config: FrequencyDisplayElementConfig
}

export function FrequencyDisplayRenderer({ config }: FrequencyDisplayRendererProps) {
  // Auto-switch to kHz if enabled and value >= 1000
  const useKHz = config.autoSwitchKHz && config.value >= 1000
  const displayValue = useKHz ? config.value / 1000 : config.value
  const unit = useKHz ? 'kHz' : 'Hz'

  const formattedValue = displayValue.toFixed(config.decimalPlaces)
  const displayText = config.showUnit ? `${formattedValue} ${unit}` : formattedValue

  return (
    <div
      className="frequencydisplay-element"
      style={{
        width: '100%',
        height: '100%',
        backgroundColor: config.backgroundColor,
        padding: `0 ${config.padding}px`,
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        fontFamily: config.fontFamily,
        fontSize: `${config.fontSize}px`,
        color: config.textColor,
        borderRadius: '4px',
        boxSizing: 'border-box',
      }}
    >
      {displayText}
    </div>
  )
}
```

Create GainReductionMeterRenderer.tsx:
```tsx
import type { GainReductionMeterElementConfig } from '../../../types/elements'

interface GainReductionMeterRendererProps {
  config: GainReductionMeterElementConfig
}

export function GainReductionMeterRenderer({ config }: GainReductionMeterRendererProps) {
  const isVertical = config.orientation === 'vertical'
  // GR meters grow FROM TOP (inverted) - value 0 = no reduction, value 1 = full reduction
  const fillPercent = config.value * 100

  // Calculate actual dB value for display
  const dbValue = config.value * config.maxReduction  // maxReduction is negative

  return (
    <div
      className="gainreductionmeter-element"
      style={{
        width: '100%',
        height: '100%',
        backgroundColor: config.backgroundColor,
        position: 'relative',
        borderRadius: '2px',
        overflow: 'hidden',
      }}
    >
      {/* Meter fill - grows from TOP (vertical) or RIGHT (horizontal) */}
      <div
        className="gr-fill"
        style={{
          position: 'absolute',
          backgroundColor: config.meterColor,
          borderRadius: '2px',
          ...(isVertical ? {
            top: 0,
            left: 0,
            right: 0,
            height: `${fillPercent}%`,
          } : {
            top: 0,
            right: 0,
            bottom: 0,
            width: `${fillPercent}%`,
          }),
        }}
      />

      {/* Value display */}
      {config.showValue && (
        <div
          style={{
            position: 'absolute',
            bottom: '2px',
            left: 0,
            right: 0,
            textAlign: 'center',
            fontSize: `${config.fontSize}px`,
            color: config.textColor,
            fontFamily: 'Roboto Mono, monospace',
          }}
        >
          {dbValue.toFixed(1)}
        </div>
      )}
    </div>
  )
}
```

Update Element.tsx with cases for dbdisplay, frequencydisplay, gainreductionmeter.
  </action>
  <verify>TypeScript compiles and all three renderers display correctly</verify>
  <done>Three audio display renderers created; Element.tsx routes correctly</done>
</task>

<task type="auto">
  <name>Task 3: Add property panels, palette category, and export</name>
  <files>
src/components/Properties/DbDisplayProperties.tsx
src/components/Properties/FrequencyDisplayProperties.tsx
src/components/Properties/GainReductionMeterProperties.tsx
src/components/Properties/PropertyPanel.tsx
src/components/Palette/Palette.tsx
src/services/export/htmlGenerator.ts
src/services/export/cssGenerator.ts
  </files>
  <action>
Create DbDisplayProperties.tsx with sections:
- Value: value (NumberInput), minDb, maxDb
- Display: decimalPlaces, showUnit (checkbox)
- Appearance: fontSize, textColor, backgroundColor, padding

Create FrequencyDisplayProperties.tsx with sections:
- Value: value (in Hz)
- Display: decimalPlaces, autoSwitchKHz (checkbox), showUnit
- Appearance: fontSize, textColor, backgroundColor, padding

Create GainReductionMeterProperties.tsx with sections:
- Layout: orientation
- Value: value (0-1), maxReduction (negative dB)
- Display: showValue (checkbox), fontSize, textColor
- Colors: meterColor, backgroundColor

Update PropertyPanel.tsx with cases for all three types.

Update Palette.tsx - add new category:
```typescript
{
  name: 'Audio Displays',
  items: [
    { id: 'dbdisplay', type: 'dbdisplay', name: 'dB Display' },
    { id: 'frequencydisplay', type: 'frequencydisplay', name: 'Frequency Display' },
    { id: 'gainreductionmeter', type: 'gainreductionmeter', name: 'GR Meter' },
  ],
},
```

Update htmlGenerator.ts with cases for all three types:
- dbdisplay: div with data-value, data-min, data-max attributes
- frequencydisplay: div with data-value (Hz), data-auto-khz attribute
- gainreductionmeter: div with data-value, data-max-reduction, inverted fill structure

Update cssGenerator.ts with styles for all three types.
  </action>
  <verify>
1. Run `npm run dev`
2. Find "Audio Displays" category in palette
3. Drag dB Display - verify shows value with dB suffix
4. Change value in property panel, verify display updates
5. Drag Frequency Display - verify Hz/kHz switching at 1000Hz
6. Drag GR Meter - verify it grows from TOP (inverted)
7. Export project, verify HTML/CSS for all three
  </verify>
  <done>Property panels complete; Palette has Audio Displays category; Export generates correct HTML/CSS</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npm run build`
2. Palette shows "Audio Displays" category with all three elements
3. dB Display shows formatted value with optional unit
4. Frequency Display auto-switches Hz/kHz at 1000Hz
5. Gain Reduction Meter grows from top (inverted from normal meter)
6. Property panels have appropriate controls
7. Exported HTML contains correct data attributes
8. Exported CSS handles all display types
</verification>

<success_criteria>
- [ ] DbDisplayElementConfig, FrequencyDisplayElementConfig, GainReductionMeterElementConfig types exist
- [ ] Type guards work for all three types
- [ ] Factory functions have sensible defaults
- [ ] dB Display renders with configurable decimals and unit
- [ ] Frequency Display auto-switches Hz/kHz
- [ ] GR Meter renders inverted (grows from top)
- [ ] Element.tsx handles all three types
- [ ] Property panels exist for all three
- [ ] Palette "Audio Displays" category contains all three
- [ ] HTML export generates correct structure
- [ ] CSS export generates appropriate styles
</success_criteria>

<output>
After completion, create `.planning/phases/13-extended-elements/13-08-SUMMARY.md`
</output>
