---
phase: 23-professional-meters
plan: 03
type: execute
wave: 2
depends_on: ["23-01"]
files_modified:
  - src/types/elements/displays.ts
  - src/components/elements/renderers/displays/meters/TruePeakRenderer.tsx
  - src/components/elements/renderers/displays/meters/LUFSMomentaryRenderer.tsx
  - src/components/elements/renderers/displays/meters/LUFSShorttermRenderer.tsx
  - src/components/elements/renderers/displays/meters/LUFSIntegratedRenderer.tsx
  - src/components/elements/renderers/displays/meters/index.ts
  - src/components/elements/renderers/displays/index.ts
  - src/components/elements/renderers/index.ts
autonomous: true

must_haves:
  truths:
    - "User can render True Peak Meter with -60 to 0 dB range"
    - "User can render LUFS Momentary with -60 to 0 LUFS range (400ms window)"
    - "User can render LUFS Short-term with -60 to 0 LUFS range (3s window)"
    - "User can render LUFS Integrated with -60 to 0 LUFS range (full program)"
    - "All LUFS meters display LUFS unit instead of dB"
  artifacts:
    - path: "src/types/elements/displays.ts"
      provides: "Element configs for 8 meter types (True Peak + LUFS variants)"
      contains: "TruePeakMeterMonoElementConfig|LUFSMomentaryMonoElementConfig|LUFSIntegratedStereoElementConfig"
    - path: "src/components/elements/renderers/displays/meters/TruePeakRenderer.tsx"
      provides: "True Peak meter mono/stereo renderers"
      exports: ["TruePeakMeterMonoRenderer", "TruePeakMeterStereoRenderer"]
    - path: "src/components/elements/renderers/displays/meters/LUFSMomentaryRenderer.tsx"
      provides: "LUFS Momentary meter mono/stereo renderers"
      exports: ["LUFSMomentaryMonoRenderer", "LUFSMomentaryStereoRenderer"]
  key_links:
    - from: "TruePeakRenderer.tsx"
      to: "SegmentedMeter.tsx"
      via: "import component"
      pattern: "import.*SegmentedMeter.*from"
    - from: "renderers/index.ts"
      to: "displays/index.ts"
      via: "registry registration"
      pattern: "truepeak|lufs"
---

<objective>
Create True Peak and LUFS (Momentary, Short-term, Integrated) meter element types with mono and stereo variants.

Purpose: True Peak meters use ITU-R BS.1770-5 standard with 4x oversampling for inter-sample peak detection. LUFS meters use EBU R128 K-weighting with varying window sizes (400ms momentary, 3s short-term, full program integrated).

Output: 8 new element types (4 meter types x mono/stereo) registered in the renderer registry.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-professional-meters/23-CONTEXT.md
@.planning/phases/23-professional-meters/23-RESEARCH.md
@.planning/phases/23-professional-meters/23-01-SUMMARY.md
@src/types/elements/displays.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add True Peak meter element type definitions</name>
  <files>src/types/elements/displays.ts</files>
  <action>
Add True Peak meter definitions to displays.ts (after PPM Type II definitions):

```typescript
// True Peak Meter - ITU-R BS.1770-5, -60 to 0 dB, 4x oversampling
export interface TruePeakMeterMonoElementConfig extends BaseProfessionalMeterConfig {
  type: 'truepeakmetermono'
  ballisticsType: 'TRUE_PEAK' // Instant (4x oversampled)
}

export interface TruePeakMeterStereoElementConfig extends BaseProfessionalMeterConfig {
  type: 'truepeakmeterstereo'
  ballisticsType: 'TRUE_PEAK'
  valueL: number
  valueR: number
  showChannelLabels: boolean
}
```

Add type guards:

```typescript
export function isTruePeakMeterMono(element: { type: string }): element is TruePeakMeterMonoElementConfig {
  return element.type === 'truepeakmetermono'
}

export function isTruePeakMeterStereo(element: { type: string }): element is TruePeakMeterStereoElementConfig {
  return element.type === 'truepeakmeterstereo'
}
```

Add factory functions:

```typescript
// True Peak uses -60 to 0 dB range with 60 segments
export function createTruePeakMeterMono(overrides?: Partial<TruePeakMeterMonoElementConfig>): TruePeakMeterMonoElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'truepeakmetermono',
    name: 'True Peak Meter',
    x: 0,
    y: 0,
    width: 30,
    height: 200,
    rotation: 0,
    zIndex: 0,
    locked: false,
    visible: true,
    value: 0.8, // -12 dB
    minDb: -60,
    maxDb: 0,
    orientation: 'vertical',
    segmentCount: 60,
    segmentGap: 1,
    scalePosition: 'outside',
    showMajorTicks: true,
    showMinorTicks: true,
    showNumericReadout: false,
    colorZones: defaultMeterColorZones,
    showPeakHold: true,
    peakHoldStyle: 'line',
    peakHoldDuration: 2000,
    ballisticsType: 'TRUE_PEAK',
    ...overrides,
  }
}

export function createTruePeakMeterStereo(overrides?: Partial<TruePeakMeterStereoElementConfig>): TruePeakMeterStereoElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'truepeakmeterstereo',
    name: 'True Peak Meter Stereo',
    x: 0,
    y: 0,
    width: 80,
    height: 200,
    rotation: 0,
    zIndex: 0,
    locked: false,
    visible: true,
    value: 0.8,
    valueL: 0.8,
    valueR: 0.78,
    minDb: -60,
    maxDb: 0,
    orientation: 'vertical',
    segmentCount: 60,
    segmentGap: 1,
    scalePosition: 'outside',
    showMajorTicks: true,
    showMinorTicks: true,
    showNumericReadout: false,
    colorZones: defaultMeterColorZones,
    showPeakHold: true,
    peakHoldStyle: 'line',
    peakHoldDuration: 2000,
    ballisticsType: 'TRUE_PEAK',
    showChannelLabels: true,
    ...overrides,
  }
}
```

Add new types to DisplayElement union.
  </action>
  <verify>grep "TruePeakMeterMonoElementConfig" src/types/elements/displays.ts</verify>
  <done>True Peak meter mono/stereo types defined with ITU-R BS.1770-5 standard range</done>
</task>

<task type="auto">
  <name>Task 2: Add LUFS meter element type definitions</name>
  <files>src/types/elements/displays.ts</files>
  <action>
Add LUFS meter definitions (Momentary, Short-term, Integrated) to displays.ts:

```typescript
// LUFS Momentary - EBU R128, -60 to 0 LUFS, 400ms window
export interface LUFSMomentaryMonoElementConfig extends BaseProfessionalMeterConfig {
  type: 'lufsmomomo' // lufs-momentary-mono
  ballisticsType: 'LUFS_M' // 400ms window
  unit: 'LUFS' // Display unit
}

export interface LUFSMomentaryStereoElementConfig extends BaseProfessionalMeterConfig {
  type: 'lufsmomostereo'
  ballisticsType: 'LUFS_M'
  unit: 'LUFS'
  valueL: number
  valueR: number
  showChannelLabels: boolean
}

// LUFS Short-term - EBU R128, -60 to 0 LUFS, 3s window
export interface LUFSShorttermMonoElementConfig extends BaseProfessionalMeterConfig {
  type: 'lufsshortmono'
  ballisticsType: 'LUFS_S' // 3s window
  unit: 'LUFS'
}

export interface LUFSShorttermStereoElementConfig extends BaseProfessionalMeterConfig {
  type: 'lufsshortstereo'
  ballisticsType: 'LUFS_S'
  unit: 'LUFS'
  valueL: number
  valueR: number
  showChannelLabels: boolean
}

// LUFS Integrated - EBU R128, -60 to 0 LUFS, full program with gating
export interface LUFSIntegratedMonoElementConfig extends BaseProfessionalMeterConfig {
  type: 'lufsintmono'
  ballisticsType: 'LUFS_I' // Full program with gating
  unit: 'LUFS'
}

export interface LUFSIntegratedStereoElementConfig extends BaseProfessionalMeterConfig {
  type: 'lufsintstereo'
  ballisticsType: 'LUFS_I'
  unit: 'LUFS'
  valueL: number
  valueR: number
  showChannelLabels: boolean
}
```

Add type guards:

```typescript
export function isLUFSMomentaryMono(element: { type: string }): element is LUFSMomentaryMonoElementConfig {
  return element.type === 'lufsmomomo'
}

export function isLUFSMomentaryStereo(element: { type: string }): element is LUFSMomentaryStereoElementConfig {
  return element.type === 'lufsmomostereo'
}

export function isLUFSShorttermMono(element: { type: string }): element is LUFSShorttermMonoElementConfig {
  return element.type === 'lufsshortmono'
}

export function isLUFSShorttermStereo(element: { type: string }): element is LUFSShorttermStereoElementConfig {
  return element.type === 'lufsshortstereo'
}

export function isLUFSIntegratedMono(element: { type: string }): element is LUFSIntegratedMonoElementConfig {
  return element.type === 'lufsintmono'
}

export function isLUFSIntegratedStereo(element: { type: string }): element is LUFSIntegratedStereoElementConfig {
  return element.type === 'lufsintstereo'
}
```

Add factory functions for all 6 LUFS types (following the same pattern as RMS):

```typescript
// LUFS uses -60 to 0 LUFS range with 60 segments
export function createLUFSMomentaryMono(overrides?: Partial<LUFSMomentaryMonoElementConfig>): LUFSMomentaryMonoElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'lufsmomomo',
    name: 'LUFS Momentary',
    x: 0,
    y: 0,
    width: 30,
    height: 200,
    rotation: 0,
    zIndex: 0,
    locked: false,
    visible: true,
    value: 0.8, // -12 LUFS
    minDb: -60,
    maxDb: 0,
    orientation: 'vertical',
    segmentCount: 60,
    segmentGap: 1,
    scalePosition: 'outside',
    showMajorTicks: true,
    showMinorTicks: true,
    showNumericReadout: false,
    colorZones: defaultMeterColorZones,
    showPeakHold: true,
    peakHoldStyle: 'line',
    peakHoldDuration: 2000,
    ballisticsType: 'LUFS_M',
    unit: 'LUFS',
    ...overrides,
  }
}

// Similar factories for:
// - createLUFSMomentaryStereo
// - createLUFSShorttermMono
// - createLUFSShorttermStereo
// - createLUFSIntegratedMono
// - createLUFSIntegratedStereo
// (All use -60 to 0 range, 60 segments, unit: 'LUFS')
```

Add all 6 LUFS types to DisplayElement union.
  </action>
  <verify>grep "LUFSIntegratedStereoElementConfig" src/types/elements/displays.ts</verify>
  <done>6 LUFS meter types defined with EBU R128 standard ranges and LUFS unit</done>
</task>

<task type="auto">
  <name>Task 3: Create renderers and register in registry</name>
  <files>
    src/components/elements/renderers/displays/meters/TruePeakRenderer.tsx
    src/components/elements/renderers/displays/meters/LUFSMomentaryRenderer.tsx
    src/components/elements/renderers/displays/meters/LUFSShorttermRenderer.tsx
    src/components/elements/renderers/displays/meters/LUFSIntegratedRenderer.tsx
    src/components/elements/renderers/displays/meters/index.ts
    src/components/elements/renderers/displays/index.ts
    src/components/elements/renderers/index.ts
  </files>
  <action>
Create renderer components for all 8 meter types following the same pattern as RMSMeterRenderer:

**TruePeakRenderer.tsx:**
- Import TruePeakMeterMonoElementConfig, TruePeakMeterStereoElementConfig
- Create TruePeakMeterMonoRenderer, TruePeakMeterStereoRenderer
- Follow same structure as RMS renderer (mono uses single SegmentedMeter, stereo uses two side-by-side)

**LUFSMomentaryRenderer.tsx:**
- Import LUFSMomentaryMonoElementConfig, LUFSMomentaryStereoElementConfig
- Create LUFSMomentaryMonoRenderer, LUFSMomentaryStereoRenderer
- Same structure as RMS renderer

**LUFSShorttermRenderer.tsx:**
- Import LUFSShorttermMonoElementConfig, LUFSShorttermStereoElementConfig
- Create LUFSShorttermMonoRenderer, LUFSShorttermStereoRenderer
- Same structure as RMS renderer

**LUFSIntegratedRenderer.tsx:**
- Import LUFSIntegratedMonoElementConfig, LUFSIntegratedStereoElementConfig
- Create LUFSIntegratedMonoRenderer, LUFSIntegratedStereoRenderer
- Same structure as RMS renderer

**Update meters/index.ts** to export all new renderers:
```typescript
export { TruePeakMeterMonoRenderer, TruePeakMeterStereoRenderer } from './TruePeakRenderer'
export { LUFSMomentaryMonoRenderer, LUFSMomentaryStereoRenderer } from './LUFSMomentaryRenderer'
export { LUFSShorttermMonoRenderer, LUFSShorttermStereoRenderer } from './LUFSShorttermRenderer'
export { LUFSIntegratedMonoRenderer, LUFSIntegratedStereoRenderer } from './LUFSIntegratedRenderer'
```

**Update displays/index.ts** to re-export from meters.

**Update renderers/index.ts** to register all 8 new meter types:
```typescript
// Add imports for True Peak and LUFS renderers

// Add to registry
['truepeakmetermono', TruePeakMeterMonoRenderer as RendererComponent],
['truepeakmeterstereo', TruePeakMeterStereoRenderer as RendererComponent],
['lufsmomomo', LUFSMomentaryMonoRenderer as RendererComponent],
['lufsmomostereo', LUFSMomentaryStereoRenderer as RendererComponent],
['lufsshortmono', LUFSShorttermMonoRenderer as RendererComponent],
['lufsshortstereo', LUFSShorttermStereoRenderer as RendererComponent],
['lufsintmono', LUFSIntegratedMonoRenderer as RendererComponent],
['lufsintstereo', LUFSIntegratedStereoRenderer as RendererComponent],
```
  </action>
  <verify>grep -l "TruePeakMeterMonoRenderer\|LUFSIntegratedStereoRenderer" src/components/elements/renderers/index.ts</verify>
  <done>8 additional meter renderers created and registered (True Peak + LUFS variants)</done>
</task>

</tasks>

<verification>
1. `grep "type: 'truepeakmetermono'" src/types/elements/displays.ts` - Type definitions exist
2. `grep "createLUFSIntegratedStereo" src/types/elements/displays.ts` - Factory functions exist
3. `ls src/components/elements/renderers/displays/meters/LUFS*.tsx` - LUFS renderer files exist
4. `grep "truepeakmetermono" src/components/elements/renderers/index.ts` - Registry entries exist
5. TypeScript compilation: `npx tsc --noEmit`
</verification>

<success_criteria>
- 8 element types defined: True Peak mono/stereo, LUFS Momentary/Short-term/Integrated mono/stereo
- True Peak uses -60 to 0 dB range
- LUFS meters use -60 to 0 LUFS range with 'LUFS' unit property
- Each LUFS type has appropriate ballisticsType (LUFS_M, LUFS_S, LUFS_I)
- All 8 types registered in rendererRegistry
</success_criteria>

<output>
After completion, create `.planning/phases/23-professional-meters/23-03-SUMMARY.md`
</output>
