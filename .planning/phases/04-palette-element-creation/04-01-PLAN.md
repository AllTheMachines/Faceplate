---
phase: 04-palette-element-creation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/App.tsx
  - src/components/Palette/Palette.tsx
  - src/components/Palette/PaletteCategory.tsx
  - src/components/Palette/PaletteItem.tsx
  - src/components/Palette/index.ts
  - src/components/Layout/LeftPanel.tsx
autonomous: true

must_haves:
  truths:
    - "User can see a categorized component palette in the left panel"
    - "User can see visual previews of each element type (knob, slider, button, etc.)"
    - "Palette items are visually draggable (cursor changes)"
  artifacts:
    - path: "src/components/Palette/Palette.tsx"
      provides: "Main palette container with DndContext sensors"
      exports: ["Palette"]
    - path: "src/components/Palette/PaletteItem.tsx"
      provides: "Draggable palette item with visual preview"
      exports: ["PaletteItem"]
    - path: "src/components/Palette/PaletteCategory.tsx"
      provides: "Collapsible category section"
      exports: ["PaletteCategory"]
  key_links:
    - from: "src/components/Layout/LeftPanel.tsx"
      to: "src/components/Palette/Palette.tsx"
      via: "renders Palette component"
      pattern: "<Palette"
    - from: "src/components/Palette/PaletteItem.tsx"
      to: "@dnd-kit/core"
      via: "useDraggable hook"
      pattern: "useDraggable"
---

<objective>
Install @dnd-kit and create categorized component palette in left panel

Purpose: Establish drag-drop infrastructure and categorized palette UI that previews all element types
Output: Draggable palette items organized by category (Rotary, Linear, Buttons, Displays, Meters, Images)
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/App.tsx
@src/components/Layout/LeftPanel.tsx
@src/types/elements.ts
@src/components/elements/renderers/KnobRenderer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @dnd-kit packages</name>
  <files>package.json</files>
  <action>
Install @dnd-kit/core and @dnd-kit/utilities:

```bash
npm install @dnd-kit/core @dnd-kit/utilities
```

These provide the drag-drop framework with sensors, collision detection, and coordinate utilities needed for palette-to-canvas drag.
  </action>
  <verify>Run `npm ls @dnd-kit/core` shows version 6.x installed</verify>
  <done>@dnd-kit/core and @dnd-kit/utilities are in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create Palette components</name>
  <files>
    src/components/Palette/Palette.tsx
    src/components/Palette/PaletteCategory.tsx
    src/components/Palette/PaletteItem.tsx
    src/components/Palette/index.ts
  </files>
  <action>
Create the Palette component hierarchy:

**src/components/Palette/index.ts:**
- Export Palette, PaletteCategory, PaletteItem

**src/components/Palette/Palette.tsx:**
- Define `paletteCategories` array with 6 categories:
  - Rotary Controls: knob (standard), knob-arc (arc style)
  - Linear Controls: slider-vertical, slider-horizontal
  - Buttons & Switches: button-momentary, button-toggle
  - Value Displays: label
  - Meters: meter-vertical
  - Images & Decorative: image
- Each item has: id (unique), type (element type), name (display name), variant (optional overrides)
- Render categories using PaletteCategory component
- Track expanded categories in local state (default: first 3 expanded)

**src/components/Palette/PaletteCategory.tsx:**
- Props: category (name, items array), isExpanded, onToggle
- Collapsible section with chevron indicator
- Grid layout (2 columns) for items when expanded
- Use Tailwind: bg-gray-800, border-gray-700, text-gray-300

**src/components/Palette/PaletteItem.tsx:**
- Props: id, elementType, name, variant
- Use `useDraggable` from @dnd-kit/core with:
  - id: `palette-${id}`
  - data: { elementType, variant }
- Show visual preview at 50% scale using actual element renderers:
  - For knob: render KnobRenderer with preview element
  - For slider: render SliderRenderer
  - For button: render ButtonRenderer
  - For label: show text "Aa"
  - For meter: render MeterRenderer
  - For image: show placeholder icon
- Create preview elements using factory functions (createKnob, etc.) with small dimensions
- Apply styles: cursor-grab, hover:bg-gray-700, border rounded, p-2
- Show isDragging opacity change
  </action>
  <verify>
Run `npm run build` - no TypeScript errors.
Check that all imports resolve correctly.
  </verify>
  <done>
Palette.tsx renders 6 categories with element items.
PaletteItem uses useDraggable hook with elementType and variant in data.
Visual previews show actual element renderers at reduced scale.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate Palette into LeftPanel</name>
  <files>
    src/components/Layout/LeftPanel.tsx
  </files>
  <action>
Update LeftPanel to render the Palette component:

- Import Palette from '../Palette'
- Replace placeholder content with `<Palette />`
- Keep the container styling (bg-gray-800, border-r, overflow-y-auto)
- Optionally add a header "Components" above the palette

The Palette does NOT need its own DndContext - that will be added at App level in Plan 02.
  </action>
  <verify>
Run `npm run dev` and visually confirm:
1. Left panel shows "Components" header
2. Collapsible categories visible (Rotary Controls, Linear Controls, etc.)
3. Each category shows element items in 2-column grid
4. Items show visual previews of elements
5. Items have grab cursor on hover
  </verify>
  <done>
LeftPanel renders Palette component.
Categories collapse/expand correctly.
Visual previews are visible for each element type.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Run `npm run build` - passes without errors
2. Run `npm run dev` - app loads
3. Visual check: Left panel shows categorized palette with element previews
4. Categories can be expanded/collapsed by clicking headers
5. Palette items show grab cursor
</verification>

<success_criteria>
- @dnd-kit installed (core + utilities)
- Palette component renders 6 categories with element items
- PaletteItem uses useDraggable with elementType data
- Visual previews show actual element renderers
- LeftPanel renders Palette component
</success_criteria>

<output>
After completion, create `.planning/phases/04-palette-element-creation/04-01-SUMMARY.md`
</output>
