---
phase: 48-display-led-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements/displays.ts
  - src/components/Properties/NoteDisplayProperties.tsx
  - src/components/elements/renderers/displays/NoteDisplayRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "New Note Display elements default to 14px fontSize"
    - "Note Display has showOctave property (default true)"
    - "When showOctave is false, note displays show 'C' instead of 'C4'"
    - "User can toggle showOctave via property panel checkbox"
  artifacts:
    - path: "src/types/elements/displays.ts"
      provides: "NoteDisplayElementConfig with showOctave property"
      contains: "showOctave: boolean"
    - path: "src/components/Properties/NoteDisplayProperties.tsx"
      provides: "Show Octave Number checkbox"
      contains: "showOctave"
    - path: "src/components/elements/renderers/displays/NoteDisplayRenderer.tsx"
      provides: "Conditional octave stripping in display"
      contains: "showOctave"
  key_links:
    - from: "NoteDisplayProperties.tsx"
      to: "displays.ts"
      via: "onUpdate({ showOctave: ... })"
      pattern: "showOctave"
    - from: "NoteDisplayRenderer.tsx"
      to: "displays.ts"
      via: "config.showOctave"
      pattern: "showOctave"
---

<objective>
Add showOctave property to Note Display and change default fontSize to 14px.

Purpose: DSP-01 specifies that Note Display font sizes should be consistent with other displays (14px) and user should control whether octave number is shown.

Output: Note Display with configurable showOctave property and correct default fontSize.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/48-display-led-fixes/48-CONTEXT.md
@.planning/phases/48-display-led-fixes/48-RESEARCH.md

@src/types/elements/displays.ts
@src/components/Properties/NoteDisplayProperties.tsx
@src/components/elements/renderers/displays/NoteDisplayRenderer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add showOctave property to NoteDisplayElementConfig</name>
  <files>src/types/elements/displays.ts</files>
  <action>
In NoteDisplayElementConfig interface (around line 296):
1. Add `showOctave: boolean` property after showMidiNumber (line ~304)
   - Comment: "// Show octave number (C4 vs C)"

In createNoteDisplay factory function (around line 1579):
1. Change `fontSize: 20` to `fontSize: 14` (matches Numeric Display default)
2. Add `showOctave: true` after showMidiNumber

The interface should now include:
```typescript
showMidiNumber: boolean // Show MIDI number below note name
showOctave: boolean // Show octave number (C4 vs C)
```

The factory should now include:
```typescript
showMidiNumber: false,
showOctave: true,
fontSize: 14,
```
  </action>
  <verify>TypeScript compiles - `npx tsc --noEmit` should show errors in dependent files (NoteDisplayProperties, NoteDisplayRenderer) because showOctave is now required but not used</verify>
  <done>NoteDisplayElementConfig has showOctave: boolean property, createNoteDisplay has fontSize: 14 and showOctave: true defaults</done>
</task>

<task type="auto">
  <name>Task 2: Add showOctave checkbox to property panel and update renderer</name>
  <files>
    src/components/Properties/NoteDisplayProperties.tsx
    src/components/elements/renderers/displays/NoteDisplayRenderer.tsx
  </files>
  <action>
In NoteDisplayProperties.tsx:
1. Find the showMidiNumber checkbox (search for "showMidiNumber")
2. Add a new checkbox immediately after it for showOctave:
```tsx
<label
  htmlFor="notedisplay-show-octave"
  className="flex items-center gap-2 cursor-pointer select-none"
>
  <input
    type="checkbox"
    id="notedisplay-show-octave"
    checked={element.showOctave}
    onChange={(e) => onUpdate({ showOctave: e.target.checked })}
    className="bg-gray-700 border border-gray-600 rounded cursor-pointer"
  />
  <span className="text-sm text-gray-300">Show Octave Number</span>
</label>
```

In NoteDisplayRenderer.tsx:
1. Find where formatDisplayValue is called or where the note string is generated
2. After getting the formatted note value (e.g., "C4"), conditionally strip the octave:
```typescript
// Strip octave number if showOctave is false
// Regex handles both positive (C4) and negative (C-1) octaves
const displayValue = config.showOctave
  ? formattedValue  // "C4" - full note with octave
  : formattedValue.replace(/[-]?\d+$/, '')  // "C" - note letter only
```
3. Use displayValue instead of formattedValue for the visible text
  </action>
  <verify>
Run dev server: `npm run dev`
1. Add Note Display to canvas - should have 14px font (smaller than before)
2. In property panel, find "Show Octave Number" checkbox (should be checked by default)
3. Uncheck it - display should change from "C4" to "C"
4. Check it again - display should change back to "C4"
  </verify>
  <done>showOctave checkbox in property panel, renderer conditionally strips octave number</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` compiles without errors
2. New Note Display elements have fontSize 14 (check via property panel)
3. showOctave property panel checkbox exists and works
4. Note Display shows "C4" when showOctave is true
5. Note Display shows "C" when showOctave is false
6. Negative octaves (C-1) handled correctly - shows "C" not "C-"
</verification>

<success_criteria>
- NoteDisplayElementConfig includes showOctave: boolean
- createNoteDisplay defaults: fontSize: 14, showOctave: true
- Property panel has "Show Octave Number" checkbox after "Show MIDI Number"
- Renderer strips octave when showOctave is false
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/48-display-led-fixes/48-01-SUMMARY.md`
</output>
