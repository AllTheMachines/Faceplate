---
phase: 22-value-displays-leds
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements/displays.ts
  - src/components/elements/renderers/displays/SingleLEDRenderer.tsx
  - src/components/elements/renderers/displays/BiColorLEDRenderer.tsx
  - src/components/elements/renderers/displays/TriColorLEDRenderer.tsx
  - src/components/elements/renderers/displays/LEDArrayRenderer.tsx
  - src/components/elements/renderers/displays/LEDRingRenderer.tsx
  - src/components/elements/renderers/displays/LEDMatrixRenderer.tsx
  - src/components/elements/renderers/displays/index.ts
  - src/components/elements/renderers/index.ts
  - src/utils/ledColorPalettes.ts
autonomous: true

must_haves:
  truths:
    - "User can add Single LED with on/off state and color"
    - "User can add Bi-Color LED with green/red states"
    - "User can add Tri-Color LED with off/yellow/red states"
    - "User can add LED Array with 8-24 segments showing level"
    - "User can add LED Ring with circular segment display"
    - "User can add LED Matrix with configurable grid (4x4, 8x8, etc.)"
  artifacts:
    - path: "src/types/elements/displays.ts"
      provides: "SingleLEDElementConfig, BiColorLEDElementConfig, TriColorLEDElementConfig, LEDArrayElementConfig, LEDRingElementConfig, LEDMatrixElementConfig"
      contains: "type: 'singleled'"
    - path: "src/components/elements/renderers/displays/SingleLEDRenderer.tsx"
      provides: "Single LED rendering with glow effect"
      exports: ["SingleLEDRenderer"]
    - path: "src/components/elements/renderers/displays/LEDMatrixRenderer.tsx"
      provides: "LED Matrix with CSS Grid layout"
      exports: ["LEDMatrixRenderer"]
    - path: "src/utils/ledColorPalettes.ts"
      provides: "Preset color palettes (classic, modern, neon)"
      exports: ["LED_COLOR_PALETTES"]
  key_links:
    - from: "src/components/elements/renderers/index.ts"
      to: "rendererRegistry"
      via: "Map.set for all 6 LED types"
      pattern: "\\['singleled'"
---

<objective>
Implement 6 LED indicator element types with color palettes and renderers.

Purpose: Provide audio plugin designers with status indicator LEDs including single on/off, bi-color, tri-color, array, ring, and matrix patterns for visualizing signal states and levels.

Output: 6 new LED element configs, renderers with glow effects, and color palette utility.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-value-displays-leds/22-CONTEXT.md
@.planning/phases/22-value-displays-leds/22-RESEARCH.md

# Existing patterns to extend
@src/types/elements/displays.ts
@src/components/elements/renderers/controls/PowerButtonRenderer.tsx
@src/components/elements/renderers/displays/index.ts
@src/components/elements/renderers/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LED color palettes utility</name>
  <files>
    src/utils/ledColorPalettes.ts
  </files>
  <action>
    Create utility file with preset LED color palettes:

    1. **LEDColorPalette interface:**
       ```typescript
       export interface LEDColorPalette {
         name: string
         onColor: string
         offColor: string
         greenColor?: string
         redColor?: string
         yellowColor?: string
       }
       ```

    2. **LED_COLOR_PALETTES record:**
       ```typescript
       export const LED_COLOR_PALETTES: Record<string, LEDColorPalette> = {
         classic: {
           name: 'Classic',
           onColor: '#00ff00',      // Bright green
           offColor: '#003300',     // Dim green (visible off state per CONTEXT.md)
           greenColor: '#00ff00',
           redColor: '#ff0000',
           yellowColor: '#ffff00',
         },
         modern: {
           name: 'Modern',
           onColor: '#0088ff',      // Blue
           offColor: '#001a33',
           greenColor: '#00ff88',   // Cyan-green
           redColor: '#ff0044',     // Pink-red
           yellowColor: '#ffaa00',  // Amber
         },
         neon: {
           name: 'Neon',
           onColor: '#ff00ff',      // Magenta
           offColor: '#330033',
           greenColor: '#00ffaa',   // Cyan
           redColor: '#ff0066',     // Hot pink
           yellowColor: '#ffff00',  // Pure yellow
         },
       }
       ```

    3. **Helper functions:**
       - getDefaultOffColor(onColor: string): Derive dim off color (30% brightness)
       - getPaletteByName(name: string): Get palette or default to classic

    Note: Off state colors should be visibly dim versions of lit color (user can see what color it will be when on).
  </action>
  <verify>
    File exists: src/utils/ledColorPalettes.ts
    Import test: `import { LED_COLOR_PALETTES } from './utils/ledColorPalettes'` compiles
  </verify>
  <done>
    LED color palettes created with classic, modern, and neon presets.
    Helper functions for off color derivation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create 6 LED element types and renderers</name>
  <files>
    src/types/elements/displays.ts
    src/components/elements/renderers/displays/SingleLEDRenderer.tsx
    src/components/elements/renderers/displays/BiColorLEDRenderer.tsx
    src/components/elements/renderers/displays/TriColorLEDRenderer.tsx
    src/components/elements/renderers/displays/LEDArrayRenderer.tsx
    src/components/elements/renderers/displays/LEDRingRenderer.tsx
    src/components/elements/renderers/displays/LEDMatrixRenderer.tsx
    src/components/elements/renderers/displays/index.ts
    src/components/elements/renderers/index.ts
  </files>
  <action>
    **Add to displays.ts (after value display types):**

    Common LED properties (shared across LED types):
    - shape: 'round' | 'square'
    - cornerRadius: number (only for square shape, 0-20px)
    - glowEnabled: boolean
    - glowRadius: number (default: size * 0.3)
    - glowIntensity: number (default: glowRadius / 2)
    - colorPalette: 'classic' | 'modern' | 'neon' | 'custom'

    1. **SingleLEDElementConfig:**
       - type: 'singleled'
       - state: 'on' | 'off'
       - onColor: string
       - offColor: string
       - shape, cornerRadius, glowEnabled, glowRadius, glowIntensity, colorPalette

    2. **BiColorLEDElementConfig:**
       - type: 'bicolorled'
       - state: 'green' | 'red'
       - greenColor: string
       - redColor: string
       - offColor: string (dim when off - same shape but shown briefly during state transitions)
       - shape, cornerRadius, glowEnabled, glowRadius, glowIntensity, colorPalette

    3. **TriColorLEDElementConfig:**
       - type: 'tricolorled'
       - state: 'off' | 'yellow' | 'red'
       - offColor: string
       - yellowColor: string
       - redColor: string
       - shape, cornerRadius, glowEnabled, glowRadius, glowIntensity, colorPalette

    4. **LEDArrayElementConfig:**
       - type: 'ledarray'
       - value: number (0-1, determines how many LEDs lit)
       - segmentCount: number (8-24)
       - orientation: 'horizontal' | 'vertical'
       - spacing: number (gap between LEDs)
       - onColor: string
       - offColor: string
       - shape, cornerRadius, glowEnabled, glowRadius, glowIntensity, colorPalette

    5. **LEDRingElementConfig:**
       - type: 'ledring'
       - value: number (0-1, determines arc length lit)
       - segmentCount: number (12-36)
       - diameter: number (computed from width/height)
       - thickness: number (LED segment thickness)
       - startAngle: number (degrees, default -135)
       - endAngle: number (degrees, default 135)
       - onColor: string
       - offColor: string
       - glowEnabled: boolean
       - glowRadius: number
       - colorPalette

    6. **LEDMatrixElementConfig:**
       - type: 'ledmatrix'
       - rows: number (preset: 4, 8, 16 or custom 2-32)
       - columns: number (preset: 4, 8, 16 or custom 2-32)
       - states: boolean[][] (2D array of on/off states)
       - spacing: number (gap between LEDs)
       - onColor: string
       - offColor: string
       - shape, cornerRadius, glowEnabled, glowRadius, glowIntensity, colorPalette

    Add type guards: isSingleLED, isBiColorLED, isTriColorLED, isLEDArray, isLEDRing, isLEDMatrix

    Add factory functions with sensible defaults:
    - createSingleLED: state 'on', classic palette, round shape, glow enabled
    - createBiColorLED: state 'green', classic palette
    - createTriColorLED: state 'off', classic palette
    - createLEDArray: value 0.7, 12 segments, horizontal, 2px spacing
    - createLEDRing: value 0.5, 24 segments, diameter 80
    - createLEDMatrix: 8x8, all false initially, 2px spacing

    Add to DisplayElement union type.

    **Create renderers following PowerButton LED pattern:**

    All LED renderers share:
    - transition: none (instant state changes per CONTEXT.md)
    - border-radius: 50% for round, cornerRadius for square
    - box-shadow for glow effect when lit and glowEnabled
    - Off state shows dim version of color (visible but not bright)
    - Container overflow: visible (don't clip glow)

    **SingleLEDRenderer.tsx:**
    - Simple div with background color based on state
    - Glow: `0 0 ${glowRadius}px ${glowIntensity}px ${onColor}` when on

    **BiColorLEDRenderer.tsx:**
    - Color based on state (greenColor or redColor)
    - Always shows solid color (no off state for bi-color - always one or other)
    - Glow uses current state color

    **TriColorLEDRenderer.tsx:**
    - Color map: off -> offColor, yellow -> yellowColor, red -> redColor
    - Glow only when not in 'off' state

    **LEDArrayRenderer.tsx:**
    - Flexbox row/column based on orientation
    - Map segmentCount LEDs
    - litCount = Math.round(value * segmentCount)
    - LEDs at index < litCount are lit, others off
    - Gap property for spacing

    **LEDRingRenderer.tsx:**
    - SVG circle with dashed stroke for segments
    - Calculate circumference and dasharray for exact segment count
    - Background circle (off segments) at low opacity
    - Foreground arc (lit segments) uses strokeDasharray to clip
    - rotate transform to start at startAngle
    - filter: drop-shadow for glow effect

    **LEDMatrixRenderer.tsx:**
    - CSS Grid with rows x columns template
    - Flatten states array and map to LED divs
    - Validate states array length matches rows * columns in factory
    - justifySelf: center, alignSelf: center for LEDs in grid cells

    **Register in displays/index.ts and main index.ts:**
    - Export all 6 LED renderers from displays/index.ts
    - Add to rendererRegistry Map in main index.ts
  </action>
  <verify>
    npm run build succeeds with no TypeScript errors.
    grep -r "singleled" src/ returns type, renderer, registry entries.
    grep -r "ledmatrix" src/ returns type, renderer, registry entries.
  </verify>
  <done>
    Six LED element types defined with type guards and factories.
    Six renderers created with proper glow effects and instant transitions.
    LED Array supports horizontal/vertical orientations.
    LED Ring renders SVG with dashed segments.
    LED Matrix uses CSS Grid layout.
    All registered in rendererRegistry.
    Build passes.
  </done>
</task>

</tasks>

<verification>
1. TypeScript build: `npm run build` completes with no errors
2. Color palette test:
   - LED_COLOR_PALETTES.classic.onColor === '#00ff00'
   - LED_COLOR_PALETTES.neon.redColor === '#ff0066'
3. Registry verification:
   - grep "singleled" src/components/elements/renderers/index.ts returns entry
   - grep "ledarray" src/components/elements/renderers/index.ts returns entry
   - grep "ledmatrix" src/components/elements/renderers/index.ts returns entry
4. Type exports:
   - displays.ts exports all 6 new LED config types
   - Type guards exist for all 6 types
</verification>

<success_criteria>
- All 6 LED types compile without errors
- LED_COLOR_PALETTES provides classic, modern, neon presets
- Renderers display correct visual appearance:
  - Single LED: round/square with glow when on
  - Bi-Color LED: green or red state
  - Tri-Color LED: off, yellow, or red state
  - LED Array: row of lit/unlit LEDs based on value
  - LED Ring: circular arc of lit segments
  - LED Matrix: grid of LEDs with 2D state
- All state transitions are instant (transition: none)
- Glow effect uses box-shadow/filter drop-shadow
- Off state shows dim version of lit color
- All renderers registered in rendererRegistry
</success_criteria>

<output>
After completion, create `.planning/phases/22-value-displays-leds/22-02-SUMMARY.md`
</output>
