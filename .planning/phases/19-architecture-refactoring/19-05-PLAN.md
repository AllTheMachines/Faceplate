---
phase: 19-architecture-refactoring
plan: 05
type: execute
wave: 3
depends_on: ["19-02", "19-03"]
files_modified:
  - src/components/elements/renderers/controls/KnobRenderer.tsx
  - src/components/elements/renderers/controls/SliderRenderer.tsx
  - src/components/elements/renderers/controls/ButtonRenderer.tsx
  - src/components/elements/renderers/controls/index.ts
  - src/components/elements/renderers/displays/LabelRenderer.tsx
  - src/components/elements/renderers/displays/MeterRenderer.tsx
  - src/components/elements/renderers/displays/index.ts
  - src/components/elements/renderers/containers/PanelRenderer.tsx
  - src/components/elements/renderers/containers/index.ts
  - src/components/elements/renderers/decorative/RectangleRenderer.tsx
  - src/components/elements/renderers/decorative/index.ts
  - src/components/elements/renderers/index.ts
autonomous: false

must_haves:
  truths:
    - "Renderers organized by category: controls/, displays/, containers/, decorative/"
    - "All imports through category index files work correctly"
    - "Registry imports updated to use category paths"
  artifacts:
    - path: "src/components/elements/renderers/controls/index.ts"
      provides: "Control renderer exports"
      exports: ["KnobRenderer", "SliderRenderer", "ButtonRenderer"]
    - path: "src/components/elements/renderers/displays/index.ts"
      provides: "Display renderer exports"
      exports: ["LabelRenderer", "MeterRenderer"]
  key_links:
    - from: "src/components/elements/renderers/index.ts"
      to: "src/components/elements/renderers/*/index.ts"
      via: "imports from category folders"
      pattern: "from './controls'"
    - from: "src/components/elements/Element.tsx"
      to: "src/components/elements/renderers/index.ts"
      via: "getRenderer() lookup"
      pattern: "getRenderer\\(.*type\\)"
---

<objective>
Restructure renderer file organization by moving them into category-based subdirectories aligned with the type system.

Purpose: With 25+ element types (growing to 100+), flat file organization becomes unwieldy. Category folders (controls/, displays/, containers/, decorative/) match the type system structure and prepare for code splitting.

Output: Renderer components organized by category with proper index.ts exports.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/19-architecture-refactoring/19-RESEARCH.md
@.planning/phases/19-architecture-refactoring/19-02-SUMMARY.md
@.planning/phases/19-architecture-refactoring/19-03-SUMMARY.md
@src/components/elements/renderers/index.ts
@src/components/elements/Element.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Organize renderer files by category</name>
  <files>
    src/components/elements/renderers/controls/index.ts
    src/components/elements/renderers/displays/index.ts
    src/components/elements/renderers/containers/index.ts
    src/components/elements/renderers/decorative/index.ts
    src/components/elements/renderers/index.ts
  </files>
  <action>
Create category subdirectories and move renderer files.

1. Create directories:
```bash
mkdir -p src/components/elements/renderers/controls
mkdir -p src/components/elements/renderers/displays
mkdir -p src/components/elements/renderers/containers
mkdir -p src/components/elements/renderers/decorative
```

2. Move renderer files to categories:

**controls/** (8 files):
- KnobRenderer.tsx
- SliderRenderer.tsx
- ButtonRenderer.tsx
- RangeSliderRenderer.tsx
- DropdownRenderer.tsx
- CheckboxRenderer.tsx
- RadioGroupRenderer.tsx
- TextFieldRenderer.tsx

**displays/** (9 files):
- LabelRenderer.tsx
- MeterRenderer.tsx
- DbDisplayRenderer.tsx
- FrequencyDisplayRenderer.tsx
- GainReductionMeterRenderer.tsx
- WaveformRenderer.tsx
- OscilloscopeRenderer.tsx
- PresetBrowserRenderer.tsx
- ModulationMatrixRenderer.tsx

**containers/** (4 files):
- PanelRenderer.tsx
- FrameRenderer.tsx
- GroupBoxRenderer.tsx
- CollapsibleRenderer.tsx

**decorative/** (4 files):
- ImageRenderer.tsx
- SvgGraphicRenderer.tsx
- RectangleRenderer.tsx
- LineRenderer.tsx

3. Create category index.ts files:

**controls/index.ts**:
```typescript
export { KnobRenderer } from './KnobRenderer'
export { SliderRenderer } from './SliderRenderer'
export { ButtonRenderer } from './ButtonRenderer'
export { RangeSliderRenderer } from './RangeSliderRenderer'
export { DropdownRenderer } from './DropdownRenderer'
export { CheckboxRenderer } from './CheckboxRenderer'
export { RadioGroupRenderer } from './RadioGroupRenderer'
export { TextFieldRenderer } from './TextFieldRenderer'
```

**displays/index.ts**:
```typescript
export { LabelRenderer } from './LabelRenderer'
export { MeterRenderer } from './MeterRenderer'
export { DbDisplayRenderer } from './DbDisplayRenderer'
export { FrequencyDisplayRenderer } from './FrequencyDisplayRenderer'
export { GainReductionMeterRenderer } from './GainReductionMeterRenderer'
export { WaveformRenderer } from './WaveformRenderer'
export { OscilloscopeRenderer } from './OscilloscopeRenderer'
export { PresetBrowserRenderer } from './PresetBrowserRenderer'
export { ModulationMatrixRenderer } from './ModulationMatrixRenderer'
```

**containers/index.ts**:
```typescript
export { PanelRenderer } from './PanelRenderer'
export { FrameRenderer } from './FrameRenderer'
export { GroupBoxRenderer } from './GroupBoxRenderer'
export { CollapsibleRenderer } from './CollapsibleRenderer'
```

**decorative/index.ts**:
```typescript
export { ImageRenderer } from './ImageRenderer'
export { SvgGraphicRenderer } from './SvgGraphicRenderer'
export { RectangleRenderer } from './RectangleRenderer'
export { LineRenderer } from './LineRenderer'
```

4. Update main renderers/index.ts to import from categories:

**IMPORTANT:** Read the existing renderers/index.ts from Plan 19-02 first. Preserve the Map-based registry pattern (`rendererRegistry`, `getRenderer` function). Only change the import paths to use category folders - do NOT replace the registry pattern.

```typescript
/**
 * Element Renderer Registry
 */
import React from 'react'
import type { ElementConfig } from '../../../types/elements'

// Import all renderers from category folders
import {
  KnobRenderer,
  SliderRenderer,
  ButtonRenderer,
  RangeSliderRenderer,
  DropdownRenderer,
  CheckboxRenderer,
  RadioGroupRenderer,
  TextFieldRenderer,
} from './controls'

import {
  LabelRenderer,
  MeterRenderer,
  DbDisplayRenderer,
  FrequencyDisplayRenderer,
  GainReductionMeterRenderer,
  WaveformRenderer,
  OscilloscopeRenderer,
  PresetBrowserRenderer,
  ModulationMatrixRenderer,
} from './displays'

import {
  PanelRenderer,
  FrameRenderer,
  GroupBoxRenderer,
  CollapsibleRenderer,
} from './containers'

import {
  ImageRenderer,
  SvgGraphicRenderer,
  RectangleRenderer,
  LineRenderer,
} from './decorative'

// Renderer component type
export type RendererComponent = React.ComponentType<{ config: ElementConfig }>

// Registry mapping element types to renderers
export const rendererRegistry = new Map<ElementConfig['type'], RendererComponent>([
  // Controls
  ['knob', KnobRenderer as RendererComponent],
  ['slider', SliderRenderer as RendererComponent],
  ['button', ButtonRenderer as RendererComponent],
  ['rangeslider', RangeSliderRenderer as RendererComponent],
  ['dropdown', DropdownRenderer as RendererComponent],
  ['checkbox', CheckboxRenderer as RendererComponent],
  ['radiogroup', RadioGroupRenderer as RendererComponent],
  ['textfield', TextFieldRenderer as RendererComponent],

  // Displays
  ['label', LabelRenderer as RendererComponent],
  ['meter', MeterRenderer as RendererComponent],
  ['dbdisplay', DbDisplayRenderer as RendererComponent],
  ['frequencydisplay', FrequencyDisplayRenderer as RendererComponent],
  ['gainreductionmeter', GainReductionMeterRenderer as RendererComponent],
  ['waveform', WaveformRenderer as RendererComponent],
  ['oscilloscope', OscilloscopeRenderer as RendererComponent],
  ['presetbrowser', PresetBrowserRenderer as RendererComponent],
  ['modulationmatrix', ModulationMatrixRenderer as RendererComponent],

  // Containers
  ['panel', PanelRenderer as RendererComponent],
  ['frame', FrameRenderer as RendererComponent],
  ['groupbox', GroupBoxRenderer as RendererComponent],
  ['collapsible', CollapsibleRenderer as RendererComponent],

  // Decorative
  ['image', ImageRenderer as RendererComponent],
  ['svggraphic', SvgGraphicRenderer as RendererComponent],
  ['rectangle', RectangleRenderer as RendererComponent],
  ['line', LineRenderer as RendererComponent],
])

export function getRenderer(type: ElementConfig['type']): RendererComponent | undefined {
  return rendererRegistry.get(type)
}
```

5. Update import paths in moved renderer files:
- Change `from '../../../types/elements'` to `from '../../../../types/elements'`
- Change `from '../../../store'` to `from '../../../../store'`
- Adjust other relative imports as needed
  </action>
  <verify>
TypeScript compiles and registry imports work:
```bash
npm run build
# Verify no import errors
npm run build 2>&1 | grep -c "error" # should output 0
```

**Verify registry pattern preserved (key link):**
```bash
# Confirm Element.tsx still imports from registry
grep -n "getRenderer" src/components/elements/Element.tsx
# Confirm registry exports getRenderer
grep -n "export function getRenderer" src/components/elements/renderers/index.ts
# Confirm registry imports from category folders
grep -n "from './controls'" src/components/elements/renderers/index.ts
```
  </verify>
  <done>Renderer files organized by category with working imports and registry pattern preserved</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Moved 25 renderer files into category subdirectories and updated all import paths while preserving the registry pattern</what-built>
  <how-to-verify>
    **Comprehensive element verification (testing all 25 moved renderers):**

    1. Run `npm run dev` and open the application
    2. Open browser DevTools console to watch for errors

    **Test CONTROLS category (8 elements):**
    - Drag a Knob onto canvas - verify it renders with circular control
    - Drag a Slider onto canvas - verify it renders with track and thumb
    - Drag a Button onto canvas - verify it renders with clickable appearance
    - Drag a RangeSlider onto canvas - verify dual thumbs appear
    - Drag a Dropdown onto canvas - verify select appearance
    - Drag a Checkbox onto canvas - verify checkbox renders
    - Drag a RadioGroup onto canvas - verify radio buttons appear
    - Drag a TextField onto canvas - verify text input renders

    **Test DISPLAYS category (9 elements):**
    - Drag a Label onto canvas - verify text displays
    - Drag a Meter onto canvas - verify meter bar renders
    - Drag a DbDisplay onto canvas - verify dB value display
    - Drag a FrequencyDisplay onto canvas - verify Hz display
    - Drag a GainReductionMeter onto canvas - verify GR meter
    - Drag a Waveform onto canvas - verify waveform placeholder
    - Drag an Oscilloscope onto canvas - verify scope placeholder
    - Drag a PresetBrowser onto canvas - verify browser UI
    - Drag a ModulationMatrix onto canvas - verify matrix grid

    **Test CONTAINERS category (4 elements):**
    - Drag a Panel onto canvas - verify container renders
    - Drag a Frame onto canvas - verify bordered container
    - Drag a GroupBox onto canvas - verify titled group
    - Drag a Collapsible onto canvas - verify expandable section

    **Test DECORATIVE category (4 elements):**
    - Drag a Rectangle onto canvas - verify shape renders
    - Drag a Line onto canvas - verify line renders
    - Drag an Image onto canvas - verify image placeholder
    - Drag an SvgGraphic onto canvas - verify SVG placeholder

    3. For each element above:
       - Confirm it appears on canvas (not blank/error)
       - Click to select - confirm property panel shows properties
       - Check console for any import/render errors

    4. **Verify registry link intact:**
       - After adding elements, inspect the canvas
       - All element types should use their correct renderer (not fallback)

    5. Final check: No console errors related to missing imports or undefined renderers
  </how-to-verify>
  <resume-signal>Type one of:
    - "approved" (all 25 elements work)
    - "failed-controls: [list failed]" (e.g., "failed-controls: Knob, Slider")
    - "failed-displays: [list failed]"
    - "failed-containers: [list failed]"
    - "failed-decorative: [list failed]"
    - Or describe specific rendering issues observed</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` passes without errors
2. `npm run dev` - application starts
3. All 25 element types render correctly on canvas:
   - 8 controls (Knob, Slider, Button, RangeSlider, Dropdown, Checkbox, RadioGroup, TextField)
   - 9 displays (Label, Meter, DbDisplay, FrequencyDisplay, GainReductionMeter, Waveform, Oscilloscope, PresetBrowser, ModulationMatrix)
   - 4 containers (Panel, Frame, GroupBox, Collapsible)
   - 4 decorative (Rectangle, Line, Image, SvgGraphic)
4. File structure shows category folders:
   - src/components/elements/renderers/{controls,displays,containers,decorative}/
5. Registry pattern intact: Element.tsx -> getRenderer() -> rendererRegistry -> category exports
</verification>

<success_criteria>
- [ ] Renderer files moved to category subdirectories
- [ ] Each category has index.ts with re-exports
- [ ] Main index.ts imports from categories
- [ ] All relative imports updated correctly
- [ ] Build passes without TypeScript errors
- [ ] Registry pattern preserved (getRenderer function works)
- [ ] Element.tsx -> rendererRegistry link verified
- [ ] All 25 element types render correctly after reorganization
</success_criteria>

<output>
After completion, create `.planning/phases/19-architecture-refactoring/19-05-SUMMARY.md`
</output>
