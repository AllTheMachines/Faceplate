---
phase: 19-architecture-refactoring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements.ts
  - src/types/elements/base.ts
  - src/types/elements/controls.ts
  - src/types/elements/displays.ts
  - src/types/elements/containers.ts
  - src/types/elements/decorative.ts
  - src/types/elements/index.ts
autonomous: true

must_haves:
  truths:
    - "TypeScript compilation time remains under 10 seconds"
    - "All existing element type imports continue to work"
    - "Developers can use type guards (isKnob, isSlider, etc.) from original import path without changes"
    - "Element factory functions remain accessible from same import path"
  artifacts:
    - path: "src/types/elements/base.ts"
      provides: "BaseElementConfig interface"
      exports: ["BaseElementConfig"]
    - path: "src/types/elements/controls.ts"
      provides: "Control element types"
      exports: ["KnobElementConfig", "SliderElementConfig", "ButtonElementConfig", "RangeSliderElementConfig", "ControlElement"]
    - path: "src/types/elements/displays.ts"
      provides: "Display element types"
      exports: ["LabelElementConfig", "MeterElementConfig", "DbDisplayElementConfig", "DisplayElement"]
    - path: "src/types/elements/containers.ts"
      provides: "Container element types"
      exports: ["PanelElementConfig", "FrameElementConfig", "ContainerElement"]
    - path: "src/types/elements/decorative.ts"
      provides: "Decorative element types"
      exports: ["RectangleElementConfig", "LineElementConfig", "DecorativeElement"]
    - path: "src/types/elements/index.ts"
      provides: "Unified exports maintaining backward compatibility"
      exports: ["ElementConfig", "BaseElementConfig"]
  key_links:
    - from: "src/types/elements/index.ts"
      to: "src/types/elements/*.ts"
      via: "re-exports all types"
      pattern: "export.*from"
    - from: "src/components/Properties/PropertyPanel.tsx"
      to: "src/types/elements"
      via: "unchanged import path"
      pattern: "from '../../types/elements'"
---

<objective>
Split the monolithic ElementConfig union type into category-based sub-unions to improve TypeScript compilation performance and enable future code splitting.

Purpose: The current 1300-line elements.ts file with a 25-member discriminated union causes compilation slowdowns. Splitting by category (controls, displays, containers, decorative) reduces type checking complexity from O(n) to O(category_size).

Output: Category-based type files in src/types/elements/ with backward-compatible re-exports from index.ts.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-architecture-refactoring/19-RESEARCH.md
@src/types/elements.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create category-based type modules</name>
  <files>
    src/types/elements/base.ts
    src/types/elements/controls.ts
    src/types/elements/displays.ts
    src/types/elements/containers.ts
    src/types/elements/decorative.ts
  </files>
  <action>
Create src/types/elements/ directory with category-based type files.

1. **base.ts** - Extract BaseElementConfig interface and ColorOverrides import:
```typescript
import { ColorOverrides } from '../knobStyle'
export interface BaseElementConfig {
  id: string; name: string;
  x: number; y: number; width: number; height: number;
  rotation: number; zIndex: number;
  locked: boolean; visible: boolean;
  parameterId?: string;
}
```

2. **controls.ts** - Move control element types:
- KnobElementConfig, SliderElementConfig, ButtonElementConfig
- RangeSliderElementConfig, DropdownElementConfig, CheckboxElementConfig
- RadioGroupElementConfig, TextFieldElementConfig
- Include type guards: isKnob, isSlider, isButton, etc.
- Include factory functions: createKnob, createSlider, createButton, etc.
- Export union: `export type ControlElement = KnobElementConfig | SliderElementConfig | ...`

3. **displays.ts** - Move display element types:
- LabelElementConfig, MeterElementConfig, DbDisplayElementConfig
- FrequencyDisplayElementConfig, GainReductionMeterElementConfig
- WaveformElementConfig, OscilloscopeElementConfig, PresetBrowserElementConfig
- ModulationMatrixElementConfig (complex widget but display-oriented)
- Include type guards and factory functions
- Export union: `export type DisplayElement = LabelElementConfig | MeterElementConfig | ...`

4. **containers.ts** - Move container element types:
- PanelElementConfig, FrameElementConfig, GroupBoxElementConfig
- CollapsibleContainerElementConfig
- Include type guards and factory functions
- Export union: `export type ContainerElement = PanelElementConfig | FrameElementConfig | ...`

5. **decorative.ts** - Move decorative element types:
- ImageElementConfig, SvgGraphicElementConfig
- RectangleElementConfig, LineElementConfig
- Include type guards and factory functions
- Export union: `export type DecorativeElement = ImageElementConfig | RectangleElementConfig | ...`

Each file must:
- Import BaseElementConfig from './base'
- Import ColorOverrides from '../knobStyle' only where needed (controls.ts for KnobElementConfig)
- Export all interfaces, type guards, and factory functions
- Export a category union type
  </action>
  <verify>TypeScript compiles without errors: `npm run build`</verify>
  <done>Five category type files created with all 25 element types properly distributed</done>
</task>

<task type="auto">
  <name>Task 2: Create backward-compatible index.ts re-exports</name>
  <files>src/types/elements/index.ts</files>
  <action>
Create src/types/elements/index.ts that re-exports everything for backward compatibility.

```typescript
// Re-export base
export * from './base'

// Re-export all category types
export * from './controls'
export * from './displays'
export * from './containers'
export * from './decorative'

// Unified ElementConfig union
import { ControlElement } from './controls'
import { DisplayElement } from './displays'
import { ContainerElement } from './containers'
import { DecorativeElement } from './decorative'

export type ElementConfig =
  | ControlElement
  | DisplayElement
  | ContainerElement
  | DecorativeElement

// Category type aliases for registry use
export type { ControlElement, DisplayElement, ContainerElement, DecorativeElement }
```

This maintains the existing import pattern `from '../../types/elements'` across all consumers.
  </action>
  <verify>All imports from '../../types/elements' continue to work - run `npm run build`</verify>
  <done>index.ts re-exports maintain backward compatibility with all existing imports</done>
</task>

<task type="auto">
  <name>Task 3: Update original elements.ts to re-export from new location</name>
  <files>src/types/elements.ts</files>
  <action>
Replace the entire contents of src/types/elements.ts with a simple re-export:

```typescript
/**
 * Element type system for VST3 WebView UI Designer
 *
 * Types are organized by category in src/types/elements/
 * This file re-exports everything for backward compatibility.
 *
 * @see src/types/elements/base.ts - BaseElementConfig
 * @see src/types/elements/controls.ts - Knob, Slider, Button, etc.
 * @see src/types/elements/displays.ts - Label, Meter, dB Display, etc.
 * @see src/types/elements/containers.ts - Panel, Frame, GroupBox, etc.
 * @see src/types/elements/decorative.ts - Image, Rectangle, Line, etc.
 */

export * from './elements/index'
```

This keeps all existing imports working without changes:
- `import { ElementConfig } from '../../types/elements'` still works
- `import { createKnob, isKnob } from '../../types/elements'` still works
  </action>
  <verify>
Run full build and ensure no import errors:
```bash
npm run build
npm run test
```
  </verify>
  <done>Original elements.ts now re-exports from category modules; all imports unchanged</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without TypeScript errors
2. `npm run test` passes (all existing tests work with new type structure)
3. Application runs correctly: `npm run dev` and verify elements render
4. Verify import paths work: grep for `from.*types/elements` and confirm no broken imports
</verification>

<success_criteria>
- [ ] 5 category type files created in src/types/elements/
- [ ] ElementConfig union composed from category unions
- [ ] All 25 element types distributed to appropriate categories
- [ ] All type guards (isKnob, isSlider, etc.) accessible from original import path
- [ ] All factory functions (createKnob, createSlider, etc.) accessible from original import path
- [ ] Build succeeds with no TypeScript errors
- [ ] Tests pass
- [ ] No changes required in consuming files (PropertyPanel.tsx, Element.tsx, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/19-architecture-refactoring/19-01-SUMMARY.md`
</output>
