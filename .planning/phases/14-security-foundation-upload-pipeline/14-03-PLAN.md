---
phase: 14-security-foundation-upload-pipeline
plan: 03
type: execute
wave: 2
depends_on: ["14-02"]
files_modified:
  - package.json
  - src/components/SafeSVG.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "SafeSVG component renders SVG content safely using dangerouslySetInnerHTML with sanitization"
    - "SafeSVG always re-sanitizes content before rendering (defense-in-depth)"
    - "Toast notifications appear in the application UI"
    - "Toaster component is mounted in application root"
  artifacts:
    - path: "src/components/SafeSVG.tsx"
      provides: "React component for safe SVG rendering"
      exports: ["SafeSVG"]
      min_lines: 20
    - path: "src/App.tsx"
      provides: "Application root with Toaster"
      contains: "Toaster"
  key_links:
    - from: "src/components/SafeSVG.tsx"
      to: "src/lib/svg-sanitizer.ts"
      via: "import sanitizeSVG"
      pattern: "import.*sanitizeSVG.*svg-sanitizer"
    - from: "src/App.tsx"
      to: "react-hot-toast"
      via: "Toaster component"
      pattern: "import.*Toaster.*react-hot-toast"
---

<objective>
Create SafeSVG React component and add toast notification infrastructure.

Purpose: Implements SEC-08 (SafeSVG component) - the single point through which ALL SVG rendering must pass. Also adds react-hot-toast for user-facing validation error messages. This establishes the UI infrastructure for secure SVG handling.

Output: SafeSVG component and toast infrastructure ready for use throughout the application.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-security-foundation-upload-pipeline/14-CONTEXT.md
@.planning/phases/14-security-foundation-upload-pipeline/14-RESEARCH.md
@src/lib/svg-sanitizer.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-hot-toast</name>
  <files>package.json</files>
  <action>
    Install react-hot-toast for toast notifications:
    ```bash
    npm install react-hot-toast
    ```

    This provides lightweight (5KB) toast notifications with:
    - ARIA accessibility built-in
    - Promise-based API for async operations
    - Configurable positioning and styling
  </action>
  <verify>`npm list react-hot-toast` shows version installed</verify>
  <done>react-hot-toast is in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create SafeSVG component</name>
  <files>src/components/SafeSVG.tsx</files>
  <action>
    Create SafeSVG React component that encapsulates all SVG rendering:

    ```typescript
    import React, { useMemo } from 'react';
    import { sanitizeSVG } from '../lib/svg-sanitizer';

    interface SafeSVGProps {
      content: string;
      className?: string;
      style?: React.CSSProperties;
    }

    export const SafeSVG: React.FC<SafeSVGProps> = ({ content, className, style }) => {
      // Always re-sanitize, even if content was sanitized before
      // This is defense-in-depth - stored content could be tampered with
      const sanitized = useMemo(() => {
        return sanitizeSVG(content);
      }, [content]);

      return (
        <div
          className={className}
          style={style}
          dangerouslySetInnerHTML={{ __html: sanitized }}
        />
      );
    };
    ```

    Key design decisions:
    - useMemo for performance (avoid re-sanitizing on every render)
    - Memoization key is content (re-sanitize when content changes)
    - Wrapper div allows className/style for positioning
    - dangerouslySetInnerHTML is safe because DOMPurify sanitizes first
  </action>
  <verify>File exists and TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>SafeSVG component exports and compiles without errors</done>
</task>

<task type="auto">
  <name>Task 3: Add Toaster to App root</name>
  <files>src/App.tsx</files>
  <action>
    Add Toaster component to the application root:

    1. Import Toaster from react-hot-toast
    2. Add Toaster component at root level (after main content, before closing fragment)
    3. Configure position as "top-right" for standard toast location

    ```typescript
    import { Toaster } from 'react-hot-toast';

    // In the App component return:
    <>
      {/* existing content */}
      <Toaster
        position="top-right"
        toastOptions={{
          // Default styling to match dark theme
          style: {
            background: '#1f2937', // gray-800
            color: '#f3f4f6', // gray-100
          },
          // Error toasts are red
          error: {
            style: {
              background: '#7f1d1d', // red-900
              color: '#fecaca', // red-200
            },
          },
          // Success toasts are green
          success: {
            style: {
              background: '#14532d', // green-900
              color: '#bbf7d0', // green-200
            },
          },
        }}
      />
    </>
    ```
  </action>
  <verify>App compiles and Toaster is visible in React DevTools</verify>
  <done>Toaster component is mounted in App and styled for dark theme</done>
</task>

</tasks>

<verification>
- `npm list react-hot-toast` shows package installed
- `npx tsc --noEmit` compiles without errors
- SafeSVG.tsx exists with sanitizeSVG import
- App.tsx includes Toaster component
- Run dev server and verify no console errors
</verification>

<success_criteria>
- react-hot-toast installed
- SafeSVG component created with memoized sanitization
- Toaster added to App.tsx with dark theme styling
- Application compiles and runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-security-foundation-upload-pipeline/14-03-SUMMARY.md`
</output>
