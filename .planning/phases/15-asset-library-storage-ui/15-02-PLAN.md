---
phase: 15-asset-library-storage-ui
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - src/components/AssetLibrary/ImportAssetDialog.tsx
  - src/components/AssetLibrary/index.ts
  - src/lib/svg-validator.ts
autonomous: true

must_haves:
  truths:
    - "User can open import dialog and select an SVG file"
    - "Dialog shows SVG preview before confirming import"
    - "Dialog shows file size and element count validation info"
    - "User must enter a name before import button is enabled"
    - "Import adds sanitized SVG to AssetsSlice"
  artifacts:
    - path: "src/components/AssetLibrary/ImportAssetDialog.tsx"
      provides: "Modal dialog for SVG import with preview"
      min_lines: 100
    - path: "src/components/AssetLibrary/index.ts"
      provides: "Barrel export for AssetLibrary components"
      exports: ["ImportAssetDialog"]
  key_links:
    - from: "src/components/AssetLibrary/ImportAssetDialog.tsx"
      to: "src/store/assetsSlice.ts"
      via: "useStore addAsset action"
      pattern: "addAsset"
    - from: "src/components/AssetLibrary/ImportAssetDialog.tsx"
      to: "src/lib/svg-validator.ts"
      via: "validateSVG function import"
      pattern: "validateSVG"
    - from: "src/components/AssetLibrary/ImportAssetDialog.tsx"
      to: "src/lib/svg-sanitizer.ts"
      via: "sanitizeSVG function import"
      pattern: "sanitizeSVG"
---

<objective>
Create the SVG import dialog with file upload, preview, and validation display.

Purpose: Enable users to import SVG files into the asset library with full preview before confirming. Implements ASSET-03 (import via dialog) and ASSET-04 (preview before adding).

Output: ImportAssetDialog component with react-dropzone, SafeSVG preview, name input, and validation info display.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/15-asset-library-storage-ui/15-CONTEXT.md
@.planning/phases/15-asset-library-storage-ui/15-RESEARCH.md
@src/components/Import/TemplateImporter.tsx
@src/components/SafeSVG.tsx
@src/lib/svg-validator.ts
@src/lib/svg-sanitizer.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ImportAssetDialog component</name>
  <files>src/components/AssetLibrary/ImportAssetDialog.tsx, src/components/AssetLibrary/index.ts</files>
  <action>
Create ImportAssetDialog following TemplateImporter pattern but for single SVG files:

Props interface:
```typescript
interface ImportAssetDialogProps {
  isOpen: boolean
  onClose: () => void
}
```

State:
- `file: File | null` - Selected file
- `svgContent: string` - Raw SVG text content
- `sanitizedContent: string` - After sanitizeSVG
- `previewUrl: string | null` - URL.createObjectURL for native preview
- `name: string` - User-entered asset name (empty by default per CONTEXT.md)
- `selectedCategories: string[]` - Multi-select for categories
- `validationResult: ValidationResult | null` - From validateSVG
- `importing: boolean` - Loading state

react-dropzone config:
```typescript
const { getRootProps, getInputProps, isDragActive } = useDropzone({
  accept: { 'image/svg+xml': ['.svg'] },
  multiple: false,
  maxFiles: 1,
  onDrop: handleFileDrop
})
```

handleFileDrop flow:
1. Get file from acceptedFiles[0]
2. Read file text: `const text = await file.text()`
3. Validate with validateSVG from svg-validator.ts
4. If validation fails, show error toast and return
5. If validation passes, sanitize with sanitizeSVG
6. Create preview URL: `URL.createObjectURL(file)`
7. Count elements using DOMParser (from RESEARCH.md analyzeSVG pattern)
8. Update state with content, preview, validation result

CRITICAL: Memory leak prevention
- Use useEffect to revoke preview URL when dialog closes or new file selected
- Pattern from RESEARCH.md:
```typescript
useEffect(() => {
  return () => {
    if (previewUrl) {
      URL.revokeObjectURL(previewUrl)
    }
  }
}, [previewUrl])
```

Dialog UI layout (modal matching project style):
1. Header: "Import SVG Asset" with close X button
2. Drop zone (styled like TemplateImporter)
3. If file selected:
   - Preview area with SafeSVG component (96px max size for preview)
   - File info: name, size in KB, element count
   - Validation status (green checkmarks for passed checks)
4. Name input field (required, empty by default)
5. Category multi-select checkboxes (DEFAULT_CATEGORIES)
6. Footer: Cancel and Import buttons
   - Import disabled if: no file, no name entered, or validation failed

handleImport:
1. Call addAsset from useStore with:
   - name: user-entered name
   - svgContent: sanitized content
   - categories: selected categories
   - fileSize: file.size
   - elementCount: counted from DOM
2. Show success toast
3. Reset state and close dialog

Create barrel export in index.ts:
```typescript
export { ImportAssetDialog } from './ImportAssetDialog'
```
  </action>
  <verify>`npx tsc --noEmit` passes; component renders in isolation</verify>
  <done>ImportAssetDialog component with react-dropzone, SafeSVG preview, name input, category selection, and validation display</done>
</task>

<task type="auto">
  <name>Task 2: Add SVG info extraction helper</name>
  <files>src/lib/svg-validator.ts</files>
  <action>
Add helper function to extract SVG metadata for import dialog display.

Add to svg-validator.ts (alongside existing validateSVG):

```typescript
/**
 * Extracts metadata from SVG content for display purposes.
 * Used by import dialog to show element count and validation info.
 */
export function getSVGMetadata(svgContent: string): {
  elementCount: number
  hasScripts: boolean
  hasExternalRefs: boolean
  viewBox: string | null
  width: string | null
  height: string | null
} {
  const parser = new DOMParser()
  const doc = parser.parseFromString(svgContent, 'image/svg+xml')

  // Check for parse errors
  const parseError = doc.querySelector('parsererror')
  if (parseError) {
    return {
      elementCount: 0,
      hasScripts: false,
      hasExternalRefs: false,
      viewBox: null,
      width: null,
      height: null
    }
  }

  const svg = doc.documentElement

  return {
    elementCount: doc.getElementsByTagName('*').length,
    hasScripts: doc.querySelectorAll('script').length > 0,
    hasExternalRefs: !!svg.innerHTML.match(/url\s*\(\s*['"]?https?:/i),
    viewBox: svg.getAttribute('viewBox'),
    width: svg.getAttribute('width'),
    height: svg.getAttribute('height')
  }
}
```

This keeps element counting logic in one place (don't repeat in component).
  </action>
  <verify>`npx tsc --noEmit` passes; existing tests still pass `npm test`</verify>
  <done>getSVGMetadata function exported from svg-validator.ts</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Dev server starts: `npm run dev`
3. Existing tests pass: `npm test`
4. Dialog can be manually tested by adding temporary button trigger
</verification>

<success_criteria>
- ImportAssetDialog uses react-dropzone for file upload
- Preview shows SafeSVG rendering of selected file
- File size and element count displayed
- Name field required and empty by default
- Category checkboxes for DEFAULT_CATEGORIES
- Import button calls addAsset with all required fields
- Object URL properly cleaned up to prevent memory leaks
</success_criteria>

<output>
After completion, create `.planning/phases/15-asset-library-storage-ui/15-02-SUMMARY.md`
</output>
