---
phase: 15-asset-library-storage-ui
plan: 03
type: execute
wave: 3
depends_on: ["15-02"]
files_modified:
  - src/components/AssetLibrary/AssetLibraryPanel.tsx
  - src/components/AssetLibrary/AssetThumbnail.tsx
  - src/components/AssetLibrary/CategorySection.tsx
  - src/components/AssetLibrary/AssetSearch.tsx
  - src/components/AssetLibrary/index.ts
  - src/components/Layout/LeftPanel.tsx
autonomous: true

must_haves:
  truths:
    - "Asset Library panel displays in left panel with tab switching"
    - "Assets shown as 96px thumbnails in grid layout"
    - "Collapsible category sections group assets"
    - "Search box filters assets by name as user types"
    - "Import SVG button opens import dialog"
    - "Empty state shows helpful message when no assets"
  artifacts:
    - path: "src/components/AssetLibrary/AssetLibraryPanel.tsx"
      provides: "Main asset library container"
      min_lines: 80
    - path: "src/components/AssetLibrary/AssetThumbnail.tsx"
      provides: "Individual asset thumbnail with SafeSVG"
      min_lines: 30
    - path: "src/components/AssetLibrary/CategorySection.tsx"
      provides: "Collapsible category container"
      min_lines: 40
    - path: "src/components/AssetLibrary/AssetSearch.tsx"
      provides: "Debounced search input"
      min_lines: 30
    - path: "src/components/Layout/LeftPanel.tsx"
      provides: "Tab switching between Elements and Assets"
      contains: "activeTab"
  key_links:
    - from: "src/components/AssetLibrary/AssetLibraryPanel.tsx"
      to: "src/store/assetsSlice.ts"
      via: "useStore assets selector"
      pattern: "useStore.*assets"
    - from: "src/components/AssetLibrary/AssetThumbnail.tsx"
      to: "src/components/SafeSVG.tsx"
      via: "SafeSVG import for secure rendering"
      pattern: "SafeSVG"
    - from: "src/components/Layout/LeftPanel.tsx"
      to: "src/components/AssetLibrary/AssetLibraryPanel.tsx"
      via: "conditional render based on activeTab"
      pattern: "AssetLibraryPanel"
---

<objective>
Create the Asset Library panel UI with grid thumbnails, category sections, search, and tab switching.

Purpose: Enable users to browse, search, and organize their imported SVG assets in a dedicated panel. Implements ASSET-02 (library UI panel), ASSET-06 (categories), and ASSET-07 (thumbnail previews).

Output: AssetLibraryPanel with thumbnails, categories, search, and LeftPanel with tab switching.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/15-asset-library-storage-ui/15-CONTEXT.md
@.planning/phases/15-asset-library-storage-ui/15-RESEARCH.md
@src/components/Layout/LeftPanel.tsx
@src/components/Palette/Palette.tsx
@src/components/Palette/PaletteCategory.tsx
@src/components/SafeSVG.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AssetSearch component with debouncing</name>
  <files>src/components/AssetLibrary/AssetSearch.tsx</files>
  <action>
Create debounced search input following RESEARCH.md pattern:

```typescript
interface AssetSearchProps {
  onSearch: (term: string) => void
}
```

Implementation:
- Use useState for inputValue (controlled input)
- Use useRef for timeout ID storage
- 300ms debounce delay (standard from RESEARCH.md)
- Clear timeout on unmount to prevent memory leaks
- Case-insensitive search will be handled by parent

UI:
- Full-width input with search icon
- Placeholder: "Search assets..."
- Gray-700 background, gray-100 text (match app theme)
- Clear button (X) when input has value
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>AssetSearch component with 300ms debounced search</done>
</task>

<task type="auto">
  <name>Task 2: Create CategorySection and AssetThumbnail components</name>
  <files>src/components/AssetLibrary/CategorySection.tsx, src/components/AssetLibrary/AssetThumbnail.tsx</files>
  <action>
**CategorySection** - Collapsible container for asset category:

Props:
```typescript
interface CategorySectionProps {
  name: string
  isExpanded: boolean
  onToggle: () => void
  children: React.ReactNode
}
```

UI following PaletteCategory pattern:
- Click header to expand/collapse
- Chevron icon rotates on expand
- Grid layout for children (assets): `grid grid-cols-2 gap-2`
- Category name styled like PaletteCategory

**AssetThumbnail** - Individual asset in grid:

Props:
```typescript
interface AssetThumbnailProps {
  asset: Asset
  isSelected?: boolean
  onClick?: () => void
}
```

UI per CONTEXT.md:
- 96px square container (w-24 h-24)
- SafeSVG component renders svgContent
- Preserve aspect ratio (contain, not cover)
- Asset name below thumbnail (truncate if long)
- Selected state: blue border
- Hover state: lighter background

NOTE: Do NOT add drag functionality yet - that's Plan 04.
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>CategorySection and AssetThumbnail components created</done>
</task>

<task type="auto">
  <name>Task 3: Create AssetLibraryPanel and update LeftPanel with tabs</name>
  <files>src/components/AssetLibrary/AssetLibraryPanel.tsx, src/components/AssetLibrary/index.ts, src/components/Layout/LeftPanel.tsx</files>
  <action>
**AssetLibraryPanel** - Main library container:

State:
- `searchTerm: string` - Current search filter
- `expandedCategories: Set<string>` - Which categories are expanded
- `selectedAssetId: string | null` - Currently selected asset (for delete key handling)

Read from store:
- `assets` - All assets from AssetsSlice
- `customCategories` - User-added categories

Computed (useMemo):
- Filter assets by searchTerm (case-insensitive name match)
- Group filtered assets by category (asset can appear in multiple)
- Separate uncategorized assets

UI layout:
1. "Import SVG" button at top (prominent, opens ImportAssetDialog)
2. AssetSearch component
3. For each category (DEFAULT_CATEGORIES + customCategories):
   - CategorySection with matching assets
   - Only show category if it has assets (after search filter)
4. "Uncategorized" section at bottom for assets with empty categories[]
5. Empty state when no assets: "No assets yet. Click 'Import SVG' to add your first asset."

**Update index.ts** - Add exports:
```typescript
export { ImportAssetDialog } from './ImportAssetDialog'
export { AssetLibraryPanel } from './AssetLibraryPanel'
export { AssetThumbnail } from './AssetThumbnail'
export { CategorySection } from './CategorySection'
export { AssetSearch } from './AssetSearch'
```

**Update LeftPanel** - Add tab switching:

State:
- `activeTab: 'elements' | 'assets'` - Default to 'elements'

UI changes:
1. Replace static "Components" header with tab buttons
2. Tab button styling: active tab has blue underline, inactive is gray
3. Conditional render based on activeTab:
   - 'elements': Show Palette component
   - 'assets': Show AssetLibraryPanel component
4. Keep "Import Template" button visible on both tabs (bottom)

Tab styling example:
```tsx
<div className="flex border-b border-gray-700">
  <button
    onClick={() => setActiveTab('elements')}
    className={`px-4 py-2 text-sm ${
      activeTab === 'elements'
        ? 'text-blue-400 border-b-2 border-blue-400'
        : 'text-gray-400 hover:text-gray-200'
    }`}
  >
    Elements
  </button>
  <button
    onClick={() => setActiveTab('assets')}
    className={`px-4 py-2 text-sm ${
      activeTab === 'assets'
        ? 'text-blue-400 border-b-2 border-blue-400'
        : 'text-gray-400 hover:text-gray-200'
    }`}
  >
    Assets
  </button>
</div>
```
  </action>
  <verify>`npm run dev` shows tab switching between Elements and Assets panels</verify>
  <done>AssetLibraryPanel renders with categories, LeftPanel has working tab switch</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Dev server starts: `npm run dev`
3. Tab switching works in left panel
4. Assets panel shows "Import SVG" button and empty state
5. Search input visible with debounced filtering
6. Category sections expand/collapse
</verification>

<success_criteria>
- Tab buttons switch between Elements and Assets panels
- Asset Library shows "Import SVG" button prominently
- Search box filters assets by name (case-insensitive)
- Category sections are collapsible with chevron icons
- 96px thumbnails render SVG with SafeSVG component
- Empty state displays helpful message
- Uncategorized section appears for assets without categories
</success_criteria>

<output>
After completion, create `.planning/phases/15-asset-library-storage-ui/15-03-SUMMARY.md`
</output>
