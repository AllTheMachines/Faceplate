---
phase: 09-enhancements-bugfixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Canvas/hooks/useResize.ts
  - src/store/viewportSlice.ts
  - src/components/Properties/PropertyPanel.tsx
autonomous: true

must_haves:
  truths:
    - "Position/Size values in property panel update in real-time during drag"
    - "Position/Size values in property panel update in real-time during resize"
  artifacts:
    - path: "src/store/viewportSlice.ts"
      provides: "Live drag values state"
      contains: "liveDragValues"
    - path: "src/components/Properties/PropertyPanel.tsx"
      provides: "Property panel showing live values"
      contains: "liveDragValues"
  key_links:
    - from: "src/components/Canvas/hooks/useResize.ts"
      to: "src/store/viewportSlice.ts"
      via: "setLiveDragValues action"
      pattern: "setLiveDragValues"
---

<objective>
Implement real-time position/size updates in property panel during drag and resize operations.

Purpose: IMP-01 improves UX by showing exact pixel values during manipulation, enabling precise positioning.
Output: Property panel displays live x/y/width/height values that update every frame during drag/resize.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-enhancements-bugfixes/09-RESEARCH.md

@src/store/viewportSlice.ts
@src/store/index.ts
@src/components/Canvas/hooks/useResize.ts
@src/components/Properties/PropertyPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add live drag values to viewport slice</name>
  <files>src/store/viewportSlice.ts</files>
  <action>
Add state for tracking live drag/resize values. These are stored separately from element state to avoid triggering undo history on every mousemove.

Add to ViewportSlice interface:
```typescript
// Live drag/resize values (not persisted, not undoable)
liveDragValues: { [elementId: string]: { x?: number; y?: number; width?: number; height?: number } } | null
setLiveDragValues: (values: { [elementId: string]: { x?: number; y?: number; width?: number; height?: number } } | null) => void
```

Add to createViewportSlice:
```typescript
liveDragValues: null,
setLiveDragValues: (values) => set({ liveDragValues: values }),
```

Why viewport slice: This state is camera/interaction state, not document state. It should NOT be undoable (already excluded via partialize).
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Check that ViewportSlice exports the new interface members.
  </verify>
  <done>Viewport slice has liveDragValues state and setter action.</done>
</task>

<task type="auto">
  <name>Task 2: Update useResize to broadcast live values</name>
  <files>src/components/Canvas/hooks/useResize.ts</files>
  <action>
Modify useResize to set live drag values during resize without updating the actual element state until mouseup.

Import setLiveDragValues from store:
```typescript
const setLiveDragValues = useStore((state) => state.setLiveDragValues)
```

In handleMouseMove, BEFORE calling updateElement, set live values:
```typescript
// Broadcast live values for property panel (high frequency, no re-render)
setLiveDragValues({
  [elementId]: {
    x: updates.x ?? element.x,
    y: updates.y ?? element.y,
    width: updates.width ?? element.width,
    height: updates.height ?? element.height,
  }
})

// Note: We still call updateElement for canvas preview (existing behavior)
updateElement(elementId, updates)
```

Wait - the existing code already calls updateElement on every mousemove, which IS updating the store. The issue is that PropertyPanel reads from store, so it DOES update in real-time already.

Let me re-check: The research says property panel "lags" - this might be a perceived issue due to React batching or Zustand subscription timing, not a real problem.

Actually, keep the current approach BUT also clear live values on mouseup:

In handleMouseUp, add:
```typescript
setLiveDragValues(null) // Clear live values, element state is source of truth
```

This ensures clean state transitions.
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Check that useResize imports and uses setLiveDragValues.
  </verify>
  <done>useResize broadcasts live values during resize and clears them on completion.</done>
</task>

<task type="auto">
  <name>Task 3: Update PropertyPanel to show live values during drag</name>
  <files>src/components/Properties/PropertyPanel.tsx</files>
  <action>
Modify PropertyPanel to prefer live drag values over element state when available.

Add to the component:
```typescript
const liveDragValues = useStore((state) => state.liveDragValues)

// ... later, after getting element:
// Merge live values if available (live values take precedence during drag)
const liveValues = liveDragValues?.[element.id]
const displayX = liveValues?.x ?? element.x
const displayY = liveValues?.y ?? element.y
const displayWidth = liveValues?.width ?? element.width
const displayHeight = liveValues?.height ?? element.height
```

Update the Position & Size section to use display values:
```typescript
<NumberInput
  label="X"
  value={displayX}
  onChange={(x) => update({ x })}
/>
<NumberInput
  label="Y"
  value={displayY}
  onChange={(y) => update({ y })}
/>
<NumberInput
  label="Width"
  value={displayWidth}
  onChange={(width) => update({ width })}
  min={20}
/>
<NumberInput
  label="Height"
  value={displayHeight}
  onChange={(height) => update({ height })}
  min={20}
/>
```

The inputs remain editable - user can still type values. But during drag/resize, they show the live position.
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Manual test: Select element, resize it - X/Y/Width/Height values should update smoothly during drag.
  </verify>
  <done>Property panel shows real-time values during drag and resize operations.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes successfully
2. Start app with `npm run dev`
3. Add element to canvas, select it
4. Observe property panel shows X, Y, Width, Height values
5. Drag element - X, Y values in property panel should update in real-time
6. Resize element via corner handle - Width, Height values should update in real-time
7. Release mouse - values should remain accurate
8. Type new value in property panel - element should move/resize accordingly
</verification>

<success_criteria>
- IMP-01: Position and Size values update in real-time during drag/resize
- Property panel inputs remain functional for direct value entry
- No performance degradation during drag (smooth animation)
</success_criteria>

<output>
After completion, create `.planning/phases/09-enhancements-bugfixes/09-02-SUMMARY.md`
</output>
