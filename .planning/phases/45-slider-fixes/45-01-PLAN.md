---
phase: 45-slider-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/elements/renderers/controls/NotchedSliderRenderer.tsx
  - src/components/elements/renderers/controls/BipolarSliderRenderer.tsx
  - src/components/Properties/NotchedSliderProperties.tsx
  - src/types/elements/controls.ts
autonomous: true

must_haves:
  truths:
    - "Notched Slider displays visible tick lines extending from track at each notch position"
    - "Notched Slider labels are readable when showNotchLabels is enabled"
    - "Notched Slider tick color is configurable and defaults to visible contrast"
    - "Bipolar Slider horizontal orientation fills correctly from center to thumb position"
    - "Bipolar Slider center marker is visible as thin vertical line at zero position"
  artifacts:
    - path: "src/components/elements/renderers/controls/NotchedSliderRenderer.tsx"
      provides: "Notched slider with visible tick lines and configurable labels"
      contains: "notchLength"
    - path: "src/components/elements/renderers/controls/BipolarSliderRenderer.tsx"
      provides: "Bipolar slider with working horizontal orientation"
      contains: "horizontal"
    - path: "src/components/Properties/NotchedSliderProperties.tsx"
      provides: "Notch tick length and label font size controls"
      contains: "notchLength"
  key_links:
    - from: "NotchedSliderRenderer.tsx"
      to: "config.notchLength"
      via: "config property access"
      pattern: "config\\.notchLength"
    - from: "BipolarSliderRenderer.tsx"
      to: "fillWidth calculation"
      via: "horizontal orientation branch"
      pattern: "fillWidth.*=.*thumbX"
---

<objective>
Fix renderer bugs in Notched Slider and Bipolar Slider horizontal orientation.

Purpose: Address visibility and rendering issues that prevent these slider variants from working correctly (GitHub #35, #33).

Output: Working Notched Slider with visible tick lines/labels and working Bipolar Slider horizontal mode.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/45-slider-fixes/45-CONTEXT.md
@.planning/phases/45-slider-fixes/45-RESEARCH.md
@src/components/elements/renderers/controls/NotchedSliderRenderer.tsx
@src/components/elements/renderers/controls/BipolarSliderRenderer.tsx
@src/types/elements/controls.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Notched Slider visibility</name>
  <files>
    src/components/elements/renderers/controls/NotchedSliderRenderer.tsx
    src/components/Properties/NotchedSliderProperties.tsx
    src/types/elements/controls.ts
  </files>
  <action>
Fix Notched Slider tick lines and labels visibility:

1. **Type definition** (controls.ts):
   - Add `notchLength: number` property to NotchedSliderElementConfig (default: 12px)
   - Add `notchLabelFontSize: number` property (default: 10px)
   - Update createNotchedSlider factory with defaults

2. **Renderer** (NotchedSliderRenderer.tsx):
   - Use `config.notchLength ?? 12` instead of hardcoded `8`
   - Use `config.notchLabelFontSize ?? 10` instead of hardcoded `9`
   - Ensure notch lines extend BOTH sides of track (already implemented, verify working)
   - Verify notchColor contrasts with default background (current default is `rgba(255, 255, 255, 0.5)`)

3. **Property Panel** (NotchedSliderProperties.tsx):
   - Add NumberInput for "Tick Length" (min: 4, max: 30)
   - Add NumberInput for "Label Font Size" (min: 8, max: 16)
   - Place in "Notch Settings" section after showNotchLabels checkbox

Research identified: notchLength=8 and fontSize=9 may be too small to be visible. Increase defaults and make configurable per user decision.
  </action>
  <verify>
    - `npm run build` succeeds
    - Add Notched Slider to canvas with showNotchLabels=true
    - Tick lines visible on both sides of track
    - Labels readable at each notch position
    - Tick Length and Label Font Size inputs appear in property panel
  </verify>
  <done>
    - Notched Slider tick lines visible with configurable length (default 12px)
    - Notched Slider labels visible with configurable font size (default 10px)
    - Both vertical and horizontal orientations render tick marks correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Bipolar Slider horizontal orientation</name>
  <files>
    src/components/elements/renderers/controls/BipolarSliderRenderer.tsx
  </files>
  <action>
Fix Bipolar Slider horizontal orientation fill calculation:

1. **Analyze current bug** (lines 188-272):
   - Current: `fillWidth = normalizedValue * config.width - centerX`
   - Problem: This doesn't account for thumb width offset

2. **Fix fill calculation**:
   - When value >= centerValue: fillX = centerX, fillWidth = (thumbX + thumbWidth/2) - centerX
   - When value < centerValue: fillX = thumbX + thumbWidth/2, fillWidth = centerX - fillX
   - Use thumb center position, not raw normalizedValue * width

3. **Verify center line**:
   - Center line should be vertical (x1=centerX, x2=centerX)
   - Currently correct but verify strokeWidth is visible (currently 2)

4. **Test cases to verify**:
   - centerValue=0.5, value=0.5 -> fill should be zero width
   - centerValue=0.5, value=1.0 -> fill from center to right
   - centerValue=0.5, value=0.0 -> fill from left to center
   - centerValue=0.25 (off-center) -> fill should adjust correctly

The vertical orientation (lines 104-187) is working correctly. Only horizontal branch needs fix.
  </action>
  <verify>
    - `npm run build` succeeds
    - Add Bipolar Slider, set orientation to horizontal
    - Fill extends from center to thumb position correctly
    - Moving value to 0.5 shows no fill (thumb at center)
    - Moving value to 1.0 shows fill from center to right
    - Moving value to 0.0 shows fill from left to center
    - Center line visible as vertical line at center position
  </verify>
  <done>
    - Bipolar Slider horizontal orientation renders and fills correctly
    - Fill calculation matches vertical orientation behavior
    - Center marker visible at zero position
  </done>
</task>

</tasks>

<verification>
1. `npm run build` - no TypeScript errors
2. Visual verification in dev server:
   - Notched Slider: tick lines visible both sides, labels readable
   - Bipolar Slider horizontal: fill extends correctly from center
3. Property panel: new controls visible and functional
</verification>

<success_criteria>
- SLD-03 (Notched Slider shows labels and lines): Tick lines visible, labels configurable
- SLD-04 (Bipolar Slider horizontal): Horizontal orientation renders and operates correctly
- No regression in vertical orientations
</success_criteria>

<output>
After completion, create `.planning/phases/45-slider-fixes/45-01-SUMMARY.md`
</output>
