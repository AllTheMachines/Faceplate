---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/Layout/ThreePanelLayout.tsx
  - src/components/Layout/LeftPanel.tsx
  - src/components/Layout/RightPanel.tsx
  - src/components/Layout/index.ts
  - src/components/Canvas/CanvasStage.tsx
  - src/components/Canvas/CanvasBackground.tsx
  - src/components/Canvas/index.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User sees a three-panel layout with left palette, center canvas, and right properties panel"
    - "User sees an empty canvas with default dimensions (800x600) rendered via react-konva"
    - "Canvas has dark background that transforms correctly with the stage"
    - "Layout is responsive with fixed sidebars (250px left, 300px right) and flexible center"
  artifacts:
    - path: "src/components/Layout/ThreePanelLayout.tsx"
      provides: "Main application layout shell"
      contains: "grid-cols-[250px_1fr_300px]"
    - path: "src/components/Canvas/CanvasStage.tsx"
      provides: "React-Konva Stage wrapper"
      contains: "Stage"
    - path: "src/components/Canvas/CanvasBackground.tsx"
      provides: "Canvas background rendering (color, gradient, image)"
      contains: "Rect"
  key_links:
    - from: "src/components/Canvas/CanvasStage.tsx"
      to: "src/store/index.ts"
      via: "useStore hook"
      pattern: "useStore"
    - from: "src/components/Canvas/CanvasBackground.tsx"
      to: "src/store/index.ts"
      via: "useStore for background config"
      pattern: "backgroundColor|backgroundType"
    - from: "src/App.tsx"
      to: "src/components/Layout/ThreePanelLayout.tsx"
      via: "component import"
      pattern: "ThreePanelLayout"
---

<objective>
Build the three-panel layout shell and canvas rendering infrastructure using react-konva. Users will see the foundational UI structure: palette panel (left), canvas (center), and properties panel (right).

Purpose: Establishes the visual structure and canvas rendering that all interactive features will build upon. Without visible canvas, pan/zoom cannot be implemented or tested.

Output: Working three-panel layout with a react-konva Stage rendering an empty canvas with configurable background.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Three-Panel Layout Components</name>
  <files>
    src/components/Layout/ThreePanelLayout.tsx
    src/components/Layout/LeftPanel.tsx
    src/components/Layout/RightPanel.tsx
    src/components/Layout/index.ts
  </files>
  <action>
    Create the layout component directory structure.

    ThreePanelLayout.tsx:
    - Use CSS Grid with Tailwind: `grid grid-cols-[250px_1fr_300px]`
    - Full viewport: `h-screen w-screen`
    - Dark theme base: `bg-gray-900 text-gray-100`
    - Render LeftPanel, center div for canvas, RightPanel as children
    - Accept children prop for center panel content

    LeftPanel.tsx:
    - Styling: `bg-gray-800 border-r border-gray-700 overflow-y-auto`
    - Header: "Elements" with padding and font styling
    - Placeholder text: "Element palette (Phase 4)" - this panel gets populated later

    RightPanel.tsx:
    - Styling: `bg-gray-800 border-l border-gray-700 overflow-y-auto`
    - Header: "Properties" with padding and font styling
    - Placeholder text: "Property panel (Phase 5)" - this panel gets populated later

    index.ts:
    - Export all layout components: ThreePanelLayout, LeftPanel, RightPanel
  </action>
  <verify>
    Import ThreePanelLayout in App.tsx
    Run `npm run dev` - should see three-panel layout
    Inspect with DevTools - center panel should be flexible width
    Resize browser - sidebars stay fixed, center grows/shrinks
  </verify>
  <done>
    Three-panel layout visible with fixed 250px left sidebar, flexible center, fixed 300px right sidebar
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Canvas Stage and Background Components</name>
  <files>
    src/components/Canvas/CanvasStage.tsx
    src/components/Canvas/CanvasBackground.tsx
    src/components/Canvas/index.ts
    src/App.tsx
  </files>
  <action>
    Create canvas component directory structure.

    CanvasBackground.tsx:
    - Import Rect from react-konva
    - Import useStore to get canvas dimensions and background config
    - Render based on backgroundType:
      - 'color': Simple Rect with fill={backgroundColor}
      - 'gradient': Rect with fillLinearGradientStartPoint, fillLinearGradientEndPoint, fillLinearGradientColorStops
      - 'image': Placeholder comment for Phase 6+ (complex implementation)
    - CRITICAL: Set `listening={false}` on background Rect - prevents event interference
    - Position at (0, 0) with canvas dimensions

    CanvasStage.tsx:
    - Import Stage, Layer from react-konva
    - Import useStore to get viewport state (scale, offsetX, offsetY) and canvas dimensions
    - Import CanvasBackground component
    - Use useRef<Konva.Stage> for stage reference
    - State: containerRef to measure parent container dimensions
    - Use useEffect with ResizeObserver to track container size
    - Stage props:
      - width/height: container dimensions (not canvas dimensions - canvas is inside)
      - scaleX/scaleY: viewport scale
      - x/y: viewport offsetX/offsetY
      - style: cursor changes based on isPanning state
    - Single Layer containing CanvasBackground
    - Add visual canvas border: another Rect with stroke but no fill, strokeWidth 1, stroke gray-600

    index.ts:
    - Export CanvasStage, CanvasBackground

    Update App.tsx:
    - Replace test content with ThreePanelLayout
    - Place CanvasStage as center panel content
    - Wrap center panel div with `relative overflow-hidden` for proper canvas sizing
  </action>
  <verify>
    Run `npm run dev`
    Canvas should render in center panel with dark background (#1a1a1a)
    Canvas should have visible border showing its 800x600 dimensions
    Canvas should be centered-ish in the available space (not filling entire area)
    Resize browser - canvas stays same size, container adjusts
  </verify>
  <done>
    Canvas renders via react-konva in center panel, background is dark, canvas border visible, stage scales correctly
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Canvas Dimension and Background Controls</name>
  <files>
    src/components/Layout/RightPanel.tsx
    src/components/Canvas/CanvasStage.tsx
  </files>
  <action>
    Add temporary controls to RightPanel for testing canvas configuration (these will be replaced by proper property panel in Phase 5).

    Update RightPanel.tsx:
    - Import useStore
    - Add "Canvas Settings" section with:
      - Width input: number input bound to canvasWidth, onChange calls setCanvasDimensions
      - Height input: number input bound to canvasHeight, onChange calls setCanvasDimensions
      - Background color input: color picker input bound to backgroundColor, onChange calls setBackgroundColor
    - Style inputs with Tailwind dark theme: `bg-gray-700 border-gray-600 text-white rounded px-2 py-1`
    - Add labels for each input

    Update CanvasStage.tsx:
    - Add zoom level indicator in corner: small text showing current scale as percentage
    - Position indicator absolutely in bottom-right of the stage container
    - Display format: "100%" for scale 1, "50%" for scale 0.5, "200%" for scale 2

    This task verifies that:
    1. Store state flows to canvas correctly (change dimensions -> canvas updates)
    2. Background color updates work
    3. Scale display works (will be controlled by zoom in Plan 03)
  </action>
  <verify>
    Run `npm run dev`
    Change width to 1000 - canvas border should expand horizontally
    Change height to 400 - canvas border should shrink vertically
    Change background color - canvas fill should update immediately
    Zoom indicator should show "100%"
  </verify>
  <done>
    Canvas dimensions configurable via inputs, background color configurable, scale indicator visible, all changes reflect immediately on canvas
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Three-panel layout visible with correct proportions
2. Canvas renders in center panel via react-konva
3. Canvas has visible border showing dimensions
4. Background is configurable (color changes work)
5. Dimension changes update canvas size
6. Zoom indicator shows current scale
</verification>

<success_criteria>
- Three-panel layout with 250px/flex/300px columns
- Dark theme applied to all panels
- react-konva Stage renders in center panel
- Canvas background uses Rect with listening={false}
- Canvas dimensions controllable (800x600 default, configurable)
- Background color controllable (default #1a1a1a)
- Scale indicator visible (shows 100% at default)
- All components properly typed with TypeScript
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
