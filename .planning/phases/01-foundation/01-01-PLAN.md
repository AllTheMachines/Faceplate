---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vite.config.ts
  - tsconfig.json
  - tsconfig.node.json
  - index.html
  - src/main.tsx
  - src/App.tsx
  - src/index.css
  - src/types/coordinates.ts
  - src/utils/coordinates.ts
  - src/store/canvasSlice.ts
  - src/store/viewportSlice.ts
  - src/store/index.ts
  - tailwind.config.js
  - postcss.config.js
autonomous: true

must_haves:
  truths:
    - "Application builds without errors using npm run dev"
    - "TypeScript compiles with strict mode enabled"
    - "Zustand store exists with canvas dimensions and viewport state"
    - "Coordinate transformation utilities convert between screen and canvas spaces"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "react-konva"
    - path: "src/store/index.ts"
      provides: "Combined Zustand store with temporal middleware"
      exports: ["useStore"]
    - path: "src/types/coordinates.ts"
      provides: "Branded coordinate types"
      contains: "ScreenCoord"
    - path: "src/utils/coordinates.ts"
      provides: "Coordinate transformation functions"
      exports: ["screenToCanvas", "canvasToScreen"]
  key_links:
    - from: "src/store/index.ts"
      to: "src/store/canvasSlice.ts"
      via: "slice composition"
      pattern: "createCanvasSlice"
    - from: "src/utils/coordinates.ts"
      to: "src/types/coordinates.ts"
      via: "type imports"
      pattern: "import.*ScreenCoord.*CanvasCoord"
---

<objective>
Set up the foundational project infrastructure: Vite with React 18, TypeScript, Zustand state management with temporal middleware for undo/redo, Tailwind CSS with dark theme, and typed coordinate system utilities.

Purpose: Establishes the technical foundation that all subsequent plans depend on. Without this infrastructure, no canvas work can begin.

Output: A working React application that builds and runs, with state management ready for canvas and viewport state, and coordinate utilities ready for spatial operations.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Vite Project with React 18 + TypeScript</name>
  <files>
    package.json
    vite.config.ts
    tsconfig.json
    tsconfig.node.json
    index.html
    src/main.tsx
    src/App.tsx
    src/vite-env.d.ts
  </files>
  <action>
    Create a new Vite project with React and TypeScript template. Use npm create vite@latest with the react-ts template, then install the required dependencies.

    Install core dependencies:
    - react@18, react-dom@18 (should be in template)
    - zustand@5
    - react-konva@18 (MUST be v18.x for React 18 compatibility - NOT v19)
    - konva@9
    - zundo@2

    Install dev dependencies:
    - tailwindcss@3, postcss, autoprefixer
    - @types/react@18, @types/react-dom@18 (should be in template)

    Configure tsconfig.json with strict mode enabled. The template should have reasonable defaults, but ensure:
    - "strict": true
    - "noUncheckedIndexedAccess": true (optional but recommended)

    Update vite.config.ts if needed (template default is usually fine).

    Create a minimal App.tsx that renders "VST3 WebView UI Designer" heading to verify the app works.

    CRITICAL: Verify react-konva version is 18.x after install with `npm list react-konva`. If v19 was installed, explicitly install react-konva@18.
  </action>
  <verify>
    Run `npm run dev` - app should start without errors
    Run `npm run build` - TypeScript should compile without errors
    Run `npm list react-konva` - should show 18.x.x (not 19.x)
  </verify>
  <done>
    Vite dev server starts, app renders heading, TypeScript builds cleanly, react-konva is version 18.x
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Tailwind CSS with Dark Theme</name>
  <files>
    tailwind.config.js
    postcss.config.js
    src/index.css
  </files>
  <action>
    Initialize Tailwind CSS:
    1. Run `npx tailwindcss init -p` to create tailwind.config.js and postcss.config.js
    2. Configure tailwind.config.js content paths: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"]
    3. Set darkMode: 'class' for manual dark mode control

    Create src/index.css with Tailwind directives and dark theme base styles:
    ```css
    @tailwind base;
    @tailwind components;
    @tailwind utilities;

    :root {
      color-scheme: dark;
    }

    body {
      @apply bg-gray-900 text-gray-100;
    }
    ```

    Import index.css in main.tsx (should be imported before App).

    Update App.tsx to use Tailwind classes for dark theme styling - add dark class to root div, style the heading with Tailwind.
  </action>
  <verify>
    Run `npm run dev` - app should show dark background (gray-900) with light text
    Inspect in browser DevTools - Tailwind utility classes should be applied
  </verify>
  <done>
    Dark theme applied, Tailwind classes working, body has gray-900 background
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Zustand Store with Canvas and Viewport Slices</name>
  <files>
    src/types/coordinates.ts
    src/utils/coordinates.ts
    src/store/canvasSlice.ts
    src/store/viewportSlice.ts
    src/store/index.ts
  </files>
  <action>
    Create typed coordinate system (src/types/coordinates.ts):
    - Define branded types: ScreenX, ScreenY, CanvasX, CanvasY using `number & { readonly __brand: unique symbol }`
    - Define interfaces: ScreenCoord { x: ScreenX, y: ScreenY }, CanvasCoord { x: CanvasX, y: CanvasY }
    - Export helper functions to create branded values: asScreenX(n), asScreenY(n), asCanvasX(n), asCanvasY(n)

    Create coordinate utilities (src/utils/coordinates.ts):
    - screenToCanvas(screen: ScreenCoord, viewport: { scale: number; offsetX: number; offsetY: number }): CanvasCoord
      Formula: { x: (screen.x - offsetX) / scale, y: (screen.y - offsetY) / scale }
    - canvasToScreen(canvas: CanvasCoord, viewport: { scale: number; offsetX: number; offsetY: number }): ScreenCoord
      Formula: { x: canvas.x * scale + offsetX, y: canvas.y * scale + offsetY }

    Create canvas slice (src/store/canvasSlice.ts):
    - State: canvasWidth (default 800), canvasHeight (default 600), backgroundColor (default '#1a1a1a')
    - State: backgroundType ('color' | 'gradient' | 'image'), gradientConfig (optional), imageUrl (optional)
    - Actions: setCanvasDimensions(width, height), setBackgroundColor(color), setBackgroundType(type), setGradientConfig(config)
    - Use StateCreator type for proper slice typing

    Create viewport slice (src/store/viewportSlice.ts):
    - State: scale (default 1), offsetX (default 0), offsetY (default 0)
    - State: isPanning (default false)
    - Actions: setViewport(scale, x, y), setScale(scale), setPanning(isPanning)
    - Use StateCreator type for proper slice typing

    Create combined store (src/store/index.ts):
    - Combine slices using spread pattern: (...a) => ({ ...createCanvasSlice(...a), ...createViewportSlice(...a) })
    - Wrap with zundo temporal middleware
    - Configure temporal: limit 50 states, partialize to exclude viewport state (scale, offsetX, offsetY, isPanning) from undo history
    - Export useStore hook
    - Export temporal access for undo/redo: useStore.temporal

    Update App.tsx to verify store works:
    - Import useStore
    - Display current canvas dimensions and scale
    - Add a button that calls setCanvasDimensions to verify state updates
  </action>
  <verify>
    Run `npm run dev` - app should display canvas dimensions (800x600) and scale (1)
    Click test button - dimensions should update in UI
    TypeScript should compile without errors (check npm run build)
    Import ScreenCoord/CanvasCoord types - should enforce type safety (mixing types should error)
  </verify>
  <done>
    Store exists with canvas and viewport state, actions update state, coordinate types prevent mixing, temporal middleware configured for undo/redo
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npm run dev` starts without errors
2. `npm run build` compiles TypeScript cleanly
3. `npm list react-konva` shows 18.x.x
4. App displays dark theme
5. Store state displays in UI
6. State updates when actions called
</verification>

<success_criteria>
- Vite dev server runs with React 18 + TypeScript
- react-konva@18.x installed (NOT v19)
- Tailwind CSS configured with dark theme applied
- Zustand store with canvasSlice and viewportSlice
- Temporal middleware configured (undo/redo ready for Phase 3)
- Coordinate types and utilities exported and working
- All code compiles without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
