---
phase: 16-static-svg-graphics
plan: 05
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - src/components/Canvas/hooks/useResize.ts
autonomous: true

must_haves:
  truths:
    - "SVG Graphic maintains aspect ratio by default when resizing"
    - "Holding Shift unlocks aspect ratio for free resize"
    - "Minimum size constraint of 8x8 is enforced"
    - "Other element types are not affected by this change"
  artifacts:
    - path: "src/components/Canvas/hooks/useResize.ts"
      provides: "Aspect ratio locking for SVG Graphic resize"
      contains: "svggraphic"
  key_links:
    - from: "useResize.ts"
      to: "getElement"
      via: "check element.type for aspect ratio logic"
      pattern: "element.type.*svggraphic"
---

<objective>
Implement aspect ratio locking for SVG Graphic elements during resize, with Shift key to unlock.

Purpose: Prevent accidental distortion of carefully designed SVG graphics while allowing intentional free resize.
Output: Resizing SVG Graphic elements preserves aspect ratio by default; Shift key unlocks for free resize.
</objective>

<execution_context>
@./.claude/agents/gsd-executor.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-static-svg-graphics/16-CONTEXT.md
@.planning/phases/16-static-svg-graphics/16-RESEARCH.md
@.planning/phases/16-static-svg-graphics/16-01-SUMMARY.md
@src/components/Canvas/hooks/useResize.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add aspect ratio locking to resize hook</name>
  <files>src/components/Canvas/hooks/useResize.ts</files>
  <action>
Modify the useResize hook to implement aspect ratio locking for SVG Graphic elements:

1. In the handleMouseMove event handler, add logic to check element type and apply aspect ratio constraint.

2. The constraint logic should:
   - Only apply to elements with type === 'svggraphic'
   - Lock aspect ratio by DEFAULT (inverted from typical Shift behavior)
   - Holding Shift UNLOCKS aspect ratio (allows free resize)
   - Enforce minimum size of 8x8 (per CONTEXT.md)

3. Find the handleMouseMove function inside the useEffect and modify it:

```typescript
const handleMouseMove = (e: MouseEvent) => {
  // Calculate delta in canvas space (divide by scale)
  const deltaX = (e.clientX - startPos.current.x) / scale
  const deltaY = (e.clientY - startPos.current.y) / scale

  // Get element to check type
  const element = getElement(elementId)
  if (!element) return

  // Minimum size: 8 for svggraphic (per CONTEXT.md), 20 for others
  const MIN_SIZE = element.type === 'svggraphic' ? 8 : 20

  let updates: Partial<{ x: number; y: number; width: number; height: number }> = {}

  // Calculate new bounds based on handle position
  switch (activeHandle) {
    case 'se': // Bottom-right: only change size
      updates = {
        width: Math.max(MIN_SIZE, startBounds.current.width + deltaX),
        height: Math.max(MIN_SIZE, startBounds.current.height + deltaY),
      }
      break
    // ... other cases remain the same but use MIN_SIZE ...
  }

  // Apply aspect ratio constraint for SVG Graphic elements
  // Aspect ratio is LOCKED by default, Shift UNLOCKS it (inverted from typical)
  if (element.type === 'svggraphic' && !e.shiftKey) {
    const originalAspect = startBounds.current.width / startBounds.current.height

    // Determine which dimension to constrain based on handle and movement
    if (activeHandle === 'e' || activeHandle === 'w') {
      // Horizontal-only handles: adjust height to match
      const newWidth = updates.width ?? element.width
      updates.height = newWidth / originalAspect
    } else if (activeHandle === 'n' || activeHandle === 's') {
      // Vertical-only handles: adjust width to match
      const newHeight = updates.height ?? element.height
      updates.width = newHeight * originalAspect
    } else {
      // Corner handles: constrain to preserve aspect ratio
      const newWidth = updates.width ?? element.width
      const newHeight = updates.height ?? element.height

      // Calculate which dimension changed more proportionally
      const widthChange = Math.abs(newWidth - startBounds.current.width) / startBounds.current.width
      const heightChange = Math.abs(newHeight - startBounds.current.height) / startBounds.current.height

      if (widthChange > heightChange) {
        // Width changed more - adjust height
        updates.height = newWidth / originalAspect
      } else {
        // Height changed more - adjust width
        updates.width = newHeight * originalAspect
      }

      // Also need to adjust position for nw, ne, sw handles
      if (activeHandle === 'nw' || activeHandle === 'sw') {
        // Left side moved - recalculate x based on new width
        updates.x = startBounds.current.x + startBounds.current.width - (updates.width ?? element.width)
      }
      if (activeHandle === 'nw' || activeHandle === 'ne') {
        // Top moved - recalculate y based on new height
        updates.y = startBounds.current.y + startBounds.current.height - (updates.height ?? element.height)
      }
    }

    // Re-apply minimum size after aspect ratio calculation
    if ((updates.width ?? element.width) < MIN_SIZE || (updates.height ?? element.height) < MIN_SIZE) {
      // Enforce minimum on both dimensions while preserving aspect
      const minDimension = MIN_SIZE
      if (originalAspect >= 1) {
        // Wide: width is limiting
        updates.width = Math.max(MIN_SIZE, updates.width ?? element.width)
        updates.height = (updates.width ?? element.width) / originalAspect
      } else {
        // Tall: height is limiting
        updates.height = Math.max(MIN_SIZE, updates.height ?? element.height)
        updates.width = (updates.height ?? element.height) * originalAspect
      }
    }
  }

  // ... rest of existing code for live values and updateElement ...
}
```

Note: You will need to refactor all the switch cases to use the MIN_SIZE variable and ensure the aspect ratio logic integrates cleanly.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors.
Grep for svggraphic in useResize.ts: `grep -n "svggraphic" src/components/Canvas/hooks/useResize.ts`
  </verify>
  <done>SVG Graphic elements maintain aspect ratio when resizing (Shift to unlock). Minimum size is 8x8. Other elements unaffected.</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npx tsc --noEmit` passes with no errors
2. useResize.ts contains svggraphic type check
3. Aspect ratio is preserved by default for SVG Graphic resize
4. Shift key unlocks aspect ratio for free resize
5. Minimum 8x8 size is enforced
</verification>

<success_criteria>
- TypeScript compilation succeeds
- SVG Graphic resize preserves aspect ratio by default
- Holding Shift allows free resize (unlocks aspect ratio)
- Elements cannot be resized smaller than 8x8
- Other element types (knob, slider, etc.) are NOT affected by this change
</success_criteria>

<output>
After completion, create `.planning/phases/16-static-svg-graphics/16-05-SUMMARY.md`
</output>
