---
phase: 16-static-svg-graphics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements.ts
  - src/components/elements/renderers/SvgGraphicRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "SvgGraphicElementConfig type exists in discriminated union"
    - "createSvgGraphic factory function creates valid element with defaults"
    - "SvgGraphicRenderer displays placeholder for unassigned asset"
    - "SvgGraphicRenderer displays SVG content for assigned asset"
    - "SvgGraphicRenderer displays error state for missing asset"
  artifacts:
    - path: "src/types/elements.ts"
      provides: "SvgGraphicElementConfig interface, createSvgGraphic factory, isSvgGraphic type guard"
      contains: "type: 'svggraphic'"
    - path: "src/components/elements/renderers/SvgGraphicRenderer.tsx"
      provides: "SVG Graphic canvas renderer with transforms"
      exports: ["SvgGraphicRenderer"]
  key_links:
    - from: "SvgGraphicRenderer"
      to: "SafeSVG component"
      via: "import and render"
      pattern: "SafeSVG"
    - from: "SvgGraphicRenderer"
      to: "AssetsSlice.getAsset"
      via: "useStore hook"
      pattern: "getAsset.*assetId"
---

<objective>
Add the SvgGraphicElementConfig type to the element type system and create the SvgGraphicRenderer component for canvas rendering.

Purpose: Establish the core SVG Graphic element infrastructure that enables vector graphics on canvas.
Output: Type definition, factory function, type guard, and renderer component for SVG Graphics.
</objective>

<execution_context>
@./.claude/agents/gsd-executor.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-static-svg-graphics/16-CONTEXT.md
@.planning/phases/16-static-svg-graphics/16-RESEARCH.md
@src/types/elements.ts
@src/components/elements/renderers/ImageRenderer.tsx
@src/components/SafeSVG.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SvgGraphicElementConfig to element type system</name>
  <files>src/types/elements.ts</files>
  <action>
Add SvgGraphicElementConfig interface extending BaseElementConfig with:
- `type: 'svggraphic'` (discriminant)
- `assetId?: string` (optional - undefined for placeholder state)
- `flipH: boolean` (horizontal flip)
- `flipV: boolean` (vertical flip)
- `opacity: number` (0-1 range)

Note: rotation, x, y, width, height, zIndex are inherited from BaseElementConfig.

Add to ElementConfig union type (after CollapsibleContainerElementConfig):
```typescript
| SvgGraphicElementConfig
```

Add type guard function:
```typescript
export function isSvgGraphic(element: ElementConfig): element is SvgGraphicElementConfig {
  return element.type === 'svggraphic'
}
```

Add factory function with sensible defaults:
```typescript
export function createSvgGraphic(overrides?: Partial<SvgGraphicElementConfig>): SvgGraphicElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'svggraphic',
    name: 'SVG Graphic',
    x: 0,
    y: 0,
    width: 100,  // Default placeholder size (per CONTEXT.md)
    height: 100,
    rotation: 0,
    zIndex: 0,
    locked: false,
    visible: true,
    assetId: undefined,  // Starts unassigned (placeholder state)
    flipH: false,
    flipV: false,
    opacity: 1,
    ...overrides,
  }
}
```
  </action>
  <verify>Run `npx tsc --noEmit` to verify no type errors.</verify>
  <done>SvgGraphicElementConfig interface, type guard, and factory function exist in elements.ts. ElementConfig union includes SvgGraphicElementConfig.</done>
</task>

<task type="auto">
  <name>Task 2: Create SvgGraphicRenderer component</name>
  <files>src/components/elements/renderers/SvgGraphicRenderer.tsx</files>
  <action>
Create SvgGraphicRenderer.tsx following ImageRenderer pattern with three visual states:

1. **Unassigned placeholder** (assetId is undefined):
   - Dashed border, gray background
   - Folder icon or "+" icon with "Select Asset" text
   - Per CONTEXT.md: "clearly communicate 'click to assign asset'"

2. **Valid asset** (assetId exists and asset found):
   - Render asset.svgContent via SafeSVG component
   - Apply CSS transforms: rotation, flipH (scaleX(-1)), flipV (scaleY(-1))
   - Apply opacity
   - Use transform-origin: center center
   - Use object-fit: contain (per CONTEXT.md)

3. **Missing asset** (assetId exists but getAsset returns null):
   - Red/warning border
   - Warning icon with "Asset not found" text

Implementation pattern from RESEARCH.md:
```typescript
import { SvgGraphicElementConfig } from '../../../types/elements'
import { useStore } from '../../../store'
import { SafeSVG } from '../../SafeSVG'

interface SvgGraphicRendererProps {
  config: SvgGraphicElementConfig
}

// Build CSS transform string from config
function buildTransformStyle(config: SvgGraphicElementConfig): string {
  const parts: string[] = []
  // Rotation (from BaseElementConfig, but applied here for flip composition)
  if (config.rotation !== 0) {
    parts.push(`rotate(${config.rotation}deg)`)
  }
  if (config.flipH) {
    parts.push('scaleX(-1)')
  }
  if (config.flipV) {
    parts.push('scaleY(-1)')
  }
  return parts.length > 0 ? parts.join(' ') : 'none'
}

export function SvgGraphicRenderer({ config }: SvgGraphicRendererProps) {
  const getAsset = useStore((state) => state.getAsset)

  // State 1: Unassigned placeholder
  if (!config.assetId) {
    return (
      <div style={{
        width: '100%',
        height: '100%',
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        justifyContent: 'center',
        border: '2px dashed #4b5563',
        backgroundColor: '#374151',
        color: '#9ca3af',
        fontSize: '12px',
      }}>
        <div style={{ fontSize: '24px', marginBottom: '8px' }}>üìÅ</div>
        <span>Select Asset</span>
      </div>
    )
  }

  const asset = getAsset(config.assetId)

  // State 3: Missing asset (deleted from library)
  if (!asset) {
    return (
      <div style={{
        width: '100%',
        height: '100%',
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        justifyContent: 'center',
        border: '2px solid #ef4444',
        backgroundColor: '#7f1d1d',
        color: '#fca5a5',
        fontSize: '12px',
      }}>
        <div style={{ fontSize: '24px', marginBottom: '8px' }}>‚ö†Ô∏è</div>
        <span>Asset not found</span>
      </div>
    )
  }

  // State 2: Valid asset - render with transforms
  // Note: rotation is handled by BaseElement, but we include flipH/flipV here
  const transformStyle = buildTransformStyle(config)

  return (
    <div style={{
      width: '100%',
      height: '100%',
      transform: transformStyle !== 'none' ? transformStyle : undefined,
      transformOrigin: 'center center',
      opacity: config.opacity,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
    }}>
      <SafeSVG
        content={asset.svgContent}
        style={{
          maxWidth: '100%',
          maxHeight: '100%',
          objectFit: 'contain',
        }}
      />
    </div>
  )
}
```

Note: The rotation in BaseElement already applies transform: rotate(), so the SvgGraphicRenderer should NOT duplicate rotation. Remove rotation from buildTransformStyle and only handle flipH/flipV.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors.
Check file exists: `ls src/components/elements/renderers/SvgGraphicRenderer.tsx`
  </verify>
  <done>SvgGraphicRenderer.tsx exists with three visual states (placeholder, valid asset, missing asset) and uses SafeSVG for rendering.</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npx tsc --noEmit` passes with no errors
2. SvgGraphicElementConfig exists in src/types/elements.ts
3. createSvgGraphic factory function exists and returns valid config
4. isSvgGraphic type guard exists
5. SvgGraphicRenderer.tsx exists and imports SafeSVG
</verification>

<success_criteria>
- TypeScript compilation succeeds
- SvgGraphicElementConfig is part of ElementConfig union
- Factory function creates element with correct defaults (100x100, opacity 1, no flips)
- Renderer handles all three states (unassigned, valid, missing)
- Renderer uses SafeSVG component for secure rendering
</success_criteria>

<output>
After completion, create `.planning/phases/16-static-svg-graphics/16-01-SUMMARY.md`
</output>
