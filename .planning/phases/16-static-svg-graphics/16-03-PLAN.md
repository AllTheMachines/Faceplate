---
phase: 16-static-svg-graphics
plan: 03
type: execute
wave: 2
depends_on: ["16-01", "16-02"]
files_modified:
  - src/components/Palette/Palette.tsx
  - src/components/elements/Element.tsx
  - src/components/Properties/PropertyPanel.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "SVG Graphic element appears in palette under Images & Decorative"
    - "Dragging from palette creates placeholder element"
    - "Dragging asset from library creates element with asset assigned"
    - "Property panel shows SvgGraphicProperties for SVG Graphic elements"
    - "Element.tsx renders SvgGraphicRenderer for svggraphic type"
  artifacts:
    - path: "src/components/Palette/Palette.tsx"
      provides: "SVG Graphic palette item"
      contains: "svggraphic"
    - path: "src/components/elements/Element.tsx"
      provides: "SvgGraphicRenderer case in switch"
      contains: "SvgGraphicRenderer"
    - path: "src/components/Properties/PropertyPanel.tsx"
      provides: "SvgGraphicProperties rendering"
      contains: "SvgGraphicProperties"
    - path: "src/App.tsx"
      provides: "createSvgGraphic factory usage for drag-drop"
      contains: "createSvgGraphic"
  key_links:
    - from: "Element.tsx"
      to: "SvgGraphicRenderer"
      via: "switch case and import"
      pattern: "case 'svggraphic'"
    - from: "PropertyPanel.tsx"
      to: "SvgGraphicProperties"
      via: "isSvgGraphic conditional"
      pattern: "isSvgGraphic.*SvgGraphicProperties"
    - from: "App.tsx"
      to: "createSvgGraphic"
      via: "drag-drop handler"
      pattern: "createSvgGraphic"
---

<objective>
Integrate SVG Graphic element into palette, canvas rendering, property panel, and drag-drop system.

Purpose: Complete the user-facing integration so users can create and manipulate SVG Graphic elements.
Output: SVG Graphic is fully functional in the designer - can be created from palette, assigned assets, and configured via property panel.
</objective>

<execution_context>
@./.claude/agents/gsd-executor.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-static-svg-graphics/16-CONTEXT.md
@.planning/phases/16-static-svg-graphics/16-RESEARCH.md
@.planning/phases/16-static-svg-graphics/16-01-SUMMARY.md
@.planning/phases/16-static-svg-graphics/16-02-SUMMARY.md
@src/components/Palette/Palette.tsx
@src/components/elements/Element.tsx
@src/components/Properties/PropertyPanel.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SVG Graphic to palette and Element.tsx</name>
  <files>
    src/components/Palette/Palette.tsx
    src/components/elements/Element.tsx
  </files>
  <action>
**In Palette.tsx:**
Add SVG Graphic to the "Images & Decorative" category, after Image:
```typescript
{
  name: 'Images & Decorative',
  items: [
    { id: 'image', type: 'image', name: 'Image' },
    { id: 'svggraphic', type: 'svggraphic', name: 'SVG Graphic' },  // NEW
    { id: 'rectangle', type: 'rectangle', name: 'Rectangle' },
    { id: 'line', type: 'line', name: 'Line' },
  ],
},
```

**In Element.tsx:**
1. Add import for SvgGraphicRenderer:
```typescript
import { SvgGraphicRenderer } from './renderers/SvgGraphicRenderer'
```

2. Add case in renderContent() switch statement (before the default case):
```typescript
case 'svggraphic':
  return <SvgGraphicRenderer config={element} />
```

This ensures TypeScript exhaustive checking works correctly - the switch now handles all 25 element types.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors.
Grep for svggraphic in Palette.tsx: `grep -n "svggraphic" src/components/Palette/Palette.tsx`
Grep for SvgGraphicRenderer in Element.tsx: `grep -n "SvgGraphicRenderer" src/components/elements/Element.tsx`
  </verify>
  <done>SVG Graphic appears in palette. Element.tsx renders SvgGraphicRenderer for svggraphic type.</done>
</task>

<task type="auto">
  <name>Task 2: Wire PropertyPanel and drag-drop in App.tsx</name>
  <files>
    src/components/Properties/PropertyPanel.tsx
    src/App.tsx
  </files>
  <action>
**In PropertyPanel.tsx:**
1. Add import:
```typescript
import { SvgGraphicProperties } from './SvgGraphicProperties'
```

2. Add import for type guard:
```typescript
import {
  // ... existing imports ...
  isSvgGraphic,
} from '../../types/elements'
```

3. Add conditional rendering after the last type-specific properties (after isModulationMatrix):
```typescript
{isSvgGraphic(element) && <SvgGraphicProperties element={element} onUpdate={update} />}
```

**In App.tsx:**
1. Add import for createSvgGraphic:
```typescript
import {
  // ... existing imports ...
  createSvgGraphic,
} from './types/elements'
```

2. In handleDragEnd, add case for 'svggraphic' in the element creation switch.
Find the switch statement that handles element creation from palette drags and add:
```typescript
case 'svggraphic':
  newElement = createSvgGraphic({ x: canvasX, y: canvasY, ...variant })
  break
```

3. Update the library-asset drag handling to create SvgGraphic instead of Image when dropping from asset library.
Find the section that handles `dragType === 'library-asset'` and change from:
```typescript
const newElement = createImage({
  x: canvasX,
  y: canvasY,
  assetId: assetId,
  src: '',
  name: asset.name,
})
```
To:
```typescript
// Import getSVGNaturalSize at top of file
import { getSVGNaturalSize } from './services/svg'

// In the library-asset handler:
const naturalSize = getSVGNaturalSize(asset.svgContent) || { width: 100, height: 100 }
const newElement = createSvgGraphic({
  x: canvasX,
  y: canvasY,
  assetId: assetId,
  name: asset.name,
  width: naturalSize.width,
  height: naturalSize.height,
})
```

This makes library drag create SvgGraphic elements with natural size (per CONTEXT.md decision).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors.
Grep for SvgGraphicProperties in PropertyPanel.tsx: `grep -n "SvgGraphicProperties" src/components/Properties/PropertyPanel.tsx`
Grep for createSvgGraphic in App.tsx: `grep -n "createSvgGraphic" src/App.tsx`
  </verify>
  <done>PropertyPanel renders SvgGraphicProperties for SVG Graphic elements. App.tsx creates SvgGraphic elements from both palette and library drags.</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npx tsc --noEmit` passes with no errors
2. SVG Graphic appears in palette under "Images & Decorative"
3. Dragging SVG Graphic from palette creates element on canvas
4. Dragging asset from library creates SvgGraphic element with asset assigned
5. Selecting SVG Graphic element shows property panel with asset dropdown and transform controls
6. Run dev server and manually test: `npm run dev`
</verification>

<success_criteria>
- TypeScript compilation succeeds
- SVG Graphic is visible in palette
- Palette drag creates placeholder SVG Graphic element
- Library drag creates SVG Graphic with asset assigned and natural size
- Property panel shows all controls (asset dropdown, flip toggles, opacity)
- Element renders correctly on canvas in all three states
</success_criteria>

<output>
After completion, create `.planning/phases/16-static-svg-graphics/16-03-SUMMARY.md`
</output>
