---
phase: 47-button-knob-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements/controls.ts
  - src/components/elements/renderers/controls/SegmentButtonRenderer.tsx
  - src/components/Properties/SegmentButtonProperties.tsx
autonomous: true

must_haves:
  truths:
    - "Segment Button displays actual SVG icons (not placeholder symbols)"
    - "Icons change color based on selected/unselected state"
    - "User can configure icon size via property panel"
  artifacts:
    - path: "src/components/elements/renderers/controls/SegmentButtonRenderer.tsx"
      provides: "SVG icon rendering with builtInIconSVG"
      contains: "builtInIconSVG"
    - path: "src/types/elements/controls.ts"
      provides: "iconSize and icon color properties"
      contains: "iconSize"
  key_links:
    - from: "SegmentButtonRenderer.tsx"
      to: "builtInIcons.ts"
      via: "import builtInIconSVG"
      pattern: "builtInIconSVG\\[segment\\.builtInIcon"
---

<objective>
Fix Segment Button to display actual SVG icons instead of placeholder Unicode symbols.

Purpose: BTN-01 requires Segment Button to show proper icons in selected segments. The current implementation uses `getBuiltInIconSymbol()` which returns Unicode characters instead of the actual SVG icons from the icon system.

Output: Segment Button renderer that uses `builtInIconSVG` for proper icon rendering with configurable size and per-state colors.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/47-button-knob-fixes/47-CONTEXT.md
@.planning/phases/47-button-knob-fixes/47-RESEARCH.md

@src/components/elements/renderers/controls/SegmentButtonRenderer.tsx
@src/components/elements/renderers/controls/IconButtonRenderer.tsx
@src/utils/builtInIcons.ts
@src/types/elements/controls.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add icon properties to SegmentButtonElementConfig</name>
  <files>src/types/elements/controls.ts</files>
  <action>
Add icon-related properties to SegmentButtonElementConfig:
- `iconSize: number` (default 16) - Size of icons in pixels
- `iconColor: string` (default '#888888') - Icon color for unselected segments
- `selectedIconColor: string` (default '#ffffff') - Icon color for selected segments

Add these to the interface after `borderColor`. Also update `createSegmentButton()` factory to include these defaults.

Note: The SegmentConfig interface already has `iconSource`, `builtInIcon`, and `assetId` - no changes needed there.
  </action>
  <verify>TypeScript compiles without errors: `npm run build 2>&1 | head -20`</verify>
  <done>SegmentButtonElementConfig has iconSize, iconColor, and selectedIconColor properties with factory defaults</done>
</task>

<task type="auto">
  <name>Task 2: Replace placeholder icons with actual SVG rendering</name>
  <files>src/components/elements/renderers/controls/SegmentButtonRenderer.tsx</files>
  <action>
Refactor SegmentButtonRenderer to use actual SVG icons like IconButtonRenderer does:

1. Import `builtInIconSVG` from '../../../../utils/builtInIcons'
2. Import `useStore` to access `getAsset` for asset-based icons

3. Replace the `renderIcon()` function:
   - For builtin icons: Use `builtInIconSVG[segment.builtInIcon]` with `dangerouslySetInnerHTML`
   - For asset icons: Use `getAsset(segment.assetId)?.svgContent`
   - Wrap in a div with `width: config.iconSize, height: config.iconSize, color: iconColor`
   - Icon color should be `isSelected ? config.selectedIconColor : config.iconColor`

4. Delete the `getBuiltInIconSymbol()` function entirely (no longer needed)

5. Update `renderSegmentContent()` to pass config to renderIcon for color access

Reference IconButtonRenderer.tsx lines 13-27 for the pattern.

SAFE: Built-in icons are hardcoded, trusted content - dangerouslySetInnerHTML is appropriate.
  </action>
  <verify>
Run dev server: `npm run dev &`
Add a Segment Button to canvas with icon mode
Icons should render as actual SVG graphics, not unicode symbols
  </verify>
  <done>Segment Button renders actual SVG icons using builtInIconSVG, colors change based on selection state</done>
</task>

<task type="auto">
  <name>Task 3: Add icon properties to property panel</name>
  <files>src/components/Properties/SegmentButtonProperties.tsx</files>
  <action>
Add property controls for the new icon properties:

1. Add a section "Icon Style" (after font properties or near segment config)
2. Add `iconSize` as a NumberInput (range 8-48, step 1, default 16)
3. Add `iconColor` as a ColorPicker for unselected icon color
4. Add `selectedIconColor` as a ColorPicker for selected icon color

Group these together since they all relate to icon appearance.
  </action>
  <verify>
In dev server, select a Segment Button
Property panel shows Icon Style section with size and color controls
Changing values updates the segment button appearance
  </verify>
  <done>Property panel exposes iconSize, iconColor, and selectedIconColor for Segment Button configuration</done>
</task>

</tasks>

<verification>
1. Create a Segment Button element on canvas
2. Configure segment 1 with displayMode: 'icon', iconSource: 'builtin', builtInIcon: 'play'
3. Configure segment 2 with displayMode: 'icon-text', iconSource: 'builtin', builtInIcon: 'pause', text: 'Pause'
4. Verify icons render as actual SVG graphics (not unicode symbols like triangles)
5. Select segment 1, verify icon color changes to selectedIconColor
6. Deselect segment 1, verify icon color returns to iconColor
7. Change iconSize in property panel, verify icon sizes update
</verification>

<success_criteria>
- Segment Button displays actual SVG icons from builtInIconSVG
- Icons use currentColor for theming (color changes with state)
- iconSize, iconColor, selectedIconColor are configurable via property panel
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/47-button-knob-fixes/47-01-SUMMARY.md`
</output>
