---
phase: 10-uat-bug-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/elements/Element.tsx
  - src/components/elements/BaseElement.tsx
  - src/components/Properties/PropertyPanel.tsx
autonomous: true

must_haves:
  truths:
    - "Locked elements can be clicked to select them"
    - "Locked elements show in PropertyPanel when selected"
    - "Locked elements cannot be moved by dragging"
    - "Locked elements cannot be resized via handles"
    - "Lock checkbox in PropertyPanel correctly toggles and displays state"
    - "User can unlock a locked element via PropertyPanel checkbox"
  artifacts:
    - path: "src/components/elements/Element.tsx"
      provides: "Click handler that allows selection of locked elements"
      contains: "handleClick"
    - path: "src/components/elements/BaseElement.tsx"
      provides: "Drag disabled for locked elements, but pointer events enabled for selection"
      contains: "pointerEvents"
    - path: "src/components/Properties/PropertyPanel.tsx"
      provides: "Lock checkbox with correct controlled state"
      contains: "locked"
  key_links:
    - from: "Element.tsx handleClick"
      to: "selectElement action"
      via: "Click selects locked elements"
      pattern: "selectElement\\(element\\.id\\)"
    - from: "BaseElement.tsx"
      to: "useDraggable disabled"
      via: "Drag disabled for locked but pointer events allowed"
      pattern: "disabled.*locked"
---

<objective>
Fix the element locking UX so that locked elements remain selectable (click to select, view properties, unlock via checkbox) while preventing only move and resize operations.

Purpose: Users reported that after locking an element, they cannot click it to select it, making it impossible to unlock it via the PropertyPanel. The current behavior blocks ALL interactions for locked elements, but the correct UX is to block only move/resize while allowing selection.

Output: Updated `Element.tsx`, `BaseElement.tsx`, and `PropertyPanel.tsx` with corrected locking behavior.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

# Source files
@src/components/elements/Element.tsx
@src/components/elements/BaseElement.tsx
@src/components/Properties/PropertyPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Allow selection of locked elements in Element.tsx</name>
  <files>src/components/elements/Element.tsx</files>
  <action>
Current problematic code in `handleClick`:
```typescript
const handleClick = (e: React.MouseEvent) => {
  e.stopPropagation()
  // Don't allow selection in lock-all mode or for individually locked elements
  if (lockAllMode || element.locked) return  // BUG: This blocks selection
  // ... selection logic
}
```

The fix: Allow selection for individually locked elements (but NOT for lock-all mode, since that's meant to prevent all interactions for UI testing).

Update `handleClick` to:
```typescript
const handleClick = (e: React.MouseEvent) => {
  e.stopPropagation()

  // Lock-all mode blocks ALL interactions (for UI testing)
  if (lockAllMode) return

  // Individual locked elements CAN be selected (so user can unlock them)
  // Only move/resize is prevented (handled in BaseElement)

  if (e.shiftKey) {
    addToSelection(element.id)
  } else if (e.ctrlKey || e.metaKey) {
    toggleSelection(element.id)
  } else {
    selectElement(element.id)
  }
}
```

Remove the `element.locked` check from the early return - locked elements should be selectable.
  </action>
  <verify>
1. Run `npm run dev`
2. Add an element, lock it via PropertyPanel
3. Click the locked element - it should become selected
4. PropertyPanel should show the element's properties including the Lock checkbox (checked)
  </verify>
  <done>Locked elements can be clicked to select them and show in PropertyPanel</done>
</task>

<task type="auto">
  <name>Task 2: Enable pointer events for locked elements in BaseElement.tsx</name>
  <files>src/components/elements/BaseElement.tsx</files>
  <action>
Current problematic code:
```typescript
pointerEvents: element.locked || lockAllMode ? 'none' : 'auto',
```

This completely disables pointer events for locked elements, preventing clicks from reaching the click handler.

The fix: Only disable pointer events for lock-all mode. For individually locked elements, keep pointer events enabled but disable dragging (already done via `useDraggable` disabled prop).

Update the style calculation:
```typescript
// Pointer events: only disable for lock-all mode (UI testing mode)
// Individual locked elements need pointer events for selection
pointerEvents: lockAllMode ? ('none' as const) : ('auto' as const),
```

Also update the cursor style to provide visual feedback:
```typescript
cursor: lockAllMode
  ? 'default'
  : element.locked
    ? 'pointer'  // Locked elements: show pointer (can click to select, but not drag)
    : (isDragging ? 'grabbing' : isSelected ? 'grab' : 'pointer'),
```

The `useDraggable` hook already has `disabled: !isSelected || element.locked || lockAllMode` which prevents dragging of locked elements - this is correct and should remain.
  </action>
  <verify>
1. Add an element, select it, lock it via PropertyPanel
2. Try to drag the locked element - it should NOT move
3. Click elsewhere to deselect, then click the locked element - it should become selected
4. Resize handles should NOT appear on locked elements (or should be non-functional)
  </verify>
  <done>Locked elements have pointer events enabled for selection but cannot be dragged</done>
</task>

<task type="auto">
  <name>Task 3: Verify PropertyPanel lock checkbox works correctly</name>
  <files>src/components/Properties/PropertyPanel.tsx</files>
  <action>
Review the lock checkbox in PropertyPanel:
```typescript
<input
  type="checkbox"
  checked={element.locked}
  onChange={(e) => update({ locked: e.target.checked })}
  className="rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500"
/>
```

This looks correct, but verify:
1. The `checked` prop is correctly bound to `element.locked`
2. The `onChange` correctly calls `update({ locked: ... })`
3. The store's `updateElement` action correctly updates the `locked` property

Update the description text to reflect the new behavior:
```typescript
<p className="text-xs text-gray-500 mt-1">
  Locked elements cannot be moved or resized
</p>
```

(Changed from "cannot be selected or moved" to "cannot be moved or resized")

Also ensure the checkbox styling is clearly visible. The user mentioned "radio-button" which suggests there may be visual confusion. The `type="checkbox"` is correct - verify the styling renders as a checkbox, not a radio button.
  </action>
  <verify>
1. Select an element, check the Lock checkbox - element should become locked
2. The checkbox should show as checked (filled blue)
3. Click elsewhere to deselect, then click the locked element - it should select
4. Uncheck the Lock checkbox - element should become unlocked
5. The element should now be draggable again
  </verify>
  <done>Lock checkbox correctly displays state and allows toggling lock on/off</done>
</task>

</tasks>

<verification>
Complete workflow test:
1. Open app with `npm run dev`
2. Add a Knob element to the canvas
3. Select the Knob, check "Lock element" in PropertyPanel
4. Observe: checkbox shows checked, element cannot be dragged
5. Click on canvas background to deselect
6. Click on the locked Knob - it should become selected
7. PropertyPanel shows Knob properties with Lock checkbox checked
8. Uncheck "Lock element" - element should become unlocked
9. Drag the Knob - it should now move
</verification>

<success_criteria>
- Locked elements ARE selectable (click to select works)
- Locked elements show properties in PropertyPanel when selected
- Locked elements CANNOT be moved by dragging
- Locked elements CANNOT be resized via handles
- Lock checkbox in PropertyPanel displays correct state
- Lock checkbox can be toggled on/off
- Unlocking an element restores drag/resize functionality
- Lock-all mode still blocks ALL interactions (UI testing mode)
</success_criteria>

<output>
After completion, create `.planning/phases/10-uat-bug-fixes/10-02-SUMMARY.md`
</output>
