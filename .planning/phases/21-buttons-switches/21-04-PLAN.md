---
phase: 21-buttons-switches
plan: 04
type: execute
wave: 2
depends_on: ["21-01", "21-02"]
files_modified:
  - src/export/htmlGenerator.ts
  - src/export/cssGenerator.ts
autonomous: true

must_haves:
  truths:
    - "Exported HTML includes all 7 button/switch element types"
    - "Exported CSS includes styles for all button/switch visual states"
    - "Icon Button exports with inline SVG for built-in icons"
    - "Segment Button exports with proper segment structure"
    - "All button states export correctly (pressed, isOn, position, selectedIndices)"
  artifacts:
    - path: "src/export/htmlGenerator.ts"
      provides: "HTML generation for all 7 button/switch types"
      contains: "iconbutton"
    - path: "src/export/cssGenerator.ts"
      provides: "CSS generation for all 7 button/switch types"
      contains: "iconbutton"
  key_links:
    - from: "src/export/htmlGenerator.ts"
      to: "generateElementHTML"
      via: "switch case for each button/switch type"
      pattern: "case 'iconbutton'"
    - from: "src/export/cssGenerator.ts"
      to: "generateElementCSS"
      via: "switch case for each button/switch type"
      pattern: "case 'iconbutton'"
---

<objective>
Add export support for all 7 button/switch element types to the HTML and CSS generators.

Purpose: Enable users to export their designs including all new button and switch controls for use in JUCE WebView2 plugins.

Output: Updated htmlGenerator.ts and cssGenerator.ts with full support for all 7 new element types.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-buttons-switches/21-CONTEXT.md
@.planning/phases/21-buttons-switches/21-RESEARCH.md
@.planning/phases/21-buttons-switches/21-01-SUMMARY.md
@.planning/phases/21-buttons-switches/21-02-SUMMARY.md

# Export patterns
@src/export/htmlGenerator.ts
@src/export/cssGenerator.ts
@src/types/elements/controls.ts
@src/utils/builtInIcons.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add HTML generation for button/switch elements</name>
  <files>
    src/export/htmlGenerator.ts
  </files>
  <action>
    Add HTML generation cases for all 7 new element types in the generateElementHTML function (or equivalent):

    **Icon Button (iconbutton):**
    ```html
    <button id="${id}" class="iconbutton" data-mode="${mode}" data-pressed="${pressed}">
      <span class="icon">
        ${iconSource === 'builtin' ? builtInIconSVG[builtInIcon] : assetSVGContent}
      </span>
    </button>
    ```
    - Import builtInIconSVG from utils
    - For asset icons, inline the SVG content from the asset

    **Kick Button (kickbutton):**
    ```html
    <button id="${id}" class="kickbutton" data-pressed="${pressed}">
      ${label}
    </button>
    ```

    **Toggle Switch (toggleswitch):**
    ```html
    <div id="${id}" class="toggleswitch" data-on="${isOn}">
      <div class="track"></div>
      <div class="thumb"></div>
      ${showLabels ? `<span class="label-off">${offLabel}</span><span class="label-on">${onLabel}</span>` : ''}
    </div>
    ```

    **Power Button (powerbutton):**
    ```html
    <button id="${id}" class="powerbutton" data-on="${isOn}" data-led-position="${ledPosition}">
      <span class="label">${label}</span>
      <span class="led"></span>
    </button>
    ```

    **Rocker Switch (rockerswitch):**
    ```html
    <div id="${id}" class="rockerswitch" data-position="${position}" data-mode="${mode}">
      <div class="track"></div>
      <div class="paddle"></div>
      ${showLabels ? `<span class="label-up">${upLabel}</span><span class="label-down">${downLabel}</span>` : ''}
    </div>
    ```

    **Rotary Switch (rotaryswitch):**
    ```html
    <div id="${id}" class="rotaryswitch" data-position="${currentPosition}" data-count="${positionCount}">
      <div class="body"></div>
      <div class="pointer"></div>
      <div class="labels" data-layout="${labelLayout}">
        ${positionLabels.map((label, i) => `<span class="label" data-index="${i}">${label || i+1}</span>`).join('')}
      </div>
    </div>
    ```

    **Segment Button (segmentbutton):**
    ```html
    <div id="${id}" class="segmentbutton" data-mode="${selectionMode}" data-orientation="${orientation}">
      ${segments.map((seg, i) => `
        <div class="segment" data-index="${i}" data-selected="${selectedIndices.includes(i)}">
          ${seg.displayMode !== 'text' ? `<span class="segment-icon">${getIconContent(seg)}</span>` : ''}
          ${seg.displayMode !== 'icon' ? `<span class="segment-text">${seg.text || ''}</span>` : ''}
        </div>
      `).join('')}
    </div>
    ```

    Helper function for icon content:
    ```typescript
    function getIconContent(seg: SegmentConfig): string {
      if (seg.iconSource === 'builtin' && seg.builtInIcon) {
        return builtInIconSVG[seg.builtInIcon] || ''
      }
      if (seg.iconSource === 'asset' && seg.assetId) {
        // Get from assets - pass assets to generator or resolve during export
        return assetMap.get(seg.assetId)?.svgContent || ''
      }
      return ''
    }
    ```
  </action>
  <verify>
    npm run build succeeds.
    grep "iconbutton" src/export/htmlGenerator.ts returns case statement.
    grep "segmentbutton" src/export/htmlGenerator.ts returns case statement.
  </verify>
  <done>
    HTML generation added for all 7 button/switch types.
    Icon Button and Segment Button export inline SVG content for icons.
    All state attributes exported as data attributes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CSS generation for button/switch elements</name>
  <files>
    src/export/cssGenerator.ts
  </files>
  <action>
    Add CSS generation cases for all 7 new element types in generateElementCSS (or equivalent):

    **Icon Button:**
    ```css
    #${id} {
      position: absolute;
      left: ${x}px;
      top: ${y}px;
      width: ${width}px;
      height: ${height}px;
      background-color: ${backgroundColor};
      border: 2px solid ${borderColor};
      border-radius: ${borderRadius}px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: none;
    }
    #${id}[data-pressed="true"] {
      filter: brightness(0.85);
    }
    #${id} .icon {
      width: 70%;
      height: 70%;
      color: ${iconColor};
    }
    #${id} .icon svg {
      width: 100%;
      height: 100%;
    }
    ```

    **Kick Button:**
    ```css
    #${id} {
      position: absolute;
      left: ${x}px;
      top: ${y}px;
      width: ${width}px;
      height: ${height}px;
      background-color: ${backgroundColor};
      color: ${textColor};
      border: 2px solid ${borderColor};
      border-radius: ${borderRadius}px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: none;
    }
    #${id}[data-pressed="true"] {
      filter: brightness(1.2);
    }
    ```

    **Toggle Switch:**
    ```css
    #${id} {
      position: absolute;
      left: ${x}px;
      top: ${y}px;
      width: ${width}px;
      height: ${height}px;
      border-radius: ${height/2}px;
      border: 2px solid ${borderColor};
      cursor: pointer;
      transition: none;
    }
    #${id}[data-on="false"] {
      background-color: ${offColor};
    }
    #${id}[data-on="true"] {
      background-color: ${onColor};
    }
    #${id} .thumb {
      position: absolute;
      width: ${height - 8}px;
      height: ${height - 8}px;
      background-color: ${thumbColor};
      border-radius: 50%;
      margin: 4px;
      transition: none;
    }
    #${id}[data-on="false"] .thumb {
      left: 0;
    }
    #${id}[data-on="true"] .thumb {
      left: ${width - height}px;
    }
    ```

    **Power Button:**
    ```css
    #${id} {
      position: absolute;
      left: ${x}px;
      top: ${y}px;
      width: ${width}px;
      height: ${height}px;
      background-color: ${backgroundColor};
      color: ${textColor};
      border: 2px solid ${borderColor};
      border-radius: ${borderRadius}px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: none;
    }
    #${id}[data-on="true"] {
      filter: brightness(1.1);
    }
    #${id} .led {
      position: absolute;
      width: ${ledSize}px;
      height: ${ledSize}px;
      border-radius: 50%;
      transition: none;
    }
    /* LED positioning based on data-led-position */
    #${id}[data-led-position="top"] .led { top: 4px; left: 50%; transform: translateX(-50%); }
    #${id}[data-led-position="bottom"] .led { bottom: 4px; left: 50%; transform: translateX(-50%); }
    #${id}[data-led-position="left"] .led { left: 4px; top: 50%; transform: translateY(-50%); }
    #${id}[data-led-position="right"] .led { right: 4px; top: 50%; transform: translateY(-50%); }
    #${id}[data-led-position="center"] .led { top: 50%; left: 50%; transform: translate(-50%, -50%); }
    #${id}[data-on="false"] .led {
      background-color: ${ledOffColor};
    }
    #${id}[data-on="true"] .led {
      background-color: ${ledOnColor};
      box-shadow: 0 0 4px ${ledOnColor};
    }
    ```

    **Rocker Switch:**
    ```css
    #${id} {
      position: absolute;
      left: ${x}px;
      top: ${y}px;
      width: ${width}px;
      height: ${height}px;
      background-color: ${backgroundColor};
      border: 2px solid ${borderColor};
      border-radius: 4px;
      cursor: pointer;
    }
    #${id} .paddle {
      position: absolute;
      left: 4px;
      width: calc(100% - 8px);
      height: 30px;
      background-color: ${switchColor};
      border: 1px solid ${borderColor};
      border-radius: 3px;
      transition: none;
    }
    #${id}[data-position="2"] .paddle { top: 4px; }
    #${id}[data-position="1"] .paddle { top: calc(50% - 15px); }
    #${id}[data-position="0"] .paddle { top: calc(100% - 34px); }
    ```

    **Rotary Switch:**
    ```css
    #${id} {
      position: absolute;
      left: ${x}px;
      top: ${y}px;
      width: ${width}px;
      height: ${height}px;
    }
    #${id} .body {
      position: absolute;
      width: 80%;
      height: 80%;
      left: 10%;
      top: 10%;
      border-radius: 50%;
      background-color: ${backgroundColor};
      border: 2px solid ${borderColor};
    }
    #${id} .pointer {
      position: absolute;
      width: 4px;
      height: 30%;
      left: calc(50% - 2px);
      top: 10%;
      background-color: ${pointerColor};
      transform-origin: center bottom;
      transition: none;
    }
    /* Rotation calculated via JS or inline style */
    ```

    **Segment Button:**
    ```css
    #${id} {
      position: absolute;
      left: ${x}px;
      top: ${y}px;
      width: ${width}px;
      height: ${height}px;
      display: flex;
      flex-direction: ${orientation === 'horizontal' ? 'row' : 'column'};
      background-color: ${backgroundColor};
      border: 2px solid ${borderColor};
      border-radius: 4px;
      overflow: hidden;
    }
    #${id} .segment {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      padding: 6px 8px;
      color: ${textColor};
      border-right: 1px solid ${borderColor};
      cursor: pointer;
      transition: none;
    }
    #${id}[data-orientation="vertical"] .segment {
      border-right: none;
      border-bottom: 1px solid ${borderColor};
    }
    #${id} .segment:last-child {
      border-right: none;
      border-bottom: none;
    }
    #${id} .segment[data-selected="true"] {
      background-color: ${selectedColor};
      color: ${selectedTextColor};
    }
    #${id} .segment-icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }
    #${id} .segment-icon svg {
      width: 100%;
      height: 100%;
    }
    #${id} .segment-text {
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    ```

    Note: For Rotary Switch rotation, the export should either:
    1. Include inline style for rotation angle, OR
    2. Generate CSS custom properties that JS can update at runtime
  </action>
  <verify>
    npm run build succeeds.
    grep "iconbutton" src/export/cssGenerator.ts returns case statement.
    grep "segmentbutton" src/export/cssGenerator.ts returns case statement.
  </verify>
  <done>
    CSS generation added for all 7 button/switch types.
    All styles use transition: none for instant state changes.
    State-based styles use data attribute selectors.
    Segment Button supports horizontal and vertical orientations.
  </done>
</task>

</tasks>

<verification>
1. TypeScript build: `npm run build` completes with no errors
2. Export test:
   - npm run dev
   - Add one of each new button/switch type to canvas
   - Export project
   - Verify exported HTML contains elements for each type
   - Verify exported CSS contains styles for each type
3. Code verification:
   - grep -c "iconbutton" src/export/htmlGenerator.ts returns at least 1
   - grep -c "segmentbutton" src/export/cssGenerator.ts returns at least 1
4. State export:
   - Verify data-pressed, data-on, data-position, data-selected attributes in HTML
   - Verify CSS uses these data attributes for state-based styling
</verification>

<success_criteria>
- All 7 button/switch types export valid HTML structure
- All CSS includes proper positioning and state-based styles
- Icon Button exports inline SVG content for icons
- Segment Button exports all segments with proper structure
- Toggle Switch exports track and thumb with correct positioning
- Rotary Switch exports body, pointer, and labels
- All styles use transition: none
- Exported code works in browser preview
</success_criteria>

<output>
After completion, create `.planning/phases/21-buttons-switches/21-04-SUMMARY.md`
</output>
