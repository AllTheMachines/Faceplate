---
phase: 21-buttons-switches
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/builtInIcons.ts
  - src/types/elements/controls.ts
  - src/components/elements/renderers/controls/IconButtonRenderer.tsx
  - src/components/elements/renderers/controls/KickButtonRenderer.tsx
  - src/components/elements/renderers/controls/ToggleSwitchRenderer.tsx
  - src/components/elements/renderers/controls/PowerButtonRenderer.tsx
  - src/components/elements/renderers/controls/index.ts
  - src/components/elements/renderers/index.ts
autonomous: true

must_haves:
  truths:
    - "Built-in icon enum with ~35 audio plugin icons available for use"
    - "User can add Icon Button from palette that displays built-in or asset library icons"
    - "User can add Kick Button that shows momentary press state with color feedback"
    - "User can add Toggle Switch with instant snap between on/off states"
    - "User can add Power Button with LED indicator that changes color on state"
  artifacts:
    - path: "src/utils/builtInIcons.ts"
      provides: "BuiltInIcon enum and builtInIconSVG map"
      exports: ["BuiltInIcon", "builtInIconSVG"]
    - path: "src/types/elements/controls.ts"
      provides: "IconButtonElementConfig, KickButtonElementConfig, ToggleSwitchElementConfig, PowerButtonElementConfig"
      contains: "type: 'iconbutton'"
    - path: "src/components/elements/renderers/controls/IconButtonRenderer.tsx"
      provides: "Icon Button rendering with built-in or asset library icons"
      exports: ["IconButtonRenderer"]
    - path: "src/components/elements/renderers/controls/ToggleSwitchRenderer.tsx"
      provides: "Toggle Switch rendering with instant snap"
      exports: ["ToggleSwitchRenderer"]
    - path: "src/components/elements/renderers/controls/PowerButtonRenderer.tsx"
      provides: "Power Button rendering with LED indicator"
      exports: ["PowerButtonRenderer"]
  key_links:
    - from: "src/components/elements/renderers/index.ts"
      to: "rendererRegistry"
      via: "Map.set for iconbutton, kickbutton, toggleswitch, powerbutton"
      pattern: "\\['iconbutton'"
---

<objective>
Implement built-in icon system and four button element types: Icon Button, Kick Button, Toggle Switch, and Power Button.

Purpose: Provide audio plugin designers with essential button controls that cover icon-only buttons, momentary triggers, boolean toggles, and power on/off with visual LED indicators.

Output: Built-in icon utility with ~35 audio plugin icons, four new button types with element configs, renderers, and registry entries.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-buttons-switches/21-CONTEXT.md
@.planning/phases/21-buttons-switches/21-RESEARCH.md

# Existing patterns to extend
@src/types/elements/controls.ts
@src/components/elements/renderers/controls/ButtonRenderer.tsx
@src/components/elements/renderers/controls/index.ts
@src/components/elements/renderers/index.ts
@src/store/assetsSlice.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create built-in icon system</name>
  <files>
    src/utils/builtInIcons.ts
  </files>
  <action>
    Create a new utility file with built-in icon definitions:

    1. **BuiltInIcon enum** with ~35 icons organized by category:
       - Transport (7): Play, Pause, Stop, Record, Loop, SkipForward, SkipBackward
       - Common (8): Mute, Solo, Bypass, Power, Settings, Reset, Save, Load
       - Audio-specific (10): Waveform, Spectrum, Midi, Sync, Link, EQ, Compressor, Reverb, Delay, Filter
       - Additional (10): Add, Remove, Edit, Copy, Paste, Undo, Redo, Help, Info, Warning

    2. **builtInIconSVG** - Record<BuiltInIcon, string> mapping each icon to an inline SVG string:
       - Use 24x24 viewBox
       - Use `fill="currentColor"` for themability
       - Simple single-path designs (reference Material Icons or Heroicons for path data)
       - Keep SVG strings compact

    Example structure:
    ```typescript
    export enum BuiltInIcon {
      Play = 'play',
      Pause = 'pause',
      // ...
    }

    export const builtInIconSVG: Record<BuiltInIcon, string> = {
      [BuiltInIcon.Play]: '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>',
      // ...
    }
    ```

    Note: SVG paths should be simple, recognizable icons. Use common audio plugin icon patterns.
  </action>
  <verify>
    File exists: src/utils/builtInIcons.ts
    Import test: `import { BuiltInIcon, builtInIconSVG } from './utils/builtInIcons'` compiles
    At least 30 icons defined in enum
  </verify>
  <done>
    Built-in icon system created with BuiltInIcon enum and builtInIconSVG map.
    ~35 icons covering transport, common, and audio-specific categories.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create button element types and renderers</name>
  <files>
    src/types/elements/controls.ts
    src/components/elements/renderers/controls/IconButtonRenderer.tsx
    src/components/elements/renderers/controls/KickButtonRenderer.tsx
    src/components/elements/renderers/controls/ToggleSwitchRenderer.tsx
    src/components/elements/renderers/controls/PowerButtonRenderer.tsx
    src/components/elements/renderers/controls/index.ts
    src/components/elements/renderers/index.ts
  </files>
  <action>
    **Add to controls.ts:**

    1. **IconButtonElementConfig:**
       - type: 'iconbutton'
       - iconSource: 'builtin' | 'asset'
       - builtInIcon?: BuiltInIcon (when iconSource === 'builtin')
       - assetId?: string (when iconSource === 'asset')
       - mode: 'momentary' | 'toggle'
       - pressed: boolean
       - backgroundColor, iconColor, borderColor, borderRadius

    2. **KickButtonElementConfig:**
       - type: 'kickbutton'
       - pressed: boolean (momentary only)
       - label: string
       - backgroundColor, textColor, borderColor, borderRadius

    3. **ToggleSwitchElementConfig:**
       - type: 'toggleswitch'
       - isOn: boolean
       - onColor, offColor, thumbColor, borderColor
       - showLabels: boolean
       - onLabel, offLabel (default 'ON', 'OFF')
       - labelColor

    4. **PowerButtonElementConfig:**
       - type: 'powerbutton'
       - isOn: boolean
       - ledPosition: 'top' | 'bottom' | 'left' | 'right' | 'center'
       - ledSize: number
       - ledOnColor, ledOffColor
       - label: string
       - backgroundColor, textColor, borderColor, borderRadius

    Add type guards: isIconButton, isKickButton, isToggleSwitch, isPowerButton
    Add factory functions: createIconButton, createKickButton, createToggleSwitch, createPowerButton
    Add to ControlElement union type.

    **Create renderers following ButtonRenderer pattern:**

    **IconButtonRenderer.tsx:**
    - Render button container with icon inside (70% fill)
    - Support both built-in icons (via builtInIconSVG) and asset library icons (via useStore getAsset)
    - Fallback to default icon if asset missing
    - Apply brightness filter on pressed: filter: brightness(0.85)
    - transition: none for instant state change
    - Hover state: brightness(1.05) - subtle hover feedback

    **KickButtonRenderer.tsx:**
    - Simple button with text label
    - On pressed: filter: brightness(1.2) (flash brighter)
    - transition: none
    - Hover state: brightness(1.05)

    **ToggleSwitchRenderer.tsx:**
    - iOS-style pill shape (height/2 border-radius)
    - Circular thumb that moves between left and right positions
    - INSTANT snap: no slide animation, just position change
    - thumbOffset = isOn ? (width - height) : 0
    - transition: none on both track and thumb
    - Optional ON/OFF labels with opacity based on state

    **PowerButtonRenderer.tsx:**
    - Button with text label
    - LED indicator div positioned based on ledPosition prop
    - LED: circular (border-radius: 50%), solid backgroundColor
    - LED boxShadow glow only when isOn: `0 0 4px ${ledOnColor}`
    - Button filter: brightness(1.1) when isOn
    - transition: none for instant state change

    **Register in controls/index.ts and main index.ts:**
    - Export all 4 renderers from controls/index.ts
    - Add to rendererRegistry Map in main index.ts
  </action>
  <verify>
    npm run build succeeds with no TypeScript errors.
    grep -r "iconbutton" src/ returns type, renderer, registry entries.
    grep -r "toggleswitch" src/ returns type, renderer, registry entries.
  </verify>
  <done>
    Four button element types defined with type guards and factories.
    Four renderers created with instant state transitions (no animations).
    All registered in rendererRegistry.
    Build passes.
  </done>
</task>

</tasks>

<verification>
1. TypeScript build: `npm run build` completes with no errors
2. Icon system verification:
   - `grep -c "BuiltInIcon" src/utils/builtInIcons.ts` returns 30+
   - Import works: `import { BuiltInIcon } from './utils/builtInIcons'`
3. Registry verification:
   - `grep "iconbutton" src/components/elements/renderers/index.ts` returns 1 entry
   - `grep "toggleswitch" src/components/elements/renderers/index.ts` returns 1 entry
   - `grep "powerbutton" src/components/elements/renderers/index.ts` returns 1 entry
   - `grep "kickbutton" src/components/elements/renderers/index.ts` returns 1 entry
4. Type exports:
   - controls.ts exports IconButtonElementConfig, KickButtonElementConfig, ToggleSwitchElementConfig, PowerButtonElementConfig
</verification>

<success_criteria>
- Built-in icon system provides ~35 themed SVG icons for audio plugin UIs
- All four button types compile without errors
- Renderers display correct visual appearance:
  - Icon Button: displays icon (built-in or asset)
  - Kick Button: shows text label, brightens on press
  - Toggle Switch: iOS-style pill with circular thumb, instant snap
  - Power Button: shows label and LED indicator, LED solid on/off
- All state transitions are instant (transition: none)
- Renderers registered in rendererRegistry
</success_criteria>

<output>
After completion, create `.planning/phases/21-buttons-switches/21-01-SUMMARY.md`
</output>
