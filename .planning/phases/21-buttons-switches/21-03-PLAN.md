---
phase: 21-buttons-switches
plan: 03
type: execute
wave: 2
depends_on: ["21-01", "21-02"]
files_modified:
  - src/components/Properties/IconButtonProperties.tsx
  - src/components/Properties/KickButtonProperties.tsx
  - src/components/Properties/ToggleSwitchProperties.tsx
  - src/components/Properties/PowerButtonProperties.tsx
  - src/components/Properties/RockerSwitchProperties.tsx
  - src/components/Properties/RotarySwitchProperties.tsx
  - src/components/Properties/SegmentButtonProperties.tsx
  - src/components/Properties/index.ts
  - src/components/Palette/Palette.tsx
autonomous: true

must_haves:
  truths:
    - "User can configure Icon Button icon source (built-in or asset library) in property panel"
    - "User can configure Toggle Switch on/off colors and labels in property panel"
    - "User can configure Power Button LED position, size, and colors in property panel"
    - "User can configure Rocker Switch mode (spring-to-center or latch-all) in property panel"
    - "User can configure Rotary Switch position count (2-12) and labels in property panel"
    - "User can configure Segment Button segments with icon/text content in property panel"
    - "All 7 button/switch types appear in Buttons category in palette"
  artifacts:
    - path: "src/components/Properties/IconButtonProperties.tsx"
      provides: "Icon Button property panel with icon source selection"
      exports: ["IconButtonProperties"]
    - path: "src/components/Properties/SegmentButtonProperties.tsx"
      provides: "Segment Button property panel with segment configuration"
      exports: ["SegmentButtonProperties"]
    - path: "src/components/Properties/index.ts"
      provides: "Property panel registry entries for all 7 types"
      contains: "iconbutton"
    - path: "src/components/Palette/Palette.tsx"
      provides: "Palette entries for all 7 button/switch types"
      contains: "iconbutton"
  key_links:
    - from: "src/components/Properties/index.ts"
      to: "propertyRegistry"
      via: "Map.set for all 7 button/switch types"
      pattern: "\\['iconbutton'"
    - from: "src/components/Palette/Palette.tsx"
      to: "paletteCategories"
      via: "Buttons category items"
      pattern: "type: 'iconbutton'"
---

<objective>
Create property panels for all 7 button/switch element types and add them to the palette.

Purpose: Enable users to configure all button and switch properties through the property panel and access all new elements from the palette.

Output: 7 property panel components, propertyRegistry entries, and palette entries in the Buttons category.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-buttons-switches/21-CONTEXT.md
@.planning/phases/21-buttons-switches/21-RESEARCH.md
@.planning/phases/21-buttons-switches/21-01-SUMMARY.md
@.planning/phases/21-buttons-switches/21-02-SUMMARY.md

# Existing patterns
@src/components/Properties/ButtonProperties.tsx
@src/components/Properties/SliderProperties.tsx
@src/components/Properties/index.ts
@src/components/Palette/Palette.tsx
@src/utils/builtInIcons.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create property panels for button types (Plan 01 elements)</name>
  <files>
    src/components/Properties/IconButtonProperties.tsx
    src/components/Properties/KickButtonProperties.tsx
    src/components/Properties/ToggleSwitchProperties.tsx
    src/components/Properties/PowerButtonProperties.tsx
  </files>
  <action>
    Create property panels following existing patterns (ButtonProperties.tsx style):

    **IconButtonProperties.tsx:**
    - Icon Source section:
      - Dropdown: 'Built-In Icon' or 'Asset Library'
      - When 'Built-In Icon': Dropdown of BuiltInIcon enum values grouped by category (Transport, Common, Audio)
      - When 'Asset Library': Dropdown of SVG assets from store (filter by icon/graphic category)
    - Button Mode section:
      - Dropdown: 'momentary' or 'toggle'
    - State section:
      - Pressed checkbox (for design preview)
    - Colors section:
      - iconColor (ColorInput)
      - backgroundColor (ColorInput)
      - borderColor (ColorInput)
    - Style section:
      - borderRadius (NumberInput, 0-20)

    **KickButtonProperties.tsx:**
    - Label section:
      - label text input
    - State section:
      - pressed checkbox (for design preview)
    - Colors section:
      - backgroundColor, textColor, borderColor (ColorInput)
    - Style section:
      - borderRadius (NumberInput, 0-20)

    **ToggleSwitchProperties.tsx:**
    - State section:
      - isOn checkbox (for design preview)
    - Colors section:
      - onColor, offColor (ColorInput) - track colors
      - thumbColor (ColorInput)
      - borderColor (ColorInput)
    - Labels section:
      - showLabels checkbox
      - onLabel, offLabel text inputs (visible when showLabels true)
      - labelColor (ColorInput)

    **PowerButtonProperties.tsx:**
    - Label section:
      - label text input
    - State section:
      - isOn checkbox (for design preview)
    - LED section:
      - ledPosition dropdown: top, bottom, left, right, center
      - ledSize NumberInput (4-16)
      - ledOnColor, ledOffColor (ColorInput)
    - Colors section:
      - backgroundColor, textColor, borderColor (ColorInput)
    - Style section:
      - borderRadius (NumberInput, 0-20)

    Use PropertySection component for grouping.
    All inputs use existing NumberInput, TextInput, ColorInput patterns.
    Import from store with useStore for asset list access.
  </action>
  <verify>
    All 4 files created.
    npm run build succeeds.
    grep "IconButtonProperties" src/components/Properties/IconButtonProperties.tsx returns function export.
  </verify>
  <done>
    Four property panels created for Icon Button, Kick Button, Toggle Switch, and Power Button.
    Icon Button has icon source selection with built-in icon dropdown.
    Power Button has LED configuration section.
    All panels follow existing PropertySection patterns.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create property panels for switch types (Plan 02 elements)</name>
  <files>
    src/components/Properties/RockerSwitchProperties.tsx
    src/components/Properties/RotarySwitchProperties.tsx
    src/components/Properties/SegmentButtonProperties.tsx
  </files>
  <action>
    **RockerSwitchProperties.tsx:**
    - State section:
      - position dropdown: 'Up (2)', 'Center (1)', 'Down (0)'
    - Behavior section:
      - mode dropdown: 'Spring to Center', 'Latch All Positions'
    - Labels section:
      - showLabels checkbox
      - upLabel, downLabel text inputs
      - labelColor (ColorInput)
    - Colors section:
      - backgroundColor, switchColor, borderColor (ColorInput)

    **RotarySwitchProperties.tsx:**
    - Position section:
      - positionCount NumberInput (min 2, max 12)
      - currentPosition NumberInput (min 0, max positionCount-1)
    - Label Layout section:
      - labelLayout dropdown: 'Radial', 'Legend'
    - Labels section:
      - Info text: "Labels are 1, 2, 3... by default. Edit below to customize."
      - Textarea or list input for positionLabels (comma-separated or line-by-line)
      - labelFontSize NumberInput (8-16)
      - labelColor (ColorInput)
    - Colors section:
      - backgroundColor, pointerColor, borderColor (ColorInput)
    - Geometry section:
      - rotationAngle NumberInput (90-360, default 270)

    **SegmentButtonProperties.tsx:**
    - Segment Count section:
      - segmentCount NumberInput (min 2, max 8)
      - When count changes, add/remove segments from array (new segments get text-only mode with 'New')
    - Selection section:
      - selectionMode dropdown: 'Single', 'Multi'
      - selectedIndices display (read-only, shows currently selected)
    - Orientation section:
      - orientation dropdown: 'Horizontal', 'Vertical'
    - Segments section (dynamic list):
      - For each segment i (0 to segmentCount-1):
        - Header: "Segment {i+1}"
        - displayMode dropdown: 'Icon Only', 'Text Only', 'Icon + Text'
        - If displayMode includes icon:
          - iconSource dropdown: 'Built-In', 'Asset Library'
          - builtInIcon dropdown OR assetId dropdown
        - If displayMode includes text:
          - text input
        - "Selected" checkbox (toggles this segment in selectedIndices)
    - Colors section:
      - backgroundColor, selectedColor, textColor, selectedTextColor, borderColor (ColorInput)

    **Important for SegmentButtonProperties:**
    - Handle segment array mutation carefully - update entire segments array immutably
    - When segmentCount increases: push new segments with default config
    - When segmentCount decreases: slice array to new length
    - Use useCallback for segment update handlers to avoid re-render loops
  </action>
  <verify>
    All 3 files created.
    npm run build succeeds.
    grep "SegmentButtonProperties" src/components/Properties/SegmentButtonProperties.tsx returns function export.
  </verify>
  <done>
    Three property panels created for Rocker Switch, Rotary Switch, and Segment Button.
    Rocker Switch has mode selection (spring/latch).
    Rotary Switch has position count configuration and label layout.
    Segment Button has dynamic segment configuration with icon/text options.
  </done>
</task>

<task type="auto">
  <name>Task 3: Register property panels and add palette entries</name>
  <files>
    src/components/Properties/index.ts
    src/components/Palette/Palette.tsx
  </files>
  <action>
    **Update Properties/index.ts:**
    1. Import all 7 property panels:
       ```typescript
       import { IconButtonProperties } from './IconButtonProperties'
       import { KickButtonProperties } from './KickButtonProperties'
       import { ToggleSwitchProperties } from './ToggleSwitchProperties'
       import { PowerButtonProperties } from './PowerButtonProperties'
       import { RockerSwitchProperties } from './RockerSwitchProperties'
       import { RotarySwitchProperties } from './RotarySwitchProperties'
       import { SegmentButtonProperties } from './SegmentButtonProperties'
       ```

    2. Add all 7 to propertyRegistry Map:
       ```typescript
       propertyRegistry.set('iconbutton', IconButtonProperties)
       propertyRegistry.set('kickbutton', KickButtonProperties)
       propertyRegistry.set('toggleswitch', ToggleSwitchProperties)
       propertyRegistry.set('powerbutton', PowerButtonProperties)
       propertyRegistry.set('rockerswitch', RockerSwitchProperties)
       propertyRegistry.set('rotaryswitch', RotarySwitchProperties)
       propertyRegistry.set('segmentbutton', SegmentButtonProperties)
       ```

    **Update Palette.tsx:**
    Update the 'Buttons' category (currently only has Button) to include all 7 new types:
    ```typescript
    {
      name: 'Buttons',
      items: [
        { id: 'button', type: 'button', name: 'Button', variant: { mode: 'momentary' } },
        { id: 'iconbutton', type: 'iconbutton', name: 'Icon Button' },
        { id: 'kickbutton', type: 'kickbutton', name: 'Kick Button' },
        { id: 'toggleswitch', type: 'toggleswitch', name: 'Toggle Switch' },
        { id: 'powerbutton', type: 'powerbutton', name: 'Power Button' },
        { id: 'rockerswitch', type: 'rockerswitch', name: 'Rocker Switch' },
        { id: 'rotaryswitch', type: 'rotaryswitch', name: 'Rotary Switch' },
        { id: 'segmentbutton', type: 'segmentbutton', name: 'Segment Button' },
      ],
    },
    ```

    Order: Original Button first, then new buttons, then switches, then segment.
  </action>
  <verify>
    npm run build succeeds.
    npm run dev - open browser, verify all 8 items appear in Buttons palette category.
    Drag each to canvas, verify property panel shows element-specific controls.
    grep -c "iconbutton" src/components/Properties/index.ts returns at least 1.
    grep -c "iconbutton" src/components/Palette/Palette.tsx returns at least 1.
  </verify>
  <done>
    All 7 property panels registered in propertyRegistry.
    All 7 new button/switch types added to Buttons palette category.
    User can add any new element and configure via property panel.
  </done>
</task>

</tasks>

<verification>
1. TypeScript build: `npm run build` completes with no errors
2. Property registry:
   - grep "iconbutton" src/components/Properties/index.ts
   - grep "segmentbutton" src/components/Properties/index.ts
   - All 7 types have registry entries
3. Palette:
   - npm run dev - open browser
   - Verify Buttons category shows: Button, Icon Button, Kick Button, Toggle Switch, Power Button, Rocker Switch, Rotary Switch, Segment Button
4. Property panels:
   - Add Icon Button, verify icon source dropdown with built-in icons
   - Add Segment Button, verify dynamic segment configuration
   - Add Rotary Switch, verify position count changes label count
</verification>

<success_criteria>
- All 7 property panels created with correct configuration options
- Icon Button has built-in icon selection with categorized dropdown
- Segment Button has dynamic segment list with icon/text configuration
- Rotary Switch has position count (2-12) with label configuration
- All property panels registered in propertyRegistry
- All 7 types appear in Buttons palette category
- User can add each type and see element-specific property panel
</success_criteria>

<output>
After completion, create `.planning/phases/21-buttons-switches/21-03-SUMMARY.md`
</output>
