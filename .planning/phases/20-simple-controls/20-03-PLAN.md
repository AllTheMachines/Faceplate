---
phase: 20-simple-controls
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements/controls.ts
  - src/components/elements/renderers/controls/NotchedSliderRenderer.tsx
  - src/components/elements/renderers/controls/ArcSliderRenderer.tsx
  - src/components/elements/renderers/controls/index.ts
  - src/components/elements/renderers/index.ts
  - src/components/Properties/NotchedSliderProperties.tsx
  - src/components/Properties/ArcSliderProperties.tsx
  - src/components/Properties/index.ts
  - src/components/Palette/Palette.tsx
autonomous: true

must_haves:
  truths:
    - "User can add Notched Slider with visible detent positions"
    - "User can configure notch count or custom notch positions"
    - "User can add Arc Slider that follows a curved path"
    - "Arc Slider shows filled arc segment indicating current value"
  artifacts:
    - path: "src/types/elements/controls.ts"
      provides: "NotchedSliderElementConfig, ArcSliderElementConfig types"
      contains: "type: 'notchedslider'"
    - path: "src/components/elements/renderers/controls/NotchedSliderRenderer.tsx"
      provides: "Notched slider with detent indicators"
      exports: ["NotchedSliderRenderer"]
    - path: "src/components/elements/renderers/controls/ArcSliderRenderer.tsx"
      provides: "Arc slider with curved track"
      exports: ["ArcSliderRenderer"]
  key_links:
    - from: "src/components/elements/renderers/index.ts"
      to: "rendererRegistry"
      via: "Map.set for notchedslider, arcslider"
      pattern: "\\['notchedslider'"
    - from: "src/components/Properties/index.ts"
      to: "propertyRegistry"
      via: "Map.set for notchedslider, arcslider"
      pattern: "\\['notchedslider'"
---

<objective>
Implement Notched Slider and Arc Slider - two advanced linear control variants with detent positions and curved path interaction.

Purpose: Enable audio plugin designers to add sliders with discrete snap positions (for preset levels, filter types) and arc-shaped sliders for semi-circular controls that combine knob aesthetics with slider behavior.

Output: Two new slider types available in palette with complete type definitions, renderers, property panels, and registry entries.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-simple-controls/20-CONTEXT.md
@.planning/phases/20-simple-controls/20-RESEARCH.md

# Existing patterns to extend
@src/types/elements/controls.ts
@src/components/elements/renderers/controls/SliderRenderer.tsx
@src/components/elements/renderers/controls/KnobRenderer.tsx
@src/components/elements/renderers/controls/index.ts
@src/components/elements/renderers/index.ts
@src/components/Properties/SliderProperties.tsx
@src/components/Properties/index.ts
@src/components/Palette/Palette.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create notched and arc slider types and renderers</name>
  <files>
    src/types/elements/controls.ts
    src/components/elements/renderers/controls/NotchedSliderRenderer.tsx
    src/components/elements/renderers/controls/ArcSliderRenderer.tsx
    src/components/elements/renderers/controls/index.ts
    src/components/elements/renderers/index.ts
  </files>
  <action>
    Add two new element types to controls.ts:

    1. **NotchedSliderElementConfig** extends base slider properties:
       - type: 'notchedslider'
       - notchCount: number (default 5 - number of evenly spaced notches including endpoints)
       - notchPositions: number[] | null (default null - if provided, overrides notchCount with custom positions 0-1)
       - showNotchLabels: boolean (default false - show value at each notch position)
       - notchColor: string (default '#ffffff' with opacity 0.5 - color of notch indicators)
       - Inherits: orientation, value, min, max, trackColor, trackFillColor, thumbColor, thumbWidth, thumbHeight, label/value display props

    2. **ArcSliderElementConfig** - similar to knob but behaves like slider:
       - type: 'arcslider'
       - diameter: number (default 100)
       - startAngle: number (default 135 - bottom-left, following arc from left to right)
       - endAngle: number (default 45 - bottom-right, arc sweeps 270 degrees upward)
       - trackWidth: number (default 6)
       - trackColor: string (default '#374151')
       - fillColor: string (default '#949494')
       - thumbRadius: number (default 8 - circular thumb that moves along arc)
       - thumbColor: string (default '#ffffff')
       - value, min, max as standard
       - label/value display props as standard

    Add type guards: isNotchedSlider, isArcSlider
    Add factory functions: createNotchedSlider, createArcSlider
    Add to ControlElement union type.

    Create renderers:

    **NotchedSliderRenderer.tsx:**
    - Calculate notch positions from notchCount (evenly spaced) or notchPositions array
    - Draw short perpendicular lines at each notch position on the track
    - If showNotchLabels: render value text at each notch
    - Standard track, fill, and thumb rendering otherwise
    - Notches are visual only - no snap behavior (this is design-time display)

    **ArcSliderRenderer.tsx:**
    - Use polarToCartesian and describeArc from KnobRenderer pattern
    - Draw arc track from startAngle to endAngle
    - Draw filled arc from startAngle to current value angle
    - Draw circular thumb at current value position on arc
    - Thumb follows the arc path (not a line like knob indicator)
    - Default arc: 135 to 45 degrees (270 degree sweep, opening at bottom)

    Register in controls/index.ts (export statements) and main index.ts (add to rendererRegistry Map).
  </action>
  <verify>
    npm run build succeeds with no TypeScript errors.
    grep -r "notchedslider" src/ returns type, renderer, registry entries.
    grep -r "arcslider" src/ returns type, renderer, registry entries.
  </verify>
  <done>
    Two slider types defined with type guards and factories.
    Notched slider shows detent position indicators.
    Arc slider renders curved track with thumb following arc path.
    Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create property panels and add to palette</name>
  <files>
    src/components/Properties/NotchedSliderProperties.tsx
    src/components/Properties/ArcSliderProperties.tsx
    src/components/Properties/index.ts
    src/components/Palette/Palette.tsx
  </files>
  <action>
    Create property panels:

    **NotchedSliderProperties.tsx:**
    - Orientation dropdown (vertical/horizontal)
    - Notch count NumberInput (2 to 32, default 5)
    - Show notch labels checkbox
    - Notch color ColorInput
    - Value section (value, min, max)
    - Track colors section (trackColor, trackFillColor)
    - Thumb section (thumbColor, thumbWidth, thumbHeight)
    - Label section (same as Slider)
    - Value display section (same as Slider)
    - Note: Custom notch positions array is advanced - skip in property panel for now (edit in JSON if needed)

    **ArcSliderProperties.tsx:**
    - Diameter NumberInput
    - Arc Geometry section:
      - Start Angle NumberInput (-180 to 180)
      - End Angle NumberInput (-180 to 180)
      - Track Width NumberInput (2 to 20)
    - Thumb section:
      - Thumb Radius NumberInput (4 to 20)
      - Thumb Color ColorInput
    - Colors section (trackColor, fillColor)
    - Value section (value, min, max)
    - Label section (same as Knob pattern)
    - Value display section (same as Knob pattern)

    Register in Properties/index.ts:
    - Import both
    - Add to propertyRegistry Map

    Update Palette.tsx - add to 'Linear Controls' category:
    - { id: 'notchedslider', type: 'notchedslider', name: 'Notched Slider' }
    - { id: 'arcslider', type: 'arcslider', name: 'Arc Slider' }
  </action>
  <verify>
    npm run build succeeds.
    npm run dev - open browser, verify two new controls appear in Linear Controls palette category.
    Add each to canvas:
    - Notched Slider: visible notch marks on track
    - Arc Slider: curved track with thumb on arc
    Select each element, verify property panel shows correct controls.
  </verify>
  <done>
    Two property panels created with element-specific controls.
    Property panels registered in propertyRegistry.
    Both control variants appear in Linear Controls palette category.
    User can add each variant and configure via property panel.
  </done>
</task>

</tasks>

<verification>
1. TypeScript build: `npm run build` completes with no errors
2. Functional test:
   - Run `npm run dev`
   - Verify "Notched Slider" and "Arc Slider" appear in Linear Controls category
   - Drag each to canvas
   - Verify unique visual appearance:
     - Notched Slider: notch marks visible perpendicular to track
     - Arc Slider: curved track forming partial circle with thumb on arc
   - Select each element, verify property panel shows correct controls
   - Change Arc Slider start/end angles, verify arc shape updates
   - Change notch count, verify notch marks update
3. Registry verification:
   - `grep -c "notchedslider" src/components/elements/renderers/index.ts` returns 1
   - `grep -c "arcslider" src/components/Properties/index.ts` returns 1
</verification>

<success_criteria>
- Both control types compile without errors
- Notched Slider displays visible notch marks at configured positions
- Arc Slider displays curved track and thumb follows arc path
- Arc Slider angle range is configurable (default 135 to 45 = 270 degree sweep)
- Property panels show element-specific configuration options
- Palette shows both new control variants in Linear Controls category
</success_criteria>

<output>
After completion, create `.planning/phases/20-simple-controls/20-03-SUMMARY.md`
</output>
