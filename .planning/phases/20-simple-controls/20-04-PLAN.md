---
phase: 20-simple-controls
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements/controls.ts
  - src/components/elements/renderers/controls/MultiSliderRenderer.tsx
  - src/components/elements/renderers/controls/index.ts
  - src/components/elements/renderers/index.ts
  - src/components/Properties/MultiSliderProperties.tsx
  - src/components/Properties/index.ts
  - src/components/Palette/Palette.tsx
autonomous: true

must_haves:
  truths:
    - "User can add Multi-Slider with configurable band count"
    - "Multi-Slider displays parallel vertical sliders in a row"
    - "User can choose band count from presets (3, 4, 5, 7, 10, 31) or custom (1-32)"
    - "User can configure label style (frequency labels, index numbers, or hidden)"
  artifacts:
    - path: "src/types/elements/controls.ts"
      provides: "MultiSliderElementConfig type"
      contains: "type: 'multislider'"
    - path: "src/components/elements/renderers/controls/MultiSliderRenderer.tsx"
      provides: "Multi-slider rendering with parallel bands"
      exports: ["MultiSliderRenderer"]
    - path: "src/components/Properties/MultiSliderProperties.tsx"
      provides: "Multi-slider property panel"
      exports: ["MultiSliderProperties"]
  key_links:
    - from: "src/components/elements/renderers/index.ts"
      to: "rendererRegistry"
      via: "Map.set for multislider"
      pattern: "\\['multislider'"
    - from: "src/components/Properties/index.ts"
      to: "propertyRegistry"
      via: "Map.set for multislider"
      pattern: "\\['multislider'"
---

<objective>
Implement Multi-Slider - a parallel array of sliders for EQ, multi-band processing, and frequency-based controls.

Purpose: Enable audio plugin designers to add graphic EQ style controls with multiple parallel sliders representing frequency bands or multi-parameter arrays.

Output: Multi-Slider element with configurable band count, labels, and visual styling available in palette with complete type definition, renderer, property panel, and registry entries.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-simple-controls/20-CONTEXT.md
@.planning/phases/20-simple-controls/20-RESEARCH.md

# Existing patterns to extend
@src/types/elements/controls.ts
@src/components/elements/renderers/controls/SliderRenderer.tsx
@src/components/elements/renderers/controls/index.ts
@src/components/elements/renderers/index.ts
@src/components/Properties/SliderProperties.tsx
@src/components/Properties/index.ts
@src/components/Palette/Palette.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create multi-slider type and renderer</name>
  <files>
    src/types/elements/controls.ts
    src/components/elements/renderers/controls/MultiSliderRenderer.tsx
    src/components/elements/renderers/controls/index.ts
    src/components/elements/renderers/index.ts
  </files>
  <action>
    Add MultiSliderElementConfig to controls.ts:

    **MultiSliderElementConfig:**
    - type: 'multislider'
    - bandCount: number (default 7 - number of parallel sliders)
    - bandValues: number[] (array of values 0-1, one per band, initialized to 0.5 each)
    - min: number (default 0)
    - max: number (default 1)
    - labelStyle: 'frequency' | 'index' | 'hidden' (default 'index')
    - customLabels: string[] | null (default null - if provided, overrides labelStyle)
    - linkMode: 'always-linked' | 'modifier-linked' | 'independent' (default 'independent')
    - trackColor: string (default '#374151')
    - fillColor: string (default '#949494')
    - thumbColor: string (default '#ffffff')
    - labelColor: string (default '#888888')
    - labelFontSize: number (default 10)
    - bandGap: number (default 2 - pixel gap between bands)
    - Standard: width, height, x, y, etc.

    Frequency label presets (when labelStyle is 'frequency'):
    - 3 bands: ['Low', 'Mid', 'High']
    - 4 bands: ['Sub', 'Low', 'Mid', 'High']
    - 5 bands: ['Sub', 'Low', 'Mid', 'Hi-Mid', 'High']
    - 7 bands: ['63', '125', '250', '500', '1k', '2k', '4k']
    - 10 bands: ['31', '63', '125', '250', '500', '1k', '2k', '4k', '8k', '16k']
    - 31 bands: ['20', '25', '31', '40', '50', '63', '80', '100', '125', '160', '200', '250', '315', '400', '500', '630', '800', '1k', '1.3k', '1.6k', '2k', '2.5k', '3.2k', '4k', '5k', '6.3k', '8k', '10k', '12.5k', '16k', '20k']

    Add type guard: isMultiSlider
    Add factory function: createMultiSlider (initialize bandValues array to bandCount filled with 0.5)
    Add to ControlElement union type.

    **MultiSliderRenderer.tsx:**
    - Calculate band width: (element.width - (bandGap * (bandCount - 1))) / bandCount
    - For each band, render:
      - Vertical track rectangle (full height)
      - Fill rectangle (from bottom up to value)
      - Thin thumb line at value position
    - Optional labels below each band (based on labelStyle)
    - Frequency labels from preset arrays based on bandCount
    - Index labels: "1", "2", "3"... or use customLabels if provided

    Register in controls/index.ts (export statements) and main index.ts (add to rendererRegistry Map).
  </action>
  <verify>
    npm run build succeeds with no TypeScript errors.
    grep -r "multislider" src/ returns type, renderer, registry entries.
  </verify>
  <done>
    MultiSliderElementConfig type defined with bandCount, bandValues array, labelStyle options.
    MultiSliderRenderer renders parallel vertical sliders with optional labels.
    Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create property panel and add to palette</name>
  <files>
    src/components/Properties/MultiSliderProperties.tsx
    src/components/Properties/index.ts
    src/components/Palette/Palette.tsx
  </files>
  <action>
    Create **MultiSliderProperties.tsx:**

    **Band Configuration section:**
    - Band count dropdown with presets: 3, 4, 5, 7, 10, 31
    - Custom band count NumberInput (1 to 32, only shown if not using preset)
    - Band gap NumberInput (0 to 10 pixels)

    **Label Style section:**
    - Label style dropdown: Frequency Labels, Index Numbers, Hidden
    - Label color ColorInput
    - Label font size NumberInput (8 to 16)

    **Link Mode section:**
    - Link mode dropdown: Always Linked, Modifier Linked (Alt/Option), Independent
    - Note: Link mode is for runtime behavior hint - in designer, bands are independent

    **Colors section:**
    - Track color ColorInput
    - Fill color ColorInput
    - Thumb color ColorInput

    **Value Range section:**
    - Min NumberInput
    - Max NumberInput

    **Band Values section (collapsible, optional):**
    - Show current band values as read-only or allow editing individual values
    - Or just show "Bands: 7" with count

    Register in Properties/index.ts:
    - Import MultiSliderProperties
    - Add to propertyRegistry Map: ['multislider', MultiSliderProperties]

    Update Palette.tsx - add to 'Linear Controls' category:
    - { id: 'multislider', type: 'multislider', name: 'Multi-Slider' }
  </action>
  <verify>
    npm run build succeeds.
    npm run dev - open browser, verify "Multi-Slider" appears in Linear Controls palette category.
    Add Multi-Slider to canvas:
    - Verify parallel vertical sliders render (default 7 bands)
    - Verify labels appear below each band
    Select element, verify property panel shows:
    - Band count dropdown with presets
    - Label style dropdown
    - Color inputs
    Change band count, verify display updates.
    Change label style to 'frequency', verify frequency labels appear.
  </verify>
  <done>
    MultiSliderProperties panel created with band configuration, label style, link mode, and color options.
    Property panel registered in propertyRegistry.
    Multi-Slider appears in Linear Controls palette category.
    User can add Multi-Slider and configure band count, labels, and colors.
  </done>
</task>

</tasks>

<verification>
1. TypeScript build: `npm run build` completes with no errors
2. Functional test:
   - Run `npm run dev`
   - Verify "Multi-Slider" appears in Linear Controls category
   - Drag to canvas
   - Verify 7 parallel vertical sliders render (default)
   - Verify labels appear below bands (default: index numbers "1", "2", etc.)
   - Select element, verify property panel shows band configuration
   - Change band count to 10, verify 10 bands render
   - Change label style to "Frequency Labels", verify frequency labels appear
   - Change label style to "Hidden", verify labels disappear
3. Registry verification:
   - `grep -c "multislider" src/components/elements/renderers/index.ts` returns 1
   - `grep -c "multislider" src/components/Properties/index.ts` returns 1
</verification>

<success_criteria>
- MultiSlider type compiles without errors
- Renderer displays configurable number of parallel vertical sliders
- Band count presets (3, 4, 5, 7, 10, 31) work correctly
- Frequency labels display appropriate values for each band count
- Index labels display "1", "2", "3"... for each band
- Labels can be hidden
- Property panel shows all configuration options
- Palette shows Multi-Slider in Linear Controls category
</success_criteria>

<output>
After completion, create `.planning/phases/20-simple-controls/20-04-SUMMARY.md`
</output>
