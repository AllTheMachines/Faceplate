---
phase: 20-simple-controls
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements/controls.ts
  - src/components/elements/renderers/controls/SteppedKnobRenderer.tsx
  - src/components/elements/renderers/controls/CenterDetentKnobRenderer.tsx
  - src/components/elements/renderers/controls/DotIndicatorKnobRenderer.tsx
  - src/components/elements/renderers/controls/index.ts
  - src/components/elements/renderers/index.ts
  - src/components/Properties/SteppedKnobProperties.tsx
  - src/components/Properties/CenterDetentKnobProperties.tsx
  - src/components/Properties/DotIndicatorKnobProperties.tsx
  - src/components/Properties/index.ts
  - src/components/Palette/Palette.tsx
autonomous: true

must_haves:
  truths:
    - "User can add Stepped Knob from palette and see discrete step positions"
    - "User can configure step count (12, 24, 36, 48, 64) in property panel"
    - "User can add Center-Detented Knob that visually shows center snap behavior"
    - "User can add Dot Indicator Knob with minimal dot-style indicator"
  artifacts:
    - path: "src/types/elements/controls.ts"
      provides: "SteppedKnobElementConfig, CenterDetentKnobElementConfig, DotIndicatorKnobElementConfig types"
      contains: "type: 'steppedknob'"
    - path: "src/components/elements/renderers/controls/SteppedKnobRenderer.tsx"
      provides: "Stepped Knob rendering with tick marks"
      exports: ["SteppedKnobRenderer"]
    - path: "src/components/elements/renderers/controls/CenterDetentKnobRenderer.tsx"
      provides: "Center-detented knob rendering"
      exports: ["CenterDetentKnobRenderer"]
    - path: "src/components/elements/renderers/controls/DotIndicatorKnobRenderer.tsx"
      provides: "Dot indicator knob rendering"
      exports: ["DotIndicatorKnobRenderer"]
  key_links:
    - from: "src/components/elements/renderers/index.ts"
      to: "rendererRegistry"
      via: "Map.set for steppedknob, centerdetentknob, dotindicatorknob"
      pattern: "\\['steppedknob'"
    - from: "src/components/Properties/index.ts"
      to: "propertyRegistry"
      via: "Map.set for steppedknob, centerdetentknob, dotindicatorknob"
      pattern: "\\['steppedknob'"
    - from: "src/components/Palette/Palette.tsx"
      to: "paletteCategories"
      via: "Rotary Controls category items"
      pattern: "type: 'steppedknob'"
---

<objective>
Implement three rotary control variants: Stepped Knob, Center-Detented Knob, and Dot Indicator Knob.

Purpose: Provide audio plugin designers with specialized knob variants that match industry-standard behaviors - discrete stepped positions for parameter selection, center snap for bipolar controls, and minimal visual styles.

Output: Three new knob types available in palette, with complete type definitions, renderers, property panels, and registry entries.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-simple-controls/20-CONTEXT.md
@.planning/phases/20-simple-controls/20-RESEARCH.md

# Existing patterns to extend
@src/types/elements/controls.ts
@src/components/elements/renderers/controls/KnobRenderer.tsx
@src/components/elements/renderers/controls/index.ts
@src/components/elements/renderers/index.ts
@src/components/Properties/KnobProperties.tsx
@src/components/Properties/index.ts
@src/components/Palette/Palette.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create rotary control types and renderers</name>
  <files>
    src/types/elements/controls.ts
    src/components/elements/renderers/controls/SteppedKnobRenderer.tsx
    src/components/elements/renderers/controls/CenterDetentKnobRenderer.tsx
    src/components/elements/renderers/controls/DotIndicatorKnobRenderer.tsx
    src/components/elements/renderers/controls/index.ts
    src/components/elements/renderers/index.ts
  </files>
  <action>
    Add three new element types to controls.ts following existing KnobElementConfig pattern:

    1. **SteppedKnobElementConfig** extends base knob properties:
       - type: 'steppedknob'
       - stepCount: number (12, 24, 36, 48, or 64 - default 12)
       - showStepIndicators: boolean (default true - shows tick marks at each step)
       - Inherits: diameter, value, min, max, startAngle, endAngle, trackColor, fillColor, indicatorColor, trackWidth, label/value display props

    2. **CenterDetentKnobElementConfig** extends base knob properties:
       - type: 'centerdetentknob'
       - snapThreshold: number (default 0.05 - 5% of range, snaps when |value - 0.5| < threshold)
       - showCenterMark: boolean (default true - shows visual indicator at center)
       - Inherits: all base knob properties

    3. **DotIndicatorKnobElementConfig** extends base knob properties:
       - type: 'dotindicatorknob'
       - dotRadius: number (default 4 - radius of indicator dot)
       - Inherits: all base knob properties

    Add type guards: isSteppedKnob, isCenterDetentKnob, isDotIndicatorKnob
    Add factory functions: createSteppedKnob, createCenterDetentKnob, createDotIndicatorKnob
    Add to ControlElement union type.

    Create renderers following KnobRenderer pattern (reuse polarToCartesian, describeArc utilities):

    **SteppedKnobRenderer.tsx:**
    - Quantize displayed value to nearest step: Math.round(normalizedValue / stepSize) * stepSize where stepSize = 1 / (stepCount - 1)
    - Render tick marks at each step position when showStepIndicators is true (small circles on arc)
    - Use indicator line pointing to current stepped position

    **CenterDetentKnobRenderer.tsx:**
    - Show visual center mark (small line or dot at 0.5 position on arc)
    - Highlight center mark when value is at center (within snap threshold)
    - Normal arc rendering otherwise

    **DotIndicatorKnobRenderer.tsx:**
    - Minimal style: single dot on the arc edge that rotates to show value position
    - No track fill, just track arc + rotating indicator dot

    Register in controls/index.ts (export statements) and main index.ts (add to rendererRegistry Map).
  </action>
  <verify>
    npm run build succeeds with no TypeScript errors.
    grep -r "steppedknob" src/ returns type, renderer, registry entries.
  </verify>
  <done>
    Three rotary control types defined with type guards and factories.
    Three renderers created and registered in rendererRegistry.
    Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create property panels and add to palette</name>
  <files>
    src/components/Properties/SteppedKnobProperties.tsx
    src/components/Properties/CenterDetentKnobProperties.tsx
    src/components/Properties/DotIndicatorKnobProperties.tsx
    src/components/Properties/index.ts
    src/components/Palette/Palette.tsx
  </files>
  <action>
    Create property panels following KnobProperties.tsx pattern:

    **SteppedKnobProperties.tsx:**
    - Step count dropdown with options: 12, 24, 36, 48, 64
    - Show step indicators checkbox
    - Value section (value, min, max)
    - Arc geometry section (startAngle, endAngle, trackWidth)
    - Colors section (trackColor, fillColor, indicatorColor)
    - Label section (same as Knob)
    - Value display section (same as Knob)

    **CenterDetentKnobProperties.tsx:**
    - Snap threshold NumberInput (0.01 to 0.2, step 0.01)
    - Show center mark checkbox
    - Value section
    - Arc geometry section
    - Colors section
    - Label section
    - Value display section

    **DotIndicatorKnobProperties.tsx:**
    - Dot radius NumberInput (2 to 10)
    - Value section
    - Arc geometry section
    - Colors section (trackColor, indicatorColor - no fillColor needed)
    - Label section
    - Value display section

    Register in Properties/index.ts:
    - Import all three
    - Add to propertyRegistry Map

    Update Palette.tsx - add to 'Rotary Controls' category:
    - { id: 'steppedknob', type: 'steppedknob', name: 'Stepped Knob' }
    - { id: 'centerdetentknob', type: 'centerdetentknob', name: 'Center Detent' }
    - { id: 'dotindicatorknob', type: 'dotindicatorknob', name: 'Dot Indicator' }
  </action>
  <verify>
    npm run build succeeds.
    npm run dev - open browser, verify three new knobs appear in Rotary Controls palette category.
    Add each knob to canvas, verify property panel shows element-specific controls.
  </verify>
  <done>
    Three property panels created with element-specific controls.
    Property panels registered in propertyRegistry.
    All three knob variants appear in Rotary Controls palette category.
    User can add each variant and configure via property panel.
  </done>
</task>

</tasks>

<verification>
1. TypeScript build: `npm run build` completes with no errors
2. Functional test:
   - Run `npm run dev`
   - Verify "Stepped Knob", "Center Detent", "Dot Indicator" appear in Rotary Controls category
   - Drag each to canvas
   - Verify unique visual appearance:
     - Stepped Knob: tick marks visible on arc
     - Center Detent: center mark visible at 12 o'clock
     - Dot Indicator: single dot on arc edge, no fill
   - Select each element, verify property panel shows correct controls
3. Registry verification:
   - `grep -c "steppedknob" src/components/elements/renderers/index.ts` returns 1
   - `grep -c "centerdetentknob" src/components/Properties/index.ts` returns 1
</verification>

<success_criteria>
- All three rotary control types compile without errors
- Renderers display correct visual appearance (tick marks, center mark, dot indicator)
- Property panels show element-specific configuration options
- Step count dropdown works with 12/24/36/48/64 options
- Palette shows all three new knob variants in Rotary Controls category
</success_criteria>

<output>
After completion, create `.planning/phases/20-simple-controls/20-01-SUMMARY.md`
</output>
