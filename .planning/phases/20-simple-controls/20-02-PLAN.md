---
phase: 20-simple-controls
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements/controls.ts
  - src/components/elements/renderers/controls/BipolarSliderRenderer.tsx
  - src/components/elements/renderers/controls/CrossfadeSliderRenderer.tsx
  - src/components/elements/renderers/controls/index.ts
  - src/components/elements/renderers/index.ts
  - src/components/Properties/BipolarSliderProperties.tsx
  - src/components/Properties/CrossfadeSliderProperties.tsx
  - src/components/Properties/index.ts
  - src/components/Palette/Palette.tsx
autonomous: true

must_haves:
  truths:
    - "User can add Bipolar Slider with visible center line"
    - "User can add Crossfade Slider with A/B labels"
    - "Bipolar Slider fill extends from center to current value"
    - "Crossfade Slider shows DJ-style balance between A and B sides"
  artifacts:
    - path: "src/types/elements/controls.ts"
      provides: "BipolarSliderElementConfig, CrossfadeSliderElementConfig types"
      contains: "type: 'bipolarslider'"
    - path: "src/components/elements/renderers/controls/BipolarSliderRenderer.tsx"
      provides: "Bipolar slider with center-zero rendering"
      exports: ["BipolarSliderRenderer"]
    - path: "src/components/elements/renderers/controls/CrossfadeSliderRenderer.tsx"
      provides: "Crossfade slider with A/B balance rendering"
      exports: ["CrossfadeSliderRenderer"]
  key_links:
    - from: "src/components/elements/renderers/index.ts"
      to: "rendererRegistry"
      via: "Map.set for bipolarslider, crossfadeslider"
      pattern: "\\['bipolarslider'"
    - from: "src/components/Properties/index.ts"
      to: "propertyRegistry"
      via: "Map.set for bipolarslider, crossfadeslider"
      pattern: "\\['bipolarslider'"
---

<objective>
Implement Bipolar Slider and Crossfade Slider - two linear control variants for center-zero and A/B balance use cases.

Purpose: Enable audio plugin designers to add controls with center-zero behavior (bipolar parameters like pan, EQ gain) and DJ-style crossfaders for mixing/routing applications.

Output: Two new slider types available in palette with complete type definitions, renderers, property panels, and registry entries.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-simple-controls/20-CONTEXT.md
@.planning/phases/20-simple-controls/20-RESEARCH.md

# Existing patterns to extend
@src/types/elements/controls.ts
@src/components/elements/renderers/controls/SliderRenderer.tsx
@src/components/elements/renderers/controls/index.ts
@src/components/elements/renderers/index.ts
@src/components/Properties/SliderProperties.tsx
@src/components/Properties/index.ts
@src/components/Palette/Palette.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create bipolar and crossfade slider types and renderers</name>
  <files>
    src/types/elements/controls.ts
    src/components/elements/renderers/controls/BipolarSliderRenderer.tsx
    src/components/elements/renderers/controls/CrossfadeSliderRenderer.tsx
    src/components/elements/renderers/controls/index.ts
    src/components/elements/renderers/index.ts
  </files>
  <action>
    Add two new element types to controls.ts following SliderElementConfig pattern:

    1. **BipolarSliderElementConfig** extends base slider properties:
       - type: 'bipolarslider'
       - centerValue: number (default 0.5 - position of center line, normally 0.5 for center-zero)
       - centerLineColor: string (default '#ffffff' with opacity 0.5 - color of center indicator)
       - Inherits: orientation, value, min, max, trackColor, trackFillColor, thumbColor, thumbWidth, thumbHeight, label/value display props

    2. **CrossfadeSliderElementConfig** extends base slider properties:
       - type: 'crossfadeslider'
       - labelA: string (default 'A' - left/bottom label)
       - labelB: string (default 'B' - right/top label)
       - labelColor: string (default '#888888')
       - labelFontSize: number (default 12)
       - Inherits: orientation (always horizontal for crossfader), value, min, max, trackColor, trackFillColor, thumbColor, thumbWidth, thumbHeight
       - Note: crossfade is horizontal-only by convention

    Add type guards: isBipolarSlider, isCrossfadeSlider
    Add factory functions: createBipolarSlider, createCrossfadeSlider
    Add to ControlElement union type.

    Create renderers following SliderRenderer pattern:

    **BipolarSliderRenderer.tsx:**
    - Calculate center position from centerValue (default 0.5)
    - Draw center line across track at center position (perpendicular to slider direction)
    - Fill extends FROM center TO current thumb position (not from min to value)
    - If value < center: fill from value to center
    - If value > center: fill from center to value
    - Thumb position same as regular slider

    **CrossfadeSliderRenderer.tsx:**
    - Horizontal slider with A label on left, B label on right
    - Labels positioned above track with labelColor and labelFontSize
    - Center detent mark (vertical line at 50%)
    - Track fill can show balance visually (opacity based on distance from center)
    - Standard thumb movement left-to-right

    Register in controls/index.ts (export statements) and main index.ts (add to rendererRegistry Map).
  </action>
  <verify>
    npm run build succeeds with no TypeScript errors.
    grep -r "bipolarslider" src/ returns type, renderer, registry entries.
  </verify>
  <done>
    Two slider types defined with type guards and factories.
    Two renderers created showing center-based fill and A/B balance.
    Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create property panels and add to palette</name>
  <files>
    src/components/Properties/BipolarSliderProperties.tsx
    src/components/Properties/CrossfadeSliderProperties.tsx
    src/components/Properties/index.ts
    src/components/Palette/Palette.tsx
  </files>
  <action>
    Create property panels following SliderProperties.tsx pattern:

    **BipolarSliderProperties.tsx:**
    - Orientation dropdown (vertical/horizontal)
    - Center value NumberInput (0 to 1, step 0.1, default 0.5)
    - Center line color ColorInput
    - Value section (value, min, max)
    - Track colors section (trackColor, trackFillColor)
    - Thumb section (thumbColor, thumbWidth, thumbHeight)
    - Label section (same as Slider)
    - Value display section (same as Slider)

    **CrossfadeSliderProperties.tsx:**
    - Label A TextInput
    - Label B TextInput
    - Label color ColorInput
    - Label font size NumberInput (8 to 24)
    - Value section (value, min, max)
    - Track colors section (trackColor, trackFillColor)
    - Thumb section (thumbColor, thumbWidth, thumbHeight)
    - Note: No orientation selector - crossfade is always horizontal

    Register in Properties/index.ts:
    - Import both
    - Add to propertyRegistry Map

    Update Palette.tsx - add to 'Linear Controls' category:
    - { id: 'bipolarslider', type: 'bipolarslider', name: 'Bipolar Slider' }
    - { id: 'crossfadeslider', type: 'crossfadeslider', name: 'Crossfade' }
  </action>
  <verify>
    npm run build succeeds.
    npm run dev - open browser, verify two new sliders appear in Linear Controls palette category.
    Add each slider to canvas, verify property panel shows element-specific controls.
    Verify Bipolar Slider shows center line and fills from center.
    Verify Crossfade Slider shows A and B labels.
  </verify>
  <done>
    Two property panels created with element-specific controls.
    Property panels registered in propertyRegistry.
    Both slider variants appear in Linear Controls palette category.
    User can add each variant and configure via property panel.
  </done>
</task>

</tasks>

<verification>
1. TypeScript build: `npm run build` completes with no errors
2. Functional test:
   - Run `npm run dev`
   - Verify "Bipolar Slider" and "Crossfade" appear in Linear Controls category
   - Drag each to canvas
   - Verify unique visual appearance:
     - Bipolar Slider: center line visible, fill extends from center to value
     - Crossfade Slider: A and B labels visible, horizontal orientation
   - Select each element, verify property panel shows correct controls
3. Registry verification:
   - `grep -c "bipolarslider" src/components/elements/renderers/index.ts` returns 1
   - `grep -c "crossfadeslider" src/components/Properties/index.ts` returns 1
</verification>

<success_criteria>
- Both slider types compile without errors
- Bipolar Slider displays center line at configured center position
- Bipolar Slider fill extends from center to current value (not from min)
- Crossfade Slider displays A/B labels and horizontal orientation
- Property panels show element-specific configuration options
- Palette shows both new slider variants in Linear Controls category
</success_criteria>

<output>
After completion, create `.planning/phases/20-simple-controls/20-02-SUMMARY.md`
</output>
