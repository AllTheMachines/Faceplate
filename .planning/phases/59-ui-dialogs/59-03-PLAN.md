---
phase: 59-ui-dialogs
plan: 03
type: execute
wave: 3
depends_on: [59-01, 59-02]
files_modified:
  - src/components/Properties/shared/ElementStyleSection.tsx
  - src/components/Properties/SliderProperties.tsx
  - src/components/Properties/RangeSliderProperties.tsx
  - src/components/Properties/MultiSliderProperties.tsx
  - src/components/Properties/BipolarSliderProperties.tsx
  - src/components/Properties/CrossfadeSliderProperties.tsx
  - src/components/Properties/NotchedSliderProperties.tsx
  - src/components/Properties/ArcSliderProperties.tsx
  - src/components/Properties/ButtonProperties.tsx
  - src/components/Properties/IconButtonProperties.tsx
  - src/components/Properties/ToggleSwitchProperties.tsx
  - src/components/Properties/PowerButtonProperties.tsx
  - src/components/Properties/RockerSwitchProperties.tsx
  - src/components/Properties/RotarySwitchProperties.tsx
  - src/components/Properties/SegmentButtonProperties.tsx
  - src/components/Properties/meters/SharedMeterProperties.tsx
autonomous: true

must_haves:
  truths:
    - "User sees 'Manage styles...' button below style dropdown in all styled elements"
    - "Clicking 'Manage styles...' opens ManageElementStylesDialog with correct category"
    - "Style dropdown shows thumbnail preview of selected style below dropdown"
  artifacts:
    - path: "src/components/Properties/shared/ElementStyleSection.tsx"
      provides: "Reusable style section component with manage button and preview"
      min_lines: 60
      exports: ["ElementStyleSection"]
    - path: "src/components/Properties/SliderProperties.tsx"
      provides: "Slider properties using ElementStyleSection"
      contains: "ElementStyleSection"
  key_links:
    - from: "ElementStyleSection.tsx"
      to: "ManageElementStylesDialog"
      via: "button onClick"
      pattern: "setShowManageDialog\\(true\\)"
    - from: "SliderProperties.tsx"
      to: "ElementStyleSection"
      via: "component import"
      pattern: "ElementStyleSection"
---

<objective>
Extract ElementStyleSection component and integrate it into all PropertyPanel components that support SVG styling.

Purpose: Complete the UI-01, UI-03, UI-04 requirements for PropertyPanel integration with reduced duplication
Output: Reusable ElementStyleSection and all styled element property panels using it
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/59-ui-dialogs/59-CONTEXT.md
@.planning/phases/59-ui-dialogs/59-RESEARCH.md
@src/components/Properties/SliderProperties.tsx
@src/components/Properties/KnobProperties.tsx
@src/components/dialogs/ManageElementStylesDialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reusable ElementStyleSection component</name>
  <files>src/components/Properties/shared/ElementStyleSection.tsx</files>
  <action>
Create a reusable component that encapsulates the style dropdown, manage button, and thumbnail preview pattern:

```typescript
import React, { useState } from 'react'
import { ElementCategory, ElementStyle } from '../../../types/elementStyle'
import { ManageElementStylesDialog } from '../../dialogs'
import SafeSVG from '../../shared/SafeSVG'

interface ElementStyleSectionProps {
  category: ElementCategory
  currentStyleId: string | undefined
  styles: ElementStyle[]
  onStyleChange: (styleId: string | undefined) => void
  isPro: boolean
}

export function ElementStyleSection({
  category,
  currentStyleId,
  styles,
  onStyleChange,
  isPro
}: ElementStyleSectionProps) {
  const [showManageDialog, setShowManageDialog] = useState(false)
  const currentStyle = styles.find(s => s.id === currentStyleId)

  return (
    <>
      {/* Style dropdown */}
      <select
        value={currentStyleId || ''}
        onChange={(e) => onStyleChange(e.target.value || undefined)}
        className="w-full bg-gray-700 text-white rounded px-2 py-1 text-sm"
      >
        <option value="">No style</option>
        {styles.map(style => (
          <option key={style.id} value={style.id}>{style.name}</option>
        ))}
      </select>

      {/* Manage styles button - only for Pro */}
      {isPro && (
        <button
          onClick={() => setShowManageDialog(true)}
          className="w-full text-left text-sm text-blue-400 hover:text-blue-300 mt-1"
        >
          Manage styles...
        </button>
      )}

      {/* Thumbnail preview when style selected */}
      {currentStyle && (
        <div className="mt-2 p-2 bg-gray-900 rounded">
          <div className="w-16 h-16 mx-auto">
            <SafeSVG
              content={currentStyle.svgContent}
              style={{ width: '100%', height: '100%' }}
            />
          </div>
          <p className="text-xs text-gray-400 text-center mt-1">{currentStyle.name}</p>
        </div>
      )}

      {/* Manage dialog */}
      <ManageElementStylesDialog
        isOpen={showManageDialog}
        onClose={() => setShowManageDialog(false)}
        category={category}
      />
    </>
  )
}
```

Export from shared/index.ts if it exists, otherwise just use direct import.
  </action>
  <verify>
Component exists: `dir src\components\Properties\shared\ElementStyleSection.tsx`
Exports component: `findstr "export.*ElementStyleSection" src\components\Properties\shared\ElementStyleSection.tsx`
  </verify>
  <done>
ElementStyleSection component created with style dropdown, manage button, and thumbnail preview
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate ElementStyleSection into all property panels</name>
  <files>
src/components/Properties/SliderProperties.tsx
src/components/Properties/RangeSliderProperties.tsx
src/components/Properties/MultiSliderProperties.tsx
src/components/Properties/BipolarSliderProperties.tsx
src/components/Properties/CrossfadeSliderProperties.tsx
src/components/Properties/NotchedSliderProperties.tsx
src/components/Properties/ArcSliderProperties.tsx
src/components/Properties/ButtonProperties.tsx
src/components/Properties/IconButtonProperties.tsx
src/components/Properties/ToggleSwitchProperties.tsx
src/components/Properties/PowerButtonProperties.tsx
src/components/Properties/RockerSwitchProperties.tsx
src/components/Properties/RotarySwitchProperties.tsx
src/components/Properties/SegmentButtonProperties.tsx
src/components/Properties/meters/SharedMeterProperties.tsx
  </files>
  <action>
For each property panel file, replace inline style dropdown with ElementStyleSection:

1. Import ElementStyleSection:
```typescript
import { ElementStyleSection } from './shared/ElementStyleSection'
```

2. In the Style PropertySection, replace inline dropdown/button/preview with:
```typescript
<ElementStyleSection
  category="linear"  // or 'button', 'arc', 'meter' as appropriate
  currentStyleId={element.styleId}
  styles={linearStyles}  // from store, filtered by category
  onStyleChange={(styleId) => updateElement(element.id, { styleId })}
  isPro={isPro}
/>
```

Category mapping:
- SliderProperties, RangeSliderProperties, MultiSliderProperties, BipolarSliderProperties, CrossfadeSliderProperties, NotchedSliderProperties: category='linear'
- ArcSliderProperties: category='arc'
- ButtonProperties, IconButtonProperties, ToggleSwitchProperties, PowerButtonProperties, RockerSwitchProperties, RotarySwitchProperties, SegmentButtonProperties: category='button'
- SharedMeterProperties: category='meter'

3. Remove any existing inline manage button/preview code that's now handled by ElementStyleSection

4. Ensure styles are fetched from store using getStylesByCategory or filtered elementStyles
  </action>
  <verify>
All panels use ElementStyleSection:
`findstr /s "ElementStyleSection" src\components\Properties\*.tsx src\components\Properties\meters\*.tsx`
  </verify>
  <done>
All 15 property panel files use ElementStyleSection component
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify all panels and run TypeScript check</name>
  <files></files>
  <action>
1. Run TypeScript compilation to catch any import or type errors:
   `npx tsc --noEmit`

2. Fix any TypeScript errors that arise from the integration

3. Verify the pattern is consistent across all files by spot-checking:
   - SliderProperties has ElementStyleSection with category="linear"
   - ButtonProperties has ElementStyleSection with category="button"
   - SharedMeterProperties has ElementStyleSection with category="meter"
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit` exits without errors
Pattern verified: `findstr "category=" src\components\Properties\SliderProperties.tsx`
  </verify>
  <done>
All property panels compile without TypeScript errors and use consistent ElementStyleSection pattern
  </done>
</task>

</tasks>

<verification>
1. ElementStyleSection.tsx exists in shared/ with ~60+ lines
2. All 15 property panel files import and use ElementStyleSection
3. Thumbnail preview appears when a style is selected
4. ManageElementStylesDialog opens with correct category for each element type
5. TypeScript compiles without errors
</verification>

<success_criteria>
- Every styled element type shows "Manage styles..." below style dropdown (via ElementStyleSection)
- Clicking button opens ManageElementStylesDialog with correct category filter
- Selected styles show 64x64 thumbnail preview with name below
- User can navigate: PropertyPanel -> Manage styles -> Import -> Layer mapping -> Save -> New style in dropdown
- Pro license check preserved (Manage button visible only when isPro)
- Code duplication eliminated through shared component
</success_criteria>

<output>
After completion, create `.planning/phases/59-ui-dialogs/59-03-SUMMARY.md`
</output>
