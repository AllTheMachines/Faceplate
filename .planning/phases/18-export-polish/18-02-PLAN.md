---
phase: 18-export-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/services/export/cssGenerator.ts
  - src/services/export/jsGenerator.ts
  - src/services/export/htmlGenerator.ts
autonomous: true

must_haves:
  truths:
    - "Exported layout scales proportionally when plugin window resizes"
    - "Aspect ratio is maintained during scaling (no distortion)"
    - "Scale limits prevent UI from becoming too tiny or oversized"
  artifacts:
    - path: "src/services/export/cssGenerator.ts"
      provides: "Responsive scaling CSS with wrapper and container styles"
      contains: "#plugin-wrapper"
    - path: "src/services/export/jsGenerator.ts"
      provides: "Responsive scaling JavaScript with min/max limits"
      contains: "updateScale"
    - path: "src/services/export/htmlGenerator.ts"
      provides: "HTML structure with wrapper div for responsive scaling"
      contains: "plugin-wrapper"
  key_links:
    - from: "exported HTML"
      to: "exported CSS"
      via: "#plugin-wrapper and #plugin-container selectors"
      pattern: "plugin-wrapper|plugin-container"
---

<objective>
Implement responsive scaling CSS/JS for exported HTML

Purpose: Plugin UIs should scale proportionally when the JUCE WebView window is resized, maintaining aspect ratio with min/max limits to prevent extremes
Output: Updated CSS/JS generators that produce responsive scaling code
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-export-polish/18-RESEARCH.md

# Relevant source files
@src/services/export/cssGenerator.ts
@src/services/export/jsGenerator.ts
@src/services/export/htmlGenerator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add responsive wrapper CSS to cssGenerator</name>
  <files>src/services/export/cssGenerator.ts</files>
  <action>
Update `src/services/export/cssGenerator.ts` to add responsive scaling CSS:

1. **Update body and wrapper styles** in the generateCSS function:

Add after the reset section:
```css
/* Responsive Scaling */
body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #000;
}

#plugin-wrapper {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}
```

2. **Update #plugin-container styles:**
- Add `transform-origin: center center;` for proper scaling pivot
- Keep existing width/height/background

The generated CSS should support the JavaScript scaling that will be added to jsGenerator.

Per RESEARCH.md Pattern 2: Proportional Canvas Scaling
  </action>
  <verify>
- `npx tsc --noEmit` passes
- Generated CSS includes #plugin-wrapper styles
- Generated CSS includes transform-origin on #plugin-container
  </verify>
  <done>Responsive scaling CSS added to cssGenerator with wrapper positioning and transform-origin</done>
</task>

<task type="auto">
  <name>Task 2: Add responsive scaling JS to jsGenerator</name>
  <files>src/services/export/jsGenerator.ts</files>
  <action>
Update `src/services/export/jsGenerator.ts` to add a new function:

1. **Add generateResponsiveScaleJS function:**

```typescript
export function generateResponsiveScaleJS(
  canvasWidth: number,
  canvasHeight: number,
  minScale: number = 0.25,
  maxScale: number = 2.0
): string {
  return `// Responsive scaling for plugin window resize
(function() {
  const CANVAS_WIDTH = ${canvasWidth};
  const CANVAS_HEIGHT = ${canvasHeight};
  const MIN_SCALE = ${minScale};
  const MAX_SCALE = ${maxScale};

  function updateScale() {
    const container = document.getElementById('plugin-container');
    const wrapper = document.getElementById('plugin-wrapper');
    if (!container || !wrapper) return;

    const scaleX = wrapper.clientWidth / CANVAS_WIDTH;
    const scaleY = wrapper.clientHeight / CANVAS_HEIGHT;

    // Maintain aspect ratio - use smaller scale
    let scale = Math.min(scaleX, scaleY);

    // Apply min/max limits
    scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, scale));

    container.style.transform = \`scale(\${scale})\`;
  }

  window.addEventListener('resize', updateScale);
  window.addEventListener('load', updateScale);
  updateScale();
})();
`;
}
```

2. **Export the function** from the module

Per RESEARCH.md Pattern 2: Proportional Canvas Scaling with default limits 0.25-2.0
  </action>
  <verify>
- `npx tsc --noEmit` passes
- Function exported from jsGenerator.ts
- Generated JS includes updateScale function with min/max limits
  </verify>
  <done>Responsive scaling JS function added with aspect ratio maintenance and configurable min/max limits</done>
</task>

<task type="auto">
  <name>Task 3: Update HTML structure for responsive wrapper</name>
  <files>src/services/export/htmlGenerator.ts</files>
  <action>
Update `src/services/export/htmlGenerator.ts` generateHTML function:

1. **Wrap plugin-container in plugin-wrapper div:**

Update the body content from:
```html
<body>
  <div id="plugin-container">
    ${elementsHTML}
  </div>
```

To:
```html
<body>
  <div id="plugin-wrapper">
    <div id="plugin-container">
      ${elementsHTML}
    </div>
  </div>
```

This provides the wrapper element needed for CSS flexbox centering and JavaScript scale calculations.

Note: The responsive scaling script will be included by codeGenerator.ts in a later plan.
  </action>
  <verify>
- `npx tsc --noEmit` passes
- Generated HTML includes plugin-wrapper div wrapping plugin-container
  </verify>
  <done>HTML generator updated to include plugin-wrapper div for responsive scaling support</done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` to verify TypeScript compilation
2. Check cssGenerator.ts produces CSS with #plugin-wrapper and transform-origin
3. Check jsGenerator.ts exports generateResponsiveScaleJS
4. Check htmlGenerator.ts outputs plugin-wrapper div
</verification>

<success_criteria>
- CSS includes responsive wrapper styles (#plugin-wrapper with flexbox centering)
- CSS includes transform-origin: center center on #plugin-container
- JS includes updateScale function with resize listener and min/max limits
- HTML wraps plugin-container in plugin-wrapper div
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-export-polish/18-02-SUMMARY.md`
</output>
