---
phase: 18-export-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/services/export/svgOptimizer.ts
autonomous: true

must_haves:
  truths:
    - "SVG content can be optimized using SVGO with safe-only settings"
    - "Optimization preserves visual appearance (no functional changes)"
    - "Size savings can be calculated and reported"
  artifacts:
    - path: "src/services/export/svgOptimizer.ts"
      provides: "SVGO wrapper with safe optimization defaults"
      exports: ["optimizeSVG", "OptimizationResult"]
  key_links:
    - from: "src/services/export/svgOptimizer.ts"
      to: "svgo"
      via: "import { optimize } from 'svgo'"
      pattern: "import.*from 'svgo'"
---

<objective>
Implement SVGO wrapper with safe optimization settings

Purpose: Enable SVG content optimization before export without breaking visual appearance or interactive functionality (knob rotation, ID references)
Output: svgOptimizer.ts utility that wraps SVGO with conservative settings
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-export-polish/18-RESEARCH.md

# Relevant source files
@src/services/export/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install SVGO dependency</name>
  <files>package.json</files>
  <action>
Install SVGO as a production dependency:

```bash
npm install svgo
```

SVGO v4.0.0+ is ESM-only and includes TypeScript types. No @types package needed.
  </action>
  <verify>
- `npm ls svgo` shows svgo installed
- `grep '"svgo"' package.json` shows the dependency
  </verify>
  <done>SVGO installed as dependency in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create SVGO wrapper with safe defaults</name>
  <files>src/services/export/svgOptimizer.ts</files>
  <action>
Create `src/services/export/svgOptimizer.ts` with:

1. **OptimizationResult interface:**
```typescript
export interface OptimizationResult {
  optimizedSvg: string;
  originalSize: number;
  optimizedSize: number;
  savingsPercent: number;
}
```

2. **optimizeSVG function:**
- Import `optimize` from 'svgo'
- Configure preset-default with safe overrides:
  - removeViewBox: false (keep scalability)
  - cleanupIds: false (preserve ID references for knob rotation)
  - removeDesc: false (keep accessibility)
  - convertShapeToPath: false (don't convert shapes that may have event handlers)
  - convertTransform precision: 7 (safe precision)
- Calculate original and optimized sizes using `new Blob([content]).size`
- Return OptimizationResult with savings percentage

3. **optimizeMultipleSVGs function:**
- Takes array of SVG strings
- Returns combined stats (total original, total optimized, array of optimized strings)
- Used when optimizing multiple assets in export

Per RESEARCH.md Pattern 1: Safe SVGO Optimization
  </action>
  <verify>
- `npx tsc --noEmit` passes
- File exports optimizeSVG and OptimizationResult
- Safe overrides are configured (removeViewBox: false, cleanupIds: false)
  </verify>
  <done>SVGO wrapper created with safe optimization settings that preserve visual appearance and ID references</done>
</task>

</tasks>

<verification>
1. Run `npm ls svgo` to confirm installation
2. Run `npx tsc --noEmit` to verify TypeScript compilation
3. Manually verify svgOptimizer.ts has safe overrides configured
</verification>

<success_criteria>
- SVGO dependency installed
- svgOptimizer.ts exports optimizeSVG function
- Safe overrides configured (removeViewBox: false, cleanupIds: false)
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-export-polish/18-01-SUMMARY.md`
</output>
