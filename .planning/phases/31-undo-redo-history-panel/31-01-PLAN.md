---
phase: 31-undo-redo-history-panel
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/App.tsx
  - src/components/Layout/ThreePanelLayout.tsx
  - src/hooks/useHistoryPanel.ts
  - src/components/History/HistoryPanel.tsx
  - src/components/History/HistoryEntry.tsx
  - src/components/History/index.ts
autonomous: true

must_haves:
  truths:
    - "User can see a bottom panel showing undo/redo history"
    - "Panel shows list of past state changes"
    - "Panel is collapsible and resizable"
  artifacts:
    - path: "src/components/History/HistoryPanel.tsx"
      provides: "Main history panel component with scrollable list"
      min_lines: 50
    - path: "src/components/History/HistoryEntry.tsx"
      provides: "Single history entry display with action type and affected elements"
      min_lines: 40
  key_links:
    - from: "src/components/History/HistoryPanel.tsx"
      to: "useAppStore.temporal"
      via: "useStore from zustand with temporal selector"
      pattern: "useStore\\(useAppStore\\.temporal"
    - from: "src/App.tsx"
      to: "react-resizable-panels"
      via: "PanelGroup/Panel imports"
      pattern: "PanelGroup|Panel"
---

<objective>
Install resizable panel infrastructure and create the history panel components for Phase 31.

Purpose: Enable users to see a visual debug panel showing every state change in the undo/redo history. This provides transparency into what's happening and enables time-travel debugging.

Output: Working bottom panel with history entries that display past state changes. Panel is collapsible and resizable.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/31-undo-redo-history-panel/31-RESEARCH.md

Key existing files:
@src/store/index.ts - Zustand store with zundo temporal middleware (50-state limit, partialize config)
@src/App.tsx - Main app structure with DndContext and ThreePanelLayout
@src/components/Layout/ThreePanelLayout.tsx - Current three-panel grid layout
@src/components/Layout/LeftPanel.tsx - Shows how temporal state is accessed reactively (lines 13-15)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-resizable-panels and create layout infrastructure</name>
  <files>
    package.json
    src/App.tsx
    src/components/Layout/ThreePanelLayout.tsx
  </files>
  <action>
1. Install react-resizable-panels:
   ```bash
   npm install react-resizable-panels
   ```

2. Update App.tsx to wrap content with vertical PanelGroup:
   - Import Panel, PanelGroup, PanelResizeHandle from 'react-resizable-panels'
   - Wrap the DndContext content in a PanelGroup with direction="vertical"
   - Top Panel (defaultSize={80}, minSize={40}) contains existing DndContext + ThreePanelLayout
   - PanelResizeHandle (h-1, bg-gray-700, hover:bg-blue-500, cursor-ns-resize)
   - Bottom Panel (defaultSize={20}, minSize={10}, maxSize={50}, collapsible={true}, collapsedSize={0}) contains HistoryPanel placeholder

3. ThreePanelLayout remains unchanged - it's already a clean component that receives children

4. The bottom panel should initially render a placeholder div with text "History Panel" until the actual component is built
  </action>
  <verify>
    npm run dev starts without errors
    The app shows the existing three-panel layout with a resizable divider below it
    Dragging the divider resizes the bottom panel area
    Bottom panel can be collapsed to zero height
  </verify>
  <done>
    react-resizable-panels installed and App.tsx updated with vertical PanelGroup structure
    Bottom panel area is visible, resizable, and collapsible
  </done>
</task>

<task type="auto">
  <name>Task 2: Create HistoryPanel and HistoryEntry components</name>
  <files>
    src/hooks/useHistoryPanel.ts
    src/components/History/HistoryPanel.tsx
    src/components/History/HistoryEntry.tsx
    src/components/History/index.ts
  </files>
  <action>
1. Create src/hooks/useHistoryPanel.ts:
   - Import useState from 'react'
   - Create and export useHistoryPanel hook that manages:
     - isPanelVisible: boolean state (default true)
     - togglePanel: function to toggle visibility
   - Return { isPanelVisible, setIsPanelVisible, togglePanel }

   This hook will be extended in Plan 02 to add the keyboard shortcut.

2. Create src/components/History/HistoryEntry.tsx:
   - Interface HistoryEntryProps: index, isCurrent, isFuture, elementCount, timestamp (optional for now)
   - Display entry with:
     - Index number (left side)
     - Action indicator: "PAST" (gray) or "FUTURE" (blue) or "CURRENT" (green)
     - Element count: "X element(s)"
   - Current entry has bg-blue-900, others have hover:bg-gray-800
   - onClick prop for time-travel (to be wired in Plan 02)

3. Create src/components/History/HistoryPanel.tsx:
   - Use the EXISTING codebase pattern for accessing temporal state (from LeftPanel.tsx):
     ```typescript
     import { useStore } from 'zustand'
     import { useStore as useAppStore } from '../../store'

     // Subscribe to pastStates and futureStates reactively
     const pastStates = useStore(useAppStore.temporal, (state) => state.pastStates)
     const futureStates = useStore(useAppStore.temporal, (state) => state.futureStates)
     ```
   - Do NOT create a custom useTemporalStore hook - use the standard zustand pattern above
   - Render scrollable container (flex-col, overflow-y-auto, bg-gray-800)
   - Header row: "History" title, count of past/future states
   - Map over pastStates.map((state, i) => <HistoryEntry key={...} isFuture={false} index={i} ... />)
   - Current state indicator (index = pastStates.length, highlighted)
   - Map over futureStates.map((state, i) => <HistoryEntry key={...} isFuture={true} index={pastStates.length + 1 + i} ... />)
   - Empty state: "No history yet"

4. Create src/components/History/index.ts:
   - Export { HistoryPanel } from './HistoryPanel'
   - Export { HistoryEntry } from './HistoryEntry'

5. Update App.tsx to import and render HistoryPanel in the bottom Panel instead of placeholder
  </action>
  <verify>
    npm run dev shows history panel in bottom area
    Adding/removing/moving elements on canvas causes new entries to appear in history panel
    Past states show as "PAST" entries
    Current state is highlighted
    Future states appear after undo operations
  </verify>
  <done>
    HistoryPanel displays scrollable list of past and future states
    Entries update reactively when state changes
    Visual distinction between past (undoable), current, and future (redoable) entries
  </done>
</task>

</tasks>

<verification>
1. npm run dev starts without errors
2. Bottom panel is visible below the main canvas area
3. Panel is resizable by dragging the divider
4. Panel can be collapsed to zero height
5. History entries appear when adding/modifying elements
6. Entries are reactive - they update as you make changes
7. Past and future states are visually distinguished
</verification>

<success_criteria>
- react-resizable-panels installed and integrated into App.tsx
- Vertical panel layout working with collapsible bottom panel
- HistoryPanel shows scrollable list of state changes using standard zustand pattern
- HistoryEntry displays state information with past/current/future distinction
</success_criteria>

<output>
After completion, create `.planning/phases/31-undo-redo-history-panel/31-01-SUMMARY.md`
</output>
