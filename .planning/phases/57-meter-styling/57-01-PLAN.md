---
phase: 57-meter-styling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elementStyle.ts
  - src/types/elements/displays.ts
autonomous: true

must_haves:
  truths:
    - "MeterLayers supports zone fill layers (fill-green, fill-yellow, fill-red)"
    - "All professional meters have styleId and colorOverrides properties"
    - "All professional meters have peakHoldDuration property for configurable peak hold"
    - "TypeScript compiles without errors for meter type definitions"
  artifacts:
    - path: "src/types/elementStyle.ts"
      provides: "MeterLayers with zone fill support"
      contains: "fill-green"
    - path: "src/types/elements/displays.ts"
      provides: "styleId and peakHoldDuration on BaseProfessionalMeterConfig"
      contains: "peakHoldDuration"
  key_links:
    - from: "src/types/elements/displays.ts"
      to: "src/types/elementStyle.ts"
      via: "ColorOverrides import"
      pattern: "ColorOverrides"
---

<objective>
Add SVG styling type support to professional meters by extending MeterLayers with zone fill layers and adding styleId/colorOverrides/peakHoldDuration to BaseProfessionalMeterConfig.

Purpose: Enable all 24 professional meter types to use SVG styles with multi-zone color fills (green/yellow/red) and configurable peak hold duration, following user decisions from CONTEXT.md.
Output: Updated type definitions ready for StyledMeterRenderer implementation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/57-meter-styling/57-CONTEXT.md
@.planning/phases/57-meter-styling/57-RESEARCH.md
@src/types/elementStyle.ts
@src/types/elements/displays.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend MeterLayers with zone fill layers</name>
  <files>src/types/elementStyle.ts</files>
  <action>
Update the MeterLayers interface to support multi-zone fill layers for professional audio meters:

```typescript
export interface MeterLayers {
  body?: string       // Meter background/container
  fill?: string       // Level fill region (single fill fallback)
  'fill-green'?: string  // Green zone fill layer (low levels)
  'fill-yellow'?: string // Yellow zone fill layer (medium levels, -18dB threshold)
  'fill-red'?: string    // Red zone fill layer (high levels, -6dB threshold)
  scale?: string      // Scale markings (rendered statically if present)
  peak?: string       // Peak hold indicator (positioned at peak value)
  segments?: string   // Segmented meter elements (legacy)
}
```

Key points:
- Zone layers are optional - SVGs can have just 'fill' as fallback
- Zone naming follows Phase 56 patterns (fill-green, fill-yellow, fill-red)
- All properties remain optional (backwards compatible)
- 'body' is the background layer (consistent with other categories)
- 'segments' kept for legacy compatibility

Also add meter types to ELEMENT_TYPE_TO_CATEGORY mapping if not already present. Check and add any missing professional meter types:
- rmsmetermo, rmsmeterstereo
- vumetermono, vumeterstereo
- ppmtype1mono, ppmtype1stereo
- ppmtype2mono, ppmtype2stereo
- truepeakmetermono, truepeakmeterstereo
- lufsmomentarymono, lufsmomentarystereo
- lufsshorttermono, lufsshortterstereo
- lufsintegratedmono, lufsintegratedstereo
- k12metermono, k12meterstereo
- k14metermono, k14meterstereo
- k20metermono, k20meterstereo
- correlationmeter
- stereowidthmeter
  </action>
  <verify>Run `npx tsc --noEmit` - should compile without errors</verify>
  <done>MeterLayers has fill-green, fill-yellow, fill-red properties; all professional meter types mapped to 'meter' category</done>
</task>

<task type="auto">
  <name>Task 2: Add styleId, colorOverrides, and peakHoldDuration to BaseProfessionalMeterConfig</name>
  <files>src/types/elements/displays.ts</files>
  <action>
Update BaseProfessionalMeterConfig to include SVG styling properties and peak hold duration:

1. Import ColorOverrides from elementStyle.ts at top of file:
```typescript
import { ColorOverrides } from '../elementStyle'
```

2. Add styleId, colorOverrides, and peakHoldDuration to BaseProfessionalMeterConfig:
```typescript
interface BaseProfessionalMeterConfig extends BaseElementConfig {
  // ... existing properties ...

  // SVG Styling (optional - when set, uses SVG renderer)
  styleId?: string

  // Per-instance color overrides (only used when styleId is set)
  // Allows overriding specific layer colors (e.g., peak indicator color)
  colorOverrides?: ColorOverrides

  // Peak hold duration in milliseconds (how long peak indicator stays before dropping)
  // Default: 1000ms, Range: 500-5000ms
  // User decision from CONTEXT.md: configurable per-element via PropertyPanel
  peakHoldDuration?: number
}
```

Key points:
- styleId is optional - undefined means use default CSS segmented renderer
- colorOverrides follows same pattern as buttons/sliders (Phase 55-56)
- peakHoldDuration defaults to 1000ms when undefined (renderer handles default)
- peakHoldDuration range is 500-5000ms (validated in PropertyPanel, not type)
- All 24 professional meter types inherit these properties automatically
- This satisfies CONTEXT.md locked decision: "Peak hold duration: configurable per-element via PropertyPanel property"
  </action>
  <verify>Run `npx tsc --noEmit` - should compile without errors; grep for 'peakHoldDuration' in displays.ts shows it in BaseProfessionalMeterConfig</verify>
  <done>BaseProfessionalMeterConfig has styleId, colorOverrides, and peakHoldDuration properties; all 24 meter types inherit them</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. MeterLayers in elementStyle.ts includes 'fill-green', 'fill-yellow', 'fill-red'
3. BaseProfessionalMeterConfig has 'styleId?: string', 'colorOverrides?: ColorOverrides', and 'peakHoldDuration?: number'
4. All professional meter types in ELEMENT_TYPE_TO_CATEGORY map to 'meter'
</verification>

<success_criteria>
- TypeScript compiles without errors
- MeterLayers supports zone fill layers (fill-green, fill-yellow, fill-red) with single fill fallback
- All 24 professional meter types have styleId, colorOverrides, and peakHoldDuration available
- Type changes are backwards compatible (all properties optional)
</success_criteria>

<output>
After completion, create `.planning/phases/57-meter-styling/57-01-SUMMARY.md`
</output>
