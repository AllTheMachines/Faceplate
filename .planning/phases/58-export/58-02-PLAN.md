---
phase: 58-export
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/services/export/cssGenerator.ts
autonomous: true

must_haves:
  truths:
    - "Styled slider CSS rules position layers and animate thumb/fill"
    - "Styled button CSS rules handle opacity toggle without transitions"
    - "Styled meter CSS rules position zone fills with clip-path animation"
  artifacts:
    - path: "src/services/export/cssGenerator.ts"
      provides: "CSS rules for styled-slider, styled-button, styled-meter"
      contains: "styled-slider|styled-button|styled-meter"
  key_links:
    - from: "cssGenerator.ts"
      to: "htmlGenerator.ts"
      via: "class name convention"
      pattern: "styled-slider|styled-button|styled-meter"
---

<objective>
Add CSS rules for styled sliders, buttons, and meters to the export system.

Purpose: Provide positioning, z-index layering, and animation transitions for SVG-styled elements in exported JUCE bundles.

Output: CSS rule blocks for styled-slider, styled-button, and styled-meter classes that match the HTML structure from Plan 01.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/58-export/58-CONTEXT.md
@.planning/phases/58-export/58-RESEARCH.md

# Key source files
@src/services/export/cssGenerator.ts (styledKnobStyles at line 194)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add styled slider CSS rules</name>
  <files>src/services/export/cssGenerator.ts</files>
  <action>
Add CSS rules for styled sliders following the styledKnobStyles pattern (line 194):

1. Create styledSliderStyles string constant after styledKnobStyles:

```css
/* Styled Slider Layers */
.styled-slider {
  position: relative;
  width: 100%;
  height: 100%;
}

.styled-slider-container {
  position: relative;
  width: 100%;
  height: 100%;
}

.slider-layer {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.slider-layer svg {
  width: 100%;
  height: 100%;
}

/* Track - static background */
.slider-track {
  z-index: 1;
}

/* Fill - animated via clip-path (JS updates) */
.slider-fill {
  z-index: 2;
  transition: clip-path 0.05s ease-out;
}

/* Thumb - animated via transform translate (JS updates) */
.slider-thumb {
  z-index: 3;
  transition: transform 0.05s ease-out;
}

/* Range Slider - dual thumbs */
.styled-rangeslider .slider-thumb-low {
  z-index: 3;
}

.styled-rangeslider .slider-thumb-high {
  z-index: 3;
}

.styled-rangeslider .slider-thumb-low.active {
  z-index: 4;
}

.styled-rangeslider .slider-thumb-high.active {
  z-index: 4;
}
```

2. Add this to the CSS output concatenation (find where styledKnobStyles is added and add styledSliderStyles after it)

Key points:
- GPU-accelerated transitions for thumb (transform) and fill (clip-path)
- 0.05s ease-out matches styledKnobStyles timing
- Z-index ordering: track=1, fill=2, thumb=3 (thumb on top)
- Range slider active thumb gets z-index 4 to stay on top when dragging
  </action>
  <verify>
    - grep for "styled-slider" in cssGenerator.ts shows CSS rules defined
    - grep for "slider-layer" shows layer classes
    - grep for "slider-thumb" shows thumb rules with transition
  </verify>
  <done>
    - styledSliderStyles constant exists with layer positioning CSS
    - CSS includes transitions for thumb (transform) and fill (clip-path)
    - CSS added to export output
  </done>
</task>

<task type="auto">
  <name>Task 2: Add styled button CSS rules</name>
  <files>src/services/export/cssGenerator.ts</files>
  <action>
Add CSS rules for styled buttons and switches:

```css
/* Styled Button Layers */
.styled-button {
  position: relative;
  width: 100%;
  height: 100%;
}

.styled-button-container {
  position: relative;
  width: 100%;
  height: 100%;
}

.button-layer {
  position: absolute;
  inset: 0;
  pointer-events: none;
  /* CRITICAL: No transition - instant opacity toggle per CONTEXT.md decision */
  transition: none;
}

.button-layer svg {
  width: 100%;
  height: 100%;
}

/* Button state layers - fixed z-index ordering */
.button-normal {
  z-index: 1;
}

.button-pressed {
  z-index: 2;
}

.button-icon {
  z-index: 3;
}

.button-label {
  z-index: 4;
}

/* Toggle Switch layers */
.button-on {
  z-index: 2;
}

.button-off {
  z-index: 1;
}

.button-indicator {
  z-index: 3;
}

/* Power Button LED */
.button-led {
  z-index: 3;
}

/* Rocker Switch position layers */
.button-position-0,
.button-position-1,
.button-position-2 {
  z-index: 1;
}

/* Rotary Switch layers */
.button-base {
  z-index: 1;
}

.button-selector {
  z-index: 2;
  transition: transform 0.1s ease-out;
  transform-origin: center center;
}

/* Segment Button highlight */
.button-highlight {
  z-index: 2;
  transition: clip-path 0.1s ease-out;
}
```

Key points:
- transition: none on button-layer (CRITICAL from CONTEXT.md - instant toggle)
- Fixed z-index ordering: background, state layers, icon/indicator on top
- Rotary selector has transform transition for rotation animation
- Segment highlight has clip-path transition for selection slide
  </action>
  <verify>
    - grep for "styled-button" in cssGenerator.ts shows CSS rules
    - grep for "transition: none" shows instant toggle rule
    - grep for "button-layer" shows layer class
  </verify>
  <done>
    - styledButtonStyles constant exists with button CSS rules
    - Opacity toggle uses NO transition (instant)
    - Rotary selector and segment highlight have appropriate transitions
  </done>
</task>

<task type="auto">
  <name>Task 3: Add styled meter CSS rules</name>
  <files>src/services/export/cssGenerator.ts</files>
  <action>
Add CSS rules for styled meters:

```css
/* Styled Meter Layers */
.styled-meter {
  position: relative;
  width: 100%;
  height: 100%;
}

.styled-meter-container {
  position: relative;
  width: 100%;
  height: 100%;
}

.meter-layer {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.meter-layer svg {
  width: 100%;
  height: 100%;
}

/* Meter body - static background */
.meter-body {
  z-index: 1;
}

/* Zone fill layers - animated via clip-path (JS updates) */
.meter-fill-green {
  z-index: 2;
  transition: clip-path 0.05s ease-out;
}

.meter-fill-yellow {
  z-index: 3;
  transition: clip-path 0.05s ease-out;
}

.meter-fill-red {
  z-index: 4;
  transition: clip-path 0.05s ease-out;
}

/* Single fill fallback (if no zone layers) */
.meter-fill {
  z-index: 2;
  transition: clip-path 0.05s ease-out;
}

/* Scale markings - on top of fills */
.meter-scale {
  z-index: 5;
}

/* Peak hold indicator - animated via bottom positioning */
.meter-peak {
  position: absolute;
  left: 0;
  right: 0;
  z-index: 6;
  transition: bottom 0.05s ease-out;
}
```

Key points:
- Z-index ordering: body=1, fills=2-4 (stacked zones), scale=5, peak=6
- Zone fills use clip-path transition (0.05s matches slider/knob timing)
- Peak indicator uses bottom positioning with transition
- Stacked zones: green below yellow below red (red only visible at top)

Add horizontal meter orientation support:
```css
/* Horizontal meter - container rotated -90deg */
.styled-meter[data-orientation="horizontal"] .styled-meter-container {
  transform: rotate(-90deg);
  transform-origin: center center;
}
```

Ensure all three style blocks are added to the main CSS output string concatenation where styledKnobStyles is included.
  </action>
  <verify>
    - grep for "styled-meter" in cssGenerator.ts shows CSS rules
    - grep for "meter-fill-green\|meter-fill-yellow\|meter-fill-red" shows zone classes
    - grep for "meter-peak" shows peak indicator rules
    - TypeScript compiles: npm run build
  </verify>
  <done>
    - styledMeterStyles constant exists with meter CSS rules
    - Zone fills have clip-path transitions
    - Peak indicator has bottom positioning transition
    - Horizontal orientation handled via rotation transform
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. TypeScript compiles: `npm run build` exits 0
2. CSS rules for all categories:
   - `grep -c "styled-slider\|styled-button\|styled-meter" src/services/export/cssGenerator.ts` shows multiple matches
3. Key animation rules present:
   - `grep "transition: clip-path" src/services/export/cssGenerator.ts` for fill animations
   - `grep "transition: transform" src/services/export/cssGenerator.ts` for thumb/selector
   - `grep "transition: none" src/services/export/cssGenerator.ts` for instant button toggle
4. All style constants used in output:
   - Verify styledSliderStyles, styledButtonStyles, styledMeterStyles are concatenated in final CSS
</verification>

<success_criteria>
- [ ] styledSliderStyles CSS rules defined (container, layers, transitions)
- [ ] styledButtonStyles CSS rules defined (instant opacity toggle, no transition)
- [ ] styledMeterStyles CSS rules defined (zone fills, peak indicator, horizontal rotation)
- [ ] All style constants included in CSS output concatenation
- [ ] Z-index ordering correct for each category
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/58-export/58-02-SUMMARY.md`
</output>
