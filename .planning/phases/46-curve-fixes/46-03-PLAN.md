---
phase: 46-curve-fixes
plan: 03
type: execute
wave: 2
depends_on: [46-01, 46-02]
files_modified:
  - src/components/elements/renderers/displays/curves/LFODisplayRenderer.tsx
  - src/components/Properties/curves/LFODisplayProperties.tsx
  - src/utils/curveRendering.ts
autonomous: true

must_haves:
  truths:
    - "LFO Display shows visible waveform on canvas"
    - "LFO Display updates when shape property changes"
    - "All 5 curve elements render consistently with same handle styling"
    - "All 5 curve elements respond to property changes immediately"
  artifacts:
    - path: "src/components/elements/renderers/displays/curves/LFODisplayRenderer.tsx"
      provides: "LFO Display canvas rendering with visible waveform"
  key_links:
    - from: "LFODisplayRenderer"
      to: "shape switch statement"
      via: "waveform calculation"
---

<objective>
Fix LFO Display element and perform final verification of all 5 curve elements.

Purpose: LFO Display is the simplest curve element (no handles, just waveform). After fixing it, verify all 5 elements have consistent behavior and styling per CONTEXT.md.

Output: All 5 curve elements render visibly with consistent handle styling and hover behavior.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-curve-fixes/46-CONTEXT.md
@.planning/phases/46-curve-fixes/46-RESEARCH.md
@.planning/phases/46-curve-fixes/46-01-SUMMARY.md
@.planning/phases/46-curve-fixes/46-02-SUMMARY.md
@src/components/elements/renderers/displays/curves/LFODisplayRenderer.tsx
@src/utils/curveRendering.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Diagnose and fix LFO Display visibility</name>
  <files>
    src/components/elements/renderers/displays/curves/LFODisplayRenderer.tsx
    src/components/Properties/curves/LFODisplayProperties.tsx
  </files>
  <action>
    Systematically verify LFO Display rendering:

    1. **Canvas Setup Verification:**
       - Confirm `useCanvasSetup(width, height, canvasScale)` is called
       - Verify canvas ref and ctx guard

    2. **Waveform Calculation:**
       - Verify shape switch statement covers all 8 shapes:
         - sine, triangle, saw-up, saw-down, square, pulse, sample-hold, smooth-random
       - Check value range is -1 to 1
       - Verify centerY and amplitude calculations

    3. **Waveform Drawing:**
       - Check waveformColor is valid and contrasts with backgroundColor
       - Verify lineWidth > 0
       - For square/pulse/sample-hold: verify hard-edge drawing (horizontal then vertical)
       - For smooth shapes: verify lineTo creates smooth appearance

    4. **Fill Under Curve:**
       - If showFill enabled, verify fill path closes correctly
       - Check fillColor is valid

    5. **Apply Fixes:**
       - If waveform invisible: Check strokeStyle and lineWidth
       - If wrong shape: Verify shape prop flows through from config
       - If jerky appearance: Check sample count (200 should be smooth)

    **Per CONTEXT.md decisions:**
    - No handles (LFO is view-only, no interaction)
    - Animation speed property (future - not in this fix)
    - Updates instantly when parameters change
  </action>
  <verify>
    - Add LFO Display element to canvas from palette
    - Waveform is visible (sine wave by default)
    - Change shape in properties - waveform updates to new shape
    - Test all 8 shapes: sine, triangle, saw-up, saw-down, square, pulse, sample-hold, smooth-random
    - Toggle showFill - fill appears under waveform
    - Toggle showGrid - grid appears behind waveform
  </verify>
  <done>
    LFO Display shows visible waveform that updates when shape changes
  </done>
</task>

<task type="auto">
  <name>Task 2: Final verification and consistency check</name>
  <files>
    src/utils/curveRendering.ts
    src/components/elements/renderers/displays/curves/EQCurveRenderer.tsx
    src/components/elements/renderers/displays/curves/CompressorCurveRenderer.tsx
    src/components/elements/renderers/displays/curves/EnvelopeDisplayRenderer.tsx
    src/components/elements/renderers/displays/curves/FilterResponseRenderer.tsx
    src/components/elements/renderers/displays/curves/LFODisplayRenderer.tsx
  </files>
  <action>
    Verify all 5 curve elements have consistent behavior:

    1. **Handle Consistency (for elements with handles):**
       - EQ Curve: Multiple band handles
       - Compressor Curve: Single threshold handle
       - Envelope Display: 3 control point handles
       - Filter Response: Single cutoff handle
       - All should use 8px base size, 10px hover size (check drawHandle in curveRendering.ts)
       - All should have white stroke border
       - All should change cursor to 'pointer' on hover

    2. **Color Defaults:**
       - Verify all elements have visible default colors from factory functions
       - curveColor: '#00ff88' (bright green)
       - backgroundColor: '#1a1a1a' (dark gray)
       - handleColor: '#00ff88', handleHoverColor: '#00ffff'
       - These should contrast well

    3. **Property Updates:**
       - All elements should update immediately when properties change
       - Check useLayoutEffect dependency arrays include all used props

    4. **Grid Consistency:**
       - EQ Curve, Filter Response: frequency grid (log scale)
       - Compressor, Envelope, LFO: linear grid
       - Grid toggling works on all

    5. **Update buildInfo.ts:**
       - Run `date "+%d %b %H:%M CET"` to get current time
       - Update lastUpdated in src/buildInfo.ts

    **Document any fixes made for consistency.**
  </action>
  <verify>
    Comprehensive test of all 5 curve elements:

    1. Add each element to canvas:
       - EQ Curve - visible curve, 3 handles visible, hover works
       - Compressor Curve - visible transfer curve, handle visible, hover works
       - Envelope Display - visible ADSR, 3 handles visible, hover works
       - Filter Response - visible filter curve, handle visible, hover works
       - LFO Display - visible waveform, shape changes work

    2. Property panel tests:
       - Change colors on each - curves update
       - Change lineWidth - thickness changes
       - Toggle grids - grids appear/disappear
       - Specific params (threshold, cutoff, ADSR values, shape) - curves update

    3. Hover consistency:
       - All handles use same size (8px -> 10px on hover)
       - All show pointer cursor on hover
       - All have visible hover highlight effect
  </verify>
  <done>
    All 5 curve elements render visibly with consistent handle styling and hover behavior
  </done>
</task>

</tasks>

<verification>
**Full Integration Test:**
1. Start dev server: `npm run dev`
2. Create new project
3. Add one of each curve element to canvas:
   - EQ Curve (from Interactive Curves)
   - Compressor Curve
   - Envelope Display
   - Filter Response
   - LFO Display
4. Verify ALL are visible
5. Verify handles on 4/5 elements (LFO has no handles)
6. Test hover on each element with handles
7. Modify properties on each - verify immediate updates
8. Export to HTML preview - verify curves render in export

**Requirements Coverage:**
- CRV-01: EQ Curve renders and is functional - handles hover
- CRV-02: Compressor Curve renders and is functional - handle hovers
- CRV-03: Envelope Display renders and is functional - handles hover
- CRV-04: LFO Display renders and is functional - shape updates
- CRV-05: Filter Response renders and is functional - handle hovers
</verification>

<success_criteria>
1. LFO Display shows visible waveform for all 8 shape types
2. All 5 curve elements visible when added to canvas
3. All 4 elements with handles show 8px base / 10px hover size
4. All handles change cursor to 'pointer' and highlight on hover
5. All elements update immediately when properties change
6. All grids toggle correctly
7. Export preview shows all curves correctly
</success_criteria>

<output>
After completion, create `.planning/phases/46-curve-fixes/46-03-SUMMARY.md`
</output>
