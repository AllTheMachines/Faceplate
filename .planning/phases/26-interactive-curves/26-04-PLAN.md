---
phase: 26-interactive-curves
plan: 04
type: execute
wave: 2
depends_on: ["26-01"]
files_modified:
  - src/components/elements/renderers/displays/curves/LFODisplayRenderer.tsx
  - src/components/elements/renderers/displays/curves/index.ts
  - src/components/elements/renderers/index.ts
  - src/components/Properties/curves/EQCurveProperties.tsx
  - src/components/Properties/curves/CompressorCurveProperties.tsx
  - src/components/Properties/curves/EnvelopeDisplayProperties.tsx
  - src/components/Properties/curves/LFODisplayProperties.tsx
  - src/components/Properties/curves/FilterResponseProperties.tsx
  - src/components/Properties/curves/index.ts
  - src/components/Properties/index.ts
  - src/components/Palette/paletteItems.ts
autonomous: true

must_haves:
  truths:
    - "LFO Display renders all 8 waveform shapes correctly"
    - "Property panels exist for all 5 curve element types"
    - "Users can configure band count, curve colors, grid visibility"
    - "Palette shows Curves category with all 5 element types"
  artifacts:
    - path: "src/components/elements/renderers/displays/curves/LFODisplayRenderer.tsx"
      provides: "Canvas renderer for LFO waveform shapes"
      min_lines: 80
    - path: "src/components/Properties/curves/EQCurveProperties.tsx"
      provides: "Property panel for EQ Curve configuration"
      min_lines: 100
    - path: "src/components/Properties/curves/FilterResponseProperties.tsx"
      provides: "Property panel for Filter Response configuration"
      min_lines: 80
  key_links:
    - from: "src/components/elements/renderers/index.ts"
      to: "LFODisplayRenderer"
      via: "rendererRegistry entry"
      pattern: "lfodisplay.*LFODisplayRenderer"
    - from: "src/components/Palette/paletteItems.ts"
      to: "createEQCurve"
      via: "palette item factory"
      pattern: "eqcurve.*createEQCurve"
---

<objective>
Create LFO Display renderer, property panels for all 5 curve types, and palette entries

Purpose: Complete the curve element UI with waveform visualization and full configuration options
Output: LFODisplayRenderer.tsx, 5 property panel components, palette "Curves" category
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/26-interactive-curves/26-CONTEXT.md
@.planning/phases/26-interactive-curves/26-RESEARCH.md
@src/components/Properties/visualizations/SpectrumAnalyzerProperties.tsx
@src/components/Palette/paletteItems.ts
@src/types/elements/curves.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LFO Display renderer</name>
  <files>src/components/elements/renderers/displays/curves/LFODisplayRenderer.tsx, src/components/elements/renderers/displays/curves/index.ts, src/components/elements/renderers/index.ts</files>
  <action>
Create src/components/elements/renderers/displays/curves/LFODisplayRenderer.tsx:

Import:
- useCanvasSetup hook
- LFODisplayElementConfig from types/elements/curves
- drawSmoothCurve, drawLinearGrid from curveRendering

No handles needed - LFO display shows waveform shape only (shape selected in property panel)

useLayoutEffect drawing logic:
1. Clear canvas with backgroundColor
2. If showGrid, draw linear grid (center horizontal line for zero, vertical divisions for phase)

3. Calculate waveform points based on shape:
   - sampleCount = 200
   - centerY = height / 2
   - amplitude = height * 0.4

   For each sample i (0 to sampleCount):
   - t = i / sampleCount (0 to 1, one cycle)
   - x = t * width

   Calculate value (-1 to 1) based on shape:
   ```typescript
   switch (config.shape) {
     case 'sine':
       value = Math.sin(t * Math.PI * 2)
       break
     case 'triangle':
       value = t < 0.5 ? -1 + 4 * t : 3 - 4 * t
       break
     case 'saw-up':
       value = -1 + 2 * t
       break
     case 'saw-down':
       value = 1 - 2 * t
       break
     case 'square':
       value = t < 0.5 ? 1 : -1
       break
     case 'pulse':
       value = t < config.pulseWidth ? 1 : -1
       break
     case 'sample-hold':
       // Random value that holds for 10% of cycle
       // Use deterministic random based on segment index
       const segment = Math.floor(t * 10)
       value = ((segment * 7 + 3) % 11) / 5 - 1 // Deterministic pseudo-random
       break
     case 'smooth-random':
       // Smooth interpolation between random values
       const freq = 3
       value = Math.sin(t * Math.PI * 2 * freq + 0.5)
       break
   }
   ```

   - y = centerY - value * amplitude
   - Collect points

4. Draw waveform with drawSmoothCurve() (or lineTo for square/pulse/sample-hold)
5. If showFill, fill area between waveform and center line

6. Draw center line (zero reference):
   - ctx.strokeStyle = gridColor with 0.5 opacity
   - Horizontal line at centerY

Update curves/index.ts to export LFODisplayRenderer

Update rendererRegistry:
- ['lfodisplay', LFODisplayRenderer as RendererComponent]
  </action>
  <verify>File exists and TypeScript compiles with npx tsc --noEmit</verify>
  <done>LFO Display renderer shows all 8 waveform shapes correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create property panels for all 5 curve types</name>
  <files>src/components/Properties/curves/EQCurveProperties.tsx, src/components/Properties/curves/CompressorCurveProperties.tsx, src/components/Properties/curves/EnvelopeDisplayProperties.tsx, src/components/Properties/curves/LFODisplayProperties.tsx, src/components/Properties/curves/FilterResponseProperties.tsx, src/components/Properties/curves/index.ts, src/components/Properties/index.ts</files>
  <action>
Create src/components/Properties/curves/ directory with 5 property panel files.

Follow SpectrumAnalyzerProperties.tsx pattern for all panels.

**EQCurveProperties.tsx:**
- Band Count (NumberInput, 1-16)
- dB Range section (minDb, maxDb NumberInputs)
- Frequency Range section (minFreq, maxFreq NumberInputs)
- Grid section (showGrid checkbox, gridColor, showFrequencyLabels, showDbLabels checkboxes)
- Curve Style section (curveColor, lineWidth 1-4, showFill checkbox, fillColor, fillOpacity 0-1)
- Individual Bands (showIndividualBands checkbox)
- Handle Colors section (handleColor, handleHoverColor)
- Background Color
- Canvas Scale (1-4)

**CompressorCurveProperties.tsx:**
- Threshold (NumberInput, dB)
- Ratio (NumberInput, 1-20)
- Knee (NumberInput, 0-12 dB)
- dB Range section (minDb, maxDb)
- Display Mode (select: 'transfer' | 'gainreduction')
- Grid section (showGrid, gridColor, showDbLabels)
- Curve Style section (curveColor, lineWidth, showFill, fillColor)
- Handle Colors section
- Background Color
- Canvas Scale

**EnvelopeDisplayProperties.tsx:**
- ADSR section (attack, decay, sustain, release NumberInputs, 0-1 range with 0.01 step)
- Curve Type (select: 'linear' | 'exponential')
- Stage Colors section (showStageColors checkbox, then attackColor, decayColor, sustainColor, releaseColor if enabled)
- Curve Style section (curveColor, lineWidth, showFill, fillColor)
- Grid section (showGrid, gridColor, showStageMarkers)
- Handle Colors section
- Background Color
- Canvas Scale

**LFODisplayProperties.tsx:**
- Shape (select with all 8 options)
- Pulse Width (NumberInput, 0-1, shown only when shape is 'pulse')
- Grid section (showGrid, gridColor)
- Waveform Style section (waveformColor, lineWidth, showFill, fillColor)
- Background Color
- Canvas Scale

**FilterResponseProperties.tsx:**
- Filter Type (select with all 7 options)
- Cutoff Frequency (NumberInput, 20-20000)
- Resonance / Q (NumberInput, 0.1-20)
- Gain (NumberInput, -24 to +24, shown only for shelf/peak types)
- dB Range section (minDb, maxDb)
- Frequency Range section (minFreq, maxFreq)
- Grid section (showGrid, gridColor, showFrequencyLabels, showDbLabels)
- Curve Style section (curveColor, lineWidth, showFill, fillColor)
- Handle Colors section
- Background Color
- Canvas Scale

Create curves/index.ts exporting all 5 property panels.

Update src/components/Properties/index.ts:
- Add export * from './curves'
- Add property panel entries to propertyPanelRegistry (if using registry pattern)
  </action>
  <verify>npx tsc --noEmit passes, all 5 property panels exist</verify>
  <done>Property panels for all 5 curve types with full configuration options</done>
</task>

<task type="auto">
  <name>Task 3: Add palette entries for Curves category</name>
  <files>src/components/Palette/paletteItems.ts</files>
  <action>
Update src/components/Palette/paletteItems.ts:

Add new "Curves" category with all 5 curve elements:

```typescript
{
  category: 'Curves',
  items: [
    {
      type: 'eqcurve',
      label: 'EQ Curve',
      description: 'Parametric EQ frequency response',
      icon: 'üìà', // Or appropriate icon
      factory: createEQCurve,
    },
    {
      type: 'compressorcurve',
      label: 'Compressor Curve',
      description: 'Dynamics transfer function',
      icon: 'üìä',
      factory: createCompressorCurve,
    },
    {
      type: 'envelopedisplay',
      label: 'Envelope Display',
      description: 'ADSR envelope visualization',
      icon: 'üìâ',
      factory: createEnvelopeDisplay,
    },
    {
      type: 'lfodisplay',
      label: 'LFO Display',
      description: 'LFO waveform shape',
      icon: '„Ä∞Ô∏è',
      factory: createLFODisplay,
    },
    {
      type: 'filterresponse',
      label: 'Filter Response',
      description: 'Filter frequency response curve',
      icon: 'üîä',
      factory: createFilterResponse,
    },
  ],
}
```

Import factory functions from types/elements/curves:
```typescript
import {
  createEQCurve,
  createCompressorCurve,
  createEnvelopeDisplay,
  createLFODisplay,
  createFilterResponse,
} from '../../types/elements/curves'
```

Position Curves category after Visualizations in palette order.
  </action>
  <verify>Palette shows Curves category with 5 items when app runs</verify>
  <done>Palette shows Curves category with all 5 curve element types</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - TypeScript compiles without errors
2. LFODisplayRenderer.tsx exists and exports from curves/index.ts
3. rendererRegistry includes 'lfodisplay' entry
4. All 5 property panels exist in src/components/Properties/curves/
5. Palette includes "Curves" category with 5 items
6. `npm run dev` shows Curves in palette (visual check)
</verification>

<success_criteria>
- LFO Display renders all 8 waveform shapes (sine, triangle, saw-up, saw-down, square, pulse, sample-hold, smooth-random)
- Property panels provide full configuration for each curve type
- Users can adjust band count, curve colors, grid visibility, fill options
- Palette shows Curves category after Visualizations
- All 5 curve types can be dragged from palette to canvas
</success_criteria>

<output>
After completion, create `.planning/phases/26-interactive-curves/26-04-SUMMARY.md`
</output>
