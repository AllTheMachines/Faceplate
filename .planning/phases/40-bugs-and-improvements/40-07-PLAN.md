---
phase: 40-bugs-and-improvements
plan: 07
type: execute
wave: 2
depends_on: []
files_modified:
  - src/components/Canvas/hooks/useKeyboardShortcuts.ts
  - src/components/Canvas/Element.tsx
autonomous: true

must_haves:
  truths:
    - "Alt+click or Ctrl+click on selected element deselects it"
    - "Remaining elements stay selected"
    - "Works in both main canvas and container editor"
  artifacts:
    - path: "src/components/Canvas/hooks/useKeyboardShortcuts.ts"
      provides: "Modified click handler checking Alt/Ctrl for deselect"
      contains: "altKey.*deselect|ctrlKey.*deselect"
  key_links:
    - from: "src/components/Canvas/Element.tsx"
      to: "src/store/elementsSlice.ts"
      via: "toggleSelection on Alt+click"
      pattern: "toggleSelection"
---

<objective>
Add Alt/Ctrl+click to deselect individual elements from multi-selection.

Purpose: Currently you can only add to selection (Shift+click) or clear and select one. Users need a way to deselect individual elements without clearing the entire selection (FEAT-40-06).

Output: Alt+click or Ctrl+click on a selected element removes it from selection while keeping others selected.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/40-bugs-and-improvements/40-RESEARCH.md
@src/components/Canvas/Element.tsx
@src/store/elementsSlice.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Element click handler</name>
  <files>src/components/Canvas/Element.tsx</files>
  <action>
    Modify the click handler in Element.tsx to support Alt/Ctrl+click for deselection:

    1. Find the onClick or onMouseDown handler that manages selection
    2. Update the logic:

    ```typescript
    const handleClick = (e: React.MouseEvent) => {
      e.stopPropagation()

      const isShift = e.shiftKey
      const isAltOrCtrl = e.altKey || e.ctrlKey
      const isSelected = selectedIds.includes(element.id)

      if (isShift) {
        // Shift+click: Add to selection (existing behavior)
        addToSelection(element.id)
      } else if (isAltOrCtrl && isSelected) {
        // Alt/Ctrl+click on selected: Remove from selection
        toggleSelection(element.id)  // toggleSelection removes if already selected
      } else if (isAltOrCtrl && !isSelected) {
        // Alt/Ctrl+click on unselected: Add to selection (like Shift)
        addToSelection(element.id)
      } else {
        // Plain click: Select only this element
        selectElement(element.id)
      }
    }
    ```

    The `toggleSelection` function already exists in elementsSlice and correctly removes the element if already selected.
  </action>
  <verify>
    1. Select 3 elements using Shift+click
    2. Alt+click on the middle element
    3. Verify middle element is deselected, other 2 remain selected
    4. Ctrl+click on another selected element
    5. Verify that element is also deselected
  </verify>
  <done>Alt+click and Ctrl+click on selected element removes it from selection</done>
</task>

<task type="auto">
  <name>Task 2: Update container editor element handling</name>
  <files>src/components/ContainerEditor/ContainerEditor.tsx</files>
  <action>
    Apply the same click handling logic to elements in the container editor:

    1. Find where child elements are rendered in the container editor
    2. Apply the same click logic as Task 1:
       - Shift+click: Add to selection
       - Alt/Ctrl+click on selected: Remove from selection
       - Alt/Ctrl+click on unselected: Add to selection
       - Plain click: Select only this element

    If the container editor reuses Element.tsx component, the fix from Task 1 should automatically apply.
    If it has its own element rendering, apply the same pattern.
  </action>
  <verify>
    1. Open container editor
    2. Add 3 child elements
    3. Shift+click to select all 3
    4. Alt+click on one - verify it deselects
    5. Verify other 2 remain selected
  </verify>
  <done>Deselection with Alt/Ctrl+click works in container editor</done>
</task>

<task type="auto">
  <name>Task 3: Add visual feedback and cursor hint</name>
  <files>src/components/Canvas/Element.tsx</files>
  <action>
    Add visual feedback to indicate deselection is possible:

    1. When hovering over a selected element while holding Alt/Ctrl, show a visual hint:
       ```typescript
       const [isHoldingAltCtrl, setIsHoldingAltCtrl] = useState(false)

       useEffect(() => {
         const handleKeyDown = (e: KeyboardEvent) => {
           if (e.altKey || e.ctrlKey) setIsHoldingAltCtrl(true)
         }
         const handleKeyUp = () => setIsHoldingAltCtrl(false)

         window.addEventListener('keydown', handleKeyDown)
         window.addEventListener('keyup', handleKeyUp)
         return () => {
           window.removeEventListener('keydown', handleKeyDown)
           window.removeEventListener('keyup', handleKeyUp)
         }
       }, [])
       ```

    2. Change cursor when Alt/Ctrl is held over selected element:
       ```tsx
       style={{
         cursor: isSelected && isHoldingAltCtrl ? 'pointer' : 'move',
       }}
       ```

    3. Optional: Show subtle visual change (slightly dim selection outline) when Alt/Ctrl held
  </action>
  <verify>
    1. Select an element
    2. Hold Alt key
    3. Verify cursor changes when hovering over selected element
    4. Release Alt
    5. Verify cursor returns to normal
  </verify>
  <done>Visual feedback indicates when Alt/Ctrl+click will deselect</done>
</task>

</tasks>

<verification>
Complete multi-select workflow test:
1. Add 5 elements to canvas
2. Shift+click to select all 5
3. Alt+click on element 2 - verify 4 remain selected
4. Ctrl+click on element 4 - verify 3 remain selected
5. Alt+click on element 1 - verify 2 remain selected
6. Shift+click on element 2 - verify it's added back (3 selected)
7. Plain click on element 5 - verify only element 5 is selected
</verification>

<success_criteria>
1. Alt+click removes element from multi-selection
2. Ctrl+click also removes element from multi-selection
3. Alt/Ctrl+click on unselected element adds it
4. Works in both main canvas and container editor
5. Visual cursor feedback when deselection is possible
6. No interference with existing Shift+click behavior
</success_criteria>

<output>
After completion, create `.planning/phases/40-bugs-and-improvements/40-07-SUMMARY.md`
</output>
