---
phase: 53-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elementStyle.ts
  - src/store/elementStylesSlice.ts
  - src/store/index.ts
autonomous: true

must_haves:
  truths:
    - "ElementStyle type exists with category discriminant"
    - "Layer schemas exist for each of 5 categories"
    - "Store slice provides CRUD operations for element styles"
    - "getStylesByCategory selector filters by category"
  artifacts:
    - path: "src/types/elementStyle.ts"
      provides: "ElementStyle discriminated union type"
      exports: ["ElementStyle", "ElementCategory", "RotaryLayers", "LinearLayers", "ArcLayers", "ButtonLayers", "MeterLayers", "ELEMENT_TYPE_TO_CATEGORY"]
    - path: "src/store/elementStylesSlice.ts"
      provides: "Zustand slice with CRUD operations"
      exports: ["ElementStylesSlice", "createElementStylesSlice"]
    - path: "src/store/index.ts"
      provides: "Combined store with elementStylesSlice"
      contains: "createElementStylesSlice"
  key_links:
    - from: "src/store/elementStylesSlice.ts"
      to: "src/types/elementStyle.ts"
      via: "import ElementStyle type"
      pattern: "import.*ElementStyle.*from.*elementStyle"
    - from: "src/store/index.ts"
      to: "src/store/elementStylesSlice.ts"
      via: "slice integration"
      pattern: "createElementStylesSlice"
---

<objective>
Create the ElementStyle type system and Zustand store slice for generalized SVG styling.

Purpose: Establish the foundational types and state management that later phases will build upon. This extends the proven KnobStyle pattern to support all visual control categories.

Output:
- ElementStyle discriminated union type with 5 category variants
- Layer schemas for each category (RotaryLayers, LinearLayers, ArcLayers, ButtonLayers, MeterLayers)
- elementStylesSlice with CRUD operations and getStylesByCategory() selector
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/53-foundation/53-RESEARCH.md

# Existing patterns to follow
@src/types/knobStyle.ts
@src/store/knobStylesSlice.ts
@src/store/index.ts
@src/services/export/svgElementExport.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ElementStyle type system</name>
  <files>src/types/elementStyle.ts</files>
  <action>
Create new file src/types/elementStyle.ts with:

1. ElementCategory type: `'rotary' | 'linear' | 'arc' | 'button' | 'meter'`

2. Layer schemas per category (use optional strings like KnobStyleLayers):
   - RotaryLayers: indicator, track, arc, glow, shadow (same as KnobStyleLayers)
   - LinearLayers: thumb, track, fill
   - ArcLayers: thumb, track, fill, arc (curved path elements)
   - ButtonLayers: body, label, icon, pressed, normal (state layers)
   - MeterLayers: body, fill, scale, peak, segments

3. ColorOverrides type: Generic `{ [layerRole: string]: string }` to support any category

4. ElementStyle discriminated union with category as discriminant:
   - Base fields: id, name, svgContent, createdAt
   - Category-specific fields:
     - rotary: layers: RotaryLayers, minAngle, maxAngle
     - linear: layers: LinearLayers
     - arc: layers: ArcLayers, minAngle, maxAngle, arcRadius
     - button: layers: ButtonLayers
     - meter: layers: MeterLayers

5. ELEMENT_TYPE_TO_CATEGORY map (readonly object):
   - rotary: knob, steppedknob, centerdetentknob, dotindicatorknob
   - linear: slider, rangeslider, multislider, bipolarslider, crossfadeslider, notchedslider
   - arc: arcslider
   - button: button, iconbutton, toggleswitch, powerbutton, rockerswitch, rotaryswitch, segmentbutton
   - meter: meter (and all professional meter types)

Export all types and the mapping object.

Follow the pattern from knobStyle.ts - use descriptive JSDoc comments.
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors in new file.
Import ElementStyle in a test file and verify category narrowing works in switch statement.
  </verify>
  <done>
ElementStyle type exists with 5 category variants.
Each variant has category-specific layers property typed correctly.
TypeScript narrows type based on category check.
ELEMENT_TYPE_TO_CATEGORY maps all 19+ element types to 5 categories.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create elementStylesSlice with CRUD and selector</name>
  <files>src/store/elementStylesSlice.ts, src/store/index.ts</files>
  <action>
Create new file src/store/elementStylesSlice.ts following knobStylesSlice.ts pattern exactly:

1. Interface ElementStylesSlice:
   - State: elementStyles: ElementStyle[]
   - CRUD Actions:
     - addElementStyle: (style: Omit<ElementStyle, 'id' | 'createdAt'>) => void
     - removeElementStyle: (id: string) => void
     - updateElementStyle: (id: string, updates: Partial<ElementStyle>) => void
     - setElementStyles: (styles: ElementStyle[]) => void (for project load)
   - Selectors:
     - getElementStyle: (id: string) => ElementStyle | undefined
     - getStylesByCategory: (category: ElementCategory) => ElementStyle[]

2. createElementStylesSlice StateCreator implementation:
   - Use StateCreator<ElementStylesSlice, [], [], ElementStylesSlice> pattern
   - addElementStyle generates id with crypto.randomUUID(), createdAt with Date.now()
   - getStylesByCategory filters by category property

3. Update src/store/index.ts:
   - Import createElementStylesSlice and ElementStylesSlice
   - Add ElementStylesSlice to Store type union
   - Add ...createElementStylesSlice(...a) to combined store
   - Add elementStyles to partialize exclusions list (NOT undoable - styles are document state, but changes shouldn't pollute undo history with bulk imports)

Wait - actually elementStyles SHOULD be undoable (adding/removing styles is meaningful). Do NOT add to partialize. Check knobStyles - it's undoable (not in partialize list).
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors.
In browser console, test:
- useStore.getState().addElementStyle({ category: 'linear', name: 'Test', ... })
- useStore.getState().getStylesByCategory('linear') returns the added style
  </verify>
  <done>
elementStylesSlice provides addElementStyle, removeElementStyle, updateElementStyle, setElementStyles actions.
getElementStyle(id) returns style or undefined.
getStylesByCategory(category) returns filtered array.
Store integrated and functional.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. ElementStyle type narrowing works in switch statements
3. Store actions work (manual browser console test)
4. getStylesByCategory filters correctly
</verification>

<success_criteria>
- [ ] src/types/elementStyle.ts exists with all exports
- [ ] ElementStyle is discriminated union with 5 variants
- [ ] Layer schemas match LAYER_CONVENTIONS from svgElementExport.ts
- [ ] ELEMENT_TYPE_TO_CATEGORY maps all element types
- [ ] src/store/elementStylesSlice.ts exists with CRUD + selectors
- [ ] Store index.ts integrates the slice
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/53-foundation/53-01-SUMMARY.md`
</output>
