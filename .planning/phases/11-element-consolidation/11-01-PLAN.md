---
phase: 11-element-consolidation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Properties/PropertyPanel.tsx
  - src/components/Properties/ButtonProperties.tsx
  - src/components/Properties/MeterProperties.tsx
autonomous: true

must_haves:
  truths:
    - "Knob element has no rotation field in property panel"
    - "Meter element has no rotation field in property panel"
    - "Button pressed checkbox is clickable by clicking the label"
    - "Meter orientation can switch from Horizontal back to Vertical"
  artifacts:
    - path: "src/components/Properties/PropertyPanel.tsx"
      provides: "Conditional rotation field hiding for knob and meter"
      contains: "supportsRotation"
    - path: "src/components/Properties/ButtonProperties.tsx"
      provides: "Clickable checkbox label with cursor-pointer"
      contains: "cursor-pointer"
    - path: "src/components/Properties/MeterProperties.tsx"
      provides: "Fixed orientation toggle and clickable checkbox"
      contains: "cursor-pointer"
  key_links:
    - from: "PropertyPanel.tsx"
      to: "rotation field rendering"
      via: "conditional check on element type"
      pattern: "isKnob|isMeter"
---

<objective>
Fix property panel issues for Knob, Meter, and Button elements

Purpose: Address BUG-01, BUG-03, BUG-04, BUG-06, and BUG-07 from UAT feedback - rotation fields are not useful for knobs/meters, checkbox labels should be clickable, and meter orientation must work bidirectionally.

Output: Updated property panel components with correct conditional rendering and improved checkbox UX
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-element-consolidation/11-RESEARCH.md

@src/components/Properties/PropertyPanel.tsx
@src/components/Properties/ButtonProperties.tsx
@src/components/Properties/MeterProperties.tsx
@src/types/elements.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Hide rotation field for Knob and Meter elements</name>
  <files>src/components/Properties/PropertyPanel.tsx</files>
  <action>
In PropertyPanel.tsx, add conditional rendering to hide the rotation field for knob and meter elements:

1. Import isKnob and isMeter from types/elements (already imported)
2. After the existing "Position & Size" PropertySection (around line 100), add a NEW section for rotation that only renders for elements that support it
3. Create a helper: `const supportsRotation = !isKnob(element) && !isMeter(element)`
4. Move or add rotation field inside a conditional: `{supportsRotation && <NumberInput label="Rotation" ... />}`

Note: The rotation field may not currently be rendered in PropertyPanel. If not present, no changes needed for rotation - just verify knob and meter don't show rotation. If rotation IS shown elsewhere, conditionally hide it.

Check existing code first - if rotation is not currently shown in the Position & Size section, the fix may already be in place or rotation editing was never implemented. In that case, document in summary that rotation field was already hidden/not present.
  </action>
  <verify>
Run the app (`npm run dev`), add a Knob element, verify no rotation field appears in properties. Add a Meter element, verify no rotation field. Add a Label element, verify rotation field IS present (if rotation was previously shown for labels - otherwise verify all elements lack rotation which is fine).
  </verify>
  <done>Knob and Meter property panels do not show rotation field; other elements show rotation if applicable</done>
</task>

<task type="auto">
  <name>Task 2: Fix checkbox clickability in ButtonProperties and MeterProperties</name>
  <files>src/components/Properties/ButtonProperties.tsx, src/components/Properties/MeterProperties.tsx</files>
  <action>
Fix the checkbox + label pattern to be properly clickable in both files:

**ButtonProperties.tsx** (lines 32-43):
Replace the current "Pressed" checkbox pattern:
```tsx
<div className="flex items-center">
  <input type="checkbox" id="button-pressed" ... />
  <label htmlFor="button-pressed" className="ml-2 text-sm text-gray-300">Pressed</label>
</div>
```

With the clickable label wrapper pattern:
```tsx
<label
  htmlFor="button-pressed"
  className="flex items-center gap-2 cursor-pointer select-none"
>
  <input
    type="checkbox"
    id="button-pressed"
    checked={element.pressed}
    onChange={(e) => onUpdate({ pressed: e.target.checked })}
    className="bg-gray-700 border border-gray-600 rounded cursor-pointer"
  />
  <span className="text-sm text-gray-300">Pressed</span>
</label>
```

**MeterProperties.tsx** (lines 87-98):
Apply the same pattern to the "Show Peak Hold" checkbox:
```tsx
<label
  htmlFor="meter-peak-hold"
  className="flex items-center gap-2 cursor-pointer select-none"
>
  <input
    type="checkbox"
    id="meter-peak-hold"
    checked={element.showPeakHold}
    onChange={(e) => onUpdate({ showPeakHold: e.target.checked })}
    className="bg-gray-700 border border-gray-600 rounded cursor-pointer"
  />
  <span className="text-sm text-gray-300">Show Peak Hold</span>
</label>
```

Key changes:
- Wrap entire control in `<label>` element
- Add `cursor-pointer` and `select-none` classes to label
- Add `cursor-pointer` to checkbox input
- Use `gap-2` for spacing instead of `ml-2` on the text
  </action>
  <verify>
Run the app, add a Button element, click on the word "Pressed" (not the checkbox itself) - the checkbox should toggle. Add a Meter element, click on "Show Peak Hold" text - checkbox should toggle. Verify cursor changes to pointer when hovering over the label text.
  </verify>
  <done>Checkbox labels are clickable in ButtonProperties and MeterProperties with pointer cursor feedback</done>
</task>

<task type="auto">
  <name>Task 3: Fix Meter orientation toggle bug</name>
  <files>src/components/Properties/MeterProperties.tsx</files>
  <action>
Investigate and fix BUG-06: After changing from Vertical to Horizontal, cannot switch back to Vertical.

The current select element (lines 14-28) looks correct. Likely issues:
1. React controlled input value not properly bound
2. State update not propagating correctly
3. Type narrowing issue with orientation value

Steps:
1. Verify the select element has proper `value={element.orientation}` binding
2. Ensure onChange properly passes the value: `e.target.value as MeterElementConfig['orientation']`
3. Add a key prop to force re-render if needed: `key={element.id}` on the select
4. Check if there's a default value issue - the select should NOT have a `defaultValue` attribute

If the code looks correct, the issue may be in updateElement in the store. Test by adding console.log in onChange to verify the correct value is being passed.

Most likely fix: The select may need explicit option values matching exactly what TypeScript expects. Verify option values are exactly 'vertical' and 'horizontal' (not capitalized).

After investigation, apply the fix. If no code issue found, document the investigation in the summary.
  </action>
  <verify>
Run the app, add a Meter element (defaults to vertical). Change orientation to Horizontal via dropdown - meter should become horizontal. Change back to Vertical - meter should become vertical again. Repeat toggle 3+ times to confirm it works bidirectionally.
  </verify>
  <done>Meter orientation can be changed from Vertical to Horizontal and back to Vertical without issues</done>
</task>

</tasks>

<verification>
1. `npm run dev` - app starts without errors
2. `npm run typecheck` - no TypeScript errors
3. Add Knob element - no rotation field visible in properties
4. Add Meter element - no rotation field visible, orientation toggles both ways
5. Add Button element - "Pressed" label is clickable with pointer cursor
6. Meter "Show Peak Hold" label is clickable with pointer cursor
</verification>

<success_criteria>
- Knob property panel has no rotation field
- Meter property panel has no rotation field
- Meter orientation can be toggled Vertical -> Horizontal -> Vertical
- Button "Pressed" checkbox label is clickable
- Meter "Show Peak Hold" checkbox label is clickable
- All checkbox labels show pointer cursor on hover
</success_criteria>

<output>
After completion, create `.planning/phases/11-element-consolidation/11-01-SUMMARY.md`
</output>
