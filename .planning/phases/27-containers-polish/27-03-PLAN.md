---
phase: 27-containers-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements/containers.ts
  - src/components/elements/renderers/containers/WindowChromeRenderer.tsx
  - src/components/elements/renderers/containers/index.ts
  - src/components/elements/renderers/index.ts
  - src/components/Properties/WindowChromeProperties.tsx
  - src/components/Properties/index.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Window Chrome appears in palette under Containers category"
    - "Window Chrome shows configurable button style (macOS/Windows/neutral)"
    - "Title bar displays configurable title text"
    - "Close/minimize/maximize buttons can be individually toggled"
    - "Title bar is static in designer (visual only)"
  artifacts:
    - path: "src/types/elements/containers.ts"
      provides: "WindowChromeElementConfig interface and createWindowChrome factory"
      contains: "interface WindowChromeElementConfig"
    - path: "src/components/elements/renderers/containers/WindowChromeRenderer.tsx"
      provides: "Title bar with configurable button styles"
      min_lines: 100
    - path: "src/components/Properties/WindowChromeProperties.tsx"
      provides: "Property panel for window chrome configuration"
      min_lines: 80
  key_links:
    - from: "src/components/elements/renderers/index.ts"
      to: "WindowChromeRenderer"
      via: "rendererRegistry entry"
      pattern: "windowchrome.*WindowChromeRenderer"
    - from: "src/components/Properties/index.ts"
      to: "WindowChromeProperties"
      via: "propertyRegistry entry"
      pattern: "windowchrome.*WindowChromeProperties"
---

<objective>
Create Window Chrome element with configurable button styles (macOS/Windows/neutral)

Purpose: Enable users to add title bar decorations matching different OS aesthetics (CONT-03)
Output: WindowChromeElementConfig type, WindowChromeRenderer with button style variants, property panel
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/27-containers-polish/27-CONTEXT.md
@.planning/phases/27-containers-polish/27-RESEARCH.md
@src/types/elements/containers.ts
@src/components/elements/renderers/index.ts
@src/components/Properties/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Window Chrome type and factory function</name>
  <files>src/types/elements/containers.ts</files>
  <action>
Add WindowChromeElementConfig interface and factory function to src/types/elements/containers.ts:

```typescript
export interface WindowChromeElementConfig extends BaseElementConfig {
  type: 'windowchrome'

  // Button style
  buttonStyle: 'macos' | 'windows' | 'neutral'

  // Title bar
  showTitle: boolean
  titleText: string
  titleFontSize: number
  titleColor: string

  // Appearance
  backgroundColor: string

  // Buttons visibility
  showCloseButton: boolean
  showMinimizeButton: boolean
  showMaximizeButton: boolean
}

export function isWindowChrome(element: { type: string }): element is WindowChromeElementConfig {
  return element.type === 'windowchrome'
}

export function createWindowChrome(overrides?: Partial<WindowChromeElementConfig>): WindowChromeElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'windowchrome',
    name: 'Window Chrome',
    x: 0,
    y: 0,
    width: 400,
    height: 36,
    rotation: 0,
    zIndex: 100,
    locked: false,
    visible: true,
    buttonStyle: 'neutral',
    showTitle: true,
    titleText: 'Window Title',
    titleFontSize: 13,
    titleColor: '#1f2937',
    backgroundColor: '#e5e7eb',
    showCloseButton: true,
    showMinimizeButton: true,
    showMaximizeButton: true,
    ...overrides,
  }
}
```

Update ContainerElement union to include WindowChromeElementConfig:
```typescript
export type ContainerElement =
  | PanelElementConfig
  | FrameElementConfig
  | GroupBoxElementConfig
  | CollapsibleContainerElementConfig
  | TooltipElementConfig
  | HorizontalSpacerElementConfig
  | VerticalSpacerElementConfig
  | WindowChromeElementConfig
```
  </action>
  <verify>npx tsc --noEmit passes and grep "interface WindowChromeElementConfig" src/types/elements/containers.ts</verify>
  <done>WindowChromeElementConfig interface and createWindowChrome factory function exist</done>
</task>

<task type="auto">
  <name>Task 2: Create Window Chrome renderer with button style variants</name>
  <files>src/components/elements/renderers/containers/WindowChromeRenderer.tsx, src/components/elements/renderers/containers/index.ts, src/components/elements/renderers/index.ts</files>
  <action>
Create src/components/elements/renderers/containers/WindowChromeRenderer.tsx:

```typescript
/**
 * Window Chrome Renderer
 *
 * Renders a title bar with configurable button styles (macOS/Windows/neutral).
 * Buttons on left for macOS, right for Windows/neutral.
 * Static in designer (not draggable), export includes drag handler code.
 */
import { Rect, Circle, Text, Group, Line } from 'react-konva'
import type { WindowChromeElementConfig } from '../../../../types/elements/containers'

interface WindowChromeRendererProps {
  config: WindowChromeElementConfig
}

export function WindowChromeRenderer({ config }: WindowChromeRendererProps) {
  const {
    width,
    height,
    backgroundColor,
    buttonStyle,
    showTitle,
    titleText,
    titleFontSize,
    titleColor,
    showCloseButton,
    showMinimizeButton,
    showMaximizeButton,
  } = config

  // Button positions based on style
  const buttonSpacing = buttonStyle === 'macos' ? 8 : 4
  const buttonSize = buttonStyle === 'macos' ? 12 : 10
  const buttonsOnLeft = buttonStyle === 'macos'

  // Calculate title position based on button layout
  const titleX = width / 2
  const titleY = height / 2

  return (
    <Group>
      {/* Background */}
      <Rect
        width={width}
        height={height}
        fill={backgroundColor}
        cornerRadius={buttonStyle === 'macos' ? [8, 8, 0, 0] : 0}
      />

      {/* macOS style buttons (traffic lights on left) */}
      {buttonStyle === 'macos' && (
        <Group x={12} y={height / 2 - buttonSize / 2}>
          {showCloseButton && (
            <Circle
              x={0}
              y={buttonSize / 2}
              radius={buttonSize / 2}
              fill="#ff5f56"
              stroke="#e0443e"
              strokeWidth={1}
            />
          )}
          {showMinimizeButton && (
            <Circle
              x={buttonSize + buttonSpacing}
              y={buttonSize / 2}
              radius={buttonSize / 2}
              fill="#ffbd2e"
              stroke="#dea123"
              strokeWidth={1}
            />
          )}
          {showMaximizeButton && (
            <Circle
              x={(buttonSize + buttonSpacing) * 2}
              y={buttonSize / 2}
              radius={buttonSize / 2}
              fill="#27c93f"
              stroke="#1aab29"
              strokeWidth={1}
            />
          )}
        </Group>
      )}

      {/* Windows style buttons (icons on right) */}
      {buttonStyle === 'windows' && (
        <Group x={width - 12} y={height / 2}>
          {showCloseButton && (
            <Group x={0}>
              <Rect
                x={-12}
                y={-12}
                width={24}
                height={24}
                fill="transparent"
              />
              {/* X icon */}
              <Line
                points={[-5, -5, 5, 5]}
                stroke="#1f2937"
                strokeWidth={1.5}
              />
              <Line
                points={[-5, 5, 5, -5]}
                stroke="#1f2937"
                strokeWidth={1.5}
              />
            </Group>
          )}
          {showMaximizeButton && (
            <Group x={-32}>
              <Rect
                x={-12}
                y={-12}
                width={24}
                height={24}
                fill="transparent"
              />
              {/* Square icon */}
              <Rect
                x={-5}
                y={-5}
                width={10}
                height={10}
                stroke="#1f2937"
                strokeWidth={1.5}
                fill="transparent"
              />
            </Group>
          )}
          {showMinimizeButton && (
            <Group x={-64}>
              <Rect
                x={-12}
                y={-12}
                width={24}
                height={24}
                fill="transparent"
              />
              {/* Minus icon */}
              <Line
                points={[-5, 0, 5, 0]}
                stroke="#1f2937"
                strokeWidth={1.5}
              />
            </Group>
          )}
        </Group>
      )}

      {/* Neutral style buttons (simple icons on right) */}
      {buttonStyle === 'neutral' && (
        <Group x={width - 12} y={height / 2}>
          {showCloseButton && (
            <Group x={0}>
              <Circle
                x={0}
                y={0}
                radius={8}
                fill="#6b7280"
              />
              {/* X icon */}
              <Line
                points={[-3, -3, 3, 3]}
                stroke="#ffffff"
                strokeWidth={1.5}
              />
              <Line
                points={[-3, 3, 3, -3]}
                stroke="#ffffff"
                strokeWidth={1.5}
              />
            </Group>
          )}
          {showMaximizeButton && (
            <Group x={-24}>
              <Circle
                x={0}
                y={0}
                radius={8}
                fill="#6b7280"
              />
              {/* Square icon */}
              <Rect
                x={-3}
                y={-3}
                width={6}
                height={6}
                stroke="#ffffff"
                strokeWidth={1.5}
                fill="transparent"
              />
            </Group>
          )}
          {showMinimizeButton && (
            <Group x={-48}>
              <Circle
                x={0}
                y={0}
                radius={8}
                fill="#6b7280"
              />
              {/* Minus icon */}
              <Line
                points={[-3, 0, 3, 0]}
                stroke="#ffffff"
                strokeWidth={1.5}
              />
            </Group>
          )}
        </Group>
      )}

      {/* Title text */}
      {showTitle && (
        <Text
          text={titleText}
          x={0}
          y={titleY - titleFontSize / 2}
          width={width}
          align="center"
          fontSize={titleFontSize}
          fill={titleColor}
          fontFamily="Inter, system-ui, sans-serif"
          fontStyle="500"
        />
      )}
    </Group>
  )
}
```

Update src/components/elements/renderers/containers/index.ts to export WindowChromeRenderer:
```typescript
export { WindowChromeRenderer } from './WindowChromeRenderer'
```

Update src/components/elements/renderers/index.ts:
- Import WindowChromeRenderer from './containers'
- Add to rendererRegistry: `['windowchrome', WindowChromeRenderer as RendererComponent]`
- Add to export list
  </action>
  <verify>npx tsc --noEmit passes and grep "windowchrome.*WindowChromeRenderer" src/components/elements/renderers/index.ts</verify>
  <done>WindowChromeRenderer displays title bar with macOS/Windows/neutral button styles</done>
</task>

<task type="auto">
  <name>Task 3: Create property panel and palette entry</name>
  <files>src/components/Properties/WindowChromeProperties.tsx, src/components/Properties/index.ts, src/App.tsx</files>
  <action>
Create src/components/Properties/WindowChromeProperties.tsx:

```typescript
import type { WindowChromeElementConfig } from '../../types/elements/containers'
import { PropertySection } from './PropertySection'
import { NumberInput } from './NumberInput'
import { TextInput } from './TextInput'
import { ColorInput } from './ColorInput'

interface WindowChromePropertiesProps {
  element: WindowChromeElementConfig
  onUpdate: (updates: Partial<WindowChromeElementConfig>) => void
}

export function WindowChromeProperties({ element, onUpdate }: WindowChromePropertiesProps) {
  return (
    <>
      <PropertySection title="Button Style">
        <div className="space-y-1">
          <label className="text-sm text-gray-400">Style</label>
          <select
            value={element.buttonStyle}
            onChange={(e) => onUpdate({ buttonStyle: e.target.value as WindowChromeElementConfig['buttonStyle'] })}
            className="w-full bg-gray-700 text-white px-2 py-1 rounded text-sm"
          >
            <option value="macos">macOS (Traffic Lights)</option>
            <option value="windows">Windows (Icons)</option>
            <option value="neutral">Neutral (Circles)</option>
          </select>
        </div>
        <p className="text-xs text-gray-500 mt-1">
          macOS: buttons on left. Windows/Neutral: buttons on right.
        </p>
      </PropertySection>

      <PropertySection title="Buttons">
        <div className="space-y-2">
          <label className="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              checked={element.showCloseButton}
              onChange={(e) => onUpdate({ showCloseButton: e.target.checked })}
              className="rounded"
            />
            <span className="text-sm text-gray-300">Close Button</span>
          </label>
          <label className="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              checked={element.showMinimizeButton}
              onChange={(e) => onUpdate({ showMinimizeButton: e.target.checked })}
              className="rounded"
            />
            <span className="text-sm text-gray-300">Minimize Button</span>
          </label>
          <label className="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              checked={element.showMaximizeButton}
              onChange={(e) => onUpdate({ showMaximizeButton: e.target.checked })}
              className="rounded"
            />
            <span className="text-sm text-gray-300">Maximize Button</span>
          </label>
        </div>
      </PropertySection>

      <PropertySection title="Title">
        <div className="flex items-center gap-2 mb-2">
          <input
            type="checkbox"
            id="showTitle"
            checked={element.showTitle}
            onChange={(e) => onUpdate({ showTitle: e.target.checked })}
            className="rounded"
          />
          <label htmlFor="showTitle" className="text-sm text-gray-300">Show Title</label>
        </div>
        {element.showTitle && (
          <>
            <TextInput
              label="Title Text"
              value={element.titleText}
              onChange={(titleText) => onUpdate({ titleText })}
            />
            <NumberInput
              label="Font Size"
              value={element.titleFontSize}
              onChange={(titleFontSize) => onUpdate({ titleFontSize })}
              min={10}
              max={24}
            />
            <ColorInput
              label="Title Color"
              value={element.titleColor}
              onChange={(titleColor) => onUpdate({ titleColor })}
            />
          </>
        )}
      </PropertySection>

      <PropertySection title="Appearance">
        <ColorInput
          label="Background"
          value={element.backgroundColor}
          onChange={(backgroundColor) => onUpdate({ backgroundColor })}
        />
        <NumberInput
          label="Height"
          value={element.height}
          onChange={(height) => onUpdate({ height })}
          min={24}
          max={64}
        />
      </PropertySection>

      <PropertySection title="Export Behavior">
        <p className="text-xs text-gray-500">
          Title bar is static in designer. Exported HTML includes drag handler code for JUCE WebView.
        </p>
      </PropertySection>
    </>
  )
}
```

Update src/components/Properties/index.ts:
- Import WindowChromeProperties
- Add to propertyRegistry: `['windowchrome', WindowChromeProperties]`
- Export WindowChromeProperties

Update src/App.tsx:
- Import createWindowChrome from types/elements
- Add case 'windowchrome' in handleDragEnd switch statement:
  ```typescript
  case 'windowchrome':
    newElement = createWindowChrome({ x: canvasX, y: canvasY, ...variant })
    break
  ```
  </action>
  <verify>
1. npx tsc --noEmit passes
2. grep "windowchrome.*WindowChromeProperties" src/components/Properties/index.ts
3. grep "case 'windowchrome'" src/App.tsx
  </verify>
  <done>Window Chrome property panel and palette entry enable full configuration</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - TypeScript compiles without errors
2. WindowChromeElementConfig interface exists in containers.ts
3. WindowChromeRenderer.tsx exists and exports from containers/index.ts
4. rendererRegistry includes 'windowchrome' entry
5. propertyRegistry includes 'windowchrome' entry
6. App.tsx handles 'windowchrome' in drag-drop switch
7. `npm run dev` shows Window Chrome in palette (visual check)
8. All three button styles render correctly (macOS/Windows/neutral)
</verification>

<success_criteria>
- Window Chrome element type is fully defined with all configuration properties
- WindowChromeRenderer displays title bar with correct button layout per style
- macOS style shows traffic light buttons (red/yellow/green) on left
- Windows style shows minimize/maximize/close icons on right
- Neutral style shows simple circular buttons on right
- Title text can be configured and toggled
- Individual buttons can be shown/hidden
- Property panel provides full configuration
- Window Chrome can be dragged from palette to canvas
</success_criteria>

<output>
After completion, create `.planning/phases/27-containers-polish/27-03-SUMMARY.md`
</output>
