---
phase: 27-containers-polish
plan: 04
type: execute
wave: 2
depends_on: ["27-01", "27-02", "27-03"]
files_modified:
  - src/services/export/htmlGenerator.ts
  - src/services/export/cssGenerator.ts
autonomous: true

must_haves:
  truths:
    - "Tooltip exports with data attributes for JUCE binding"
    - "Spacers export as invisible divs with flex properties"
    - "Window Chrome exports with button style CSS and drag handler data"
    - "All 4 new element types included in export switch statements"
  artifacts:
    - path: "src/services/export/htmlGenerator.ts"
      provides: "HTML generation for tooltip, spacers, window chrome"
      contains: "case 'tooltip'"
    - path: "src/services/export/cssGenerator.ts"
      provides: "CSS generation for tooltip, spacers, window chrome"
      contains: "case 'windowchrome'"
  key_links:
    - from: "src/services/export/htmlGenerator.ts"
      to: "TooltipElementConfig"
      via: "switch case with data attributes"
      pattern: "case 'tooltip'"
    - from: "src/services/export/cssGenerator.ts"
      to: "WindowChromeElementConfig"
      via: "switch case with button styles"
      pattern: "case 'windowchrome'"
---

<objective>
Add HTML and CSS export support for Tooltip, Spacer, and Window Chrome elements

Purpose: Enable exported JUCE WebView bundles to include all new container elements with proper styling and data attributes
Output: Updated htmlGenerator.ts and cssGenerator.ts with switch cases for 4 new element types
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/27-containers-polish/27-CONTEXT.md
@.planning/phases/27-containers-polish/27-RESEARCH.md
@src/services/export/htmlGenerator.ts
@src/services/export/cssGenerator.ts
@src/types/elements/containers.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add HTML generation for new container elements</name>
  <files>src/services/export/htmlGenerator.ts</files>
  <action>
Update src/services/export/htmlGenerator.ts to handle the 4 new container element types.

Add imports at top:
```typescript
import type { TooltipElementConfig, HorizontalSpacerElementConfig, VerticalSpacerElementConfig, WindowChromeElementConfig } from '../../types/elements/containers'
```

Add cases in generateElementHTML switch statement:

```typescript
case 'tooltip': {
  const tooltipEl = element as TooltipElementConfig
  // Export tooltip as a trigger div with data attributes
  // Actual tooltip display handled by JavaScript in bindings.js
  return `<div id="${id}" class="${baseClass} tooltip-trigger" data-type="tooltip" data-position="${tooltipEl.position}" data-delay="${tooltipEl.hoverDelay}" data-show-arrow="${tooltipEl.showArrow}" data-content="${escapeHTML(tooltipEl.content)}" data-max-width="${tooltipEl.maxWidth}" data-bg-color="${tooltipEl.backgroundColor}" data-text-color="${tooltipEl.textColor}" data-font-size="${tooltipEl.fontSize}" data-padding="${tooltipEl.padding}" data-border-radius="${tooltipEl.borderRadius}" style="${positionStyle}"></div>`
}

case 'horizontalspacer': {
  const spacerEl = element as HorizontalSpacerElementConfig
  // Spacers are invisible in export, use flex properties
  const flexStyle = spacerEl.mode === 'flexible'
    ? `flex-grow: ${spacerEl.flexGrow}; min-width: ${spacerEl.minWidth}px; max-width: ${spacerEl.maxWidth}px;`
    : `width: ${spacerEl.width}px;`
  return `<div id="${id}" class="${baseClass} horizontal-spacer" data-type="horizontalspacer" data-mode="${spacerEl.mode}" style="${positionStyle} ${flexStyle}"></div>`
}

case 'verticalspacer': {
  const spacerEl = element as VerticalSpacerElementConfig
  // Spacers are invisible in export, use flex properties
  const flexStyle = spacerEl.mode === 'flexible'
    ? `flex-grow: ${spacerEl.flexGrow}; min-height: ${spacerEl.minHeight}px; max-height: ${spacerEl.maxHeight}px;`
    : `height: ${spacerEl.height}px;`
  return `<div id="${id}" class="${baseClass} vertical-spacer" data-type="verticalspacer" data-mode="${spacerEl.mode}" style="${positionStyle} ${flexStyle}"></div>`
}

case 'windowchrome': {
  const chromeEl = element as WindowChromeElementConfig
  // Generate button HTML based on style
  let buttonsHtml = ''

  if (chromeEl.buttonStyle === 'macos') {
    buttonsHtml = `<div class="window-buttons macos-buttons">`
    if (chromeEl.showCloseButton) buttonsHtml += `<div class="window-button close" data-action="close"></div>`
    if (chromeEl.showMinimizeButton) buttonsHtml += `<div class="window-button minimize" data-action="minimize"></div>`
    if (chromeEl.showMaximizeButton) buttonsHtml += `<div class="window-button maximize" data-action="maximize"></div>`
    buttonsHtml += `</div>`
  } else {
    // Windows and neutral styles have buttons on right
    buttonsHtml = `<div class="window-buttons ${chromeEl.buttonStyle}-buttons">`
    if (chromeEl.showMinimizeButton) buttonsHtml += `<div class="window-button minimize" data-action="minimize">&#x2212;</div>`
    if (chromeEl.showMaximizeButton) buttonsHtml += `<div class="window-button maximize" data-action="maximize">&#x25A1;</div>`
    if (chromeEl.showCloseButton) buttonsHtml += `<div class="window-button close" data-action="close">&#x2715;</div>`
    buttonsHtml += `</div>`
  }

  const titleHtml = chromeEl.showTitle
    ? `<div class="window-title">${escapeHTML(chromeEl.titleText)}</div>`
    : ''

  return `<div id="${id}" class="${baseClass} window-chrome ${chromeEl.buttonStyle}-style" data-type="windowchrome" data-button-style="${chromeEl.buttonStyle}" data-draggable="true" style="${positionStyle}">
  ${buttonsHtml}
  ${titleHtml}
</div>`
}
```
  </action>
  <verify>grep "case 'tooltip'" src/services/export/htmlGenerator.ts && grep "case 'windowchrome'" src/services/export/htmlGenerator.ts</verify>
  <done>HTML generator handles tooltip, spacers, and window chrome with proper data attributes</done>
</task>

<task type="auto">
  <name>Task 2: Add CSS generation for new container elements</name>
  <files>src/services/export/cssGenerator.ts</files>
  <action>
Update src/services/export/cssGenerator.ts to handle the 4 new container element types.

Add imports at top:
```typescript
import type { TooltipElementConfig, HorizontalSpacerElementConfig, VerticalSpacerElementConfig, WindowChromeElementConfig } from '../../types/elements/containers'
```

Add cases in generateElementCSS switch statement:

```typescript
case 'tooltip': {
  const tooltipEl = element as TooltipElementConfig
  // Tooltip trigger area styling (invisible in production)
  // Actual tooltip styling defined in global CSS below
  return `${selector} {
  /* Tooltip Trigger Area - Invisible in export */
  background: transparent;
  cursor: help;
}

${selector}:hover + .tooltip-popup,
${selector}:focus + .tooltip-popup {
  opacity: 1;
  visibility: visible;
}`
}

case 'horizontalspacer': {
  const spacerEl = element as HorizontalSpacerElementConfig
  const flexStyles = spacerEl.mode === 'flexible'
    ? `flex-grow: ${spacerEl.flexGrow};
  flex-shrink: 1;
  min-width: ${spacerEl.minWidth}px;
  max-width: ${spacerEl.maxWidth}px;`
    : `width: ${spacerEl.width}px;
  flex-shrink: 0;`

  return `${selector} {
  /* Horizontal Spacer - Invisible layout element */
  ${flexStyles}
  height: 100%;
}`
}

case 'verticalspacer': {
  const spacerEl = element as VerticalSpacerElementConfig
  const flexStyles = spacerEl.mode === 'flexible'
    ? `flex-grow: ${spacerEl.flexGrow};
  flex-shrink: 1;
  min-height: ${spacerEl.minHeight}px;
  max-height: ${spacerEl.maxHeight}px;`
    : `height: ${spacerEl.height}px;
  flex-shrink: 0;`

  return `${selector} {
  /* Vertical Spacer - Invisible layout element */
  ${flexStyles}
  width: 100%;
}`
}

case 'windowchrome': {
  const chromeEl = element as WindowChromeElementConfig
  const buttonsPosition = chromeEl.buttonStyle === 'macos' ? 'flex-start' : 'flex-end'
  const borderRadius = chromeEl.buttonStyle === 'macos' ? '8px 8px 0 0' : '0'

  // macOS button colors
  const macosButtonCSS = chromeEl.buttonStyle === 'macos' ? `
${selector} .macos-buttons {
  display: flex;
  gap: 8px;
  padding-left: 12px;
}

${selector} .macos-buttons .window-button {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: 1px solid rgba(0,0,0,0.15);
}

${selector} .macos-buttons .close {
  background-color: #ff5f56;
}

${selector} .macos-buttons .minimize {
  background-color: #ffbd2e;
}

${selector} .macos-buttons .maximize {
  background-color: #27c93f;
}` : ''

  // Windows button styles
  const windowsButtonCSS = chromeEl.buttonStyle === 'windows' ? `
${selector} .windows-buttons {
  display: flex;
  gap: 0;
}

${selector} .windows-buttons .window-button {
  width: 46px;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  color: ${chromeEl.titleColor};
  transition: none;
}

${selector} .windows-buttons .window-button:hover {
  background-color: rgba(0,0,0,0.1);
}

${selector} .windows-buttons .close:hover {
  background-color: #e81123;
  color: white;
}` : ''

  // Neutral button styles
  const neutralButtonCSS = chromeEl.buttonStyle === 'neutral' ? `
${selector} .neutral-buttons {
  display: flex;
  gap: 8px;
  padding-right: 12px;
}

${selector} .neutral-buttons .window-button {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background-color: #6b7280;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  transition: none;
}

${selector} .neutral-buttons .window-button:hover {
  background-color: #4b5563;
}` : ''

  return `${selector} {
  /* Window Chrome - Title Bar */
  background-color: ${chromeEl.backgroundColor};
  border-radius: ${borderRadius};
  display: flex;
  align-items: center;
  justify-content: space-between;
  user-select: none;
  -webkit-app-region: drag;
}

${selector} .window-title {
  flex: 1;
  text-align: center;
  font-size: ${chromeEl.titleFontSize}px;
  color: ${chromeEl.titleColor};
  font-family: Inter, system-ui, sans-serif;
  font-weight: 500;
  pointer-events: none;
}

${selector} .window-buttons {
  -webkit-app-region: no-drag;
}
${macosButtonCSS}
${windowsButtonCSS}
${neutralButtonCSS}`
}
```

Also add global tooltip popup CSS in the generateGlobalCSS function (or equivalent):

```css
/* Global Tooltip Popup Styles */
.tooltip-popup {
  position: fixed;
  z-index: 9999;
  padding: 8px;
  border-radius: 4px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
  pointer-events: none;
  opacity: 0;
  visibility: hidden;
  transition: opacity 150ms ease-out, visibility 150ms ease-out;
}

.tooltip-arrow {
  position: absolute;
  width: 0;
  height: 0;
  border-style: solid;
}
```
  </action>
  <verify>grep "case 'tooltip'" src/services/export/cssGenerator.ts && grep "case 'windowchrome'" src/services/export/cssGenerator.ts</verify>
  <done>CSS generator handles tooltip, spacers, and window chrome with proper styling</done>
</task>

<task type="auto">
  <name>Task 3: Verify export integration and test</name>
  <files>src/services/export/htmlGenerator.ts, src/services/export/cssGenerator.ts</files>
  <action>
Ensure all TypeScript compiles without errors and verify switch cases are complete:

1. Run TypeScript check: `npx tsc --noEmit`

2. Verify all 4 new element types are handled in both generators:
   ```bash
   grep -E "case 'tooltip':|case 'horizontalspacer':|case 'verticalspacer':|case 'windowchrome':" src/services/export/htmlGenerator.ts
   grep -E "case 'tooltip':|case 'horizontalspacer':|case 'verticalspacer':|case 'windowchrome':" src/services/export/cssGenerator.ts
   ```

3. Ensure imports are correct in both files for the container types

4. Test that the app builds: `npm run build`

Note: The export code generates:
- **Tooltip**: Trigger div with data attributes for JavaScript-based tooltip display in JUCE
- **Spacers**: Invisible divs with flex properties for responsive layouts
- **Window Chrome**: Title bar with button style CSS and `-webkit-app-region: drag` for JUCE window dragging
  </action>
  <verify>
1. npx tsc --noEmit passes
2. npm run build succeeds
3. All 4 element types present in both htmlGenerator.ts and cssGenerator.ts
  </verify>
  <done>Export support complete for all 4 new container element types</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - TypeScript compiles without errors
2. `npm run build` - Build succeeds
3. htmlGenerator.ts includes cases for tooltip, horizontalspacer, verticalspacer, windowchrome
4. cssGenerator.ts includes cases for tooltip, horizontalspacer, verticalspacer, windowchrome
5. Tooltip exports with data attributes for JavaScript tooltip display
6. Spacers export with flex properties based on mode (fixed/flexible)
7. Window Chrome exports with button style CSS and drag region attribute
8. Export preview shows new elements correctly (visual check)
</verification>

<success_criteria>
- All 4 new element types export correctly to HTML
- All 4 new element types have proper CSS styling
- Tooltip has data attributes for position, delay, content, styling
- Spacers have appropriate flex-grow or fixed dimension styles
- Window Chrome has button style CSS (macOS traffic lights, Windows icons, neutral circles)
- Window Chrome title bar has `-webkit-app-region: drag` for JUCE window dragging
- Button click areas have `-webkit-app-region: no-drag`
- No TypeScript errors in export code
- Build succeeds with all new export code
</success_criteria>

<output>
After completion, create `.planning/phases/27-containers-polish/27-04-SUMMARY.md`
</output>
