---
phase: 08-code-export
plan: 05
type: execute
wave: 4
depends_on: ["08-04"]
files_modified:
  - src/components/export/ExportPanel.tsx
  - src/components/Layout/RightPanel.tsx
autonomous: true

must_haves:
  truths:
    - "User can trigger JUCE export from UI button"
    - "User can trigger HTML preview export from UI button"
    - "Export errors display in panel with clear messages"
    - "Export success provides confirmation feedback"
  artifacts:
    - path: "src/components/export/ExportPanel.tsx"
      provides: "Export UI with JUCE and Preview buttons"
      exports: ["ExportPanel"]
    - path: "src/components/Layout/RightPanel.tsx"
      provides: "Updated layout including ExportPanel"
      contains: "ExportPanel"
  key_links:
    - from: "src/components/export/ExportPanel.tsx"
      to: "src/services/export"
      via: "Calls export functions"
      pattern: "import.*exportJUCEBundle.*exportHTMLPreview.*from"
    - from: "src/components/export/ExportPanel.tsx"
      to: "src/store"
      via: "Gets elements and canvas state"
      pattern: "useStore"
---

<objective>
Create the Export Panel UI component and integrate it into the right panel.

Purpose: Provide user-facing interface for triggering exports with clear feedback on success/failure.
Output: ExportPanel.tsx component with two export buttons, integrated into RightPanel.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-code-export/08-CONTEXT.md
@src/components/project/SaveLoadPanel.tsx (reference for styling pattern)
@src/components/Layout/RightPanel.tsx
@src/store/index.ts
@src/services/export/index.ts (from Plan 04)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExportPanel component</name>
  <files>src/components/export/ExportPanel.tsx</files>
  <action>
Create `src/components/export/ExportPanel.tsx` with export UI:

1. **Component structure:**
```typescript
import { useState } from 'react'
import { useStore } from '../../store'
import { exportJUCEBundle, exportHTMLPreview, validateForExport } from '../../services/export'
```

2. **State:**
```typescript
const [isExporting, setIsExporting] = useState(false)
const [error, setError] = useState<string | null>(null)
const [lastExport, setLastExport] = useState<string | null>(null)  // Success message
```

3. **Get state from store:**
```typescript
const elements = useStore(state => state.elements)
const canvasWidth = useStore(state => state.canvasWidth)
const canvasHeight = useStore(state => state.canvasHeight)
const backgroundColor = useStore(state => state.backgroundColor)
```

4. **Export handlers:**
```typescript
const handleExportJUCE = async () => {
  setIsExporting(true)
  setError(null)
  setLastExport(null)

  const result = await exportJUCEBundle({
    elements,
    canvasWidth,
    canvasHeight,
    backgroundColor
  })

  setIsExporting(false)

  if (result.success) {
    setLastExport('JUCE bundle exported successfully')
  } else {
    setError(result.error)
  }
}

const handleExportPreview = async () => {
  // Similar to above but calls exportHTMLPreview
}
```

5. **Pre-export validation display:**
   - Before export buttons, show validation status
   - Call validateForExport(elements) on render
   - If invalid, show warning icon + message
   - Still allow export (validation runs again and blocks if needed)

6. **UI Layout:**
```tsx
<div className="bg-gray-800 rounded-lg p-4">
  <div className="flex items-center justify-between mb-3">
    <h3 className="text-sm font-medium text-gray-200">Export</h3>
    {/* Collapse button if desired */}
  </div>

  {/* Validation warnings (if any) */}
  {!validationResult.valid && (
    <div className="mb-3 p-2 bg-yellow-900/30 border border-yellow-700 rounded text-xs text-yellow-200">
      <span className="font-medium">Warnings:</span>
      <ul className="mt-1 list-disc list-inside">
        {validationResult.errors.map(err => (
          <li key={err.elementId + err.field}>{err.message}</li>
        ))}
      </ul>
    </div>
  )}

  {/* Export buttons */}
  <div className="space-y-2">
    <button
      onClick={handleExportJUCE}
      disabled={isExporting}
      className="w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white text-sm font-medium rounded transition-colors"
    >
      {isExporting ? 'Exporting...' : 'Export JUCE Bundle'}
    </button>

    <button
      onClick={handleExportPreview}
      disabled={isExporting}
      className="w-full px-3 py-2 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-700 text-white text-sm font-medium rounded transition-colors"
    >
      {isExporting ? 'Exporting...' : 'Export HTML Preview'}
    </button>
  </div>

  {/* Error display */}
  {error && (
    <div className="mt-3 p-2 bg-red-900/30 border border-red-700 rounded">
      <div className="flex justify-between items-start">
        <span className="text-xs text-red-200">{error}</span>
        <button onClick={() => setError(null)} className="text-red-400 hover:text-red-300">
          Ã—
        </button>
      </div>
    </div>
  )}

  {/* Success message */}
  {lastExport && (
    <div className="mt-3 p-2 bg-green-900/30 border border-green-700 rounded">
      <span className="text-xs text-green-200">{lastExport}</span>
    </div>
  )}

  {/* Info text */}
  <p className="mt-3 text-xs text-gray-400">
    JUCE Bundle: HTML/CSS/JS + C++ snippets<br/>
    HTML Preview: Standalone with mock values
  </p>
</div>
```

7. **Styling:**
   - Match SaveLoadPanel styling pattern (bg-gray-800, rounded-lg, etc.)
   - Primary button (JUCE) in blue, secondary (Preview) in gray
   - Disabled state when exporting
  </action>
  <verify>
Component renders without errors:
- Both buttons visible
- Clicking triggers export (may show file save dialog)
- Error/success states display correctly
- TypeScript compilation passes: `npx tsc --noEmit`
  </verify>
  <done>ExportPanel provides complete export UI with feedback</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ExportPanel into RightPanel</name>
  <files>src/components/Layout/RightPanel.tsx</files>
  <action>
Update `src/components/Layout/RightPanel.tsx` to include ExportPanel:

1. **Import ExportPanel:**
```typescript
import { ExportPanel } from '../export/ExportPanel'
```

2. **Add ExportPanel to layout:**
   - Position after SaveLoadPanel, before PropertyPanel
   - Order: SaveLoadPanel -> ExportPanel -> PropertyPanel -> ...

3. **Layout structure:**
```tsx
<div className="h-full flex flex-col overflow-hidden">
  {/* Project operations */}
  <div className="p-4 border-b border-gray-700">
    <SaveLoadPanel />
  </div>

  {/* Export operations */}
  <div className="p-4 border-b border-gray-700">
    <ExportPanel />
  </div>

  {/* Property panel (scrollable) */}
  <div className="flex-1 overflow-y-auto p-4">
    <PropertyPanel />
    {/* ... rest */}
  </div>
</div>
```

4. **Create index.ts for export components (if not exists):**
   Create `src/components/export/index.ts`:
```typescript
export { ExportPanel } from './ExportPanel'
```
  </action>
  <verify>
RightPanel shows ExportPanel:
- Export section visible below Save/Load
- Both export buttons functional
- Layout doesn't overflow
- `npm run dev` shows working UI
  </verify>
  <done>ExportPanel integrated into application layout</done>
</task>

</tasks>

<verification>
1. `src/components/export/ExportPanel.tsx` exists and exports ExportPanel
2. ExportPanel visible in RightPanel below SaveLoadPanel
3. "Export JUCE Bundle" button triggers export with file save dialog
4. "Export HTML Preview" button triggers preview export
5. Validation warnings display before export
6. Error messages display with dismiss button
7. Success message displays after successful export
8. `npm run dev` shows working application
9. `npm run build` completes without errors
</verification>

<success_criteria>
- User can trigger JUCE export from UI button
- User can trigger HTML preview export from UI button
- Validation warnings shown before export (if any)
- Export errors display clearly with option to dismiss
- Export success provides confirmation feedback
- UI matches existing panel styling (SaveLoadPanel pattern)
- Disabled state during export prevents double-clicks
</success_criteria>

<output>
After completion, create `.planning/phases/08-code-export/08-05-SUMMARY.md`
</output>
