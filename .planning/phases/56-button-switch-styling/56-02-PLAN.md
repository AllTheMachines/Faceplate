---
phase: 56-button-switch-styling
plan: 02
type: execute
wave: 2
depends_on: ["56-01"]
files_modified:
  - src/components/elements/renderers/controls/ButtonRenderer.tsx
  - src/components/elements/renderers/controls/IconButtonRenderer.tsx
  - src/components/Properties/ButtonProperties.tsx
  - src/components/Properties/IconButtonProperties.tsx
autonomous: true

must_haves:
  truths:
    - "Button renders with normal/pressed SVG layers that swap on click"
    - "Icon Button renders with SVG icon layer that can be colored"
    - "Style selector appears in Button and Icon Button property panels"
  artifacts:
    - path: "src/components/elements/renderers/controls/ButtonRenderer.tsx"
      provides: "StyledButtonRenderer with state layer swapping"
      contains: "StyledButtonRenderer"
    - path: "src/components/elements/renderers/controls/IconButtonRenderer.tsx"
      provides: "StyledIconButtonRenderer with colorable icon"
      contains: "StyledIconButtonRenderer"
  key_links:
    - from: "ButtonRenderer.tsx"
      to: "extractElementLayer"
      via: "import"
      pattern: "import.*extractElementLayer"
    - from: "ButtonProperties.tsx"
      to: "getStylesByCategory"
      via: "store selector"
      pattern: "getStylesByCategory.*button"
---

<objective>
Add SVG styling support to Button and Icon Button elements with state layer swapping.

Purpose: Enable user-customizable button artwork with normal/pressed state visuals.
Output: StyledButtonRenderer, StyledIconButtonRenderer, updated property panels with style selectors.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/56-button-switch-styling/56-CONTEXT.md
@.planning/phases/56-button-switch-styling/56-RESEARCH.md
@.planning/phases/56-button-switch-styling/56-01-SUMMARY.md
@src/components/elements/renderers/controls/SliderRenderer.tsx (pattern reference)
@src/components/Properties/SliderProperties.tsx (pattern reference)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add StyledButtonRenderer with normal/pressed state swapping</name>
  <files>src/components/elements/renderers/controls/ButtonRenderer.tsx</files>
  <action>
Follow the SliderRenderer pattern to add SVG styling support:

1. Add imports at top:
```typescript
import { useMemo } from 'react'
import { useStore } from '../../../../store'
import { SafeSVG } from '../../../SafeSVG'
import { extractElementLayer } from '../../../../services/elementLayers'
import { applyAllColorOverrides } from '../../../../services/knobLayers'
```

2. Rename current ButtonRenderer to DefaultButtonRenderer (keep ALL existing code unchanged)

3. Create new StyledButtonRenderer:
```typescript
function StyledButtonRenderer({ config }: ButtonRendererProps) {
  const getElementStyle = useStore((state) => state.getElementStyle)
  const style = config.styleId ? getElementStyle(config.styleId) : undefined

  // Category validation
  if (style && style.category !== 'button') {
    console.warn('Button requires button category style')
    return null
  }

  // Apply color overrides
  const svgContent = useMemo(() => {
    if (!style) return ''
    return applyAllColorOverrides(style.svgContent, style.layers, config.colorOverrides)
  }, [style, config.colorOverrides])

  // Extract layers
  const layers = useMemo(() => {
    if (!style || !svgContent) return null
    return {
      normal: style.layers.normal ? extractElementLayer(svgContent, style.layers.normal) : null,
      pressed: style.layers.pressed ? extractElementLayer(svgContent, style.layers.pressed) : null,
      icon: style.layers.icon ? extractElementLayer(svgContent, style.layers.icon) : null,
      label: style.layers.label ? extractElementLayer(svgContent, style.layers.label) : null,
    }
  }, [style, svgContent])

  // Style not found fallback
  if (!style) {
    return (
      <div style={{
        width: '100%', height: '100%',
        display: 'flex', alignItems: 'center', justifyContent: 'center',
        background: '#374151', borderRadius: '4px',
        color: '#9CA3AF', fontSize: '12px', textAlign: 'center', padding: '8px',
      }}>
        Style not found
      </div>
    )
  }

  return (
    <div style={{ position: 'relative', width: '100%', height: '100%' }}>
      {/* Normal state - visible when NOT pressed */}
      {layers?.normal && (
        <div style={{
          position: 'absolute', inset: 0,
          opacity: config.pressed ? 0 : 1,
          transition: 'none', // Instant swap per CONTEXT.md
        }}>
          <SafeSVG content={layers.normal} style={{ width: '100%', height: '100%' }} />
        </div>
      )}

      {/* Pressed state - visible when pressed */}
      {layers?.pressed && (
        <div style={{
          position: 'absolute', inset: 0,
          opacity: config.pressed ? 1 : 0,
          transition: 'none',
        }}>
          <SafeSVG content={layers.pressed} style={{ width: '100%', height: '100%' }} />
        </div>
      )}

      {/* Icon layer - always visible if present */}
      {layers?.icon && (
        <div style={{ position: 'absolute', inset: 0 }}>
          <SafeSVG content={layers.icon} style={{ width: '100%', height: '100%' }} />
        </div>
      )}

      {/* Label layer OR text label */}
      {layers?.label ? (
        <div style={{ position: 'absolute', inset: 0 }}>
          <SafeSVG content={layers.label} style={{ width: '100%', height: '100%' }} />
        </div>
      ) : config.label && (
        <div style={{
          position: 'absolute', inset: 0,
          display: 'flex', alignItems: 'center', justifyContent: 'center',
          color: config.textColor,
          fontSize: `${config.fontSize}px`,
          fontFamily: config.fontFamily,
          fontWeight: config.fontWeight,
          pointerEvents: 'none',
        }}>
          {config.label}
        </div>
      )}
    </div>
  )
}
```

4. Create main ButtonRenderer that delegates:
```typescript
export function ButtonRenderer({ config }: ButtonRendererProps) {
  if (!config.styleId) {
    return <DefaultButtonRenderer config={config} />
  }
  return <StyledButtonRenderer config={config} />
}
```

IMPORTANT: The ButtonElementConfig type must include styleId and colorOverrides. Check if they exist - if not, they're inherited from base element type. If TypeScript errors occur, the type needs updating in types/elements.ts (add styleId?: string and colorOverrides?: ColorOverrides).
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit`
- Dev server runs without errors: `npm run dev`
- Button renders on canvas (no visual change without styleId)
  </verify>
  <done>Button element supports SVG styling with normal/pressed state swapping</done>
</task>

<task type="auto">
  <name>Task 2: Add StyledIconButtonRenderer + update both property panels</name>
  <files>
    src/components/elements/renderers/controls/IconButtonRenderer.tsx
    src/components/Properties/ButtonProperties.tsx
    src/components/Properties/IconButtonProperties.tsx
  </files>
  <action>
**IconButtonRenderer.tsx:**

1. Add imports at top:
```typescript
import { useMemo } from 'react'
import { SafeSVG } from '../../../SafeSVG'
import { extractElementLayer } from '../../../../services/elementLayers'
import { applyAllColorOverrides } from '../../../../services/knobLayers'
```

2. Rename current IconButtonRenderer to DefaultIconButtonRenderer (keep ALL existing code)

3. Create StyledIconButtonRenderer (similar to Button but icon-focused):
```typescript
function StyledIconButtonRenderer({ config }: IconButtonRendererProps) {
  const getElementStyle = useStore((state) => state.getElementStyle)
  const style = config.styleId ? getElementStyle(config.styleId) : undefined

  if (style && style.category !== 'button') {
    console.warn('IconButton requires button category style')
    return null
  }

  const svgContent = useMemo(() => {
    if (!style) return ''
    return applyAllColorOverrides(style.svgContent, style.layers, config.colorOverrides)
  }, [style, config.colorOverrides])

  const layers = useMemo(() => {
    if (!style || !svgContent) return null
    return {
      normal: style.layers.normal ? extractElementLayer(svgContent, style.layers.normal) : null,
      pressed: style.layers.pressed ? extractElementLayer(svgContent, style.layers.pressed) : null,
      icon: style.layers.icon ? extractElementLayer(svgContent, style.layers.icon) : null,
    }
  }, [style, svgContent])

  if (!style) {
    return (
      <div style={{
        width: '100%', height: '100%',
        display: 'flex', alignItems: 'center', justifyContent: 'center',
        background: '#374151', borderRadius: '4px',
        color: '#9CA3AF', fontSize: '12px', textAlign: 'center', padding: '8px',
      }}>
        Style not found
      </div>
    )
  }

  return (
    <div style={{ position: 'relative', width: '100%', height: '100%' }}>
      {/* Normal state */}
      {layers?.normal && (
        <div style={{
          position: 'absolute', inset: 0,
          opacity: config.pressed ? 0 : 1,
          transition: 'none',
        }}>
          <SafeSVG content={layers.normal} style={{ width: '100%', height: '100%' }} />
        </div>
      )}

      {/* Pressed state */}
      {layers?.pressed && (
        <div style={{
          position: 'absolute', inset: 0,
          opacity: config.pressed ? 1 : 0,
          transition: 'none',
        }}>
          <SafeSVG content={layers.pressed} style={{ width: '100%', height: '100%' }} />
        </div>
      )}

      {/* Icon layer - colorable */}
      {layers?.icon && (
        <div style={{ position: 'absolute', inset: 0 }}>
          <SafeSVG content={layers.icon} style={{ width: '100%', height: '100%' }} />
        </div>
      )}
    </div>
  )
}
```

4. Create delegating IconButtonRenderer:
```typescript
export function IconButtonRenderer({ config }: IconButtonRendererProps) {
  if (!config.styleId) {
    return <DefaultIconButtonRenderer config={config} />
  }
  return <StyledIconButtonRenderer config={config} />
}
```

**ButtonProperties.tsx:**

Add Style section at the top (before Behavior section), following SliderProperties.tsx pattern:

```typescript
import { useLicense } from '../../hooks/useLicense'
import { ButtonLayers } from '../../types/elementStyle'
// ... existing imports

export function ButtonProperties({ element, onUpdate }: ButtonPropertiesProps) {
  const { isPro } = useLicense()
  const getStylesByCategory = useStore((state) => state.getStylesByCategory)
  const getElementStyle = useStore((state) => state.getElementStyle)
  const buttonStyles = getStylesByCategory('button')

  return (
    <>
      {/* Style Section */}
      <PropertySection title="Style">
        <div>
          <label className="block text-xs text-gray-400 mb-1">SVG Style</label>
          <select
            value={element.styleId || ''}
            onChange={(e) => onUpdate({
              styleId: e.target.value || undefined,
              colorOverrides: e.target.value ? element.colorOverrides : undefined
            })}
            className="w-full bg-gray-700 border border-gray-600 text-white rounded px-2 py-1.5 text-sm"
            disabled={!isPro && buttonStyles.length > 0}
          >
            <option value="">Default (CSS)</option>
            {buttonStyles.map(style => (
              <option key={style.id} value={style.id}>{style.name}</option>
            ))}
          </select>
          {!isPro && buttonStyles.length > 0 && (
            <p className="text-xs text-amber-500 mt-1">Pro license required for SVG styles</p>
          )}
        </div>
      </PropertySection>

      {/* Color Overrides - only when SVG style selected */}
      {isPro && element.styleId && (() => {
        const style = getElementStyle(element.styleId)
        if (!style || style.category !== 'button') return null

        const layerNames: Array<keyof ButtonLayers> = ['normal', 'pressed', 'icon', 'label']
        const existingLayers = layerNames.filter((layerName) => style.layers[layerName])

        if (existingLayers.length === 0) return null

        return (
          <PropertySection title="Color Overrides">
            {existingLayers.map((layerName) => (
              <ColorInput
                key={layerName}
                label={layerName.charAt(0).toUpperCase() + layerName.slice(1)}
                value={element.colorOverrides?.[layerName] || ''}
                onChange={(color) => {
                  const newOverrides = { ...element.colorOverrides }
                  if (color) {
                    newOverrides[layerName] = color
                  } else {
                    delete newOverrides[layerName]
                  }
                  onUpdate({ colorOverrides: newOverrides })
                }}
              />
            ))}
            <button
              onClick={() => onUpdate({ colorOverrides: undefined })}
              className="w-full text-left text-sm text-red-400 hover:text-red-300 mt-1"
            >
              Reset to Original Colors
            </button>
          </PropertySection>
        )
      })()}

      {/* ... existing sections (Behavior, Action, Typography, Appearance) ... */}
    </>
  )
}
```

**IconButtonProperties.tsx:**

Add same Style section pattern. The layer names for Icon Button are: `['normal', 'pressed', 'icon']`
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit`
- Dev server runs: `npm run dev`
- Button and Icon Button property panels show Style dropdown
  </verify>
  <done>Icon Button supports SVG styling, both Button and Icon Button property panels have style selectors</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Dev server starts: `npm run dev`
3. Place a Button on canvas, verify it renders (default CSS style)
4. Place an Icon Button on canvas, verify it renders
5. Check property panels show "Style" section (even if no styles imported yet)
</verification>

<success_criteria>
1. Button renders with normal/pressed SVG layers when style applied
2. Icon Button renders with normal/pressed + colorable icon when style applied
3. Both elements still work with default CSS when no styleId set
4. Property panels show SVG Style dropdown
5. Color override section appears when style selected
6. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/56-button-switch-styling/56-02-SUMMARY.md`
</output>
