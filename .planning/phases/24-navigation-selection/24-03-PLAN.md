---
phase: 24-navigation-selection
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/elements/controls.ts
  - src/components/elements/renderers/controls/TabBarRenderer.tsx
  - src/components/elements/renderers/controls/TagSelectorRenderer.tsx
  - src/components/elements/renderers/controls/index.ts
  - src/components/elements/renderers/index.ts
autonomous: true

must_haves:
  truths:
    - "Tab Bar renders configurable tabs with icon, text, or both per tab"
    - "Tab Bar emits data-active-tab attribute for JUCE integration"
    - "Tab Bar supports arrow key navigation between tabs"
    - "Tag Selector shows chips with X button to remove tags"
    - "Tag Selector allows adding tags from available options"
  artifacts:
    - path: "src/types/elements/controls.ts"
      provides: "TabBarElementConfig and TagSelectorElementConfig types"
      contains: "TabBarElementConfig|TagSelectorElementConfig"
    - path: "src/components/elements/renderers/controls/TabBarRenderer.tsx"
      provides: "Tab bar with configurable tabs"
      exports: ["TabBarRenderer"]
    - path: "src/components/elements/renderers/controls/TagSelectorRenderer.tsx"
      provides: "Tag selector with chip removal"
      exports: ["TagSelectorRenderer"]
  key_links:
    - from: "TabBarRenderer.tsx"
      to: "controls.ts"
      via: "type import"
      pattern: "import.*TabBarElementConfig"
    - from: "TabBarRenderer.tsx"
      to: "data-active-tab"
      via: "data attribute"
      pattern: "data-active-tab"
---

<objective>
Create type definitions and renderers for Tab Bar and Tag Selector - selection and navigation UI patterns.

Purpose: Tab Bar enables page switching in multi-page plugin UIs with both data-attribute and callback support for JUCE integration. Tag Selector provides tag-based filtering with chip UI.

Output: Two new element types with renderers that implement proper keyboard navigation and JUCE integration patterns per CONTEXT.md decisions.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-navigation-selection/24-CONTEXT.md
@.planning/phases/24-navigation-selection/24-RESEARCH.md
@src/types/elements/controls.ts
@src/utils/builtInIcons.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Tab Bar and Tag Selector type definitions</name>
  <files>src/types/elements/controls.ts</files>
  <action>
Add TabBarElementConfig and TagSelectorElementConfig interfaces to controls.ts.

**TabConfig type (for individual tabs):**
```typescript
export interface TabConfig {
  id: string
  label?: string
  icon?: BuiltInIcon
  showLabel: boolean
  showIcon: boolean
}
```

**TabBarElementConfig:**
```typescript
export interface TabBarElementConfig extends BaseElementConfig {
  type: 'tabbar'

  // Tab configuration
  tabs: TabConfig[]
  activeTabIndex: number

  // Layout
  orientation: 'horizontal' | 'vertical'
  tabHeight: number // Height of tabs in px (configurable per CONTEXT.md)

  // Visual style
  backgroundColor: string
  activeTabColor: string
  inactiveTabColor: string
  textColor: string
  activeTextColor: string
  borderColor: string

  // Active indicator style
  indicatorStyle: 'background' | 'underline' | 'accent-bar'
  indicatorColor: string
}
```

**Tag type (for individual tags):**
```typescript
export interface Tag {
  id: string
  label: string
}
```

**TagSelectorElementConfig:**
```typescript
export interface TagSelectorElementConfig extends BaseElementConfig {
  type: 'tagselector'

  // Available and selected tags
  availableTags: Tag[]
  selectedTags: Tag[]

  // Visual style
  chipBackgroundColor: string
  chipTextColor: string
  chipBorderRadius: number
  removeButtonColor: string

  // Input for adding tags
  showInput: boolean
  inputPlaceholder: string
  inputBackgroundColor: string
  inputTextColor: string
  inputBorderColor: string
}
```

Add to ControlElement union type.

Add type guards:
```typescript
export function isTabBar(element: { type: string }): element is TabBarElementConfig {
  return element.type === 'tabbar'
}

export function isTagSelector(element: { type: string }): element is TagSelectorElementConfig {
  return element.type === 'tagselector'
}
```

Add factory functions:
```typescript
export function createTabBar(overrides?: Partial<TabBarElementConfig>): TabBarElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'tabbar',
    name: 'Tab Bar',
    x: 0,
    y: 0,
    width: 300,
    height: 40,
    rotation: 0,
    zIndex: 0,
    locked: false,
    visible: true,
    tabs: [
      { id: '1', label: 'Tab 1', showLabel: true, showIcon: false },
      { id: '2', label: 'Tab 2', showLabel: true, showIcon: false },
      { id: '3', label: 'Tab 3', showLabel: true, showIcon: false },
    ],
    activeTabIndex: 0,
    orientation: 'horizontal',
    tabHeight: 40,
    backgroundColor: '#1f2937',
    activeTabColor: '#374151',
    inactiveTabColor: 'transparent',
    textColor: '#9ca3af',
    activeTextColor: '#ffffff',
    borderColor: '#374151',
    indicatorStyle: 'background',
    indicatorColor: '#3b82f6',
    ...overrides,
  }
}

export function createTagSelector(overrides?: Partial<TagSelectorElementConfig>): TagSelectorElementConfig {
  return {
    id: crypto.randomUUID(),
    type: 'tagselector',
    name: 'Tag Selector',
    x: 0,
    y: 0,
    width: 250,
    height: 80,
    rotation: 0,
    zIndex: 0,
    locked: false,
    visible: true,
    availableTags: [
      { id: '1', label: 'Synth' },
      { id: '2', label: 'Bass' },
      { id: '3', label: 'Lead' },
      { id: '4', label: 'Pad' },
      { id: '5', label: 'FX' },
    ],
    selectedTags: [
      { id: '1', label: 'Synth' },
      { id: '3', label: 'Lead' },
    ],
    chipBackgroundColor: '#374151',
    chipTextColor: '#ffffff',
    chipBorderRadius: 4,
    removeButtonColor: '#9ca3af',
    showInput: true,
    inputPlaceholder: 'Add tag...',
    inputBackgroundColor: '#1f2937',
    inputTextColor: '#ffffff',
    inputBorderColor: '#374151',
    ...overrides,
  }
}
```
  </action>
  <verify>grep -c "TabBarElementConfig\|TagSelectorElementConfig" src/types/elements/controls.ts shows 2+ matches</verify>
  <done>TabBarElementConfig and TagSelectorElementConfig types added with type guards and factory functions</done>
</task>

<task type="auto">
  <name>Task 2: Create TabBar and TagSelector renderers</name>
  <files>
    src/components/elements/renderers/controls/TabBarRenderer.tsx
    src/components/elements/renderers/controls/TagSelectorRenderer.tsx
    src/components/elements/renderers/controls/index.ts
  </files>
  <action>
**TabBarRenderer.tsx:**
Tab bar with arrow key navigation, data-active-tab attribute for JUCE. Tabs configurable per tab (icon, text, or both).

```typescript
import React, { useState } from 'react'
import { TabBarElementConfig } from '../../../../types/elements/controls'
import { getBuiltInIconSVG } from '../../../../utils/builtInIcons'

interface TabBarRendererProps {
  config: TabBarElementConfig
}

export function TabBarRenderer({ config }: TabBarRendererProps) {
  const [activeIndex, setActiveIndex] = useState(config.activeTabIndex)
  const isHorizontal = config.orientation === 'horizontal'

  const handleKeyDown = (e: React.KeyboardEvent, index: number) => {
    let newIndex = index

    if (isHorizontal) {
      if (e.key === 'ArrowRight') newIndex = (index + 1) % config.tabs.length
      else if (e.key === 'ArrowLeft') newIndex = (index - 1 + config.tabs.length) % config.tabs.length
    } else {
      if (e.key === 'ArrowDown') newIndex = (index + 1) % config.tabs.length
      else if (e.key === 'ArrowUp') newIndex = (index - 1 + config.tabs.length) % config.tabs.length
    }

    if (newIndex !== index) {
      e.preventDefault()
      setActiveIndex(newIndex)
    }
  }

  return (
    <div
      role="tablist"
      data-active-tab={activeIndex}
      style={{
        display: 'flex',
        flexDirection: isHorizontal ? 'row' : 'column',
        width: config.width,
        height: config.height,
        backgroundColor: config.backgroundColor,
        borderRadius: 4,
        overflow: 'hidden',
      }}
    >
      {config.tabs.map((tab, index) => {
        const isActive = index === activeIndex
        const iconSvg = tab.showIcon && tab.icon ? getBuiltInIconSVG(tab.icon) : null

        return (
          <button
            key={tab.id}
            role="tab"
            aria-selected={isActive}
            aria-controls={`panel-${tab.id}`}
            tabIndex={isActive ? 0 : -1}
            onClick={() => setActiveIndex(index)}
            onKeyDown={(e) => handleKeyDown(e, index)}
            style={{
              flex: 1,
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              gap: 6,
              height: isHorizontal ? '100%' : config.tabHeight,
              padding: '0 12px',
              border: 'none',
              backgroundColor: isActive
                ? config.indicatorStyle === 'background'
                  ? config.activeTabColor
                  : config.inactiveTabColor
                : config.inactiveTabColor,
              color: isActive ? config.activeTextColor : config.textColor,
              cursor: 'pointer',
              position: 'relative',
              transition: 'none',
            }}
          >
            {/* Underline/accent-bar indicator */}
            {isActive && config.indicatorStyle === 'underline' && (
              <div
                style={{
                  position: 'absolute',
                  bottom: 0,
                  left: 0,
                  right: 0,
                  height: 2,
                  backgroundColor: config.indicatorColor,
                }}
              />
            )}
            {isActive && config.indicatorStyle === 'accent-bar' && (
              <div
                style={{
                  position: 'absolute',
                  left: 0,
                  top: '25%',
                  bottom: '25%',
                  width: 3,
                  backgroundColor: config.indicatorColor,
                  borderRadius: 2,
                }}
              />
            )}

            {/* Icon */}
            {tab.showIcon && iconSvg && (
              <span
                dangerouslySetInnerHTML={{ __html: iconSvg }}
                style={{
                  width: 16,
                  height: 16,
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                }}
              />
            )}

            {/* Label */}
            {tab.showLabel && tab.label && (
              <span style={{ fontSize: 13 }}>{tab.label}</span>
            )}
          </button>
        )
      })}
    </div>
  )
}
```

**TagSelectorRenderer.tsx:**
Tag selector with chips that have X button to remove. Shows available tags to add.

```typescript
import React, { useState, useRef, useEffect } from 'react'
import { TagSelectorElementConfig, Tag } from '../../../../types/elements/controls'

interface TagSelectorRendererProps {
  config: TagSelectorElementConfig
}

export function TagSelectorRenderer({ config }: TagSelectorRendererProps) {
  const [selectedTags, setSelectedTags] = useState<Tag[]>(config.selectedTags)
  const [inputValue, setInputValue] = useState('')
  const [showDropdown, setShowDropdown] = useState(false)
  const containerRef = useRef<HTMLDivElement>(null)

  const availableToAdd = config.availableTags.filter(
    tag => !selectedTags.some(s => s.id === tag.id)
  )

  const filteredAvailable = inputValue
    ? availableToAdd.filter(tag =>
        tag.label.toLowerCase().includes(inputValue.toLowerCase())
      )
    : availableToAdd

  // Click-outside handler
  useEffect(() => {
    if (!showDropdown) return

    const handleClickOutside = (e: MouseEvent) => {
      if (containerRef.current && !containerRef.current.contains(e.target as Node)) {
        setShowDropdown(false)
      }
    }

    document.addEventListener('mousedown', handleClickOutside, true)
    return () => document.removeEventListener('mousedown', handleClickOutside, true)
  }, [showDropdown])

  const removeTag = (tagId: string) => {
    setSelectedTags(prev => prev.filter(t => t.id !== tagId))
  }

  const addTag = (tag: Tag) => {
    setSelectedTags(prev => [...prev, tag])
    setInputValue('')
    setShowDropdown(false)
  }

  return (
    <div
      ref={containerRef}
      role="list"
      aria-label="Selected tags"
      style={{
        width: config.width,
        height: config.height,
        display: 'flex',
        flexDirection: 'column',
        gap: 8,
      }}
    >
      {/* Selected tags */}
      <div
        style={{
          display: 'flex',
          flexWrap: 'wrap',
          gap: 4,
          flex: 1,
          alignContent: 'flex-start',
        }}
      >
        {selectedTags.map(tag => (
          <div
            key={tag.id}
            role="listitem"
            style={{
              display: 'inline-flex',
              alignItems: 'center',
              padding: '4px 8px',
              backgroundColor: config.chipBackgroundColor,
              borderRadius: config.chipBorderRadius,
              color: config.chipTextColor,
              fontSize: 12,
            }}
          >
            <span>{tag.label}</span>
            <button
              onClick={() => removeTag(tag.id)}
              aria-label={`Remove ${tag.label}`}
              style={{
                marginLeft: 6,
                background: 'transparent',
                border: 'none',
                cursor: 'pointer',
                color: config.removeButtonColor,
                padding: 0,
                fontSize: 14,
                lineHeight: 1,
              }}
            >
              &times;
            </button>
          </div>
        ))}
      </div>

      {/* Input for adding tags */}
      {config.showInput && (
        <div style={{ position: 'relative' }}>
          <input
            type="text"
            value={inputValue}
            placeholder={config.inputPlaceholder}
            onChange={e => setInputValue(e.target.value)}
            onFocus={() => setShowDropdown(true)}
            style={{
              width: '100%',
              padding: '6px 8px',
              backgroundColor: config.inputBackgroundColor,
              color: config.inputTextColor,
              border: `1px solid ${config.inputBorderColor}`,
              borderRadius: config.chipBorderRadius,
              boxSizing: 'border-box',
            }}
          />

          {/* Dropdown for available tags */}
          {showDropdown && filteredAvailable.length > 0 && (
            <div
              style={{
                position: 'absolute',
                top: '100%',
                left: 0,
                right: 0,
                backgroundColor: config.inputBackgroundColor,
                border: `1px solid ${config.inputBorderColor}`,
                borderRadius: config.chipBorderRadius,
                marginTop: 4,
                maxHeight: 120,
                overflowY: 'auto',
                zIndex: 1000,
                opacity: 1,
                transition: 'opacity 100ms ease-out',
              }}
            >
              {filteredAvailable.map(tag => (
                <div
                  key={tag.id}
                  onClick={() => addTag(tag)}
                  style={{
                    padding: '6px 8px',
                    cursor: 'pointer',
                    color: config.inputTextColor,
                    fontSize: 12,
                  }}
                >
                  {tag.label}
                </div>
              ))}
            </div>
          )}
        </div>
      )}
    </div>
  )
}
```

**Update controls/index.ts:**
Add exports for both renderers.
  </action>
  <verify>ls src/components/elements/renderers/controls/TabBarRenderer.tsx src/components/elements/renderers/controls/TagSelectorRenderer.tsx both exist</verify>
  <done>TabBarRenderer and TagSelectorRenderer created with proper keyboard navigation and JUCE integration</done>
</task>

<task type="auto">
  <name>Task 3: Register renderers in registry</name>
  <files>src/components/elements/renderers/index.ts</files>
  <action>
Update the renderer registry to include Tab Bar and Tag Selector renderers.

1. Add imports from controls:
```typescript
import {
  // ... existing imports ...
  TabBarRenderer,
  TagSelectorRenderer,
} from './controls'
```

2. Add to rendererRegistry Map (in Controls section):
```typescript
['tabbar', TabBarRenderer as RendererComponent],
['tagselector', TagSelectorRenderer as RendererComponent],
```

3. Add to re-exports:
```typescript
export {
  // ... existing exports ...
  TabBarRenderer,
  TagSelectorRenderer,
  // ...
}
```
  </action>
  <verify>grep -c "tabbar\|tagselector" src/components/elements/renderers/index.ts shows 4+ matches</verify>
  <done>TabBar and TagSelector renderers registered in rendererRegistry</done>
</task>

</tasks>

<verification>
1. `grep "TabBarElementConfig" src/types/elements/controls.ts` - Type exists
2. `grep "TagSelectorElementConfig" src/types/elements/controls.ts` - Type exists
3. `ls src/components/elements/renderers/controls/TabBarRenderer.tsx` - File exists
4. `ls src/components/elements/renderers/controls/TagSelectorRenderer.tsx` - File exists
5. `grep "data-active-tab" src/components/elements/renderers/controls/TabBarRenderer.tsx` - JUCE data attribute present
6. `grep "tabbar\|tagselector" src/components/elements/renderers/index.ts` - Registry entries exist
7. TypeScript compilation: `npx tsc --noEmit`
</verification>

<success_criteria>
- TabBarElementConfig has tabs array with per-tab configuration (icon, text, showLabel, showIcon)
- TabBarElementConfig has data-active-tab attribute output for JUCE integration
- Tab Bar implements arrow key navigation (Left/Right or Up/Down based on orientation)
- TabBarElementConfig supports three indicator styles: background, underline, accent-bar
- TagSelectorElementConfig has availableTags and selectedTags arrays
- Tag Selector shows chips with X button for removal
- Tag Selector shows input with dropdown for adding tags
- Both renderers use transition: none for state changes
- Renderers registered in rendererRegistry
</success_criteria>

<output>
After completion, create `.planning/phases/24-navigation-selection/24-03-SUMMARY.md`
</output>
