---
phase: 43-help-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/help/types.ts
  - src/content/help/styles.ts
  - src/services/helpService.ts
  - src/components/common/HelpButton.tsx
autonomous: true

must_haves:
  truths:
    - "HelpButton component renders a clickable (?) icon"
    - "Clicking HelpButton opens a new browser window"
    - "Help window displays content with dark theme styling"
    - "Blob URLs are cleaned up after window loads"
  artifacts:
    - path: "src/content/help/types.ts"
      provides: "HelpContent interface definition"
      exports: ["HelpContent"]
    - path: "src/content/help/styles.ts"
      provides: "Dark theme CSS for help windows"
      exports: ["HELP_WINDOW_STYLES"]
    - path: "src/services/helpService.ts"
      provides: "Help window management and HTML generation"
      exports: ["openHelpWindow"]
    - path: "src/components/common/HelpButton.tsx"
      provides: "Reusable help button component"
      exports: ["HelpButton"]
  key_links:
    - from: "src/components/common/HelpButton.tsx"
      to: "src/services/helpService.ts"
      via: "openHelpWindow import and onClick call"
      pattern: "openHelpWindow\\(content\\)"
    - from: "src/services/helpService.ts"
      to: "src/content/help/styles.ts"
      via: "HELP_WINDOW_STYLES import"
      pattern: "HELP_WINDOW_STYLES"
---

<objective>
Create the help system foundation: HelpContent types, helpService for window management, dark theme styles, and reusable HelpButton component.

Purpose: Establish the infrastructure needed for contextual help throughout the Properties Panel. This foundation enables all subsequent help content and integration work.

Output:
- HelpContent TypeScript interface for type-safe help content
- helpService with openHelpWindow() that creates dark-themed popup windows
- HelpButton component with (?) icon ready for use in any section header
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/43-help-system/43-RESEARCH.md

# Key existing files
@src/components/Properties/PropertySection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create help content types and styles</name>
  <files>src/content/help/types.ts, src/content/help/styles.ts</files>
  <action>
Create the content/help directory structure and two foundational files:

1. **src/content/help/types.ts** - Define the HelpContent interface:
```typescript
export interface HelpContent {
  title: string
  description: string
  examples?: Array<{
    label: string
    code?: string
    explanation: string
  }>
  relatedTopics?: string[]
}
```

2. **src/content/help/styles.ts** - Create dark theme CSS template matching app colors:
- Background: #1a1a1a (matching Tailwind gray-900)
- Text: #e5e5e5 (gray-200)
- Headings: #ffffff
- Code background: #2d2d2d
- Code text: #60a5fa (blue-400)
- Example sections with left border accent
- Related topics section with subtle background
- Export as `HELP_WINDOW_STYLES` constant string

Refer to research document for complete CSS example. Use system-ui font stack.
  </action>
  <verify>Files exist at src/content/help/types.ts and src/content/help/styles.ts. TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>HelpContent interface exported, HELP_WINDOW_STYLES constant exported with complete dark theme CSS</done>
</task>

<task type="auto">
  <name>Task 2: Create helpService with window management</name>
  <files>src/services/helpService.ts</files>
  <action>
Create helpService.ts with these features:

1. **Import** HelpContent type and HELP_WINDOW_STYLES

2. **escapeHtml(text: string)** - Helper to escape HTML entities safely using DOM methods

3. **generateHelpHTML(content: HelpContent)** - Build complete HTML document:
   - DOCTYPE, html, head with charset and viewport meta
   - Title: `${content.title} - Help`
   - Inline style tag with HELP_WINDOW_STYLES
   - Body with h1 title, p description
   - Conditionally render examples section if content.examples exists
   - Conditionally render related topics if content.relatedTopics exists
   - Use template literals, escape any code content

4. **openWindows Map** - Track open help windows to prevent duplicates (windowKey -> Window)

5. **openHelpWindow(content: HelpContent)** - Main export function:
   - Create windowKey from `help-${content.title}`
   - Check if window already exists and not closed, focus if so
   - Generate HTML, create Blob with type 'text/html'
   - Create blob URL with URL.createObjectURL
   - Open window with: width=700, height=800, scrollbars=yes, resizable=yes, menubar=no, toolbar=no, location=no
   - Track in openWindows Map
   - Add load event listener to revoke blob URL
   - Set up interval to clean up tracking when window closes
   - Handle popup blocked case: revoke URL, log warning, show alert about allowing popups

**Critical**: window.open() must be called synchronously in event handler, not after any async operations.
  </action>
  <verify>File exists at src/services/helpService.ts. TypeScript compiles: `npx tsc --noEmit`. Manual test: import and call openHelpWindow with test content from browser console.</verify>
  <done>helpService exports openHelpWindow function that creates dark-themed help windows with proper cleanup</done>
</task>

<task type="auto">
  <name>Task 3: Create HelpButton component</name>
  <files>src/components/common/HelpButton.tsx</files>
  <action>
Create the common directory if it doesn't exist, then create HelpButton.tsx:

1. **Interface HelpButtonProps**:
   - content: HelpContent (required)
   - className?: string (optional, for custom styling)

2. **HelpButton component**:
   - Import openHelpWindow from helpService
   - Return a button element with:
     - onClick handler calling openHelpWindow(content)
     - Base classes: text-gray-400 hover:text-gray-200 transition-colors
     - Merge with className prop
     - title="Show help"
     - aria-label={`Help for ${content.title}`}
   - SVG icon inside button:
     - w-4 h-4 dimensions
     - Question mark circle icon (see research doc for path)
     - fill="none", stroke="currentColor"
     - strokeWidth={2}

3. **Export** the component as named export

Follow existing component patterns in the codebase.
  </action>
  <verify>File exists at src/components/common/HelpButton.tsx. TypeScript compiles. Component can be imported: `import { HelpButton } from './components/common/HelpButton'`</verify>
  <done>HelpButton component renders accessible (?) button that opens help window when clicked</done>
</task>

</tasks>

<verification>
1. All three directories/files exist:
   - src/content/help/types.ts
   - src/content/help/styles.ts
   - src/services/helpService.ts
   - src/components/common/HelpButton.tsx

2. TypeScript compiles without errors: `npx tsc --noEmit`

3. Manual verification: In browser dev tools console, test:
   ```javascript
   // After importing in a component temporarily
   openHelpWindow({ title: 'Test', description: 'Test description' })
   ```
   Should open dark-themed popup window.
</verification>

<success_criteria>
- HelpContent interface provides type safety for all help content
- HELP_WINDOW_STYLES creates consistent dark theme matching app
- openHelpWindow() successfully opens popup windows without browser blocking
- Blob URLs are properly cleaned up (no memory leaks)
- HelpButton renders accessible (?) icon with proper hover states
- All code follows existing project patterns and TypeScript conventions
</success_criteria>

<output>
After completion, create `.planning/phases/43-help-system/43-01-SUMMARY.md`
</output>
