---
phase: 43-help-system
plan: 04
type: execute
wave: 3
depends_on: ["43-01", "43-02", "43-03"]
files_modified:
  - src/hooks/useHelpShortcut.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Pressing F1 with element selected opens element-specific help"
    - "Pressing F1 with no selection opens general app help"
    - "F1 does not open browser's default help page"
    - "Help window matches dark theme styling"
  artifacts:
    - path: "src/hooks/useHelpShortcut.ts"
      provides: "F1 keyboard shortcut hook"
      exports: ["useHelpShortcut"]
  key_links:
    - from: "src/hooks/useHelpShortcut.ts"
      to: "src/services/helpService.ts"
      via: "openHelpWindow import"
      pattern: "openHelpWindow"
    - from: "src/hooks/useHelpShortcut.ts"
      to: "src/content/help/elements.ts"
      via: "getElementHelp import"
      pattern: "getElementHelp"
    - from: "src/hooks/useHelpShortcut.ts"
      to: "src/content/help/general.ts"
      via: "generalHelp import"
      pattern: "generalHelp"
    - from: "src/App.tsx"
      to: "src/hooks/useHelpShortcut.ts"
      via: "useHelpShortcut hook call"
      pattern: "useHelpShortcut\\(\\)"
---

<objective>
Implement F1 keyboard shortcut to open contextual help for the selected element or general app help.

Purpose: Allow users to quickly access help by pressing F1 anywhere in the app. This completes requirement HELP-06.

Output:
- useHelpShortcut hook using react-hotkeys-hook
- App.tsx integration to enable global F1 shortcut
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/43-help-system/43-RESEARCH.md
@.planning/phases/43-help-system/43-01-SUMMARY.md
@.planning/phases/43-help-system/43-02-SUMMARY.md
@.planning/phases/43-help-system/43-03-SUMMARY.md

# Key existing files
@src/App.tsx
@src/hooks/useHistoryPanel.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useHelpShortcut hook</name>
  <files>src/hooks/useHelpShortcut.ts</files>
  <action>
Create hook using react-hotkeys-hook (already installed v5.2.3):

1. **Imports:**
```typescript
import { useHotkeys } from 'react-hotkeys-hook'
import { useStore } from '../store'
import { openHelpWindow } from '../services/helpService'
import { getElementHelp } from '../content/help/elements'
import { generalHelp } from '../content/help/general'
```

2. **Hook implementation:**
```typescript
export function useHelpShortcut() {
  const selectedIds = useStore(state => state.selectedIds)
  const elements = useStore(state => state.elements)

  useHotkeys('f1', (event) => {
    event.preventDefault() // Prevent browser's default help

    // Get help for currently selected element
    if (selectedIds.length === 1) {
      const element = elements.find(el => el.id === selectedIds[0])
      if (element) {
        const helpContent = getElementHelp(element.type)
        openHelpWindow(helpContent)
        return
      }
    }

    // Multiple selection or no selection - show general help
    openHelpWindow(generalHelp)
  }, {
    preventDefault: true,
    enableOnFormTags: true, // Allow F1 even when inputs are focused
  }, [selectedIds, elements])
}
```

**Key points:**
- Use 'f1' as the key string (lowercase)
- Call event.preventDefault() to stop browser help
- enableOnFormTags allows F1 to work even when typing in text inputs
- Dependency array includes selectedIds and elements for reactivity
- Single selection: show element-specific help
- Multiple selection or no selection: show general app help
  </action>
  <verify>File exists at src/hooks/useHelpShortcut.ts. Hook exports. TypeScript compiles. No runtime errors when imported.</verify>
  <done>useHelpShortcut hook created with F1 handling and proper browser help prevention</done>
</task>

<task type="auto">
  <name>Task 2: Integrate hook into App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Add useHelpShortcut hook to App component:

1. **Add import** at top of file with other hook imports:
```typescript
import { useHelpShortcut } from './hooks/useHelpShortcut'
```

2. **Call hook** inside App component, near other hook calls (after useHistoryPanel, useBeforeUnload):
```typescript
function App() {
  // History panel visibility controlled by Ctrl+Shift+H
  const { isPanelVisible } = useHistoryPanel()

  // Dirty state tracking...
  // ... existing code ...

  // F1 help shortcut
  useHelpShortcut()

  // ... rest of component
}
```

This is a simple two-line change. The hook handles all the keyboard logic internally.
  </action>
  <verify>App.tsx imports and calls useHelpShortcut. Run app, press F1 with no selection - general help opens. Select element, press F1 - element help opens.</verify>
  <done>F1 shortcut active globally in app, opens contextual or general help</done>
</task>

</tasks>

<verification>
1. Run `npm run dev` and open app in browser

2. **Test F1 with no selection:**
   - Don't select any element
   - Press F1
   - General help window should open with "Faceplate - VST3 UI Designer" title
   - Browser's built-in help should NOT open

3. **Test F1 with element selected:**
   - Add a Knob element to canvas
   - Select the Knob
   - Press F1
   - Help window should open with "Knob Element" title
   - Content should be specific to knobs

4. **Test F1 with multiple selection:**
   - Select multiple elements (Shift+click)
   - Press F1
   - General help should open (not element-specific)

5. **Test F1 in form field:**
   - Select an element
   - Click in the Name text input in Properties panel
   - Press F1
   - Should still open help (not browser help, not blocked by input focus)

6. **Test no duplicate windows:**
   - Press F1 multiple times
   - Should focus existing window, not open new ones
</verification>

<success_criteria>
- F1 key opens help window, not browser help
- Element-specific help shown when single element selected
- General help shown when no selection or multiple selection
- F1 works even when text inputs are focused
- No interference with other keyboard shortcuts
</success_criteria>

<output>
After completion, create `.planning/phases/43-help-system/43-04-SUMMARY.md`
</output>
